import{Q as be,K as B,J as we,d as Z,ah as Ae,r as f,m as b,o as Ee,f as $,g as Oe,i as v,N as J,V,j as a,W as Y,k,M as D,Z as Se,aa as $e,p as w,a6 as Ve,a7 as ke,a5 as _e,ad as A,ac as G,aw as Ne,n as Te,I as K}from"./vue-0.0.0-dataease.js";import{l as Fe,x as X,i as Ie,ao as We,P as Be,S as De,h as Ke,t as Pe,w as Ce}from"./index-0.0.0-dataease.js";import{a0 as _,ad as C,aa as ee,A as Re,a1 as Me,e as Le,y as xe}from"./index-0.0.0-dataease2.js";import{b as Ue,g as je,E as He}from"./index-0.0.0-dataease4.js";import{e as qe}from"./lodash-0.0.0-dataease.js";const ze=Fe({valueKey:{type:String,default:"value"},modelValue:{type:[String,Number],default:""},debounce:{type:Number,default:300},placement:{type:X(String),values:["top","top-start","top-end","bottom","bottom-start","bottom-end"],default:"bottom-start"},fetchSuggestions:{type:X([Function,Array]),default:be},popperClass:{type:String,default:""},triggerOnFocus:{type:Boolean,default:!0},selectWhenUnmatched:{type:Boolean,default:!1},hideLoading:{type:Boolean,default:!1},label:{type:String},teleported:Ue.teleported,highlightFirstItem:{type:Boolean,default:!1},fitInputWidth:{type:Boolean,default:!1}}),Je={[_]:o=>B(o),[C]:o=>B(o),[ee]:o=>B(o),focus:o=>o instanceof FocusEvent,blur:o=>o instanceof FocusEvent,clear:()=>!0,select:o=>we(o)},Ye=["aria-expanded","aria-owns"],Ge={key:0},Xe=["id","aria-selected","onClick"],te="ElAutocomplete",Qe=Z({name:te,inheritAttrs:!1}),Ze=Z({...Qe,props:ze,emits:Je,setup(o,{expose:t,emit:n}){const s=o,N=Re(),ae=Ae(),le=Me(),c=Ie("autocomplete"),i=f(),R=f(),M=f(),L=f();let x=!1,E=!1;const d=f([]),r=f(-1),U=f(""),p=f(!1),O=f(!1),g=f(!1),y=b(()=>c.b(String(je()))),ne=b(()=>ae.style),h=b(()=>(d.value.length>0||g.value)&&p.value),j=b(()=>!s.hideLoading&&g.value),oe=b(()=>i.value?Array.from(i.value.$el.querySelectorAll("input")):[]),re=async()=>{await Te(),h.value&&(U.value=`${i.value.$el.offsetWidth}px`)},ie=()=>{E=!0},ue=()=>{E=!1,r.value=-1},H=qe(async e=>{if(O.value)return;const l=u=>{g.value=!1,!O.value&&(K(u)?(d.value=u,r.value=s.highlightFirstItem?0:-1):Pe(te,"autocomplete suggestions must be an array"))};if(g.value=!0,K(s.fetchSuggestions))l(s.fetchSuggestions);else{const u=await s.fetchSuggestions(e,l);K(u)&&l(u)}},s.debounce),ce=e=>{const l=!!e;if(n(C,e),n(_,e),O.value=!1,p.value||(p.value=l),!s.triggerOnFocus&&!e){O.value=!0,d.value=[];return}H(e)},de=e=>{var l;le.value||(((l=e.target)==null?void 0:l.tagName)!=="INPUT"||oe.value.includes(document.activeElement))&&(p.value=!0)},fe=e=>{n(ee,e)},pe=e=>{E||(p.value=!0,n("focus",e),s.triggerOnFocus&&!x&&H(String(s.modelValue)))},ve=e=>{E||n("blur",e)},he=()=>{p.value=!1,n(_,""),n("clear")},q=async()=>{h.value&&r.value>=0&&r.value<d.value.length?T(d.value[r.value]):s.selectWhenUnmatched&&(n("select",{value:s.modelValue}),d.value=[],r.value=-1)},ge=e=>{h.value&&(e.preventDefault(),e.stopPropagation(),S())},S=()=>{p.value=!1},me=()=>{var e;(e=i.value)==null||e.focus()},ye=()=>{var e;(e=i.value)==null||e.blur()},T=async e=>{n(C,e[s.valueKey]),n(_,e[s.valueKey]),n("select",e),d.value=[],r.value=-1},F=e=>{if(!h.value||g.value)return;if(e<0){r.value=-1;return}e>=d.value.length&&(e=d.value.length-1);const l=R.value.querySelector(`.${c.be("suggestion","wrap")}`),m=l.querySelectorAll(`.${c.be("suggestion","list")} li`)[e],I=l.scrollTop,{offsetTop:z,scrollHeight:W}=m;z+W>I+l.clientHeight&&(l.scrollTop+=W),z<I&&(l.scrollTop-=W),r.value=e,i.value.ref.setAttribute("aria-activedescendant",`${y.value}-item-${r.value}`)};return We(L,()=>{h.value&&S()}),Ee(()=>{i.value.ref.setAttribute("role","textbox"),i.value.ref.setAttribute("aria-autocomplete","list"),i.value.ref.setAttribute("aria-controls","id"),i.value.ref.setAttribute("aria-activedescendant",`${y.value}-item-${r.value}`),x=i.value.ref.hasAttribute("readonly")}),t({highlightedIndex:r,activated:p,loading:g,inputRef:i,popperRef:M,suggestions:d,handleSelect:T,handleKeyEnter:q,focus:me,blur:ye,close:S,highlight:F}),(e,l)=>($(),Oe(a(He),{ref_key:"popperRef",ref:M,visible:a(h),placement:e.placement,"fallback-placements":["bottom-start","top-start"],"popper-class":[a(c).e("popper"),e.popperClass],teleported:e.teleported,"gpu-acceleration":!1,pure:"","manual-mode":"",effect:"light",trigger:"click",transition:`${a(c).namespace.value}-zoom-in-top`,persistent:"",onBeforeShow:re,onShow:ie,onHide:ue},{content:v(()=>[J("div",{ref_key:"regionRef",ref:R,class:V([a(c).b("suggestion"),a(c).is("loading",a(j))]),style:Y({[e.fitInputWidth?"width":"minWidth"]:U.value,outline:"none"}),role:"region"},[k(a(Be),{id:a(y),tag:"ul","wrap-class":a(c).be("suggestion","wrap"),"view-class":a(c).be("suggestion","list"),role:"listbox"},{default:v(()=>[a(j)?($(),D("li",Ge,[k(a(Le),{class:V(a(c).is("loading"))},{default:v(()=>[k(a(De))]),_:1},8,["class"])])):($(!0),D(Se,{key:1},$e(d.value,(u,m)=>($(),D("li",{id:`${a(y)}-item-${m}`,key:m,class:V({highlighted:r.value===m}),role:"option","aria-selected":r.value===m,onClick:I=>T(u)},[w(e.$slots,"default",{item:u},()=>[Ve(ke(u[e.valueKey]),1)])],10,Xe))),128))]),_:3},8,["id","wrap-class","view-class"])],6)]),default:v(()=>[J("div",{ref_key:"listboxRef",ref:L,class:V([a(c).b(),e.$attrs.class]),style:Y(a(ne)),role:"combobox","aria-haspopup":"listbox","aria-expanded":a(h),"aria-owns":a(y)},[k(a(xe),_e({ref_key:"inputRef",ref:i},a(N),{"model-value":e.modelValue,onInput:ce,onChange:fe,onFocus:pe,onBlur:ve,onClear:he,onKeydown:[l[0]||(l[0]=A(G(u=>F(r.value-1),["prevent"]),["up"])),l[1]||(l[1]=A(G(u=>F(r.value+1),["prevent"]),["down"])),A(q,["enter"]),A(S,["tab"]),A(ge,["esc"])],onMousedown:de}),Ne({_:2},[e.$slots.prepend?{name:"prepend",fn:v(()=>[w(e.$slots,"prepend")])}:void 0,e.$slots.append?{name:"append",fn:v(()=>[w(e.$slots,"append")])}:void 0,e.$slots.prefix?{name:"prefix",fn:v(()=>[w(e.$slots,"prefix")])}:void 0,e.$slots.suffix?{name:"suffix",fn:v(()=>[w(e.$slots,"suffix")])}:void 0]),1040,["model-value","onKeydown"])],14,Ye)]),_:3},8,["visible","placement","popper-class","teleported","transition"]))}});var et=Ke(Ze,[["__file","/Users/st/Desktop/vue/nxx-ui/packages/components/autocomplete/src/autocomplete.vue"]]);const rt=Ce(et);class se{set(t,n){t=this.initOptions(t);for(const s in t)Object.prototype.hasOwnProperty.call(t,s)&&(this[s]instanceof Array||(n===!0?this[s]=t[s]===void 0?this[s]:t[s]:this[s]=t[s]))}sets(t,n){if(n=this.initOptions(n),t)for(const s in t)Object.prototype.hasOwnProperty.call(t,s)&&Object.prototype.hasOwnProperty.call(n,s)&&n[s].forEach(N=>{this[s].push(new t[s](N))})}initOptions(t){return t||{}}isValid(){return!0}}class Q extends se{constructor(t){t=t||{},t.enable=t.enable===void 0?!0:t.enable,super(),this.name=void 0,this.value=void 0,this.type=void 0,this.files=void 0,this.enable=void 0,this.uuid=void 0,this.time=void 0,this.contentType=void 0,this.set(t)}isValid(){return(!!this.name||!!this.value)&&this.type!=="file"}isFile(){return(!!this.name||!!this.value)&&this.type==="file"}}class it extends se{constructor(t){super(),this.type="KeyValue",this.raw=void 0,this.kvs=[],this.binary=[],this.set(t),this.sets({kvs:Q},{binary:Q},t)}isValid(){return this.isKV()?this.kvs.some(t=>t.isValid()):!!this.raw}isKV(){return[P.FORM_DATA,P.WWW_FORM,P.BINARY].indexOf(this.type)>0}}const P={KV:"KeyValue",FORM_DATA:"Form_Data",RAW:"Raw",WWW_FORM:"WWW_FORM",XML:"XML",JSON:"JSON"};export{P as B,rt as E,Q as K,it as a};
