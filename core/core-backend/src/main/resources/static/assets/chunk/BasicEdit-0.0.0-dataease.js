import{au as X}from"./index-0.0.0-dataease.js";import{E as Y}from"./el-drawer-0.0.0-dataease.js";import{j as ee,w as T,d as C,n as oe}from"./index-0.0.0-dataease2.js";import"./el-form-0.0.0-dataease.js";import{a as le,E as te}from"./el-form-item-0.0.0-dataease.js";import"./el-radio-group-0.0.0-dataease.js";import{E as ae,a as re}from"./el-radio-0.0.0-dataease.js";import"./el-tag-0.0.0-dataease.js";import{E as se,a as ne}from"./el-select-0.0.0-dataease.js";import"./el-popper-0.0.0-dataease.js";import"./el-tree-0.0.0-dataease.js";import"./el-checkbox-0.0.0-dataease.js";import{E as ie}from"./el-tree-select-0.0.0-dataease.js";import{E as me}from"./el-input-number-0.0.0-dataease.js";import{E as pe}from"./el-switch-0.0.0-dataease.js";import{d as de,r as x,_ as E,e as ue,f as i,g as b,i as c,N as O,k as m,a6 as L,a7 as v,j as f,M as d,Z as h,aa as V,V as ce,a0 as fe}from"./vue-0.0.0-dataease.js";import{_ as _e}from"./_plugin-vue_export-helper-0.0.0-dataease.js";import"./library-0.0.0-dataease.js";import"./lodash-0.0.0-dataease.js";import"./use-dialog-0.0.0-dataease.js";import"./axios-0.0.0-dataease.js";import"./echarts-0.0.0-dataease.js";import"./tinymce-0.0.0-dataease.js";import"./user-0.0.0-dataease.js";import"./index-0.0.0-dataease4.js";import"./index-0.0.0-dataease14.js";import"./strings-0.0.0-dataease.js";import"./index-0.0.0-dataease5.js";import"./index-0.0.0-dataease12.js";import"./index-0.0.0-dataease15.js";const ye={key:1,class:"ds-task-form-inline"},ve={class:"ds-span"},ge={key:2},ke={key:3},be={key:4},he={key:5},Ve={key:6},Te={key:7},xe={key:8},Ee={class:"dialog-footer"},Oe=de({__name:"BasicEdit",emits:["saved"],setup(Le,{expose:B,emit:F}){const{t}=ee(),g=x(!1),U=x(null),k=x(),N=[{value:"minute",label:t("system.time_0_seconds")},{value:"hour",label:t("system.and_0_seconds_de")}],R=[{value:"0",label:t("commons.date.permanent")},{value:"1",label:t("commons.date.one_year")},{value:"2",label:t("commons.date.six_months")},{value:"3",label:t("commons.date.three_months")},{value:"4",label:t("commons.date.one_month")}],e=E({form:E({dsIntervalTime:"30",dsExecuteTime:"minute",frontTimeOut:"30"}),settingList:[],orgOptions:[],roleOptions:[],loginOptions:[{value:"0",label:t("system.normal_login")},{value:"1",label:"LDAP"},{value:"2",label:"OIDC"},{value:"3",label:"CAS"},{value:"9",label:"OAUTH2"}]}),y=E({dsIntervalTime:[{required:!0,message:t("common.require"),trigger:"blur"}]}),S=()=>e.settingList.map(a=>{const r=a.pkey.startsWith("basic.")?a.pkey:`basic.${a.pkey}`,p=a.sort,n=a.type;let s=e.form[a.pkey];return Array.isArray(s)&&(s=s.join(",")),{pkey:r,pval:s,type:n,sort:p}}),$=F,A=async a=>{a&&await a.validate(r=>{if(r){if(e.form.dsExecuteTime==="minute"&&(Number(e.form.dsIntervalTime)<1||Number(e.form.dsIntervalTime)>59)){T.error(t("commons.date.of_range_1_59"));return}if(e.form.dsExecuteTime==="hour"&&(Number(e.form.dsIntervalTime)<1||Number(e.form.dsIntervalTime)>23)){T.error(t("commons.date.of_range_1_23"));return}const p=S();if(p.length<2)return;j(),C.post({url:"/sysParameter/basic/save",data:p}).then(n=>{n.msg||(T.success(t("common.save_success")),$("saved"),D()),I()}).catch(()=>{I()})}})},w=a=>{e.settingList=[],a&&(a.resetFields(),g.value=!1)},D=()=>{w(k.value)},j=()=>{U.value=X.service({target:".basic-param-drawer"})},I=()=>{var a;(a=U.value)==null||a.close()},M=(a,r,p,n)=>{e.orgOptions=r||[],e.roleOptions=p||[],e.loginOptions=n||[],e.settingList=a.map(s=>{const u=s.pkey;(u==="basic.logLiveTime"||u==="basic.thresholdLogLiveTime")&&(y[u.split(".")[1]]=[{required:!0,message:t("common.require"),trigger:["blur","change"]}]),(u==="basic.exportFileLiveTime"||u==="basic.frontTimeOut")&&(y[u.split(".")[1]]=[{required:!0,message:t("common.require"),trigger:["blur","change"]}]),s.label=`setting_${u}`,s.pkey=u.split(".")[1];let _=s.pval;return s.pkey.includes("platformRid")&&(_!=null&&_.length)&&(_=_.split(","),y.platformRid||(y.platformRid=[{required:!0,message:t("common.require"),trigger:["blur","change"]}])),s.pkey.includes("platformOid")&&(y.platformOid||(y.platformOid=[{required:!0,message:t("common.require"),trigger:["blur","change"]}])),e.form[s.pkey]=_||e.form[s.pkey],s}),g.value=!0},P=async()=>{const a=e.form.platformOid;if(!a)return;const p=(await C.get({url:`/role/queryWithOid/${a}`})).data,n=z(p);e.roleOptions[0].children=n.get(!1),e.roleOptions[1].children=n.get(!0)},z=a=>{const r=new Map;return a.forEach(p=>{const n=p.readonly;let s=r.get(n);s||(s=[]),s.push({value:p.id,label:p.name,disabled:!1}),r.set(n,s)}),r},W=()=>{e.form.platformRid=[],P()};return B({edit:M}),(a,r)=>{const p=pe,n=me,s=se,u=ne,_=ie,G=ae,H=re,Z=ue("v-else"),J=le,K=te,q=oe,Q=Y;return i(),b(Q,{title:f(t)("system.basic_settings"),modelValue:g.value,"onUpdate:modelValue":r[5]||(r[5]=o=>g.value=o),"custom-class":"basic-param-drawer",size:"600px",direction:"rtl"},{footer:c(()=>[O("span",Ee,[m(q,{secondary:"",onClick:r[3]||(r[3]=o=>w(k.value))},{default:c(()=>[L(v(f(t)("common.cancel")),1)]),_:1}),m(q,{type:"primary",onClick:r[4]||(r[4]=o=>A(k.value))},{default:c(()=>[L(v(f(t)("commons.save")),1)]),_:1})])]),default:c(()=>[m(K,{ref_key:"basicForm",ref:k,"require-asterisk-position":"right",model:e.form,rules:y,"label-width":"80px","label-position":"top"},{default:c(()=>[(i(!0),d(h,null,V(e.settingList,o=>(i(),b(J,{key:o.pkey,prop:o.pkey,class:ce({"setting-hidden-item":o.pkey==="dsExecuteTime"}),label:f(t)(o.label)},{default:c(()=>[o.pkey==="autoCreateUser"||o.pkey==="pwdStrategy"||o.pkey==="dip"||o.pkey==="shareDisable"||o.pkey==="sharePeRequire"?(i(),b(p,{key:0,class:"de-basic-switch","active-value":"true","inactive-value":"false",modelValue:e.form[o.pkey],"onUpdate:modelValue":l=>e.form[o.pkey]=l},null,8,["modelValue","onUpdate:modelValue"])):o.pkey==="dsIntervalTime"?(i(),d("div",ye,[O("span",null,v(f(t)("cron.every")),1),m(n,{modelValue:e.form.dsIntervalTime,"onUpdate:modelValue":r[0]||(r[0]=l=>e.form.dsIntervalTime=l),autocomplete:"off","step-strictly":"",class:"text-left",min:1,placeholder:f(t)("common.inputText"),"controls-position":"right",type:"number"},null,8,["modelValue","placeholder"]),m(u,{modelValue:e.form.dsExecuteTime,"onUpdate:modelValue":r[1]||(r[1]=l=>e.form.dsExecuteTime=l)},{default:c(()=>[(i(),d(h,null,V(N,l=>m(s,{key:l.value,label:l.label,value:l.value},null,8,["label","value"])),64))]),_:2},1032,["modelValue"]),O("span",ve,v(f(t)("cron.every_exec")),1)])):o.pkey==="frontTimeOut"?(i(),d("div",ge,[m(n,{modelValue:e.form.frontTimeOut,"onUpdate:modelValue":r[2]||(r[2]=l=>e.form.frontTimeOut=l),autocomplete:"off","step-strictly":"",class:"text-left edit-all-line",min:1,placeholder:f(t)("common.inputText"),"controls-position":"right",type:"number"},null,8,["modelValue","placeholder"])])):o.pkey==="logLiveTime"||o.pkey==="thresholdLogLiveTime"?(i(),d("div",ke,[m(n,{modelValue:e.form[o.pkey],"onUpdate:modelValue":l=>e.form[o.pkey]=l,autocomplete:"off","step-strictly":"",class:"text-left edit-all-line",min:1,max:4e3,placeholder:f(t)("common.inputText"),"controls-position":"right",type:"number"},null,8,["modelValue","onUpdate:modelValue","placeholder"])])):o.pkey==="platformOid"?(i(),d("div",be,[m(_,{class:"edit-all-line",modelValue:e.form[o.pkey],"onUpdate:modelValue":l=>e.form[o.pkey]=l,data:e.orgOptions,"check-strictly":"","render-after-expand":!1,onChange:W},null,8,["modelValue","onUpdate:modelValue","data"])])):o.pkey==="platformRid"?(i(),d("div",he,[m(_,{class:"edit-all-line",modelValue:e.form[o.pkey],"onUpdate:modelValue":l=>e.form[o.pkey]=l,data:e.roleOptions,"highlight-current":!0,multiple:"","render-after-expand":!1,placeholder:a.$t("common.please_select")+a.$t("user.role"),"show-checkbox":"","check-on-click-node":""},null,8,["modelValue","onUpdate:modelValue","data","placeholder"])])):o.pkey==="pvp"?(i(),d("div",Ve,[m(u,{modelValue:e.form[o.pkey],"onUpdate:modelValue":l=>e.form[o.pkey]=l,class:"edit-all-line"},{default:c(()=>[(i(),d(h,null,V(R,l=>m(s,{key:l.value,label:l.label,value:l.value},null,8,["label","value"])),64))]),_:2},1032,["modelValue","onUpdate:modelValue"])])):o.pkey==="exportFileLiveTime"?(i(),d("div",Te,[m(n,{modelValue:e.form[o.pkey],"onUpdate:modelValue":l=>e.form[o.pkey]=l,autocomplete:"off","step-strictly":"",class:"text-left edit-all-line",min:1,max:4e3,placeholder:f(t)("common.inputText"),"controls-position":"right",type:"number"},null,8,["modelValue","onUpdate:modelValue","placeholder"])])):o.pkey==="defaultLogin"?(i(),d("div",xe,[m(H,{modelValue:e.form[o.pkey],"onUpdate:modelValue":l=>e.form[o.pkey]=l},{default:c(()=>[(i(!0),d(h,null,V(e.loginOptions,l=>(i(),b(G,{key:l.value,label:l.value},{default:c(()=>[L(v(l.label),1)]),_:2},1032,["label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])])):fe("",!0),m(Z)]),_:2},1032,["prop","class","label"]))),128))]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"])}}});const ao=_e(Oe,[["__scopeId","data-v-1fffbd45"]]);export{ao as default};
