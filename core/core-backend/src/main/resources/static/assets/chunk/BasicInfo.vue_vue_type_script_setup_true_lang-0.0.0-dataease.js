import{_ as S}from"./InfoTemplate.vue_vue_type_style_index_0_scope_true_lang-0.0.0-dataease.js";import j from"./BasicEdit-0.0.0-dataease.js";import{j as I,d as y}from"./index-0.0.0-dataease2.js";import{d as u}from"./lodash-0.0.0-dataease.js";import{d as N,r as p,_ as M,f as T,M as U,k as w,j as $,Z as z}from"./vue-0.0.0-dataease.js";const J=N({__name:"BasicInfo",setup(F){const{t:l}=I(),m=p(),v=p(),f=p(!1),L=[{value:"0",label:l("commons.date.permanent")},{value:"1",label:l("commons.date.one_year")},{value:"2",label:l("commons.date.six_months")},{value:"3",label:l("commons.date.three_months")},{value:"4",label:l("commons.date.one_month")}],D=[{key:"setting_basic.frontTimeOut",val:l("system.to_take_effect")},{key:"setting_basic.platformOid",val:l("system.and_platform_docking")},{key:"setting_basic.platformRid",val:l("system.and_platform_docking")},{key:"setting_basic.shareDisable",val:"开启后仪表板以及大屏分享无效"}],s=M({templateList:[],orgOptions:[],roleOptions:[{value:"admin",label:l("role.org_admin"),children:null,disabled:!1},{value:"readonly",label:l("role.average_role"),children:null,disabled:!1}],loginOptions:[{value:"0",label:l("system.normal_login")},{value:"1",label:"LDAP"},{value:"2",label:"OIDC"},{value:"3",label:"CAS"},{value:"9",label:"OAUTH2"}]});let c=[];const b=p(""),_=p(""),h=p([]),g=p([]),O=p("0"),C=o=>{const a="/sysParameter/basic/query";c=[],s.templateList=[],y.get({url:a}).then(async n=>{c=u(n.data);const t=n.data;for(let i=0;i<t.length;i++){const e=t[i];if(e.pkey==="basic.autoCreateUser"||e.pkey==="basic.dip"||e.pkey==="basic.pwdStrategy"||e.pkey==="basic.shareDisable"||e.pkey==="basic.sharePeRequire")e.pval=e.pval==="true"?l("chart.open"):l("system.not_enabled");else if(e.pkey==="basic.platformOid")b.value=e.pval,await q(),e.pval=_.value||l("system.default_organization");else if(e.pkey==="basic.platformRid"){const r=e.pval;if(r!=null&&r.length){const d=r.split(",");h.value=d,await B(),g.value.length?e.pval=g.value.join(","):e.pval=l("system.normal_role")}else h.value=[],e.pval=l("system.normal_role")}else if(e.pkey==="basic.pvp")O.value=e.pval||"0",e.pval=L.filter(r=>r.value===O.value)[0].label;else if(e.pkey==="basic.defaultLogin"){if(await A(),f.value)if(e.pval){const r=s.loginOptions.filter(d=>d.value===e.pval);r!=null&&r.length?e.pval=r[0].label:(e.pval=s.loginOptions[0].label,P())}else e.pval=s.loginOptions[0].label}else e.pval=e.pval;e.pkey="setting_"+e.pkey,(!e.pkey.includes("defaultLogin")||f.value)&&s.templateList.push(e)}o&&o()})},k=()=>{C(()=>{v==null||v.value.init()})};k();const R=()=>{m==null||m.value.edit(u(c),u(s.orgOptions),u(s.roleOptions),u(s.loginOptions))},q=async()=>{const a=(await y.post({url:"/org/mounted",data:{}})).data;E(a),s.orgOptions=a},B=async()=>{const a=(await y.get({url:`/role/queryWithOid/${b.value}`})).data,n=x(a);s.roleOptions[0].children=n.get(!1),s.roleOptions[1].children=n.get(!0)},E=o=>{var n;const a=[...o];for(;a.length;){const t=a.pop();t.id===b.value&&(_.value=t.name),t.value=t.id,t.label=t.name,t.disabled=t.readOnly,(n=t.children)!=null&&n.length&&t.children.forEach(i=>a.push(i))}},x=o=>{const a=new Map;return g.value=[],o.forEach(n=>{h.value.includes(n.id)&&g.value.push(n.name);const t=n.readonly;let i=a.get(t);i||(i=[]),i.push({value:n.id,label:n.name,disabled:!1}),a.set(t,i)}),a},A=async()=>{const o="/setting/authentication/status",t=(await y.get({url:o})).data.reduce((e,{name:r,enable:d})=>(e[r]=d,e),{});let i=s.loginOptions.length;for(;i--;){const e=s.loginOptions[i];e.value!=="0"&&!t[e.label.toLocaleLowerCase()]&&s.loginOptions.splice(i,1)}if(f.value=s.loginOptions.length>1,!f.value){let e=c.length;for(;e--;)c[e].pkey==="basic.defaultLogin"&&c.splice(e,1)}},P=()=>{let o=c.length;for(;o--;){const a=c[o];a.pkey==="basic.defaultLogin"&&(a.pval="0")}};return(o,a)=>(T(),U(z,null,[w(S,{ref_key:"infoTemplate",ref:v,"label-tooltips":D,"setting-key":"basic","setting-title":$(l)("system.basic_settings"),"setting-data":s.templateList,onEdit:R},null,8,["setting-title","setting-data"]),w(j,{ref_key:"editor",ref:m,onSaved:k},null,512)],64))}});export{J as _};
