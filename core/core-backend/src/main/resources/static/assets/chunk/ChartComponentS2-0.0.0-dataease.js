import{u as _e}from"./index-0.0.0-dataease.js";import{E as Ee}from"./el-dialog-0.0.0-dataease.js";import{J as xe}from"./index-0.0.0-dataease2.js";import{E as Te}from"./el-row-0.0.0-dataease.js";import{d as Le,ai as Ve,t as Me,r as F,_ as je,s as Be,m as S,o as De,a as qe,f as h,M as Q,N as k,k as X,W as R,a0 as O,g as x,i as $,Z as Fe,an as Re,n as Oe,R as We,V as He,ac as ee,a7 as Ne,j as te}from"./vue-0.0.0-dataease.js";import{a as Je}from"./chart-0.0.0-dataease2.js";import{d as Ue,c as Ye}from"./dvMain-0.0.0-dataease.js";import{useAppStoreWithOut as Ke}from"./app-0.0.0-dataease.js";import{V as Ge}from"./ViewTrackBar-0.0.0-dataease.js";import{E as ae}from"./el-pagination-0.0.0-dataease.js";import"./el-tag-0.0.0-dataease.js";import"./el-select-0.0.0-dataease.js";import"./el-popper-0.0.0-dataease.js";import Ze from"./ChartError-0.0.0-dataease.js";import{B as Qe}from"./chart-0.0.0-dataease.js";import{r as oe,d as Xe,e as $e}from"./canvasStyle-0.0.0-dataease.js";import{J as et}from"./canvasUtils-0.0.0-dataease.js";import{p as tt}from"./util-0.0.0-dataease2.js";import{x as at,d as ot}from"./lodash-0.0.0-dataease.js";import{_ as it}from"./_plugin-vue_export-helper-0.0.0-dataease.js";import"./library-0.0.0-dataease.js";import"./use-dialog-0.0.0-dataease.js";import"./refs-0.0.0-dataease.js";import"./axios-0.0.0-dataease.js";import"./echarts-0.0.0-dataease.js";import"./tinymce-0.0.0-dataease.js";import"./user-0.0.0-dataease.js";import"./row-0.0.0-dataease.js";import"./dataVisualization-0.0.0-dataease2.js";import"./util-0.0.0-dataease.js";import"./formatter-0.0.0-dataease.js";import"./antv-0.0.0-dataease.js";import"./extends-0.0.0-dataease.js";import"./sysParameter-0.0.0-dataease.js";import"./TableTooltip-0.0.0-dataease.js";import"./el-col-0.0.0-dataease.js";import"./_commonjs-dynamic-modules-0.0.0-dataease.js";import"./appearance-0.0.0-dataease.js";import"./font-0.0.0-dataease.js";import"./el-dropdown-menu-0.0.0-dataease.js";import"./index-0.0.0-dataease4.js";import"./dropdown-0.0.0-dataease.js";import"./el-dropdown-item-0.0.0-dataease.js";import"./index-0.0.0-dataease14.js";import"./strings-0.0.0-dataease.js";import"./index-0.0.0-dataease5.js";import"./translate-0.0.0-dataease.js";import"./eventBus-0.0.0-dataease.js";import"./dataVisualization-0.0.0-dataease.js";import"./snapshot-0.0.0-dataease.js";const lt={class:"canvas-area"},nt={key:0,class:"canvas-content"},rt={class:"enlarge-image"},st=["src"],ie=1,ut=Le({__name:"ChartComponentS2",props:{element:{type:Object,default(){return{propValue:null}}},view:{type:Object,default(){return{propValue:null}}},showPosition:{type:String,required:!1,default:"canvas"},scale:{type:Number,required:!1,default:1},terminal:{type:String,default:"pc"},drillLength:{type:Number,required:!1,default:0},suffixId:{type:String,required:!1,default:"common"}},emits:["onPointClick","onChartClick","onDrillFilters","onJumpClick"],setup(le,{expose:ne,emit:re}){const b=Ue(),{nowPanelTrackInfo:W,nowPanelJumpInfo:H,mobileInPc:T,canvasStyleData:N,embeddedCallBack:se,inMobile:L}=Ve(b),{emitter:ue}=_e(),g=le,y=re,{view:n,showPosition:C,scale:_,terminal:J,drillLength:ce,suffixId:pe}=Me(g),P=F(!1),U=F(""),E=We("chartExtRequest"),a=je({curActionId:null,curTrackMenu:[],trackBarStyle:{position:"absolute",left:"50px",top:"50px"},linkageActiveParam:null,pointParam:null,loading:!1,data:{fields:[]},pageInfo:{total:0,pageSize:20,currentPage:1},totalItems:0,showPage:!1,pageStyle:"simple",currentPageSize:0,imgEnlarge:!1,imgSrc:""});let v=Be({fields:[]});const I="container-"+C.value+"-"+n.value.id+"-"+pe.value,Y=F(null),V=(t,e,l=!0)=>{if(t.customAttr.basicStyle.tablePageStyle==="general"?a.currentPageSize!==0&&(t.chartExtRequest.pageSize=a.currentPageSize):delete t.chartExtRequest.pageSize,t.tableId||t.dataFrom==="template"){P.value=!1;const r=JSON.parse(JSON.stringify(t));Je(r).then(i=>{i.code&&i.code!==0?(P.value=!0,U.value=i.msg):(v.value=i==null?void 0:i.data,a.totalItems=i==null?void 0:i.totalItems,b.setViewDataDetails(t.id,i),y("onDrillFilters",i==null?void 0:i.drillFilters),M(i,l)),e==null||e()}).catch(()=>{e==null||e()})}else e==null||e()};let o=null,m;const de=(t,e)=>{v.value=e,M(t,!1)},me=t=>{const e=tt(t.customAttr);e.tableCell.mergeCells===void 0&&(e.tableCell.mergeCells=!1)},M=(t,e)=>{var r,i,u;if(!t)return;me(t),m=xe({...at(t,ot(Qe)),data:v.value}),oe(Xe,m.customAttr,_.value,J.value),oe($e,m.customStyle,_.value,J.value),(i=(r=o==null?void 0:o.facet)==null?void 0:r.timer)==null||i.stop(),(u=o==null?void 0:o.facet)==null||u.cancelScrollFrame(),o==null||o.destroy(),o=null,fe(m,e),o=Ye.getChartView(t.render,t.type).drawChart({container:I,chart:Re(m),chartObj:o,pageInfo:a.pageInfo,action:ke,resizeAction:ye}),o==null||o.render(),b.setViewInstanceInfo(t.id,o),w()},fe=(t,e)=>{const l=t.customAttr;if(t.type!=="table-info"||l.basicStyle.tablePageMode!=="page"){a.showPage=!1;return}const r=a.pageInfo;r.pageSize=l.basicStyle.tablePageSize??20,a.totalItems>a.pageInfo.pageSize||a.pageStyle==="general"?(r.total=a.totalItems,a.showPage=!0):a.showPage=!1,e&&(a.pageInfo.currentPage=1),a.pageStyle=l.basicStyle.tablePageStyle,a.pageStyle==="general"&&a.currentPageSize==0&&(a.currentPageSize=r.pageSize)},K=()=>{var t,e;(e=(t=o==null?void 0:o.facet)==null?void 0:t.timer)==null||e.stop()},ge=()=>{w()};let j;const w=()=>{j&&clearTimeout(j),j=setTimeout(()=>{var l,r,i;const t=m==null?void 0:m.customAttr,e=m==null?void 0:m.senior;if(o&&((l=e==null?void 0:e.scrollCfg)!=null&&l.open)&&((r=v.value.tableRow)!=null&&r.length)&&(n.value.type==="table-normal"||n.value.type==="table-info"&&!a.showPage)){(i=o.facet.timer)==null||i.stop();let u=o.store.get("scrollY")||0;const p=document.getElementById(I).offsetHeight;if(!p)return;const c=t.tableCell.tableItemHeight,d=t.tableHeader.showTableHeader===!1?1:t.tableHeader.tableTitleHeight,s=o.theme.scrollBar.size,q=c*v.value.tableRow.length+d-p+s;if(q<s)return;u>=q-1&&(o.store.set("scrollY",0),o.render(),u=0);const Ae=p-d-s+u,Ce=(v.value.tableRow.length-Ae/c)/e.scrollCfg.row*e.scrollCfg.interval;o.facet.scrollWithAnimation({offsetY:{value:q,animate:!1}},Ce,w)}},1500)},ve=S(()=>n.value.type!=="table-info"?!1:a.showPage),G=t=>{let e={goPage:t};E.value&&(e={...e,...E.value});const l={...n.value,chartExtRequest:e};V(l,null,!1)},Se=t=>{a.pageStyle==="general"&&(a.currentPageSize=t);let e={pageSize:t};E.value&&(e={...e,...E.value});const l={...n.value,chartExtRequest:e};V(l,null,!1)},he=()=>{se.value==="yes"&&B("pointClick")},ke=t=>{if(a.pointParam=t,a.curActionId=t.data.name,a.curTrackMenu=Z(a.curActionId),he(),z.value.length<2)B(z.value[0]);else{const e={left:t.x-50,top:t.y+10};et(g.element,e,g.scale,z.value.length),a.trackBarStyle.left=e.left+"px",a.trackBarStyle.top=e.top+"px",Y.value.trackButtonClick()}};Ke();const B=t=>{var u,p;const e=a.pointParam;if(!((u=e==null?void 0:e.data)!=null&&u.dimensionList))return;const l={option:"linkage",name:a.pointParam.data.name,viewId:n.value.id,dimensionList:a.pointParam.data.dimensionList,quotaList:a.pointParam.data.quotaList};if(["table-info","table-normal"].includes(n.value.type)){l.quotaList=[];const c=[],d=[];n.value.xAxis.forEach(s=>{s.groupType==="d"?c.push(s.id):d.push(s.id)}),n.value.yAxis.forEach(s=>{s.groupType==="d"?c.push(s.id):d.push(s.id)}),c.includes(e.data.name)?l.dimensionList=l.dimensionList.filter(s=>s.id===e.data.name):d.includes(e.data.name)&&(l.dimensionList=l.dimensionList.filter(s=>c.includes(s.id))),n.value}const r={option:"jump",name:a.pointParam.data.name,viewId:n.value.id,dimensionList:a.pointParam.data.dimensionList,quotaList:a.pointParam.data.quotaList,sourceType:a.pointParam.data.sourceType},i={option:"pointClick",name:a.pointParam.data.name,viewId:n.value.id,dimensionList:a.pointParam.data.dimensionList,quotaList:a.pointParam.data.quotaList};switch(t){case"pointClick":y("onPointClick",i);break;case"linkageAndDrill":b.addViewTrackFilter(l),y("onChartClick",e);break;case"drill":y("onChartClick",e);break;case"linkage":b.addViewTrackFilter(l);break;case"jump":if(T.value&&!L.value)return;y("onJumpClick",r);break;case"enlarge":n.value.type==="table-info"&&((p=e.data.dimensionList)==null||p.forEach(c=>{c.id===a.curActionId&&(a.imgSrc=c.value,a.imgEnlarge=!0)}));break}},z=S(()=>["table-info","table-normal"].includes(n.value.type)&&a.curActionId?Z(a.curActionId):be.value),be=S(()=>{var r,i,u,p;let t=[];if(C.value==="viewDialog")return t;let e=0,l=0;return(i=(r=v.value)==null?void 0:r.fields)==null||i.forEach(c=>{const d=n.value.id+"#"+c.id;W.value[d]&&e++,H.value[d]&&l++}),l&&((u=n.value)!=null&&u.jumpActive)&&(!T.value||L.value)&&t.push("jump"),e&&((p=n.value)!=null&&p.linkageActive)&&t.push("linkage"),n.value.drillFields.length&&t.push("drill"),t.length===3&&g.element.actionSelection.linkageActive==="auto"?t=["jump","linkageAndDrill"]:t.length===2&&g.element.actionSelection.linkageActive==="auto"&&!t.includes("jump")&&(t=["linkageAndDrill"]),t}),Z=t=>{var p,c,d;let e=[];if(C.value==="viewDialog")return e;let l=0,r=0,i=0;const u=n.value.id+"#"+t;return W.value[u]&&l++,H.value[u]&&r++,r&&((p=n.value)!=null&&p.jumpActive)&&(!T.value||L.value)&&e.push("jump"),l&&((c=n.value)!=null&&c.linkageActive)&&e.push("linkage"),n.value.drillFields.length&&n.value.drillFields[ce.value].id===t&&i++,i&&e.push("drill"),e.length===3&&g.element.actionSelection.linkageActive==="auto"?e=["jump","linkageAndDrill"]:e.length===2&&g.element.actionSelection.linkageActive==="auto"&&!e.includes("jump")&&(e=["linkageAndDrill"]),n.value.type==="table-info"&&((d=n.value.xAxis)==null||d.forEach(s=>{s.id===t&&s.deType===7&&e.push("enlarge")})),e},ye=t=>{var c,d;if(o!=null&&o.facet.timer&&(o==null||o.facet.timer.stop(),Oe(w)),C.value!=="canvas")return;const e=t.info.meta.field,{basicStyle:l}=n.value.customAttr,r=document.getElementById(I).offsetWidth,i=(c=l.tableFieldWidth)==null?void 0:c.find(s=>s.fieldId===e);let u;const p=parseFloat((t.info.resizedWidth/r*100).toFixed(2));if(i)i.width=p,u=[...l.tableFieldWidth];else{const s={fieldId:e,width:p};u=(d=l.tableFieldWidth)!=null&&d.length?[...l.tableFieldWidth,s]:[s]}ue.emit("set-table-column-width",u)};ne({calcData:V,renderChart:M,renderChartFromDialog:de,trackMenu:z});let D;const Pe=(t,e)=>{D&&clearTimeout(D),D=setTimeout(()=>{var l;o==null||o.changeSheetSize(t,e),(l=o==null?void 0:o.facet.timer)==null||l.stop(),o==null||o.render(),w()},500)},f=[0,0];let A;De(()=>{A=new ResizeObserver(([t]=[])=>{const[e]=t.borderBoxSize||[];f[0]||f[1]||(f[0]=e.inlineSize,f[1]=e.blockSize);const l=Math.abs(e.inlineSize-f[0]),r=Math.abs(e.blockSize-f[1]);l<ie&&r<ie||(f[0]=e.inlineSize,f[1]=e.blockSize,Pe(e.inlineSize,e.blockSize))}),A.observe(document.getElementById(I))}),qe(()=>{var t;try{(t=o==null?void 0:o.facet.timer)==null||t.stop(),o==null||o.destroy(),o=null,A==null||A.disconnect()}catch(e){console.warn(e)}});const Ie=S(()=>({zoom:_.value}));S(()=>({height:20*_.value+8+"px"}));const we=S(()=>{var t;return[{"--de-pager-color":(t=N.value.component.seniorStyleSetting)==null?void 0:t.pagerColor}]}),ze=S(()=>{var t;return["#ffffff","#ffffffff","#a6a6a6ff"].includes((t=N.value.component.seniorStyleSetting)==null?void 0:t.pagerColor.toLowerCase())&&"table-page-info_dark"});return(t,e)=>{const l=Te,r=Ee;return h(),Q(Fe,null,[k("div",lt,[X(Ge,{ref_key:"viewTrack",ref:Y,"track-menu":z.value,class:"track-bar",style:R(a.trackBarStyle),onTrackClick:B,onMousemove:K},null,8,["track-menu","style"]),P.value?O("",!0):(h(),Q("div",nt,[k("div",{id:I,style:{position:"relative",height:"100%"},onMousemove:K,onMouseleave:ge},null,32)])),ve.value&&!P.value?(h(),x(l,{key:1,style:R(Ie.value)},{default:$(()=>[k("div",{class:He(["table-page-info",ze.value]),style:R(we.value),onKeydown:e[4]||(e[4]=ee(()=>{},["stop"])),onKeyup:e[5]||(e[5]=ee(()=>{},["stop"]))},[k("div",null,"共"+Ne(a.pageInfo.total)+"条",1),a.pageStyle!=="general"?(h(),x(te(ae),{key:0,class:"table-page-content",layout:"prev, pager, next","page-size":a.pageInfo.pageSize,"onUpdate:pageSize":e[0]||(e[0]=i=>a.pageInfo.pageSize=i),"current-page":a.pageInfo.currentPage,"onUpdate:currentPage":[e[1]||(e[1]=i=>a.pageInfo.currentPage=i),G],"pager-count":5,total:a.pageInfo.total},null,8,["page-size","current-page","total"])):(h(),x(te(ae),{key:1,class:"table-page-content",layout:"prev, pager, next, sizes, jumper","page-size":a.currentPageSize,"onUpdate:pageSize":[e[2]||(e[2]=i=>a.currentPageSize=i),Se],"current-page":a.pageInfo.currentPage,"onUpdate:currentPage":[e[3]||(e[3]=i=>a.pageInfo.currentPage=i),G],"pager-count":5,total:a.pageInfo.total},null,8,["page-size","current-page","total"]))],38)]),_:1},8,["style"])):O("",!0),P.value?(h(),x(Ze,{key:2,"err-msg":U.value},null,8,["err-msg"])):O("",!0)]),X(r,{modelValue:a.imgEnlarge,"onUpdate:modelValue":e[6]||(e[6]=i=>a.imgEnlarge=i),"append-to-body":"",class:"image-dialog"},{default:$(()=>[k("div",rt,[k("img",{src:a.imgSrc,style:{width:"100%",height:"100%","object-fit":"contain"}},null,8,st)])]),_:1},8,["modelValue"])],64)}}});const ra=it(ut,[["__scopeId","data-v-fd9b1f8d"]]);export{ra as default};
