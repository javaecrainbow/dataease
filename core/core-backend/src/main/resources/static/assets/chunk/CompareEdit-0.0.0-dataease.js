import"./index-0.0.0-dataease.js";import"./el-form-0.0.0-dataease.js";import"./el-radio-group-0.0.0-dataease.js";import{E as T,a as j}from"./el-radio-0.0.0-dataease.js";import{a as M,E as q}from"./el-form-item-0.0.0-dataease.js";import{j as I}from"./index-0.0.0-dataease2.js";import"./el-tag-0.0.0-dataease.js";import{E as J,a as w}from"./el-select-0.0.0-dataease.js";import"./el-popper-0.0.0-dataease.js";import{d as B,t as U,_ as R,w as G,m as P,f as i,M as d,k as s,i as m,j as t,Z as C,aa as L,g,a0 as E,a6 as b,a7 as x,N as Y}from"./vue-0.0.0-dataease.js";import{_ as Z}from"./_plugin-vue_export-helper-0.0.0-dataease.js";import"./library-0.0.0-dataease.js";import"./lodash-0.0.0-dataease.js";import"./axios-0.0.0-dataease.js";import"./echarts-0.0.0-dataease.js";import"./tinymce-0.0.0-dataease.js";import"./user-0.0.0-dataease.js";import"./index-0.0.0-dataease4.js";import"./index-0.0.0-dataease14.js";import"./strings-0.0.0-dataease.js";import"./index-0.0.0-dataease5.js";const z=[{name:"year_mom",value:"year_mom"}],H=[{name:"month_mom",value:"month_mom"},{name:"year_yoy",value:"year_yoy"}],K=[{name:"day_mom",value:"day_mom"},{name:"month_yoy",value:"month_yoy"},{name:"year_yoy",value:"year_yoy"}],Q={key:0,class:"exp-style"},W={key:1,class:"exp-style"},X={key:2,class:"exp-style"},$=B({__name:"CompareEdit",props:{compareItem:{type:Object,required:!0},chart:{type:Object,required:!0},dimensionData:{type:Array,required:!1},quotaData:{type:Array,required:!1}},setup(S){const{t:c}=I(),_=S,{compareItem:e,chart:n}=U(_),r=R({fieldList:[],compareList:[],dateFormatter:"y_M_d"}),A=[{name:"年",value:"y"},{name:"年月",value:"y_M"},{name:"年月日",value:"y_M_d"}],k=()=>{const l=r.fieldList.filter(a=>a.id===e.value.compareCalc.field);l&&l.length>0&&(l[0].dateStyle=r.dateFormatter,e.value.compareCalc.custom||(e.value.compareCalc.custom={timeType:"y_M_d"}),e.value.compareCalc.custom.timeType=r.dateFormatter),f()},F=()=>{var a;const l=(a=e.value.compareCalc.custom)==null?void 0:a.timeType;y.value&&l&&(r.dateFormatter=l,k())};G(()=>_.chart,()=>{V(),f(),F()},{deep:!0});const y=P(()=>n.value.type==="indicator"),V=()=>{let l=null;Object.prototype.toString.call(n.value.xAxis)==="[object Array]"?l=JSON.parse(JSON.stringify(n.value.xAxis)):l=JSON.parse(n.value.xAxis);const a=l.filter(p=>p.deType===1);if(n.value.type==="table-pivot"){let p=null;Object.prototype.toString.call(n.value.xAxisExt)==="[object Array]"?p=JSON.parse(JSON.stringify(n.value.xAxisExt)):p=JSON.parse(n.value.xAxisExt);const v=p.filter(u=>u.deType===1);a.push(...v)}y.value&&(a.length=0,a.push(..._.dimensionData.filter(p=>p.deType===1)),a.push(..._.quotaData.filter(p=>p.deType===1))),r.fieldList=a,(!e.value.compareCalc.field||e.value.compareCalc.field==="")&&r.fieldList.length>0&&(e.value.compareCalc.field=r.fieldList[0].id)},f=()=>{const l=r.fieldList.filter(a=>a.id===e.value.compareCalc.field);if(l&&l.length>0)switch(l[0].dateStyle){case"y":r.compareList=z;break;case"y_M":r.compareList=H;break;case"y_M_d":r.compareList=K;break}else r.compareList=[];(!e.value.compareCalc.type||e.value.compareCalc.type===""||e.value.compareCalc.type==="none")&&r.compareList.length>0&&(e.value.compareCalc.type=r.compareList[0].value)},N=l=>y.value?l.name:l.name+"("+c("chart."+l.dateStyle)+")";return V(),f(),F(),(l,a)=>{const p=J,v=w,u=M,h=T,D=j,O=q;return i(),d("div",null,[s(O,{ref:"form",model:t(e).compareCalc,"label-width":"80px",class:"compare-form"},{default:m(()=>[s(u,{label:t(c)("chart.compare_date")},{default:m(()=>[s(v,{modelValue:t(e).compareCalc.field,"onUpdate:modelValue":a[0]||(a[0]=o=>t(e).compareCalc.field=o),placeholder:t(c)("chart.pls_select_field"),onChange:f},{default:m(()=>[(i(!0),d(C,null,L(r.fieldList,o=>(i(),g(p,{key:o.id,label:N(o),value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),y.value?(i(),g(u,{key:0,label:t(c)("chart.datePattern")},{default:m(()=>[s(v,{modelValue:r.dateFormatter,"onUpdate:modelValue":a[1]||(a[1]=o=>r.dateFormatter=o),placeholder:t(c)("chart.date_format"),onChange:k},{default:m(()=>[(i(),d(C,null,L(A,o=>s(p,{key:o.value,label:o.name,value:o.value},null,8,["label","value"])),64))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"])):E("",!0),s(u,{label:t(c)("chart.compare_type")},{default:m(()=>[s(D,{modelValue:t(e).compareCalc.type,"onUpdate:modelValue":a[2]||(a[2]=o=>t(e).compareCalc.type=o)},{default:m(()=>[(i(!0),d(C,null,L(r.compareList,o=>(i(),g(h,{key:o.value,label:o.value},{default:m(()=>[b(x(t(c)("chart."+o.value)),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),s(u,{label:t(c)("chart.compare_data")},{default:m(()=>[s(D,{modelValue:t(e).compareCalc.resultData,"onUpdate:modelValue":a[3]||(a[3]=o=>t(e).compareCalc.resultData=o)},{default:m(()=>[s(h,{label:"pre"},{default:m(()=>[b(x(t(c)("chart.data_pre")),1)]),_:1}),s(h,{label:"sub"},{default:m(()=>[b(x(t(c)("chart.data_sub")),1)]),_:1}),s(h,{label:"percent"},{default:m(()=>[b(x(t(c)("chart.data_percent")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"]),s(u,{label:t(c)("chart.compare_calc_expression")},{default:m(()=>[t(e).compareCalc.resultData==="pre"?(i(),d("span",Q,"上期数据")):E("",!0),t(e).compareCalc.resultData==="sub"?(i(),d("span",W,"本期数据 - 上期数据")):t(e).compareCalc.resultData==="percent"?(i(),d("span",X,"(本期数据 / |上期数据| - 1) * 100%")):E("",!0)]),_:1},8,["label"]),s(u,{label:t(c)("chart.tip")},{default:m(()=>a[4]||(a[4]=[Y("span",{class:"exp-style",style:{"padding-top":"2px"}}," 当对比日期需要过滤时，请使用过滤组件实现过滤；使用图表过滤器，仪表板下钻和联动等功能，会导致结果不一致 ",-1)])),_:1},8,["label"])]),_:1},8,["model"])])}}});const Ce=Z($,[["__scopeId","data-v-c7f68684"]]);export{Ce as default};
