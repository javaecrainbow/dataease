import{i as q}from"./imgUtils-0.0.0-dataease.js";import"./eventBus-0.0.0-dataease.js";import{d as W,b as z}from"./dvMain-0.0.0-dataease.js";import{a as G}from"./chart-0.0.0-dataease2.js";import{p as g}from"./util-0.0.0-dataease2.js";import{d as $,ai as D,_ as H,r as p,t as K,m as V,w as Q,al as X,f as y,M as O,W as Y,j as _,g as Z,n as m}from"./vue-0.0.0-dataease.js";import b from"./ChartEmptyInfo-0.0.0-dataease.js";import{_ as k}from"./_plugin-vue_export-helper-0.0.0-dataease.js";import"./library-0.0.0-dataease.js";import"./index-0.0.0-dataease.js";import"./lodash-0.0.0-dataease.js";import"./index-0.0.0-dataease2.js";import"./axios-0.0.0-dataease.js";import"./echarts-0.0.0-dataease.js";import"./tinymce-0.0.0-dataease.js";import"./user-0.0.0-dataease.js";import"./util-0.0.0-dataease.js";import"./chart-0.0.0-dataease.js";import"./formatter-0.0.0-dataease.js";import"./dataVisualization-0.0.0-dataease2.js";import"./antv-0.0.0-dataease.js";import"./extends-0.0.0-dataease.js";import"./sysParameter-0.0.0-dataease.js";import"./TableTooltip-0.0.0-dataease.js";import"./el-col-0.0.0-dataease.js";import"./row-0.0.0-dataease.js";import"./el-row-0.0.0-dataease.js";import"./_commonjs-dynamic-modules-0.0.0-dataease.js";import"./appearance-0.0.0-dataease.js";import"./font-0.0.0-dataease.js";import"./app-0.0.0-dataease.js";import"./chart-dark-list-0.0.0-dataease.js";import"./chart-list-0.0.0-dataease.js";const ee={class:"pic-main"},te=["src"],oe=$({__name:"Component",props:{element:{type:Object,default(){return{propValue:{urlList:[]}}}},showPosition:{required:!1,type:String,default:"preview"},view:{type:Object,default(){return{propValue:null}}}},setup(N,{expose:R}){const I=W(),{canvasViewInfo:L,editMode:ie,mobileInPc:A,canvasStyleData:F}=D(I),n=H({emptyValue:"-",data:null,viewDataInfo:null,showUrl:null,firstRender:!0,previewFirstRender:!0,curImgList:[]}),l=p(!0),M=N,x=p(!1),U=p(""),C=p({}),f=p({}),v=p([]);let u=null;const{element:i,view:h,showPosition:E}=K(M),S=V(()=>E.value.includes("canvas")&&!A.value);Q(()=>S.value,()=>{c()});const c=()=>{var r,s;u&&clearInterval(u),u=null;const t=((r=i.value.propValue.urlList)==null?void 0:r.length)||0,{threshold:o}=g(h.value.senior);if(!S.value&&!o.enable&&t>0&&((s=i.value.carousel)!=null&&s.enable)){const e=(i.value.carousel.time||5)*1e3;let a=1;u=setInterval(()=>{const d=a%i.value.propValue.urlList.length;a++,m(()=>{n.showUrl=i.value.propValue.urlList[d].url})},e)}},J=V(()=>{const t={position:"relative",width:"100%",height:"100%"};return i.value.style.adaptation==="original"?(t.width="auto",t.height="auto"):i.value.style.adaptation==="equiratio"&&(t.height="auto"),t}),T=t=>{if(v.value=[],C.value={},f.value={},t.data&&t.data.sourceFields){const o=JSON.stringify(t.xAxis)+JSON.stringify(t.xAxisExt)+JSON.stringify(t.yAxis)+JSON.stringify(t.yAxisExt);t.data.sourceFields.forEach(e=>{o.indexOf(e.id)>-1&&v.value.push(`[${e.name}]`)}),o.indexOf('"记录数*"')>-1&&v.value.push("[记录数*]");const r=t.data.fields.reduce((e,a)=>(e[a.dataeaseName]=a.name,e),{}),s=t.data.tableRow[0];for(const e in s)f.value[r[e]]=s[e]}B(h.value)},B=t=>{if(n.showUrl=null,!t||!t.senior)return;const{threshold:o}=g(t.senior);if(!o.enable)return;const r=o.tableThreshold??[];if((r==null?void 0:r.length)>0)for(let s=0;s<r.length;s++){const e=r[s];let a=null;const d=z(f.value[e.field.name],a,e,"url");d&&(n.showUrl=d)}},w=()=>{i.value.propValue.urlList&&i.value.propValue.urlList.length>0&&(n.showUrl=i.value.propValue.urlList[0].url),c()},P=(t,o)=>{x.value=!1;const{threshold:r}=g(t.senior);if(!r.enable){w(),o==null||o();return}if(t.tableId||t.dataFrom==="template"){const s=JSON.parse(JSON.stringify(t));G(s).then(e=>{if(e.code&&e.code!==0)x.value=!0,U.value=e.msg;else{n.data=e==null?void 0:e.data,n.viewDataInfo=e,n.totalItems=e==null?void 0:e.totalItems;const a=L.value[i.value.id];a.curFields=e.data.fields,I.setViewDataDetails(i.value.id,e),l.value=!0,T(e),c()}o==null||o(),m(()=>{l.value=!0})}).catch(e=>{console.error(e),m(()=>{l.value=!0}),o==null||o()})}else t.tableId?(w(),m(()=>{l.value=!0}),o==null||o()):(l.value=!0,w(),o==null||o(),m(()=>{l.value=!0}))},j=t=>{};return X(()=>{u&&(clearInterval(u),u=null)}),R({calcData:P,renderChart:j}),(t,o)=>(y(),O("div",ee,[n.showUrl?(y(),O("img",{key:0,draggable:"false",style:Y(J.value),src:_(q)(n.showUrl)},null,12,te)):(y(),Z(b,{key:1,themes:_(F).dashboard.themeColor,"view-icon":_(h).type},null,8,["themes","view-icon"]))]))}});const Be=k(oe,[["__scopeId","data-v-84279497"]]);export{Be as default};
