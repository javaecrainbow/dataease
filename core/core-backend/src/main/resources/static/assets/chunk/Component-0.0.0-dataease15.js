import{aF as Ja,u as Da,a as mn}from"./index-0.0.0-dataease.js";import{j as oa,w as Le,_ as Oa,n as Xa,y as Tt,x as vn,e as ol}from"./index-0.0.0-dataease2.js";import"./el-tooltip-0.0.0-dataease.js";import"./el-popper-0.0.0-dataease.js";import{f as v,M as $,N as b,d as xe,r as X,s as xa,m as H,g as j,i as o,k as i,a6 as J,a7 as F,j as a,aa as he,Z as oe,U as wa,ac as Ne,X as kt,t as ea,w as ce,al as ha,a0 as K,V as Fe,q as Be,G as pn,ao as fn,n as we,a5 as Ct,R as Ee,W as Ae,ak as yn,ab as sl,o as dl,e as cl,ai as et,_ as ml,S as ua,aw as Ma,x as hn,ay as _n,a as gn,ag as bn}from"./vue-0.0.0-dataease.js";import{i as Sa}from"./icon_edit_outlined-0.0.0-dataease.js";import{i as Mt}from"./icon_delete-trash_outlined-0.0.0-dataease.js";import{e as Vn}from"./eventBus-0.0.0-dataease.js";import{s as vl}from"./snapshot-0.0.0-dataease.js";import{a as Tn}from"./library-0.0.0-dataease.js";import"./el-form-0.0.0-dataease.js";import{a as kn,E as Cn}from"./el-form-item-0.0.0-dataease.js";import{E as pl}from"./el-dialog-0.0.0-dataease.js";import{E as fl}from"./el-popover-0.0.0-dataease.js";import"./el-tag-0.0.0-dataease.js";import{E as Ia,a as De}from"./el-select-0.0.0-dataease.js";import"./el-tree-0.0.0-dataease.js";import{E as St,a as Mn}from"./el-checkbox-0.0.0-dataease.js";import{E as yl}from"./el-tree-select-0.0.0-dataease.js";import"./el-checkbox-group-0.0.0-dataease.js";import{E as Sn,a as Fn}from"./el-tabs-0.0.0-dataease.js";import"./el-radio-group-0.0.0-dataease.js";import{E as at,a as tt}from"./el-radio-0.0.0-dataease.js";import{_ as wn}from"./HandleMore.vue_vue_type_style_index_0_lang-0.0.0-dataease.js";import{m as An}from"./more_v-0.0.0-dataease.js";import{i as Qa}from"./icon_add_outlined-0.0.0-dataease.js";import{i as $n}from"./icon_drag_outlined-0.0.0-dataease.js";import{i as Dn}from"./icon_visible_outlined-0.0.0-dataease.js";import{d as On}from"./dv-folder-0.0.0-dataease.js";import{i as qn}from"./icon_dataset-0.0.0-dataease.js";import{i as Nn}from"./icon_warning_filled-0.0.0-dataease.js";import{i as En}from"./icon_info_outlined-0.0.0-dataease.js";import{g as hl}from"./util-0.0.0-dataease.js";import{g as qa,a as xn,b as In,c as Rn,d as Ln,e as Yn,f as Un,h as Bn,i as Gn}from"./time-format-0.0.0-dataease.js";import{d as Ra}from"./dvMain-0.0.0-dataease.js";import{g as na,a as ze,b as fa,c as Ft}from"./time-format-dayjs-0.0.0-dataease.js";import{f as be}from"./attr-0.0.0-dataease20.js";import{y as Pn,z as jn,A as Hn,B as zn,C as Wn,D as Kt,g as Qn}from"./dataset-0.0.0-dataease.js";import{E as ht}from"./EmptyBackground-0.0.0-dataease.js";import{d as je,c as Kn,g as Zn,e as _l}from"./lodash-0.0.0-dataease.js";import{d as Jn}from"./vuedraggable-es-0.0.0-dataease.js";import{d as Me}from"./dayjs.min-0.0.0-dataease.js";import{E as Xn}from"./el-time-picker-0.0.0-dataease.js";import{E as wt}from"./el-input-number-0.0.0-dataease.js";import{i as ei}from"./icon_admin_outlined-0.0.0-dataease.js";import{E as La}from"./el-date-picker-0.0.0-dataease.js";import{s as ai}from"./index-0.0.0-dataease22.js";import{c as Aa,i as ti,e as ya,a as Za,n as _t,m as Pa,b as Na,u as gl,d as bl,p as Vl,f as ra,t as Tl,g as kl,h as li,j as Ea,k as ni,l as ii,o as ba,q as Cl,w as lt,r as Zt}from"./index-0.0.0-dataease23.js";import{u as ui,a as nt}from"./use-route-0.0.0-dataease.js";import{L as ri}from"./index-0.0.0-dataease25.js";import{H as Jt,B as oi}from"./index-0.0.0-dataease24.js";import{T as si,a as di}from"./index-0.0.0-dataease26.js";import"./index-0.0.0-dataease27.js";import"./el-virtual-list-0.0.0-dataease.js";import{E as ci}from"./el-select-v2-0.0.0-dataease.js";import{_ as Ya}from"./_plugin-vue_export-helper-0.0.0-dataease.js";import{E as At}from"./index-0.0.0-dataease4.js";import{i as mi}from"./chart-list-0.0.0-dataease.js";import{i as Xe}from"./field-list-0.0.0-dataease.js";import{t as vi}from"./treeSortUtils-0.0.0-dataease.js";import"./axios-0.0.0-dataease.js";import"./echarts-0.0.0-dataease.js";import"./tinymce-0.0.0-dataease.js";import"./user-0.0.0-dataease.js";import"./dataVisualization-0.0.0-dataease2.js";import"./chart-0.0.0-dataease.js";import"./formatter-0.0.0-dataease.js";import"./use-dialog-0.0.0-dataease.js";import"./refs-0.0.0-dataease.js";import"./dropdown-0.0.0-dataease.js";import"./index-0.0.0-dataease14.js";import"./strings-0.0.0-dataease.js";import"./index-0.0.0-dataease5.js";import"./index-0.0.0-dataease12.js";import"./el-dropdown-menu-0.0.0-dataease.js";import"./el-dropdown-item-0.0.0-dataease.js";import"./util-0.0.0-dataease2.js";import"./chart-0.0.0-dataease2.js";import"./app-0.0.0-dataease.js";import"./antv-0.0.0-dataease.js";import"./extends-0.0.0-dataease.js";import"./sysParameter-0.0.0-dataease.js";import"./TableTooltip-0.0.0-dataease.js";import"./el-col-0.0.0-dataease.js";import"./row-0.0.0-dataease.js";import"./el-row-0.0.0-dataease.js";import"./_commonjs-dynamic-modules-0.0.0-dataease.js";import"./appearance-0.0.0-dataease.js";import"./font-0.0.0-dataease.js";import"./el-empty-0.0.0-dataease.js";import"./none-0.0.0-dataease.js";import"./nothing-tree-0.0.0-dataease.js";import"./index-0.0.0-dataease15.js";import"./arrays-0.0.0-dataease.js";import"./fixed-size-list-0.0.0-dataease.js";import"./browser-0.0.0-dataease.js";const pi={width:"16",height:"16",viewBox:"0 0 16 16",xmlns:"http://www.w3.org/2000/svg"};function fi(r,h){return v(),$("svg",pi,h[0]||(h[0]=[b("path",{d:"M8.00022 9.99975C7.56203 9.99975 7.13323 9.96523 6.71734 9.89921L6.38535 11.1382C6.33771 11.316 6.15493 11.4216 5.9771 11.3739L5.33315 11.2014C5.15533 11.1537 5.0498 10.9709 5.09745 10.7931L5.42255 9.57985C4.88013 9.39561 4.37096 9.15494 3.90491 8.86629L2.8454 9.9258C2.71522 10.056 2.50417 10.056 2.37399 9.9258L1.90259 9.4544C1.77242 9.32422 1.77242 9.11317 1.90259 8.98299L2.83565 8.04994C2.35424 7.59918 1.95209 7.0852 1.64812 6.52421C1.64492 6.51832 1.64162 6.51215 1.63823 6.50575C1.5136 6.27038 1.56023 5.97574 1.75709 5.79635C1.92051 5.64743 2.03596 5.5461 2.13639 5.44567C2.14538 5.43669 2.15521 5.42666 2.16569 5.41583C2.31108 5.2656 2.55902 5.32152 2.64417 5.51246C3.47427 7.37398 5.46211 8.66641 8.00022 8.66641C10.4321 8.66641 12.4664 7.40872 13.2829 5.68239C13.3042 5.63747 13.328 5.5809 13.3519 5.52084C13.4276 5.33064 13.6741 5.27325 13.8188 5.41801C13.9259 5.52508 14.0687 5.66784 14.2471 5.8463C14.4235 6.0227 14.4713 6.29211 14.356 6.51334C14.3279 6.56715 14.3006 6.61785 14.2774 6.65816C13.9638 7.20109 13.5572 7.69751 13.0754 8.1321L13.9263 8.98299C14.0565 9.11317 14.0565 9.32422 13.9263 9.4544L13.4549 9.9258C13.3247 10.056 13.1136 10.056 12.9835 9.9258L11.9888 8.93112C11.5521 9.19111 11.0792 9.40958 10.5779 9.57985L10.903 10.7931C10.9506 10.9709 10.8451 11.1537 10.6673 11.2014L10.0233 11.3739C9.84552 11.4216 9.66274 11.316 9.61509 11.1382L9.2831 9.89921C8.86721 9.96523 8.43842 9.99975 8.00022 9.99975Z"},null,-1)]))}const yi={render:fi},{t:hi}=oa(),Ml=r=>{const{id:h,name:u,deType:t,type:s,datasetId:g}=r;return{id:hl(),name:u,showError:!0,timeGranularity:"date",timeGranularityMultiple:"datetimerange",field:{id:h,type:s,name:u,deType:t},displayId:h,sortId:"",sort:"asc",defaultMapValue:[],mapValue:[],conditionType:0,conditionValueOperatorF:"eq",conditionValueF:"",conditionValueOperatorS:"like",conditionValueS:"",defaultConditionValueOperatorF:"eq",defaultConditionValueF:"",defaultConditionValueOperatorS:"like",defaultConditionValueS:"",timeType:"fixed",relativeToCurrent:"custom",required:!1,timeNum:0,relativeToCurrentType:"date",around:"f",parametersStart:null,parametersEnd:null,arbitraryTime:new Date,timeNumRange:0,relativeToCurrentTypeRange:"date",aroundRange:"f",arbitraryTimeRange:new Date,auto:!1,defaultValue:void 0,selectValue:void 0,optionValueSource:0,valueSource:[],dataset:{id:g,name:"",fields:[]},visible:!0,defaultValueCheck:!1,multiple:!1,displayType:"0",checkedFields:[],parameters:[],parametersCheck:!1,parametersList:[],checkedFieldsMap:{}}},_i=()=>{const r={id:"",name:hi("v_query.unnamed"),deType:0,type:"VARCHAR",datasetId:""};return Ml(r)},gi={class:"cascade-content"},bi={style:{display:"flex","align-items":"center","justify-content":"space-between"}},Vi={class:"cascade-item"},Ti={class:"label"},ki={class:"item-name"},Ci={class:"label"},Mi={class:"item-name"},Si={class:"dialog-footer"},Fi=xe({__name:"TreeFieldDialog",emits:["saveTree"],setup(r,{expose:h,emit:u}){const t=X(!1),s=X([]),g=xa([]),y=u,{t:C}=oa(),S=()=>{s.value.push({field:{id:""},id:hl()})},V=()=>{t.value=!1},L=(W,Z)=>{g.value=je(W),s.value=je(Z).map(B=>({field:B,id:B.id})),t.value=!0},P=H(()=>s.value.map(W=>W.field).map(W=>W.id)),d=()=>{V()},w=()=>{let W=!1;return{arr:je(s.value).map(B=>(B.field||(W=!0),B.field)),isError:W}},Y=()=>{const{isError:W,arr:Z}=w();if(W){Le.error(C("v_query.select_a_field"));return}y("saveTree",Z),V()},k=[" ",C("report.week_mon"),C("report.week_tue"),C("report.week_wed"),C("report.week_thu"),C("report.week_fri")],ee=W=>{s.value.splice(W,1)};return h({init:L}),(W,Z)=>{const B=Oa,re=Xa,m=Ia,q=De,ae=pl;return v(),j(ae,{modelValue:t.value,"onUpdate:modelValue":Z[0]||(Z[0]=e=>t.value=e),width:"600","custom-class":"tree-field_dialog","before-close":V,onMousedown:Z[1]||(Z[1]=Ne(()=>{},["stop"])),onMousedup:Z[2]||(Z[2]=Ne(()=>{},["stop"])),title:a(C)("v_query.tree_structure_design")},{footer:o(()=>[b("div",Si,[i(re,{secondary:"",onClick:d},{default:o(()=>[J(F(a(C)("common.cancel")),1)]),_:1}),i(re,{type:"primary",onClick:Y},{default:o(()=>[J(F(a(C)("pblink.sure_bt")),1)]),_:1})])]),default:o(()=>[b("div",gi,[b("div",bi,[i(re,{disabled:s.value.length===5,text:"",onClick:S},{icon:o(()=>[i(B,{name:"icon_add_outlined"},{default:o(()=>[i(a(Qa),{class:"svg-icon"})]),_:1})]),default:o(()=>[J(" "+F(a(C)("v_query.add_level")),1)]),_:1},8,["disabled"])]),b("div",Vi,[b("div",Ti,F(a(C)("visualization.level")),1),b("div",ki,F(a(C)("v_query.tree_query_field")),1)]),(v(!0),$(oe,null,he(s.value,(e,pe)=>(v(),$("div",{class:"cascade-item",key:e.id},[b("div",Ci,F(a(C)("visualization.level"))+F(k[pe+1]),1),b("div",Mi,[i(q,{disabled:pe===0&&e.field,"value-key":"id",modelValue:e.field,"onUpdate:modelValue":E=>e.field=E,style:{width:"300px"}},{default:o(()=>[(v(!0),$(oe,null,he(g.value,E=>(v(),j(m,{disabled:P.value.includes(E.id),key:E.id,label:E.name,value:E},null,8,["disabled","label","value"]))),128))]),_:2},1032,["disabled","modelValue","onUpdate:modelValue"])]),wa(i(re,{onClick:E=>ee(pe),class:"cascade-delete",text:""},{icon:o(()=>[i(B,{name:"icon_delete-trash_outlined"},{default:o(()=>[i(a(Mt),{class:"svg-icon"})]),_:1})]),_:2},1032,["onClick"]),[[kt,pe!==0]])]))),128))])]),_:1},8,["modelValue","title"])}}});const wi=xe({__name:"DynamicTimeFiltering",props:{config:{type:Object,default:()=>({regularOrTrendsValue:"",intervalType:"none",regularOrTrends:"fixed",relativeToCurrent:"custom",timeNum:0,relativeToCurrentType:"year",around:"f"})},timeGranularityMultiple:{type:String,default:()=>"yearrange"}},setup(r){const h=r,{config:u}=ea(h),t=H(()=>{const{relativeToCurrent:y,regularOrTrends:C,intervalType:S,timeNum:V,relativeToCurrentType:L,around:P}=u.value;return{relativeToCurrent:y,timeNum:V,regularOrTrends:C,intervalType:S,relativeToCurrentType:L,around:P,timeGranularityMultiple:h.timeGranularityMultiple}});ce(()=>t.value,()=>{g()},{deep:!0});const s=H(()=>{const y=h.timeGranularityMultiple.split("time").join("");return u.value.intervalType==="timeInterval"?y:y.split("range")[0]}),g=()=>{const{relativeToCurrent:y,regularOrTrends:C,timeNum:S,relativeToCurrentType:V,around:L}=t.value;if(C==="fixed"){if(u.value.regularOrTrendsValue&&!Array.isArray(u.value.regularOrTrendsValue))return;u.value.regularOrTrendsValue=new Date;return}if(y==="custom")u.value.regularOrTrendsValue=na(V,L==="f"?"subtract":"add",S);else switch(y){case"thisYear":u.value.regularOrTrendsValue=ze("year");break;case"lastYear":u.value.regularOrTrendsValue=fa("year");break;case"thisMonth":u.value.regularOrTrendsValue=ze("month");break;case"lastMonth":u.value.regularOrTrendsValue=fa("month");break;case"today":u.value.regularOrTrendsValue=ze("day");break;case"yesterday":u.value.regularOrTrendsValue=fa("day");break;case"monthBeginning":u.value.regularOrTrendsValue=ze("month");break;case"yearBeginning":u.value.regularOrTrendsValue=ze("year");break}};return ha(()=>{g()}),(y,C)=>{const S=La;return v(),j(S,{disabled:a(u).regularOrTrends!=="fixed",key:s.value,modelValue:a(u).regularOrTrendsValue,"onUpdate:modelValue":C[0]||(C[0]=V=>a(u).regularOrTrendsValue=V),type:s.value,"prefix-icon":a(Ja),placeholder:y.$t("commons.date.select_date_time")},null,8,["disabled","modelValue","type","prefix-icon","placeholder"])}}}),Ai=xe({__name:"DynamicTimeRangeFiltering",props:{config:{type:Object,default:()=>({timeGranularityMultiple:"daterange",regularOrTrendsValue:[],regularOrTrends:"fixed",timeNum:0,intervalType:"none",relativeToCurrentRange:"custom",relativeToCurrentType:"year",around:"f",timeGranularity:"date",timeNumRange:0,relativeToCurrentTypeRange:"year",aroundRange:"f"})},timeGranularityMultiple:{type:String,default:()=>"yearrange"}},setup(r){const h=r,{config:u}=ea(h),t=H(()=>{const{timeNum:C,relativeToCurrentType:S,around:V,relativeToCurrentRange:L,intervalType:P,regularOrTrends:d,timeGranularity:w,timeNumRange:Y,relativeToCurrentTypeRange:k,aroundRange:ee}=u.value;return{timeNum:C,relativeToCurrentType:S,around:V,intervalType:P,relativeToCurrentRange:L,regularOrTrends:d,timeGranularity:w,timeNumRange:Y,relativeToCurrentTypeRange:k,aroundRange:ee,timeGranularityMultiple:h.timeGranularityMultiple}}),s=H(()=>{const C=h.timeGranularityMultiple.split("time").join("");return u.value.intervalType==="timeInterval"?C:C.split("range")[0]});ce(()=>t.value,()=>{g()},{deep:!0});const g=()=>{const{timeNum:C,relativeToCurrentType:S,around:V,relativeToCurrentRange:L,regularOrTrends:P,timeNumRange:d,relativeToCurrentTypeRange:w,aroundRange:Y}=t.value;if(P==="fixed"){if(Array.isArray(u.value.regularOrTrendsValue)&&u.value.regularOrTrendsValue.length)return;u.value.regularOrTrendsValue=[na(w,"add",0),na(w,"add",1)];return}const k=na(S,V==="f"?"subtract":"add",C),ee=na(w,Y==="f"?"subtract":"add",d);if(L&&L!=="custom"){u.value.regularOrTrendsValue=Ft(L);return}u.value.regularOrTrendsValue=[k,ee]};ha(()=>{g()});const y=H(()=>h.timeGranularityMultiple==="yearrange"?"YYYY":void 0);return(C,S)=>{const V=La;return v(),j(V,{disabled:a(u).regularOrTrends!=="fixed",modelValue:a(u).regularOrTrendsValue,"onUpdate:modelValue":S[0]||(S[0]=L=>a(u).regularOrTrendsValue=L),key:s.value,type:s.value,"prefix-icon":a(Ja),format:y.value,"range-separator":C.$t("cron.to"),"start-placeholder":C.$t("datasource.start_time"),"end-placeholder":C.$t("datasource.end_time")},null,8,["disabled","modelValue","type","prefix-icon","format","range-separator","start-placeholder","end-placeholder"])}}}),$i={class:"set-time-filtering-range"},Di={class:"title"},Oi={class:"list-item"},qi={class:"label"},Ni={class:"setting-content"},Ei={class:"setting"},xi={key:0,class:"list-item"},Ii={class:"label"},Ri={class:"setting-content"},Li={class:"setting"},Yi={key:0,class:"setting"},Ui={class:"setting-label"},Bi={class:"setting-value select"},Gi={key:1,class:"setting"},Pi={class:"setting-input"},ji={class:"setting"},Hi={class:"setting-label"},zi={class:"setting-value select"},Wi={class:"setting-label"},Qi={class:"setting-input range"},Ki={class:"setting-label"},Zi={class:"setting-input range"},Ji={key:0,class:"setting-label"},Xi={class:"list-item"},eu={class:"label"},au={key:0,class:"setting-content maximum-single-query"},tu=xe({__name:"RangeFilterTime",props:{timeRange:{type:Object,default:()=>({intervalType:"none",dynamicWindow:!1,maximumSingleQuery:0,regularOrTrends:"fixed",relativeToCurrentRange:"custom",regularOrTrendsValue:"",relativeToCurrent:"custom",timeNum:0,relativeToCurrentType:"year",around:"f",timeNumRange:0,relativeToCurrentTypeRange:"year",aroundRange:"f"})},timeGranularityMultiple:{type:String,default:"yearrange"}},setup(r){const h=r,{t:u}=oa(),t=[{label:u("chart.line_symbol_none"),value:"none"},{label:u("v_query.start_at"),value:"start"},{label:u("v_query.end_at"),value:"end"},{label:u("v_query.time_interval"),value:"timeInterval"}],s=H(()=>t.find(w=>w.value===g.value.intervalType).label),{timeRange:g}=ea(h),y=H(()=>g.value.regularOrTrends!=="fixed"),C=H(()=>{const{intervalType:w}=g.value;return w==="timeInterval"?Ai:wi}),S=[{label:u("dynamic_time.before"),value:"f"},{label:u("dynamic_time.after"),value:"b"}],V=H(()=>{if(!g.value)return[];let w=["yearrange","monthrange","daterange","datetimerange"].indexOf(h.timeGranularityMultiple)+1;return[{label:u("dynamic_time.year"),value:"year"},{label:u("dynamic_time.month"),value:"month"},{label:u("dynamic_time.date"),value:"day"}].slice(0,w)}),L=H(()=>(V.value[V.value.length-1]||{}).label),P=H(()=>{let w=[];if(!g.value)return w;switch(h.timeGranularityMultiple){case"yearrange":w=[{label:u("dynamic_year.current"),value:"thisYear"},{label:u("dynamic_year.last"),value:"lastYear"}];break;case"monthrange":w=[{label:u("cron.this_month"),value:"thisMonth"},{label:u("dynamic_month.last"),value:"lastMonth"}];break;case"daterange":w=[{label:u("dynamic_time.today"),value:"today"},{label:u("dynamic_time.yesterday"),value:"yesterday"},{label:u("dynamic_time.firstOfMonth"),value:"monthBeginning"},{label:u("dynamic_time.firstOfYear"),value:"yearBeginning"}];break;case"datetimerange":w=[{label:u("dynamic_time.today"),value:"today"},{label:u("dynamic_time.yesterday"),value:"yesterday"},{label:u("dynamic_time.firstOfMonth"),value:"monthBeginning"},{label:u("dynamic_time.firstOfYear"),value:"yearBeginning"}];break}return[...w,{label:u("dynamic_time.custom"),value:"custom"}]}),d=H(()=>{let w=[];if(!g.value)return w;switch(h.timeGranularityMultiple){case"yearrange":w=[{label:u("dynamic_year.current"),value:"thisYear"},{label:u("dynamic_year.last"),value:"lastYear"}];break;case"monthrange":w=[{label:u("cron.this_month"),value:"thisMonth"},{label:u("dynamic_month.dynamic_month"),value:"lastMonth"},{label:u("v_query.last_3_months"),value:"LastThreeMonths"},{label:u("v_query.last_6_months"),value:"LastSixMonths"},{label:u("v_query.last_12_months"),value:"LastTwelveMonths"}];break;case"daterange":case"datetimerange":w=[{label:u("dynamic_time.today"),value:"today"},{label:u("dynamic_time.yesterday"),value:"yesterday"},{label:u("v_query.last_3_days"),value:"LastThreeDays"},{label:u("v_query.month_to_date"),value:"monthBeginning"},{label:u("v_query.year_to_date"),value:"yearBeginning"}];break}return[...w,{label:u("dynamic_time.custom"),value:"custom"}]});return(w,Y)=>{const k=at,ee=tt,W=Ia,Z=De,B=wt,re=St;return v(),$("div",$i,[b("div",Di,F(a(u)("v_query.time_filter_range")),1),b("div",Oi,[b("div",qi,F(a(u)("v_query.interval_type")),1),b("div",Ni,[b("div",Ei,[i(ee,{modelValue:a(g).intervalType,"onUpdate:modelValue":Y[0]||(Y[0]=m=>a(g).intervalType=m)},{default:o(()=>[(v(),$(oe,null,he(t,m=>i(k,{key:m.value,label:m.value},{default:o(()=>[J(F(m.label),1)]),_:2},1032,["label"])),64))]),_:1},8,["modelValue"])])])]),a(g).intervalType!=="none"?(v(),$("div",xi,[b("div",Ii,F(s.value),1),b("div",Ri,[b("div",Li,[i(ee,{modelValue:a(g).regularOrTrends,"onUpdate:modelValue":Y[1]||(Y[1]=m=>a(g).regularOrTrends=m)},{default:o(()=>[i(k,{label:"fixed"},{default:o(()=>[J(F(a(u)("dynamic_time.fix")),1)]),_:1}),i(k,{label:"dynamic"},{default:o(()=>[J(F(a(u)("dynamic_time.dynamic")),1)]),_:1})]),_:1},8,["modelValue"])]),y.value&&a(g).intervalType!=="timeInterval"?(v(),$(oe,{key:0},[a(g).intervalType!=="timeInterval"?(v(),$("div",Yi,[b("div",Ui,F(a(u)("dynamic_time.relative")),1),b("div",Bi,[i(Z,{modelValue:a(g).relativeToCurrent,"onUpdate:modelValue":Y[2]||(Y[2]=m=>a(g).relativeToCurrent=m)},{default:o(()=>[(v(!0),$(oe,null,he(P.value,m=>(v(),j(W,{key:m.value,label:m.label,value:m.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])])):K("",!0),a(g).relativeToCurrent==="custom"?(v(),$("div",Gi,[b("div",Pi,[i(B,{modelValue:a(g).timeNum,"onUpdate:modelValue":Y[3]||(Y[3]=m=>a(g).timeNum=m),min:0,"controls-position":"right"},null,8,["modelValue"]),i(Z,{modelValue:a(g).relativeToCurrentType,"onUpdate:modelValue":Y[4]||(Y[4]=m=>a(g).relativeToCurrentType=m)},{default:o(()=>[(v(!0),$(oe,null,he(V.value,m=>(v(),j(W,{key:m.value,label:m.label,value:m.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),i(Z,{modelValue:a(g).around,"onUpdate:modelValue":Y[5]||(Y[5]=m=>a(g).around=m)},{default:o(()=>[(v(),$(oe,null,he(S,m=>i(W,{key:m.value,label:m.label,value:m.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])])])):K("",!0)],64)):y.value&&a(g).intervalType==="timeInterval"?(v(),$(oe,{key:1},[b("div",ji,[b("div",Hi,F(a(u)("dynamic_time.relative")),1),b("div",zi,[i(Z,{modelValue:a(g).relativeToCurrentRange,"onUpdate:modelValue":Y[6]||(Y[6]=m=>a(g).relativeToCurrentRange=m)},{default:o(()=>[(v(!0),$(oe,null,he(d.value,m=>(v(),j(W,{key:m.value,label:m.label,value:m.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])]),a(g).relativeToCurrentRange==="custom"?(v(),$(oe,{key:0},[b("div",{class:Fe(["setting",["yearrange","monthrange"].includes(r.timeGranularityMultiple)&&"is-year-month-range"])},[b("div",Wi,F(a(u)("datasource.start_time")),1),b("div",Qi,[i(B,{"step-strictly":"",modelValue:a(g).timeNum,"onUpdate:modelValue":Y[7]||(Y[7]=m=>a(g).timeNum=m),min:0,"controls-position":"right"},null,8,["modelValue"]),i(Z,{modelValue:a(g).relativeToCurrentType,"onUpdate:modelValue":Y[8]||(Y[8]=m=>a(g).relativeToCurrentType=m)},{default:o(()=>[(v(!0),$(oe,null,he(V.value,m=>(v(),j(W,{key:m.value,label:m.label,value:m.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),i(Z,{modelValue:a(g).around,"onUpdate:modelValue":Y[9]||(Y[9]=m=>a(g).around=m)},{default:o(()=>[(v(),$(oe,null,he(S,m=>i(W,{key:m.value,label:m.label,value:m.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])])],2),b("div",{class:Fe(["setting",["yearrange","monthrange"].includes(r.timeGranularityMultiple)&&"is-year-month-range"])},[b("div",Ki,F(a(u)("datasource.end_time")),1),b("div",Zi,[i(B,{modelValue:a(g).timeNumRange,"onUpdate:modelValue":Y[10]||(Y[10]=m=>a(g).timeNumRange=m),min:0,"step-strictly":"","controls-position":"right"},null,8,["modelValue"]),i(Z,{modelValue:a(g).relativeToCurrentTypeRange,"onUpdate:modelValue":Y[11]||(Y[11]=m=>a(g).relativeToCurrentTypeRange=m)},{default:o(()=>[(v(!0),$(oe,null,he(V.value,m=>(v(),j(W,{key:m.value,label:m.label,value:m.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),i(Z,{modelValue:a(g).aroundRange,"onUpdate:modelValue":Y[12]||(Y[12]=m=>a(g).aroundRange=m)},{default:o(()=>[(v(),$(oe,null,he(S,m=>i(W,{key:m.value,label:m.label,value:m.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])])],2)],64)):K("",!0)],64)):K("",!0)]),b("div",{class:Fe(["parameters",y.value&&"setting"])},[y.value?(v(),$("div",Ji,F(a(u)("template_manage.preview")),1)):K("",!0),b("div",{class:Fe(y.value?"setting-value":"w100")},[(v(),j(Be(C.value),{config:a(g),timeGranularityMultiple:r.timeGranularityMultiple,ref:"inputCom"},null,8,["config","timeGranularityMultiple"]))],2)],2)])):K("",!0),b("div",Xi,[b("div",eu,[i(re,{modelValue:a(g).dynamicWindow,"onUpdate:modelValue":Y[13]||(Y[13]=m=>a(g).dynamicWindow=m),label:a(u)("v_query.query_time_window")},null,8,["modelValue","label"])]),a(g).dynamicWindow?(v(),$("div",au,[J(F(a(u)("v_query.maximum_single_query"))+" ",1),i(B,{modelValue:a(g).maximumSingleQuery,"onUpdate:modelValue":Y[14]||(Y[14]=m=>a(g).maximumSingleQuery=m),min:1,"controls-position":"right"},null,8,["modelValue"]),J(" "+F(L.value),1)])):K("",!0)])])}}});const lu=xe({__name:"DynamicTime",props:{config:{type:Object,default:()=>({defaultValue:"",selectValue:"",timeType:"fixed",relativeToCurrent:"custom",timeNum:0,relativeToCurrentType:"year",around:"f",arbitraryTime:new Date,defaultValueCheck:!1,timeGranularity:"date"})}},setup(r){const h=r,u=X(),{config:t}=ea(h),s=H(()=>{const{relativeToCurrent:y,timeNum:C,relativeToCurrentType:S,around:V,defaultValueCheck:L,arbitraryTime:P,timeGranularity:d}=t.value;return{relativeToCurrent:y,timeNum:C,relativeToCurrentType:S,around:V,defaultValueCheck:L,arbitraryTime:P,timeGranularity:d}});ce(()=>s.value,()=>{g()},{deep:!0}),ce(()=>u.value,y=>{t.value.defaultValue=y,t.value.selectValue=y}),ce(()=>t.value.id,()=>{g()});const g=()=>{const{relativeToCurrent:y,timeNum:C,relativeToCurrentType:S,around:V,defaultValueCheck:L,arbitraryTime:P,timeGranularity:d}=s.value;if(!L){u.value=null;return}if(y==="custom")u.value=qa(C,S,d,V,d==="datetime"?P:null);else switch(y){case"thisYear":u.value=Gn();break;case"lastYear":u.value=Bn();break;case"thisMonth":u.value=Un();break;case"lastMonth":u.value=Yn();break;case"today":u.value=Ln();break;case"yesterday":u.value=Rn();break;case"monthBeginning":u.value=In();break;case"yearBeginning":u.value=xn();break}};return ha(()=>{g()}),(y,C)=>{const S=La;return v(),j(S,{disabled:"",key:a(t).timeGranularity,modelValue:u.value,"onUpdate:modelValue":C[0]||(C[0]=V=>u.value=V),type:a(t).timeGranularity,"prefix-icon":a(Ja),placeholder:y.$t("commons.date.select_date_time")},null,8,["modelValue","type","prefix-icon","placeholder"])}}}),nu=xe({__name:"DynamicTimeRange",props:{config:{type:Object,default:()=>({timeGranularityMultiple:"datetimerange",defaultValue:[],selectValue:[],timeType:"fixed",timeNum:0,relativeToCurrentType:"year",around:"f",arbitraryTime:new Date,defaultValueCheck:!1,timeGranularity:"date",timeNumRange:0,relativeToCurrentRange:"custom",relativeToCurrentTypeRange:"year",aroundRange:"f",arbitraryTimeRange:new Date})}},setup(r){const h=r,u=X([new Date,new Date]),{config:t}=ea(h),s=H(()=>{const{timeNum:C,relativeToCurrentType:S,timeGranularityMultiple:V,around:L,relativeToCurrentRange:P,defaultValueCheck:d,arbitraryTime:w,timeGranularity:Y,timeNumRange:k,relativeToCurrentTypeRange:ee,aroundRange:W,arbitraryTimeRange:Z}=t.value;return{timeNum:C,relativeToCurrentType:S,around:L,relativeToCurrentRange:P,timeGranularityMultiple:V,defaultValueCheck:d,arbitraryTime:w,timeGranularity:Y,timeNumRange:k,relativeToCurrentTypeRange:ee,aroundRange:W,arbitraryTimeRange:Z}});ce(()=>s.value,()=>{g()},{deep:!0}),ce(()=>u.value,C=>{t.value.defaultValue=C,t.value.selectValue=C}),ce(()=>t.value.id,()=>{g()});const g=()=>{const{timeNum:C,relativeToCurrentType:S,around:V,defaultValueCheck:L,arbitraryTime:P,timeGranularity:d,timeGranularityMultiple:w,timeNumRange:Y,relativeToCurrentTypeRange:k,aroundRange:ee,relativeToCurrentRange:W,arbitraryTimeRange:Z}=s.value;if(!L){u.value=[new Date,new Date];return}if(W!=="custom"){u.value=Ft(W);return}const B=qa(C,S,d,V,P,w,"start-config"),re=qa(Y,k,d,ee,Z,w,"end-config");u.value=[B,re]};ha(()=>{g()});const y=H(()=>t.value.timeGranularityMultiple==="yearrange"?"YYYY":void 0);return(C,S)=>{const V=La;return v(),j(V,{disabled:"",modelValue:u.value,"onUpdate:modelValue":S[0]||(S[0]=L=>u.value=L),key:a(t).timeGranularityMultiple,type:a(t).timeGranularityMultiple,"prefix-icon":a(Ja),format:y.value,"range-separator":C.$t("cron.to"),"start-placeholder":C.$t("datasource.start_time"),"end-placeholder":C.$t("datasource.end_time")},null,8,["modelValue","type","prefix-icon","format","range-separator","start-placeholder","end-placeholder"])}}});var Sl={exports:{}};(function(r,h){(function(u,t){r.exports=t()})(Kn,function(){var u="month",t="quarter";return function(s,g){var y=g.prototype;y.quarter=function(V){return this.$utils().u(V)?Math.ceil((this.month()+1)/3):this.month(this.month()%3+3*(V-1))};var C=y.add;y.add=function(V,L){return V=Number(V),this.$utils().p(L)===t?this.add(3*V,u):C.bind(this)(V,L)};var S=y.startOf;y.startOf=function(V,L){var P=this.$utils(),d=!!P.u(L)||L;if(P.p(V)===t){var w=this.quarter()-1;return d?this.month(3*w).startOf(u).startOf("day"):this.month(3*w+2).endOf(u).endOf("day")}return S.bind(this)(V,L)}}})})(Sl);var iu=Sl.exports;const uu=Zn(iu),{t:ru}=oa();Me.extend(uu);function ja(r="month"){return new Date(Me().startOf(r).format("YYYY/MM/DD HH:mm:ss"))}function Ha(r="month"){return new Date(Me().endOf(r).format("YYYY/MM/DD HH:mm:ss"))}function za(r="month"){return new Date(Me().subtract(1,r).startOf(r).format("YYYY/MM/DD HH:mm:ss"))}function Wa(r="month"){return new Date(Me().subtract(1,r).endOf(r).format("YYYY/MM/DD HH:mm:ss"))}let va=()=>{};const Fl=[{text:"dynamic_time.cweek",onClick:({emit:r})=>{const h=new Date(+new Date(ja("week"))+864e5),u=new Date(+new Date(Ha("week"))+24*1e3*3600);va([h,u])||r("pick",[Me(h),Me(u)])}},{text:"dynamic_month.current",onClick:({emit:r})=>{const h=ja("month"),u=Ha("month");va([h,u])||r("pick",[Me(h),Me(u)])}},{text:"dynamic_time.cquarter",onClick:({emit:r})=>{const h=ja("quarter"),u=Ha("quarter");va([h,u])||r("pick",[Me(h),Me(u)])}},{text:"dynamic_year.current",onClick:({emit:r})=>{const h=ja("year"),u=Ha("year");va([h,u])||r("pick",[Me(h),Me(u)])}},{text:"dynamic_time.lweek",onClick:({emit:r})=>{const h=new Date(+new Date(za("week"))+864e5),u=new Date(+new Date(Wa("week"))+24*1e3*3600);va([h,u])||r("pick",[Me(h),Me(u)])}},{text:"dynamic_month.last",onClick:({emit:r})=>{const h=za("month"),u=Wa("month");va([h,u])||r("pick",[Me(h),Me(u)])}},{text:"dynamic_time.lquarter",onClick:({emit:r})=>{const h=za("quarter"),u=Wa("quarter");va([h,u])||r("pick",[Me(h),Me(u)])}},{text:"dynamic_year.last",onClick:({emit:r})=>{const h=za("year"),u=Wa("year");va([h,u])||r("pick",[Me(h),Me(u)])}}];Fl.forEach(r=>{r.text=ru(r.text)});const ou=r=>(va=r,{shortcuts:Fl}),[su,pa,Xt]=Aa("picker"),wl=r=>r.find(h=>!h.disabled)||r[0];function du(r,h){const u=r[0];if(u){if(Array.isArray(u))return"multiple";if(h.children in u)return"cascade"}return"default"}function Ka(r,h){h=Za(h,0,r.length);for(let u=h;u<r.length;u++)if(!r[u].disabled)return u;for(let u=h-1;u>=0;u--)if(!r[u].disabled)return u;return 0}const el=(r,h,u)=>h!==void 0&&!!r.find(t=>t[u.value]===h);function Vt(r,h,u){const t=r.findIndex(g=>g[u.value]===h),s=Ka(r,t);return r[s]}function cu(r,h,u){const t=[];let s={[h.children]:r},g=0;for(;s&&s[h.children];){const y=s[h.children],C=u.value[g];if(s=ti(C)?Vt(y,C,h):void 0,!s&&y.length){const S=wl(y)[h.value];s=Vt(y,S,h)}g++,t.push(y)}return t}function mu(r){const{transform:h}=window.getComputedStyle(r),u=h.slice(7,h.length-1).split(", ")[5];return Number(u)}function vu(r){return ya({text:"text",value:"value",children:"children"},r)}const al=200,tl=300,pu=15,[Al,gt]=Aa("picker-column"),$l=Symbol(Al);var fu=xe({name:Al,props:{value:_t,fields:Pa(Object),options:Na(),readonly:Boolean,allowHtml:Boolean,optionHeight:Pa(Number),swipeDuration:Pa(_t),visibleOptionNum:Pa(_t)},emits:["change","clickOption","scrollInto"],setup(r,{emit:h,slots:u}){let t,s,g,y,C;const S=X(),V=X(),L=X(0),P=X(0),d=ui(),w=()=>r.options.length,Y=()=>r.optionHeight*(+r.visibleOptionNum-1)/2,k=E=>{let f=Ka(r.options,E);const U=-f*r.optionHeight,Q=()=>{f>w()-1&&(f=Ka(r.options,E));const $e=r.options[f][r.fields.value];$e!==r.value&&h("change",$e)};t&&U!==L.value?C=Q:Q(),L.value=U},ee=()=>r.readonly||!r.options.length,W=E=>{t||ee()||(C=null,P.value=al,k(E),h("clickOption",r.options[E]))},Z=E=>Za(Math.round(-E/r.optionHeight),0,w()-1),B=H(()=>Z(L.value)),re=(E,f)=>{const U=Math.abs(E/f);E=L.value+U/.003*(E<0?-1:1);const Q=Z(E);P.value=+r.swipeDuration,k(Q)},m=()=>{t=!1,P.value=0,C&&(C(),C=null)},q=E=>{if(!ee()){if(d.start(E),t){const f=mu(V.value);L.value=Math.min(0,f-Y())}P.value=0,s=L.value,g=Date.now(),y=s,C=null}},ae=E=>{if(ee())return;d.move(E),d.isVertical()&&(t=!0,Vl(E,!0));const f=Za(s+d.deltaY.value,-(w()*r.optionHeight),r.optionHeight),U=Z(f);U!==B.value&&h("scrollInto",r.options[U]),L.value=f;const Q=Date.now();Q-g>tl&&(g=Q,y=f)},e=()=>{if(ee())return;const E=L.value-y,f=Date.now()-g;if(f<tl&&Math.abs(E)>pu){re(E,f);return}const Q=Z(L.value);P.value=al,k(Q),setTimeout(()=>{t=!1},0)},pe=()=>{const E={height:`${r.optionHeight}px`};return r.options.map((f,U)=>{const Q=f[r.fields.text],{disabled:$e}=f,_e=f[r.fields.value],Oe={role:"button",style:E,tabindex:$e?-1:0,class:[gt("item",{disabled:$e,selected:_e===r.value}),f.className],onClick:()=>W(U)},Ye={class:"van-ellipsis",[r.allowHtml?"innerHTML":"textContent"]:Q};return i("li",Oe,[u.option?u.option(f,U):i("div",Ye,null)])})};return gl($l),nt({stopMomentum:m}),pn(()=>{const E=t?Math.floor(-L.value/r.optionHeight):r.options.findIndex(Q=>Q[r.fields.value]===r.value),f=Ka(r.options,E),U=-f*r.optionHeight;t&&f<E&&m(),L.value=U}),bl("touchmove",ae,{target:S}),()=>i("div",{ref:S,class:gt(),onTouchstartPassive:q,onTouchend:e,onTouchcancel:e},[i("ul",{ref:V,style:{transform:`translate3d(0, ${L.value+Y()}px, 0)`,transitionDuration:`${P.value}ms`,transitionProperty:P.value?"all":"none"},class:gt("wrapper"),onTransitionend:m},[pe()])])}});const[yu]=Aa("picker-toolbar"),it={title:String,cancelButtonText:String,confirmButtonText:String},Dl=["cancel","confirm","title","toolbar"],hu=Object.keys(it);var Ol=xe({name:yu,props:it,emits:["confirm","cancel"],setup(r,{emit:h,slots:u}){const t=()=>{if(u.title)return u.title();if(r.title)return i("div",{class:[pa("title"),"van-ellipsis"]},[r.title])},s=()=>h("cancel"),g=()=>h("confirm"),y=()=>{var S;const V=(S=r.cancelButtonText)!=null?S:Xt("cancel");if(!(!u.cancel&&!V))return i("button",{type:"button",class:[pa("cancel"),Jt],onClick:s},[u.cancel?u.cancel():V])},C=()=>{var S;const V=(S=r.confirmButtonText)!=null?S:Xt("confirm");if(!(!u.confirm&&!V))return i("button",{type:"button",class:[pa("confirm"),Jt],onClick:g},[u.confirm?u.confirm():V])};return()=>i("div",{class:pa("toolbar")},[u.toolbar?u.toolbar():[y(),t(),C()]])}});const _u=(r,h)=>{const u=X(r());return ce(r,t=>{t!==u.value&&(u.value=t)}),ce(u,t=>{t!==r()&&h(t)}),u},[ql,bt]=Aa("picker-group"),Nl=Symbol(ql),gu=ya({tabs:Na(),activeTab:ra(0),nextStepText:String,showToolbar:Tl},it);var bu=xe({name:ql,props:gu,emits:["confirm","cancel","update:activeTab"],setup(r,{emit:h,slots:u}){const t=_u(()=>r.activeTab,V=>h("update:activeTab",V)),{children:s,linkChildren:g}=kl(Nl);g();const y=()=>+t.value<r.tabs.length-1&&r.nextStepText,C=()=>{y()?t.value=+t.value+1:h("confirm",s.map(V=>V.confirm()))},S=()=>h("cancel");return()=>{var V,L;let P=(L=(V=u.default)==null?void 0:V.call(u))==null?void 0:L.filter(w=>w.type!==fn).map(w=>w.type===oe?w.children:w);P&&(P=li(P));const d=y()?r.nextStepText:r.confirmButtonText;return i("div",{class:bt()},[r.showToolbar?i(Ol,{title:r.title,cancelButtonText:r.cancelButtonText,confirmButtonText:d,onConfirm:C,onCancel:S},Ea(u,Dl)):null,i(si,{active:t.value,"onUpdate:active":w=>t.value=w,class:bt("tabs"),shrink:!0,animated:!0,lazyRender:!1},{default:()=>[r.tabs.map((w,Y)=>i(di,{title:w,titleClass:bt("tab-title")},{default:()=>[P==null?void 0:P[Y]]}))]})])}}});const $t=ya({loading:Boolean,readonly:Boolean,allowHtml:Boolean,optionHeight:ra(44),showToolbar:Tl,swipeDuration:ra(1e3),visibleOptionNum:ra(6)},it),Vu=ya({},$t,{columns:Na(),modelValue:Na(),toolbarPosition:ni("top"),columnsFieldNames:Object});var Tu=xe({name:su,props:Vu,emits:["confirm","cancel","change","scrollInto","clickOption","update:modelValue"],setup(r,{emit:h,slots:u}){const t=X(),s=X(r.modelValue.slice(0)),{parent:g}=gl(Nl),{children:y,linkChildren:C}=kl($l);C();const S=H(()=>vu(r.columnsFieldNames)),V=H(()=>ii(r.optionHeight)),L=H(()=>du(r.columns,S.value)),P=H(()=>{const{columns:f}=r;switch(L.value){case"multiple":return f;case"cascade":return cu(f,S.value,s);default:return[f]}}),d=H(()=>P.value.some(f=>f.length)),w=H(()=>P.value.map((f,U)=>Vt(f,s.value[U],S.value))),Y=H(()=>P.value.map((f,U)=>f.findIndex(Q=>Q[S.value.value]===s.value[U]))),k=(f,U)=>{if(s.value[f]!==U){const Q=s.value.slice(0);Q[f]=U,s.value=Q}},ee=()=>({selectedValues:s.value.slice(0),selectedOptions:w.value,selectedIndexes:Y.value}),W=(f,U)=>{k(U,f),L.value==="cascade"&&s.value.forEach((Q,$e)=>{const _e=P.value[$e];el(_e,Q,S.value)||k($e,_e.length?_e[0][S.value.value]:void 0)}),we(()=>{h("change",ya({columnIndex:U},ee()))})},Z=(f,U)=>{const Q={columnIndex:U,currentOption:f};h("clickOption",ya(ee(),Q)),h("scrollInto",Q)},B=()=>{y.forEach(U=>U.stopMomentum());const f=ee();return we(()=>{h("confirm",f)}),f},re=()=>h("cancel",ee()),m=()=>P.value.map((f,U)=>i(fu,{value:s.value[U],fields:S.value,options:f,readonly:r.readonly,allowHtml:r.allowHtml,optionHeight:V.value,swipeDuration:r.swipeDuration,visibleOptionNum:r.visibleOptionNum,onChange:Q=>W(Q,U),onClickOption:Q=>Z(Q,U),onScrollInto:Q=>{h("scrollInto",{currentOption:Q,columnIndex:U})}},{option:u.option})),q=f=>{if(d.value){const U={height:`${V.value}px`},Q={backgroundSize:`100% ${(f-V.value)/2}px`};return[i("div",{class:pa("mask"),style:Q},null),i("div",{class:[oi,pa("frame")],style:U},null)]}},ae=()=>{const f=V.value*+r.visibleOptionNum,U={height:`${f}px`};return i("div",{ref:t,class:pa("columns"),style:U},[m(),q(f)])},e=()=>{if(r.showToolbar&&!g)return i(Ol,Ct(Ea(r,hu),{onConfirm:B,onCancel:re}),Ea(u,Dl))};ce(P,f=>{f.forEach((U,Q)=>{U.length&&!el(U,s.value[Q],S.value)&&k(Q,wl(U)[S.value.value])})},{immediate:!0});let pe;return ce(()=>r.modelValue,f=>{!ba(f,s.value)&&!ba(f,pe)&&(s.value=f.slice(0),pe=f.slice(0))},{deep:!0}),ce(s,f=>{ba(f,r.modelValue)||(pe=f.slice(0),h("update:modelValue",pe))},{immediate:!0}),bl("touchmove",Vl,{target:t}),nt({confirm:B,getSelectedOptions:()=>w.value}),()=>{var f,U;return i("div",{class:pa()},[r.toolbarPosition==="top"?e():null,r.loading?i(ri,{class:pa("loading")},null):null,(f=u["columns-top"])==null?void 0:f.call(u),ae(),(U=u["columns-bottom"])==null?void 0:U.call(u),r.toolbarPosition==="bottom"?e():null])}}});const El=ya({},$t,{modelValue:Na(),filter:Function,formatter:{type:Function,default:(r,h)=>h}}),xl=Object.keys($t);function ku(r,h){if(r<0)return[];const u=Array(r);let t=-1;for(;++t<r;)u[t]=h(t);return u}const Cu=(r,h)=>32-new Date(r,h-1,32).getDate(),Fa=(r,h,u,t,s,g)=>{const y=ku(h-r+1,C=>{const S=Cl(r+C);return t(u,{text:S,value:S})});return s?s(u,y,g):y},Il=(r,h)=>r.map((u,t)=>{const s=h[t];if(s.length){const g=+s[0].value,y=+s[s.length-1].value;return Cl(Za(+u,g,y))}return u}),Rl=lt(Tu),ll=new Date().getFullYear(),[Mu]=Aa("date-picker"),Su=ya({},El,{columnsType:{type:Array,default:()=>["year","month","day"]},minDate:{type:Date,default:()=>new Date(ll-10,0,1),validator:Zt},maxDate:{type:Date,default:()=>new Date(ll+10,11,31),validator:Zt}});var Fu=xe({name:Mu,props:Su,emits:["confirm","cancel","change","update:modelValue"],setup(r,{emit:h,slots:u}){const t=X(r.modelValue),s=X(!1),g=X(),y=H(()=>s.value?r.modelValue:t.value),C=m=>m===r.minDate.getFullYear(),S=m=>m===r.maxDate.getFullYear(),V=m=>m===r.minDate.getMonth()+1,L=m=>m===r.maxDate.getMonth()+1,P=m=>{const{minDate:q,columnsType:ae}=r,e=ae.indexOf(m),pe=y.value[e];if(pe)return+pe;switch(m){case"year":return q.getFullYear();case"month":return q.getMonth()+1;case"day":return q.getDate()}},d=()=>{const m=r.minDate.getFullYear(),q=r.maxDate.getFullYear();return Fa(m,q,"year",r.formatter,r.filter,y.value)},w=()=>{const m=P("year"),q=C(m)?r.minDate.getMonth()+1:1,ae=S(m)?r.maxDate.getMonth()+1:12;return Fa(q,ae,"month",r.formatter,r.filter,y.value)},Y=()=>{const m=P("year"),q=P("month"),ae=C(m)&&V(q)?r.minDate.getDate():1,e=S(m)&&L(q)?r.maxDate.getDate():Cu(m,q);return Fa(ae,e,"day",r.formatter,r.filter,y.value)},k=()=>{var m;return(m=g.value)==null?void 0:m.confirm()},ee=()=>t.value,W=H(()=>r.columnsType.map(m=>{switch(m){case"year":return d();case"month":return w();case"day":return Y();default:return[]}}));ce(t,m=>{ba(m,r.modelValue)||h("update:modelValue",m)}),ce(()=>r.modelValue,(m,q)=>{s.value=ba(q,t.value),m=Il(m,W.value),ba(m,t.value)||(t.value=m),s.value=!1},{immediate:!0});const Z=(...m)=>h("change",...m),B=(...m)=>h("cancel",...m),re=(...m)=>h("confirm",...m);return nt({confirm:k,getSelectedDate:ee}),()=>i(Rl,Ct({ref:g,modelValue:t.value,"onUpdate:modelValue":m=>t.value=m,columns:W.value,onChange:Z,onCancel:B,onConfirm:re},Ea(r,xl)),u)}});const wu=lt(Fu);var nl=wu;const[Au]=Aa("time-picker"),il=r=>/^([01]\d|2[0-3]):([0-5]\d):([0-5]\d)$/.test(r),$u=["hour","minute","second"],Du=ya({},El,{minHour:ra(0),maxHour:ra(23),minMinute:ra(0),maxMinute:ra(59),minSecond:ra(0),maxSecond:ra(59),minTime:{type:String,validator:il},maxTime:{type:String,validator:il},columnsType:{type:Array,default:()=>["hour","minute"]}});var Ou=xe({name:Au,props:Du,emits:["confirm","cancel","change","update:modelValue"],setup(r,{emit:h,slots:u}){const t=X(r.modelValue),s=X(),g=d=>{const w=d.split(":");return $u.map((Y,k)=>r.columnsType.includes(Y)?w[k]:"00")},y=()=>{var d;return(d=s.value)==null?void 0:d.confirm()},C=()=>t.value,S=H(()=>{let{minHour:d,maxHour:w,minMinute:Y,maxMinute:k,minSecond:ee,maxSecond:W}=r;if(r.minTime||r.maxTime){const Z={hour:0,minute:0,second:0};r.columnsType.forEach((m,q)=>{var ae;Z[m]=(ae=t.value[q])!=null?ae:0});const{hour:B,minute:re}=Z;if(r.minTime){const[m,q,ae]=g(r.minTime);d=m,Y=+B<=+d?q:"00",ee=+B<=+d&&+re<=+Y?ae:"00"}if(r.maxTime){const[m,q,ae]=g(r.maxTime);w=m,k=+B>=+w?q:"59",W=+B>=+w&&+re>=+k?ae:"59"}}return r.columnsType.map(Z=>{const{filter:B,formatter:re}=r;switch(Z){case"hour":return Fa(+d,+w,Z,re,B,t.value);case"minute":return Fa(+Y,+k,Z,re,B,t.value);case"second":return Fa(+ee,+W,Z,re,B,t.value);default:return[]}})});ce(t,d=>{ba(d,r.modelValue)||h("update:modelValue",d)}),ce(()=>r.modelValue,d=>{d=Il(d,S.value),ba(d,t.value)||(t.value=d)},{immediate:!0});const V=(...d)=>h("change",...d),L=(...d)=>h("cancel",...d),P=(...d)=>h("confirm",...d);return nt({confirm:y,getSelectedTime:C}),()=>i(Rl,Ct({ref:s,modelValue:t.value,"onUpdate:modelValue":d=>t.value=d,columns:S.value,onChange:V,onCancel:L,onConfirm:P},Ea(r,xl)),u)}});const qu=lt(Ou);var Nu=qu;const Eu=lt(bu);var xu=Eu;const Ll=xe({__name:"Time",props:{config:{type:Object,default:()=>({selectValue:"",defaultValue:"",defaultValueCheck:!1,displayType:"1",timeGranularity:"date",setTimeRange:!1,timeGranularityMultiple:"daterange",timeRange:{intervalType:"none",dynamicWindow:!1,maximumSingleQuery:0,regularOrTrends:"fixed",regularOrTrendsValue:"",relativeToCurrent:"custom",timeNum:0,relativeToCurrentType:"year",around:"f",timeNumRange:0,relativeToCurrentTypeRange:"year",aroundRange:"f"}})},isConfig:{type:Boolean,default:!1}},setup(r,{expose:h}){const{t:u}=oa(),t=r,s=Ee("placeholder"),g=H(()=>{var te;return(te=s==null?void 0:s.value)!=null&&te.placeholderShow?t.config.placeholder:" "}),y=X(),C=X(!1),S=Ra(),{config:V}=ea(t),L=new Date("1970/1/1"),P=new Date("2100/1/1");ce(()=>V.value.defaultValue,te=>{if(t.isConfig)return;const _=V.value.displayType==="7";_&&(C.value=_),y.value=Array.isArray(te)?[...te]:te,we(()=>{C.value=_})});const d=te=>{U.value=te[0];const _=te.some(fe=>Oe(fe));return U.value=0,_},{shortcuts:w}=ou(d);ce(()=>V.value.id,()=>{ee()});const Y=()=>{t.isConfig&&(C.value&&V.value.displayType==="7"||(y.value=V.value.displayType==="7"?[]:void 0,C.value=V.value.displayType==="7",V.value.defaultValue=C.value?[]:void 0,y.value=C.value?[]:void 0))};ce(()=>V.value.selectValue,te=>{t.isConfig||(V.value.displayType==="7"&&(y.value=Array.isArray(te)?[...te]:te),we(()=>{C.value=V.value.displayType==="7",C.value||(y.value=Array.isArray(V.value.selectValue)?[...V.value.selectValue]:V.value.selectValue)}))});const k=()=>{const te=Array.isArray(y.value)?[...y.value]:y.value;if(!t.isConfig){V.value.selectValue=Array.isArray(y.value)?[...y.value]:y.value,we(()=>{Z(V.value.id)});return}V.value.defaultValue=Array.isArray(te)?te.map(_=>new Date(_).toLocaleString()):new Date(te).toLocaleString()},ee=()=>{const{defaultValueCheck:te,displayType:_,defaultValue:fe}=V.value,Ce=_==="7";te?(V.value.selectValue=Array.isArray(fe)?[...fe]:fe,y.value=Array.isArray(fe)?[...fe]:fe):(V.value.selectValue=Ce?[]:void 0,y.value=Ce?[]:void 0),C.value=V.value.displayType==="7",ae.value=ae.value.slice(0,f()+1)},W=Ee("com-width",Function,!0),Z=Ee("is-confirm-search",Function,!0),B=H(()=>t.isConfig?{}:{width:(C.value?W()*2:W())+"px !important"}),re=H(()=>S.mobileInPc?["year","month","day"].slice(0,f()+1):[]),m=H(()=>S.mobileInPc?(C.value?V.value.timeGranularityMultiple:V.value.timeGranularity).includes("datetime"):!1),q=X([]),ae=X(["2021","01","01"]),e=X(!1),pe=H(()=>S.mobileInPc?+V.value.displayType==7:!1),E=()=>{var _;const te=((_=y.value)==null?void 0:_.length)>1?y.value[1]:null;if(te){const fe=new Date(te);ae.value=[`${fe.getFullYear()}`,`${fe.getMonth()+1}`,`${fe.getDate()}`].slice(0,f()+1),m.value&&(q.value=[`${fe.getHours()}`,`${fe.getMinutes()}`,`${fe.getSeconds()}`])}aa.value=!0,e.value=!0},f=()=>{const te=C.value?V.value.timeGranularityMultiple:V.value.timeGranularity;return["year","month","date"].findIndex(fe=>te.includes(fe))},U=X(0),Q=te=>{U.value=+new Date(te[0])},$e=()=>{U.value=0},_e=H(()=>{const te=V.value.timeGranularityMultiple.split("time").join("").split("range")[0];return te==="date"?"day":te}),Oe=te=>{const _=+new Date(te);if(!V.value.setTimeRange)return!1;const{intervalType:fe,regularOrTrends:Ce,regularOrTrendsValue:le,relativeToCurrent:x,timeNum:ne,relativeToCurrentType:z,around:ie,dynamicWindow:ye,maximumSingleQuery:Ve,timeNumRange:A,relativeToCurrentTypeRange:O,aroundRange:ue}=V.value.timeRange||{};let de=!1;if(U.value&&ye&&(de=Me(U.value).add(Ve,_e.value).startOf(_e.value).valueOf()-1e3<_),fe==="none")return ye?de:!1;let D;if(x==="custom")D=na(z,ie==="f"?"subtract":"add",ne);else switch(x){case"thisYear":D=ze("year");break;case"lastYear":D=fa("year");break;case"thisMonth":D=ze("month");break;case"lastMonth":D=fa("month");break;case"today":D=ze("day");break;case"yesterday":D=fa("day");break;case"monthBeginning":D=ze("month");break;case"yearBeginning":D=ze("year");break}const Ie=Ce==="fixed"?le:D;if(fe==="start")return _<+new Date(Ie)||de;if(fe==="end")return _>+new Date(Ie)||de;if(fe==="timeInterval"){const me=Ce==="fixed"?new Date(Me(new Date(le[0])).startOf(_e.value).format("YYYY/MM/DD HH:mm:ss")):na(z,ie==="f"?"subtract":"add",ne),Ue=Ce==="fixed"?new Date(Me(new Date(le[1])).endOf(_e.value).format("YYYY/MM/DD HH:mm:ss")):na(O,ue==="f"?"subtract":"add",A);return _<+new Date(me)-1e3||_>+new Date(Ue)||de}},Ye=()=>{if(pe.value){const[te]=y.value||[];if(te){const _=new Date(te);ae.value=[`${_.getFullYear()}`,`${_.getMonth()+1}`,`${_.getDate()}`].slice(0,f()+1),m.value&&(q.value=[`${_.getHours()}`,`${_.getMinutes()}`,`${_.getSeconds()}`])}}else{const te=y.value?new Date(y.value):new Date;ae.value=[`${te.getFullYear()}`,`${te.getMonth()+1}`,`${te.getDate()}`].slice(0,f()+1),m.value&&(q.value=[`${te.getHours()}`,`${te.getMinutes()}`,`${te.getSeconds()}`])}aa.value=!1,e.value=!0},We=()=>{e.value=!1},aa=X(!1),ia=()=>{if(ae.value=ae.value.slice(0,f()+1),pe.value){const[te,_]=y.value||[];aa.value?y.value=[te||new Date(`${ae.value.join("/")} ${q.value.join(":")}`),new Date(`${ae.value.join("/")} ${q.value.join(":")}`)]:y.value=[new Date(`${ae.value.join("/")} ${q.value.join(":")}`),_||new Date(`${ae.value.join("/")} ${q.value.join(":")}`)]}else y.value=new Date(`${ae.value.join("/")} ${q.value.join(":")}`)},Je=()=>{ia(),k(),e.value=!1};ha(()=>{ee()}),h({displayTypeChange:Y});const Ge=H(()=>V.value.timeGranularityMultiple==="yearrange"?"YYYY":void 0);return(te,_)=>{const fe=La;return v(),$(oe,null,[C.value?(v(),j(fe,{modelValue:y.value,"onUpdate:modelValue":_[0]||(_[0]=Ce=>y.value=Ce),key:a(V).timeGranularityMultiple,type:a(V).timeGranularityMultiple,style:Ae(B.value),onVisibleChange:$e,"disabled-date":Oe,onCalendarChange:Q,format:Ge.value,shortcuts:["datetimerange","daterange"].includes(a(V).timeGranularityMultiple)?a(w):[],onChange:k,editable:!1,"range-separator":te.$t("cron.to"),"start-placeholder":g.value,"end-placeholder":g.value},null,8,["modelValue","type","style","format","shortcuts","range-separator","start-placeholder","end-placeholder"])):(v(),j(fe,{key:a(V).timeGranularity+1,modelValue:y.value,"onUpdate:modelValue":_[1]||(_[1]=Ce=>y.value=Ce),type:a(V).timeGranularity,onChange:k,style:Ae(B.value),placeholder:g.value},null,8,["modelValue","type","style","placeholder"])),a(S).mobileInPc?(v(),$("div",{key:2,class:Fe(["vant-mobile",pe.value&&"wl50"]),onClick:Ye},null,2)):K("",!0),a(S).mobileInPc&&pe.value?(v(),$("div",{key:3,class:"vant-mobile wr50",onClick:E})):K("",!0),a(S).mobileInPc?(v(),j(a(ai),{key:4,teleport:"body",position:"bottom",show:e.value,"onUpdate:show":_[5]||(_[5]=Ce=>e.value=Ce)},{default:o(()=>[m.value?(v(),j(a(xu),{key:0,onConfirm:Je,onCancel:We,title:a(u)("v_query.time_selection"),tabs:[a(u)("dataset.select_date"),a(u)("dataset.select_time")],"next-step-text":a(u)("sync_datasource.next")},{default:o(()=>[i(a(nl),{"min-date":a(L),"max-date":a(P),"columns-type":re.value,modelValue:ae.value,"onUpdate:modelValue":_[2]||(_[2]=Ce=>ae.value=Ce)},null,8,["min-date","max-date","columns-type","modelValue"]),i(a(Nu),{"columns-type":["hour","minute","second"],modelValue:q.value,"onUpdate:modelValue":_[3]||(_[3]=Ce=>q.value=Ce)},null,8,["modelValue"])]),_:1},8,["title","tabs","next-step-text"])):K("",!0),m.value?K("",!0):(v(),j(a(nl),{key:1,title:a(u)("dataset.select_date"),"columns-type":re.value,onConfirm:Je,onCancel:We,"min-date":a(L),"max-date":a(P),modelValue:ae.value,"onUpdate:modelValue":_[4]||(_[4]=Ce=>ae.value=Ce)},null,8,["title","columns-type","min-date","max-date","modelValue"]))]),_:1},8,["show"])):K("",!0)],64)}}});const Yl=xe({__name:"Select",props:{config:{type:Object,default:()=>({selectValue:"",resultMode:0,defaultValue:"",displayType:"",defaultValueCheck:!1,optionValueSource:0,multiple:!1,checkedFieldsMap:{}})},isConfig:{type:Boolean,default:!1}},setup(r,{expose:h}){const{t:u}=oa(),t=r,{config:s}=ea(t);let g=[];const y=X(),C=X(!1),S=X(!1),V=xa([]),L=Ee("unmount-select"),P=Ee("placeholder"),d=Ee("release-unmount-select",Function,!0),w=Ee("query-data-for-id",Function,!0),Y=Ee("is-confirm-search",Function,!0),k=Ee("com-width",Function,!0),ee=Ee("cascade-list",Function,!0),W=Ee("set-cascade-default",Function,!0),Z=H(()=>{var x;return(x=P==null?void 0:P.value)!=null&&x.placeholderShow?["",void 0].includes(t.config.placeholder)?" ":t.config.placeholder:" "}),B=H(()=>ee()||[]),re=x=>{const{displayId:ne,field:z}=s.value;if(s.value.optionValueSource!==1)return[];let ie={},ye=[];return x.forEach(Ve=>{ie[Ve]=[]}),g.forEach(Ve=>{ie[Ve[ne||(z==null?void 0:z.id)]]&&ie[Ve[ne||(z==null?void 0:z.id)]].push(Ve[z==null?void 0:z.id])}),Object.values(ie).forEach(Ve=>{ye=[...new Set([...ye,...Ve])]}),ye};yn(()=>{g=[]});const m=x=>{B.value.forEach(ne=>{ne.forEach(z=>{z.datasetId.split("--")[1]===s.value.id&&(t.isConfig&&(z.selectValue=Array.isArray(x)?[...x]:x),z.currentSelectValue=Array.isArray(x)?[...x]:x)})})},q=()=>{B.value.forEach(x=>{let ne=!1;x.forEach(z=>{z.datasetId.split("--")[1]===s.value.id?ne=!0:ne&&(Da().emitter.emit(`${z.datasetId.split("--")[1]}-select`),ne=!1)})})},ae=()=>{const x=[];return B.value.forEach(ne=>{let z=!1;ne.forEach(ie=>{ie.datasetId.split("--")[1]===s.value.id?z=!0:z&&(x.push(ie.datasetId.split("--")[1]),z=!1)})}),x},e=()=>{const x=[];return B.value.forEach(ne=>{let z=null;ne.forEach(ie=>{var O,ue;const[ye,Ve,A]=ie.datasetId.split("--");Ve===s.value.id&&z?(ie.fieldId&&(z.fieldId=ie.fieldId),x.push(z)):t.isConfig?(O=ie.selectValue)!=null&&O.length&&(z={fieldId:A,operator:"in",value:[...ie.selectValue]}):(ue=ie.currentSelectValue)!=null&&ue.length&&(z={fieldId:A,operator:"in",value:[...ie.currentSelectValue]})})}),x},pe=()=>{const x=Array.isArray(y.value)?[...y.value]:y.value;if(!t.isConfig){s.value.selectValue=Array.isArray(y.value)?[...y.value]:y.value,s.value.mapValue=re(Array.isArray(y.value)?[...y.value]:[y.value]),m(s.value.mapValue),q(),we(()=>{Y(s.value.id)});return}W(ae()),s.value.defaultValue=x,s.value.mapValue=re(Array.isArray(y.value)?[...y.value]:[y.value]),s.value.defaultMapValue=re(Array.isArray(y.value)?[...y.value]:[y.value]),m(s.value.mapValue)},E=()=>{t.isConfig&&(s.value.defaultValue=s.value.multiple?[]:void 0,y.value=s.value.multiple?[]:void 0)},f=x=>{C.value=!0,Pn({fieldIds:x,resultMode:s.value.resultMode||0}).then(ne=>{V.value=(ne||[]).filter(z=>z!==null).map(z=>({label:`${z}`,value:`${z}`}))}).finally(()=>{C.value=!1,s.value.defaultValueCheck?y.value=Array.isArray(s.value.defaultValue)?[...s.value.defaultValue]:s.value.defaultValue:y.value=Array.isArray(y.value)?[...y.value]:y.value,Oe()})},U=x=>{const{displayId:ne}=s.value;if(!ne)return[];let z={},ie=[];return x.forEach(ye=>{z[ye]=[]}),g.forEach(ye=>{z[ye[ne]]&&z[ye[ne]].push(ye)}),Object.values(z).forEach(ye=>{ie=[...ie,...ye]}),ie},Q=x=>{C.value=!0,jn(x).then(ne=>{var ye;let z=[],ie=[];(ye=y.value)!=null&&ye.length&&s.value.multiple&&(z=[...y.value],ie=U(z)),g=[...ne||[],...ie],V.value=[...new Set((ne||[]).map(Ve=>`${Ve[x.displayId||x.queryId]}`).concat(z))].map(Ve=>({label:`${Ve}`,value:`${Ve}`,checked:z.includes(Ve)}))}).finally(()=>{var ne;if(C.value=!1,!We.value)if(s.value.defaultValueCheck){y.value=Array.isArray(s.value.defaultValue)?[...s.value.defaultValue]:s.value.defaultValue;let z=!1;if(L.value.includes(s.value.id)){const ie=re(Array.isArray(y.value)?[...y.value]:[y.value]);(ie==null?void 0:ie.length)!==((ne=s.value.defaultMapValue)==null?void 0:ne.length)?z=!0:ie.every(ye=>s.value.defaultMapValue.includes(ye))||(z=!0),d(s.value.id)}s.value.mapValue=re(Array.isArray(y.value)?[...y.value]:[y.value]),z&&w(s.value.id)}else y.value=Array.isArray(y.value)?[...y.value]:y.value})},$e=X(!1),_e=x=>{setTimeout(()=>{$e.value=!x,x||(We.value=!1,Ye.value="",ia(""))},50)};ce(()=>s.value.showEmpty,()=>{Oe()});const Oe=()=>{const{showEmpty:x,displayType:ne,optionValueSource:z}=s.value;if(+ne!=0||z===1)return;const[ie]=V.value;x?(ie==null?void 0:ie.value)!=="_empty_$"&&(V.value=[{label:u("v_query.empty_data"),value:"_empty_$"},...V.value]):(ie==null?void 0:ie.value)==="_empty_$"&&(V.value=V.value.slice(1))};ce(()=>s.value.defaultValue,x=>{s.value.multiple&&(y.value=Array.isArray(x)?[...x]:x),we(()=>{S.value=s.value.multiple})}),ce(()=>s.value.id,()=>{te()}),ce(()=>s.value.selectValue,x=>{t.isConfig||(s.value.multiple&&(y.value=Array.isArray(x)?[...x]:x),we(()=>{S.value=s.value.multiple,s.value.multiple||(y.value=Array.isArray(s.value.selectValue)?[...s.value.selectValue]:s.value.selectValue)}))}),ce(()=>s.value.multiple,x=>{t.isConfig&&(x&&(y.value=[]),we(()=>{S.value=x,x||we(()=>{y.value=void 0})}))}),ce([()=>s.value.field.id,()=>s.value.displayId,()=>s.value.sort,()=>s.value.sortId],x=>{x&&Ge(1)}),ce(()=>s.value.optionValueSource,(x,ne)=>{t.isConfig&&([x,ne].includes(2)&&(y.value=Array.isArray(y.value)?[]:void 0,s.value.selectValue=je(y.value),s.value.defaultValue=je(y.value)),Ge(x))}),ce([()=>s.value.checkedFields,()=>s.value.checkedFieldsMap],()=>{Ge(s.value.optionValueSource)},{deep:!0});const Ye=X(""),We=X(!1),aa=()=>{ia("")},ia=x=>{s.value.optionValueSource===1&&(We.value=!0,Ye.value=x,Ge(1))};ce(()=>s.value.valueSource,()=>{s.value.optionValueSource===2&&Ge(2)});const Ge=_l(x=>{if(x!==s.value.optionValueSource)return;const{optionValueSource:ne,checkedFieldsMap:z,checkedFields:ie,field:ye,valueSource:Ve,displayId:A,sort:O,sortId:ue}=s.value;switch(ne){case 0:const de=Object.values(z).filter(D=>!!D);ie.length&&de.length?f(ie.map(D=>z[D]).filter(D=>!!D)):V.value=[];break;case 1:ye.id?Q({queryId:ye.id,displayId:A||ye.id,sort:O,sortId:ue,resultMode:s.value.resultMode||0,searchText:Ye.value,filter:e()}):V.value=[];break;case 2:V.value=je((Ve||[]).map(D=>({label:`${D}`,value:`${D}`}))),Oe();break}},300),te=()=>{const{defaultValueCheck:x,multiple:ne,defaultValue:z,optionValueSource:ie}=s.value;x?(s.value.selectValue=Array.isArray(z)?[...z]:z,y.value=Array.isArray(z)?[...z]:z):(s.value.selectValue=ne?[]:void 0,y.value=ne?[]:void 0),we(()=>{S.value=s.value.multiple}),Ge(ie)},_=H(()=>t.isConfig?{}:{width:k()+"px"}),fe=X(),Ce=X(),le=()=>{s.value.optionValueSource!==1||![0,2,5].includes(+s.value.displayType)||Ge(1)};return ha(()=>{te(),Da({name:`${s.value.id}-select`,callback:le})}),h({displayTypeChange:E,mult:fe,single:Ce}),(x,ne)=>{const z=ci,ie=at,ye=tt,Ve=sl("loading");return S.value?wa((v(),j(z,{key:"multiple",ref_key:"mult",ref:fe,modelValue:y.value,"onUpdate:modelValue":ne[0]||(ne[0]=A=>y.value=A),placeholder:Z.value,filterable:"",onChange:pe,onVisibleChange:_e,"popper-class":$e.value?"load-select filter-select-popper_class":"filter-select-popper_class",multiple:"","show-checked":"",clearable:"",style:Ae(_.value),"collapse-tags":"",options:V.value,"collapse-tags-tooltip":""},null,8,["modelValue","placeholder","popper-class","style","options"])),[[Ve,C.value]]):wa((v(),j(z,{modelValue:y.value,"onUpdate:modelValue":ne[2]||(ne[2]=A=>y.value=A),key:"single",placeholder:Z.value,onChange:pe,clearable:"",ref_key:"single",ref:Ce,style:Ae(_.value),filterable:"",onClear:aa,radio:"",onVisibleChange:_e,"popper-class":$e.value?"load-select filter-select-popper_class":"filter-select-popper_class",options:V.value},{default:o(({item:A})=>[i(ye,{modelValue:y.value,"onUpdate:modelValue":ne[1]||(ne[1]=O=>y.value=O)},{default:o(()=>[i(ie,{title:A.label,label:A.value},{default:o(()=>[J(F(A.label),1)]),_:2},1032,["title","label"])]),_:2},1032,["modelValue"])]),_:1},8,["modelValue","placeholder","style","popper-class","options"])),[[Ve,C.value]])}}});const ul="",Iu=xe({__name:"Tree",props:{config:{type:Object,default:()=>({selectValue:"",defaultValue:"",displayType:"",resultMode:0,defaultValueCheck:!1,multiple:!1,checkedFieldsMap:{},treeFieldList:[]})},isConfig:{type:Boolean,default:!1}},setup(r){const h=r,u=Ee("placeholder"),t=H(()=>{var m;return(m=u==null?void 0:u.value)!=null&&m.placeholderShow?["",void 0].includes(h.config.placeholder)?" ":h.config.placeholder:" "}),{config:s}=ea(h),g=X(!1),y=m=>{B.value=m,C()},C=()=>{const m=Array.isArray(B.value)?[...B.value]:B.value;if(!h.isConfig){s.value.selectValue=Array.isArray(B.value)?[...B.value]:B.value,we(()=>{P(s.value.id)});return}s.value.defaultValue=m};ce(()=>s.value.defaultValue,m=>{s.value.multiple&&(B.value=Array.isArray(m)?[...m]:m),we(()=>{g.value=s.value.multiple})}),ce(()=>s.value.treeFieldList,()=>{B.value=s.value.multiple?[]:void 0,V.value=!1,Z()});const S=()=>{const{defaultValueCheck:m,multiple:q,defaultValue:ae}=s.value;m?(s.value.selectValue=Array.isArray(ae)?je([...ae]):ae,B.value=Array.isArray(ae)?je([...ae]):ae):(s.value.selectValue=q?[]:void 0,B.value=q?[]:void 0),we(()=>{g.value=s.value.multiple}),Z()};ce(()=>s.value.id,()=>{S()});const V=X(!0),L=Ee("com-width",Function,!0),P=Ee("is-confirm-search",Function,!0);ce(()=>s.value.id,()=>{Z()}),dl(()=>{setTimeout(()=>{S()},0)}),ce(()=>s.value.selectValue,m=>{h.isConfig||(s.value.multiple&&(B.value=Array.isArray(m)?[...m]:m),we(()=>{g.value=s.value.multiple,s.value.multiple||(B.value=Array.isArray(s.value.selectValue)?[...s.value.selectValue]:s.value.selectValue)}))});const d=X(!1);ce(()=>s.value.multiple,m=>{h.isConfig&&(d.value=!1,m&&(B.value=[]),we(()=>{g.value=m,m||we(()=>{B.value=void 0}),we(()=>{d.value=!0})}))});let w="",Y=xa([]);const k=(m,q)=>(q.label??"").toLowerCase().includes((m??"").toLowerCase()),ee=m=>(m||[]).map(q=>{var e;let ae=[];return(e=q.children)!=null&&e.length&&(ae=ee(q.children)),{...q,value:q.id,label:q.text,children:ae}}),W=X(!1),Z=_l(()=>{W.value=!0,Hn({fieldIds:h.config.treeFieldList.map(m=>m.id),resultMode:s.value.resultMode||0}).then(m=>{Y.value=ee(m)}).finally(()=>{W.value=!1,d.value=!0})},300);ce(()=>h.config.treeFieldList,m=>{if(!h.isConfig)return;const q=m.map(ae=>ae.id).join("");w!==m.map(ae=>ae.id).join("")&&(w=q,Z())});const B=X(),re=H(()=>h.isConfig?{}:{width:L()+"px"});return(m,q)=>{const ae=yl,e=sl("loading");return g.value&&!W.value?(v(),j(ae,{modelValue:B.value,"onUpdate:modelValue":q[0]||(q[0]=pe=>B.value=pe),data:a(Y),clearable:"",onTreeSelectConfirm:y,"render-after-expand":!1,"show-checkbox":"",showBtn:"",placeholder:t.value,"collapse-tags":"","filter-node-method":k,showWholePath:d.value,"collapse-tags-tooltip":"",key:"multipleTree",filterable:"",style:Ae(re.value),multiple:""},null,8,["modelValue","data","placeholder","showWholePath","style"])):!g.value&&!W.value?(v(),j(ae,{modelValue:B.value,"onUpdate:modelValue":q[1]||(q[1]=pe=>B.value=pe),onChange:C,data:a(Y),"check-strictly":"",clearable:"","filter-node-method":k,placeholder:t.value,"render-after-expand":!1,key:"singleTree",showWholePath:d.value,style:Ae(re.value),filterable:""},null,8,["modelValue","data","placeholder","showWholePath","style"])):wa((v(),j(ae,{modelValue:ul,"onUpdate:modelValue":q[2]||(q[2]=pe=>ul=pe),data:[],placeholder:t.value,"render-after-expand":!1,key:"fakeTree",style:Ae(re.value)},null,8,["placeholder","style"])),[[e,W.value]])}}});const Ul=Ya(Iu,[["__scopeId","data-v-e98b750b"]]),Ru={class:"label"},Lu={class:"condition-type"},Yu={key:0,class:"condition-type"},Uu={class:"label"},Bu={class:"setting-content",style:{display:"flex","align-items":"center"}},Gu={key:2,class:"list-item"},Pu={class:"label"},ju={class:"value"},Hu={key:3,class:"list-item"},zu={class:"label"},Wu={class:"setting-content"},Qu={key:0,class:"config-flag range-filter-time-flag"},Ku={key:4,class:"list-item"},Zu={class:"label"},Ju={key:5,class:"list-item"},Xu={class:"label"},er={key:0,class:"setting-content"},ar={class:"setting"},tr={class:"setting"},lr={class:"setting-label"},nr={class:"setting-value select"},ir={key:0,class:"setting"},ur={class:"setting"},rr={class:"setting-label"},or={class:"setting-value select"},sr={class:"setting-label"},dr={class:"setting-input with-date range"},cr={class:"setting-label"},mr={class:"setting-input with-date range"},vr={key:0,class:"setting-label"},pr=xe({__name:"ConditionDefaultConfiguration",props:{curComponent:{type:Object,required:!0},showPosition:{type:String,default:"main"}},emits:["handleTimeTypeChange"],setup(r,{expose:h,emit:u}){const{t}=oa(),s=X(!1),g=()=>{s.value=!1},y=E=>{E.stopPropagation(),s.value=!s.value},C=H(()=>{const{displayType:E,timeType:f="fixed"}=d.value;return["1","7"].includes(E)?f==="dynamic"?E==="1"?lu:nu:Ll:E==="9"?Ul:Yl}),S=u,V=E=>{E==="dynamic"&&S("handleTimeTypeChange")},L=r,P=H(()=>L.showPosition==="main"),{curComponent:d}=ea(L),w=H(()=>{if(!d.value)return[];let E=["year","month","date","datetime"].indexOf(d.value.timeGranularity)+1;return+d.value.displayType==7&&(E=["yearrange","monthrange","daterange","datetimerange"].indexOf(d.value.timeGranularityMultiple)+1),[{label:t("dynamic_time.year"),value:"year"},{label:t("dynamic_time.month"),value:"month"},{label:t("dynamic_time.date"),value:"date"}].slice(0,E)}),Y=H(()=>{let E=[];if(!d.value)return E;switch(d.value.timeGranularity){case"year":E=[{label:t("dynamic_year.current"),value:"thisYear"},{label:t("dynamic_year.last"),value:"lastYear"}];break;case"month":E=[{label:t("cron.this_month"),value:"thisMonth"},{label:t("dynamic_month.last"),value:"lastMonth"}];break;case"date":E=[{label:t("dynamic_time.today"),value:"today"},{label:t("dynamic_time.yesterday"),value:"yesterday"},{label:t("dynamic_time.firstOfMonth"),value:"monthBeginning"},{label:t("dynamic_time.firstOfYear"),value:"yearBeginning"}];break;case"datetime":E=[{label:t("dynamic_time.today"),value:"today"},{label:t("dynamic_time.yesterday"),value:"yesterday"},{label:t("dynamic_time.firstOfMonth"),value:"monthBeginning"},{label:t("dynamic_time.firstOfYear"),value:"yearBeginning"}];break}return[...E,{label:t("dynamic_time.custom"),value:"custom"}]}),k=H(()=>{let E=[];if(!d.value)return E;switch(d.value.timeGranularityMultiple){case"yearrange":E=[{label:t("dynamic_year.current"),value:"thisYear"},{label:t("dynamic_year.last"),value:"lastYear"}];break;case"monthrange":E=[{label:t("cron.this_month"),value:"thisMonth"},{label:t("dynamic_month.dynamic_month"),value:"lastMonth"},{label:t("v_query.last_3_months"),value:"LastThreeMonths"},{label:t("v_query.last_6_months"),value:"LastSixMonths"},{label:t("v_query.last_12_months"),value:"LastTwelveMonths"}];break;case"daterange":case"datetimerange":E=[{label:t("dynamic_time.today"),value:"today"},{label:t("dynamic_time.yesterday"),value:"yesterday"},{label:t("v_query.last_3_days"),value:"LastThreeDays"},{label:t("v_query.month_to_date"),value:"monthBeginning"},{label:t("v_query.year_to_date"),value:"yearBeginning"}];break}return[...E,{label:t("dynamic_time.custom"),value:"custom"}]}),ee=[{label:t("dynamic_time.before"),value:"f"},{label:t("dynamic_time.after"),value:"b"}],W=H(()=>{const{displayType:E,timeType:f}=d.value;return f==="dynamic"&&[1,7].includes(+E)}),Z=[{label:t("v_query.exact_match"),value:"eq"},{label:t("v_query.fuzzy_match"),value:"like"}],B=X(!1),re=(E,f=!1)=>{f&&(d.value.defaultValue=E?[]:void 0);const{defaultValue:U}=d.value;if(Array.isArray(U)?d.value.selectValue=E?U:void 0:d.value.selectValue=E?U!==void 0?[U]:[]:U,d.value.field.deType===1){d.value.multiple=E;return}d.value.multiple=E},m=E=>{B.value=E},q=X();return h({multipleChange:re,handleDialogClick:g,changeMultiple:m,displayTypeChange:()=>{var E,f;(f=(E=q.value)==null?void 0:E.displayTypeChange)==null||f.call(E)},mult:()=>{var E,f,U;(U=(f=(E=q.value)==null?void 0:E.mult)==null?void 0:f.handleClickOutside)==null||U.call(f)},single:()=>{var E,f,U;(U=(f=(E=q.value)==null?void 0:E.single)==null?void 0:f.handleClickOutside)==null||U.call(f)}}),(E,f)=>{const U=Ia,Q=Tt,$e=cl("sapn"),_e=St,Oe=wt,Ye=at,We=tt,aa=Oa,ia=Xa,Je=fl,Ge=At,te=Xn;return v(),$(oe,null,[a(d).displayType==="8"?(v(),$("div",{key:0,class:"list-item top-item",onClick:f[4]||(f[4]=Ne(()=>{},["stop"]))},[b("div",Ru,F(a(t)("dynamic_time.set_default")),1),b("div",{class:Fe(["value",a(d).hideConditionSwitching&&"hide-condition_switching"])},[b("div",Lu,[a(d).hideConditionSwitching?K("",!0):(v(),j(a(De),{key:0,class:"condition-value-select","popper-class":"condition-value-select-popper",modelValue:a(d).defaultConditionValueOperatorF,"onUpdate:modelValue":f[0]||(f[0]=_=>a(d).defaultConditionValueOperatorF=_)},{default:o(()=>[(v(),$(oe,null,he(Z,_=>i(U,{key:_.value,label:_.label,value:_.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])),i(Q,{class:"condition-value-input",modelValue:a(d).defaultConditionValueF,"onUpdate:modelValue":f[1]||(f[1]=_=>a(d).defaultConditionValueF=_)},null,8,["modelValue"]),f[30]||(f[30]=b("div",{class:"bottom-line"},null,-1))]),[1,2].includes(a(d).conditionType)?(v(),$("div",Yu,[i($e,{class:"condition-type-tip"},{default:o(()=>[J(F(a(d).conditionType===1?a(t)("chart.and"):a(t)("chart.or")),1)]),_:1}),a(d).hideConditionSwitching?K("",!0):(v(),j(a(De),{key:0,class:"condition-value-select","popper-class":"condition-value-select-popper",modelValue:a(d).defaultConditionValueOperatorS,"onUpdate:modelValue":f[2]||(f[2]=_=>a(d).defaultConditionValueOperatorS=_)},{default:o(()=>[(v(),$(oe,null,he(Z,_=>i(U,{key:_.value,label:_.label,value:_.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])),i(Q,{class:"condition-value-input",modelValue:a(d).defaultConditionValueS,"onUpdate:modelValue":f[3]||(f[3]=_=>a(d).defaultConditionValueS=_)},null,8,["modelValue"]),f[31]||(f[31]=b("div",{class:"bottom-line next-line"},null,-1))])):K("",!0)],2)])):K("",!0),a(d).displayType==="22"?(v(),$("div",{key:1,class:"list-item top-item",onClick:f[8]||(f[8]=Ne(()=>{},["stop"]))},[b("div",Uu,[i(_e,{modelValue:a(d).defaultValueCheck,"onUpdate:modelValue":f[5]||(f[5]=_=>a(d).defaultValueCheck=_),label:a(t)("dynamic_time.set_default")},null,8,["modelValue","label"])]),b("div",Bu,[i(Oe,{disabled:!a(d).defaultValueCheck,placeholder:a(t)("system.the_minimum_value"),style:{width:"192.5px"},"controls-position":"right",modelValue:a(d).defaultNumValueStart,"onUpdate:modelValue":f[6]||(f[6]=_=>a(d).defaultNumValueStart=_)},null,8,["disabled","placeholder","modelValue"]),f[32]||(f[32]=b("div",{class:"num-value_line"},null,-1)),i(Oe,{placeholder:a(t)("system.the_maximum_value"),style:{width:"192.5px"},"controls-position":"right",disabled:!a(d).defaultValueCheck,modelValue:a(d).defaultNumValueEnd,"onUpdate:modelValue":f[7]||(f[7]=_=>a(d).defaultNumValueEnd=_)},null,8,["placeholder","disabled","modelValue"])])])):K("",!0),!["1","7","8","22"].includes(a(d).displayType)&&P.value?(v(),$("div",Gu,[b("div",Pu,F(a(t)("v_query.option_type")),1),b("div",ju,[i(We,{class:"larger-radio",onChange:f[9]||(f[9]=_=>re(_,!0)),modelValue:B.value,"onUpdate:modelValue":f[10]||(f[10]=_=>B.value=_)},{default:o(()=>[i(Ye,{label:!1},{default:o(()=>[J(F(a(t)("visualization.single_choice")),1)]),_:1}),i(Ye,{label:!0},{default:o(()=>[J(F(a(t)("visualization.multiple_choice")),1)]),_:1})]),_:1},8,["modelValue"])])])):K("",!0),a(d).displayType==="7"&&P.value?(v(),$("div",Hu,[b("div",zu,[i(_e,{modelValue:a(d).setTimeRange,"onUpdate:modelValue":f[11]||(f[11]=_=>a(d).setTimeRange=_),label:a(t)("v_query.time_filter_range")},null,8,["modelValue","label"])]),b("div",Wu,[i(Je,{"show-arrow":!1,"popper-class":"range-filter-time",placement:"bottom-start",width:452,visible:s.value,offset:4},{reference:o(()=>[i(ia,{disabled:!a(d).setTimeRange,onClick:f[12]||(f[12]=_=>y(_)),text:"",style:{"margin-left":"-4px"}},{icon:o(()=>[i(aa,{name:"icon_admin_outlined"},{default:o(()=>[i(a(ei),{class:"svg-icon"})]),_:1})]),default:o(()=>[J(" "+F(a(t)("dynamic_time.set")),1)]),_:1},8,["disabled"])]),default:o(()=>[i(tu,{timeRange:a(d).timeRange,timeGranularityMultiple:a(d).timeGranularityMultiple},null,8,["timeRange","timeGranularityMultiple"])]),_:1},8,["visible"]),a(d).timeRange.intervalType!=="none"||a(d).timeRange.dynamicWindow?(v(),$("span",Qu,F(a(t)("v_query.configured")),1)):K("",!0)])])):K("",!0),+a(d).displayType==0&&a(d).optionValueSource!==1&&P.value?(v(),$("div",Ku,[b("div",Zu,[i(Ge,{effect:"dark",content:a(t)("v_query.is_not_supported"),disabled:!a(d).parametersCheck,placement:"top"},{default:o(()=>[i(_e,{disabled:a(d).parametersCheck,modelValue:a(d).showEmpty,"onUpdate:modelValue":f[13]||(f[13]=_=>a(d).showEmpty=_),label:a(t)("v_query.contains_empty_data")},null,8,["disabled","modelValue","label"])]),_:1},8,["content","disabled"])])])):K("",!0),["8","22"].includes(a(d).displayType)?K("",!0):(v(),$("div",Ju,[b("div",Xu,[i(_e,{modelValue:a(d).defaultValueCheck,"onUpdate:modelValue":f[14]||(f[14]=_=>a(d).defaultValueCheck=_),label:a(t)("dynamic_time.set_default")},null,8,["modelValue","label"])]),a(d).defaultValueCheck&&["1","7"].includes(a(d).displayType)?(v(),$("div",er,[b("div",ar,[i(We,{onChange:V,modelValue:a(d).timeType,"onUpdate:modelValue":f[15]||(f[15]=_=>a(d).timeType=_)},{default:o(()=>[i(Ye,{label:"fixed"},{default:o(()=>[J(F(a(t)("dynamic_time.fix")),1)]),_:1}),i(Ye,{label:"dynamic"},{default:o(()=>[J(F(a(t)("dynamic_time.dynamic")),1)]),_:1})]),_:1},8,["modelValue"])]),W.value&&a(d).displayType==="1"?(v(),$(oe,{key:0},[b("div",tr,[b("div",lr,F(a(t)("dynamic_time.relative")),1),b("div",nr,[i(a(De),{onFocus:g,modelValue:a(d).relativeToCurrent,"onUpdate:modelValue":f[16]||(f[16]=_=>a(d).relativeToCurrent=_)},{default:o(()=>[(v(!0),$(oe,null,he(Y.value,_=>(v(),j(U,{key:_.value,label:_.label,value:_.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])]),a(d).relativeToCurrent==="custom"?(v(),$("div",ir,[b("div",{class:Fe(["setting-input",a(d).timeGranularity==="datetime"&&"with-date"])},[i(Oe,{"step-strictly":"",modelValue:a(d).timeNum,"onUpdate:modelValue":f[17]||(f[17]=_=>a(d).timeNum=_),min:0,"controls-position":"right"},null,8,["modelValue"]),i(a(De),{onFocus:g,modelValue:a(d).relativeToCurrentType,"onUpdate:modelValue":f[18]||(f[18]=_=>a(d).relativeToCurrentType=_)},{default:o(()=>[(v(!0),$(oe,null,he(w.value,_=>(v(),j(U,{key:_.value,label:_.label,value:_.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),i(a(De),{onFocus:g,modelValue:a(d).around,"onUpdate:modelValue":f[19]||(f[19]=_=>a(d).around=_)},{default:o(()=>[(v(),$(oe,null,he(ee,_=>i(U,{key:_.value,label:_.label,value:_.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),a(d).timeGranularity==="datetime"?(v(),j(te,{key:0,modelValue:a(d).arbitraryTime,"onUpdate:modelValue":f[20]||(f[20]=_=>a(d).arbitraryTime=_)},null,8,["modelValue"])):K("",!0)],2)])):K("",!0)],64)):W.value&&a(d).displayType==="7"?(v(),$(oe,{key:1},[b("div",ur,[b("div",rr,F(a(t)("dynamic_time.relative")),1),b("div",or,[i(a(De),{onFocus:g,modelValue:a(d).relativeToCurrentRange,"onUpdate:modelValue":f[21]||(f[21]=_=>a(d).relativeToCurrentRange=_)},{default:o(()=>[(v(!0),$(oe,null,he(k.value,_=>(v(),j(U,{key:_.value,label:_.label,value:_.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])]),a(d).relativeToCurrentRange==="custom"?(v(),$("div",{key:0,class:Fe(["setting",["yearrange","monthrange","daterange"].includes(a(d).timeGranularityMultiple)&&"is-year-month-range"])},[b("div",sr,F(a(t)("datasource.start_time")),1),b("div",dr,[i(Oe,{"step-strictly":"",modelValue:a(d).timeNum,"onUpdate:modelValue":f[22]||(f[22]=_=>a(d).timeNum=_),min:0,"controls-position":"right"},null,8,["modelValue"]),i(a(De),{onFocus:g,modelValue:a(d).relativeToCurrentType,"onUpdate:modelValue":f[23]||(f[23]=_=>a(d).relativeToCurrentType=_)},{default:o(()=>[(v(!0),$(oe,null,he(w.value,_=>(v(),j(U,{key:_.value,label:_.label,value:_.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),i(a(De),{onFocus:g,modelValue:a(d).around,"onUpdate:modelValue":f[24]||(f[24]=_=>a(d).around=_)},{default:o(()=>[(v(),$(oe,null,he(ee,_=>i(U,{key:_.value,label:_.label,value:_.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),i(te,{modelValue:a(d).arbitraryTime,"onUpdate:modelValue":f[25]||(f[25]=_=>a(d).arbitraryTime=_)},null,8,["modelValue"])])],2)):K("",!0),a(d).relativeToCurrentRange==="custom"?(v(),$("div",{key:1,class:Fe(["setting",["yearrange","monthrange","daterange"].includes(a(d).timeGranularityMultiple)&&"is-year-month-range"])},[b("div",cr,F(a(t)("datasource.end_time")),1),b("div",mr,[i(Oe,{modelValue:a(d).timeNumRange,"onUpdate:modelValue":f[26]||(f[26]=_=>a(d).timeNumRange=_),min:0,"step-strictly":"","controls-position":"right"},null,8,["modelValue"]),i(a(De),{onFocus:g,modelValue:a(d).relativeToCurrentTypeRange,"onUpdate:modelValue":f[27]||(f[27]=_=>a(d).relativeToCurrentTypeRange=_)},{default:o(()=>[(v(!0),$(oe,null,he(w.value,_=>(v(),j(U,{key:_.value,label:_.label,value:_.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),i(a(De),{onFocus:g,modelValue:a(d).aroundRange,"onUpdate:modelValue":f[28]||(f[28]=_=>a(d).aroundRange=_)},{default:o(()=>[(v(),$(oe,null,he(ee,_=>i(U,{key:_.value,label:_.label,value:_.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),i(te,{modelValue:a(d).arbitraryTimeRange,"onUpdate:modelValue":f[29]||(f[29]=_=>a(d).arbitraryTimeRange=_)},null,8,["modelValue"])])],2)):K("",!0)],64)):K("",!0)])):K("",!0),a(d).defaultValueCheck?(v(),$("div",{key:1,class:Fe(["parameters",W.value&&"setting"])},[W.value?(v(),$("div",vr,F(a(t)("template_manage.preview")),1)):K("",!0),b("div",{class:Fe(W.value?"setting-value":"w100")},[(v(),j(Be(C.value),{config:a(d),isConfig:"",ref_key:"inputCom",ref:q},null,8,["config"]))],2)],2)):K("",!0)]))],64)}}});const fr=Ya(pr,[["__scopeId","data-v-3c24b44d"]]),yr={class:"query-condition-list"},hr={class:"title"},_r=["onDblclick","onClick"],gr=["title"],br={class:"condition-icon flex-align-center"},Vr={key:0,class:"mask"},Tr={class:"title flex-align-center"},kr={class:"flex-align-center"},Cr={class:"select-all"},Mr={class:"field-list"},Sr=["title"],Fr=["title"],wr={class:"flex-align-center icon"},Ar=["title"],$r=["onClick"],Dr={class:"flex-align-center icon"},Or=["title"],qr=["onClick"],Nr=["title"],Er=["title"],xr=["onClick"],Ir={key:3,style:{width:"172px","margin-left":"12px"}},Rr={key:0,class:"mask condition"},Lr={class:"title flex-align-center"},Yr={class:"configuration-list"},Ur={class:"list-item"},Br={class:"label"},Gr={class:"value"},Pr={key:0,class:"list-item"},jr={class:"label"},Hr={class:"value"},zr={key:1,class:"list-item"},Wr={class:"label",style:{width:"135px",height:"26px","line-height":"26px"}},Qr={class:"search-tree"},Kr={class:"level-index"},Zr={class:"field-type"},Jr={class:"field-tree_name"},Xr={key:2,class:"list-item"},eo={class:"label"},ao={class:"value"},to={key:3,class:"list-item top-item"},lo={class:"label"},no={class:"value"},io={class:"value"},uo={class:"value"},ro={class:"content"},oo=["title"],so={class:"value"},co={class:"label"},mo=["title"],vo={class:"value"},po={class:"label"},fo=["title"],yo={class:"value"},ho={class:"label"},_o=["title"],go={key:1,class:"value flex-align-center"},bo={class:"manual-input-container"},Vo={class:"title"},To={class:"select-value"},ko={class:"add-btn"},Co={class:"manual-footer flex-align-center"},Mo={key:0,class:"config-flag flex-align-center"},So={class:"label",style:{"margin-top":"10.5px"}},Fo={class:"value",style:{"margin-top":"10.5px"}},wo={key:4,class:"list-item top-item"},Ao={class:"label"},$o={class:"value"},Do={class:"value"},Oo={key:5,style:{"margin-bottom":"10.5px"}},qo={key:1,class:"empty"},No={key:2,class:"empty"},Eo={key:3,class:"empty"},xo={class:"dialog-footer"},Io=xe({__name:"QueryConditionConfiguration",props:{queryElement:{type:Object,default(){return{id:null,propValue:[]}}}},emits:["queryData"],setup(r,{expose:h,emit:u}){const{t}=oa(),{wsCache:s}=mn(),g=Ra(),{componentData:y,canvasViewInfo:C}=et(g),S=X(null),V=r,L=X(!1),P=X([]),d=X([]),w=X([]),Y=X(!1),k=ml({id:"",name:"",visible:!1}),ee={},W=vl(),Z=()=>{let n=y.value.filter(l=>!["VQuery","DeTabs"].includes(l.innerType)&&l.component!=="Group");return y.value.forEach(l=>{l.innerType==="DeTabs"?l.propValue.forEach(p=>{n=[...n,...p.componentData.filter(T=>!["VQuery","DeTabs"].includes(T.innerType)&&T.component!=="Group")]}):l.component==="Group"&&(n=[...n,l.propValue.filter(p=>!["VQuery","DeTabs"].includes(p.innerType)&&p.component!=="Group")],l.propValue.forEach(p=>{p.innerType==="DeTabs"&&p.propValue.forEach(T=>{n=[...n,...T.componentData.filter(M=>!["VQuery","DeTabs"].includes(M.innerType)&&M.component!=="Group")]})}))}),n.flat()},B=H(()=>Z().map(n=>{const l=C.value[n.id];if(!l)return null;const{id:p,title:T,tableId:M,type:I}=l;return p&&M?{id:p,type:I,title:T,tableId:M}:null}).filter(n=>!!n)),re=n=>{w.value.forEach(l=>{l.optionValueSource===1&&[0,2,5].includes(+l.displayType)&&n.includes(l.id)&&(l.selectValue=Array.isArray(l.selectValue)?[]:void 0,l.defaultValue=Array.isArray(l.defaultValue)?[]:void 0,l.mapValue=Array.isArray(l.mapValue)?[]:void 0,l.defaultMapValue=Array.isArray(l.defaultMapValue)?[]:void 0)})};let m=[];const q=n=>{m=n},ae=()=>m;ua("set-cascade-default",re),ua("cascade-list",ae);const e=X(),pe=X(),E=X(""),f=X(!1),U=xa([]),Q=X(),{queryElement:$e}=ea(V),_e=(n,l)=>{var p;return(p=l.flat().find(T=>T.id===n))==null?void 0:p.deType},Oe=H(()=>{var n;return!e.value||!((n=e.value.checkedFields)!=null&&n.length)?!1:e.value.checkedFields.some(l=>!!e.value.checkedFieldsMap[l])}),Ye=H(()=>{var M,I;if(!e.value||!((M=e.value.checkedFields)!=null&&M.length)||!((I=Q.value)!=null&&I.length))return!1;if(e.value.parameters.length&&ma.value){const G=e.value.parameters.map(R=>R.type[1]),[se]=G;if(G.some(R=>R!==se))return!0}let n=null,l=0,p=0,T=e.value.checkedFields.every(G=>{var se,R;return(R=(se=e.value.checkedFieldsMapArrNum)==null?void 0:se[G])==null?void 0:R.length})&&["22"].includes(e.value.displayType);return e.value.checkedFields.some(G=>{var Re,ge,Pe,Te,ta,Se,Ke,la,qe,Ze,He,c,N;if(T)return!1;if((ge=(Re=e.value.checkedFieldsMapArrNum)==null?void 0:Re[G])!=null&&ge.length&&["22","2"].includes(e.value.displayType)&&(p===0&&(p=1),p===2)||!((Te=(Pe=e.value.checkedFieldsMapArrNum)==null?void 0:Pe[G])!=null&&Te.length)&&["22","2"].includes(e.value.displayType)&&e.value.parameters.some(ke=>[2,3].includes(ke.deType))&&e.value.checkedFieldsMap[G]&&(p===0&&(p=2),p===1)||(Se=(ta=e.value.checkedFieldsMapArr)==null?void 0:ta[G])!=null&&Se.length&&["7","1"].includes(e.value.displayType)&&(l===0&&(l=1),l===2)||!((la=(Ke=e.value.checkedFieldsMapArr)==null?void 0:Ke[G])!=null&&la.length)&&["7","1"].includes(e.value.displayType)&&e.value.parameters.length&&(l===0&&(l=2),l===1))return!0;const se=Q.value.find(ke=>ke.componentId===G),R=(qe=e.value.checkedFieldsMap)==null?void 0:qe[G],ve=Ue(Object.values((se==null?void 0:se.fields)||{}).flat()).find(ke=>R===ke.id);if(!ve)return!1;if(n===null)return n=ve,!1;if((n==null?void 0:n.deType)===(ve==null?void 0:ve.deType)&&(n==null?void 0:n.deType)===1){if(!((Ze=n.type)!=null&&Ze.length)&&!((He=ve.type)!=null&&He.length))return!1;if(((c=n.type)==null?void 0:c.length)!==((N=ve.type)==null?void 0:N.length))return!0;for(let ke=0;ke<n.type.length;ke++)if(n.type[ke]!==ve.type[ke])return!0}return[2,3].includes(ve==null?void 0:ve.deType)&&[2,3].includes(n.deType)?!1:n.deType!==(ve==null?void 0:ve.deType)})}),We=H(()=>{var l,p;if(!e.value||e.value.displayType!=="9"||!((l=e.value.checkedFields)!=null&&l.length)||!((p=Q.value)!=null&&p.length))return!1;let n=null;return e.value.checkedFields.some(T=>{const I=Q.value.find(G=>G.componentId===T).id;return I?n===null?(n=I,!1):n!==I:!1})}),aa=[{label:t("data_fill.rename"),command:"rename"},{label:t("data_fill.delete"),command:"del"}],ia=n=>{e.value.checkedFields=n?Q.value.map(l=>l.componentId):[],f.value=!1},Je=()=>{var n,l;if(e.value.checkedFields.length){let p="",T="",M="";if(Q.value.forEach(I=>{var G;e.value.checkedFields.includes(I.componentId)&&e.value.checkedFieldsMap[I.componentId]&&!p&&(p=e.value.checkedFieldsMap[I.componentId],M=I.componentId,T=(G=B.value.find(se=>se.id===I.componentId))==null?void 0:G.tableId)}),p&&T){const I=Q.value.find(R=>R.componentId===M),G=e.value.optionValueSource===0?(n=I==null?void 0:I.fields)==null?void 0:n.dimensionList:(l=(Q.value.find(R=>R.id===T)||{}).fields)==null?void 0:l.dimensionList;Q.value.forEach(R=>{var ve;e.value.checkedFields.includes(R.componentId)&&((ve=B.value.find(Re=>Re.id===R.componentId))==null?void 0:ve.tableId)===T&&(e.value.checkedFieldsMap[R.componentId]=p)});const se=G.find(R=>R.id===p);if(e.value.treeFieldList.length){const[R]=e.value.treeFieldList;R&&R.field!==p&&(e.value.treeFieldList=[se])}else se&&(e.value.treeFieldList=[se])}}},Ge=n=>{Qe();const l=n.length;Y.value=l===Q.value.length,f.value=l>0&&l<Q.value.length,e.value.displayType!=="8"&&da()},te=n=>{Qe();const l=n.length;if(Y.value=l===Q.value.length,f.value=l>0&&l<Q.value.length,e.value.displayType!=="8"){if(e.value.displayType==="9"){Je();return}da()}},_=n=>{var p;let l=!1;if(!ka.value){for(let T=0;T<$a.value.length;T++)$a.value[T]!==((p=n.type)==null?void 0:p[T])&&(l=!0);$a.value.length&&n.deType!==1&&(l=!0)}return l},fe=(n,l)=>{var M,I;(I=(M=e.value.checkedFieldsMapArr)==null?void 0:M[l])!=null&&I.length&&(e.value.checkedFieldsMapArr[l]=[],e.value.checkedFieldsMapEnd[l]="",e.value.checkedFieldsMapStart[l]="");const p=e.value.checkedFieldsMapStartNum[l],T=e.value.checkedFieldsMapEndNum[l];p&&(e.value.checkedFieldsMapEndNum[l]=n.find(G=>G!==p)),T&&(e.value.checkedFieldsMapStartNum[l]=n.find(G=>G!==T)),n.length||(e.value.checkedFieldsMap[l]="",e.value.checkedFieldsMapEndNum[l]="",e.value.checkedFieldsMapStartNum[l]="",e.value.parametersArr[l]=[]),e.value.checkedFieldsMapArrNum[l].length&&de(l),ca()},Ce=(n,l)=>{var M,I;(I=(M=e.value.checkedFieldsMapArrNum)==null?void 0:M[l])!=null&&I.length&&(e.value.checkedFieldsMapArrNum[l]=[],e.value.checkedFieldsMapEndNum[l]="",e.value.checkedFieldsMapStartNum[l]="");const p=e.value.checkedFieldsMapStart[l],T=e.value.checkedFieldsMapEnd[l];p&&(e.value.checkedFieldsMapEnd[l]=n.find(G=>G!==p)),T&&(e.value.checkedFieldsMapStart[l]=n.find(G=>G!==T)),n.length||(e.value.checkedFieldsMap[l]="",e.value.checkedFieldsMapEnd[l]="",e.value.checkedFieldsMapStart[l]="",e.value.displayType="1",e.value.parametersArr[l]=[],e.value.timeGranularity="",e.value.timeGranularityMultiple=""),e.value.checkedFieldsMapArr[l].length&&D(l),ca()};let le="",x="";const ne=X(!1),z=X(0),ie=X(""),ye=X(!1),Ve=X(0),A=X(""),O=()=>{e.value.checkedFieldsMapArr[le]||(e.value.checkedFieldsMapArr[le]=[]),z.value===0&&(e.value.checkedFieldsMap[le]=x,e.value.checkedFieldsMapArr[le]=[],e.value.checkedFieldsMapStart[le]="",e.value.checkedFieldsMapEnd[le]=""),z.value===1&&(e.value.checkedFieldsMapStart[le]=x,e.value.checkedFieldsMapArr[le]=[...new Set([...e.value.checkedFieldsMapArr[le],x])],e.value.checkedFieldsMapArr[le].length===1?e.value.checkedFieldsMapEnd[le]="":e.value.checkedFieldsMapEnd[le]=e.value.checkedFieldsMapArr[le].length===2?e.value.checkedFieldsMapArr[le].find(n=>n!==x):x),z.value===2&&(e.value.checkedFieldsMapArr[le]=[...new Set([...e.value.checkedFieldsMapArr[le],x])],e.value.checkedFieldsMapEnd[le]=x,e.value.checkedFieldsMapArr[le].length===1?e.value.checkedFieldsMapStart[le]="":e.value.checkedFieldsMapStart[le]=e.value.checkedFieldsMapArr[le].length===2?e.value.checkedFieldsMapArr[le].find(n=>n!==x):x),e.value.displayType=e.value.checkedFieldsMapArr[le].length?"7":"1",D(le),ca(),ne.value=!1},ue=()=>{e.value.checkedFieldsMapArrNum[le]||(e.value.checkedFieldsMapArrNum[le]=[]),Ve.value===0&&(e.value.checkedFieldsMap[le]=x,e.value.checkedFieldsMapArrNum[le]=[],e.value.checkedFieldsMapStartNum[le]="",e.value.checkedFieldsMapEndNum[le]=""),Ve.value===1&&(e.value.checkedFieldsMapStartNum[le]=x,e.value.checkedFieldsMapArrNum[le]=[...new Set([...e.value.checkedFieldsMapArrNum[le],x])],e.value.checkedFieldsMapArrNum[le].length===1?e.value.checkedFieldsMapEndNum[le]="":e.value.checkedFieldsMapEndNum[le]=e.value.checkedFieldsMapArrNum[le].length===2?e.value.checkedFieldsMapArrNum[le].find(n=>n!==x):x),Ve.value===2&&(e.value.checkedFieldsMapArrNum[le]=[...new Set([...e.value.checkedFieldsMapArrNum[le],x])],e.value.checkedFieldsMapEndNum[le]=x,e.value.checkedFieldsMapArrNum[le].length===1?e.value.checkedFieldsMapStartNum[le]="":e.value.checkedFieldsMapStartNum[le]=e.value.checkedFieldsMapArrNum[le].length===2?e.value.checkedFieldsMapArrNum[le].find(n=>n!==x):x),e.value.displayType=e.value.checkedFieldsMapArrNum[le].length?"22":"2",de(le),ca(),ye.value=!1},de=n=>{e.value.parametersArr[n]=Ue(a(Q).filter(l=>l.componentId===n).map(l=>Object.values((l==null?void 0:l.fields)||{}).flat()).flat().filter(l=>[e.value.checkedFieldsMapEndNum[n],e.value.checkedFieldsMapStartNum[n]].filter(p=>!!p).includes(l.id)&&!!l.variableName))},D=n=>{if(e.value.parametersArr[n]=Ue(a(Q).filter(T=>T.componentId===n).map(T=>Object.values((T==null?void 0:T.fields)||{}).flat()).flat().filter(T=>[e.value.checkedFieldsMapEnd[n],e.value.checkedFieldsMapStart[n]].filter(M=>!!M).includes(T.id)&&!!T.variableName)),!e.value.parametersArr[n].length)return;const[l,p]=e.value.parametersArr[n][0].type;e.value.timeGranularityMultiple=_a[p||l]?`${_a[p||l]}range`:"",e.value.timeGranularity=_a[p||l]},Ie=(n,l)=>{Ve.value=l.id===e.value.checkedFieldsMapStartNum[n]?1:l.id===e.value.checkedFieldsMapEndNum[n]?2:0,le=n,x=l.id,A.value=l.variableName,ye.value=!0},me=(n,l)=>{z.value=l.id===e.value.checkedFieldsMapStart[n]?1:l.id===e.value.checkedFieldsMapEnd[n]?2:0,le=n,x=l.id,ie.value=l.variableName,ne.value=!0},Ue=n=>{const l=[];let p=n.map(T=>T.id);for(let T=0;T<n.length;T++){const M=n[T];p.includes(M.id)&&(l.push(M),p=p.filter(I=>I!==M.id))}return l},sa=n=>{const l=Object.values(e.value.checkedFieldsMap).filter(p=>!!p);e.value.parameters=Ue(Object.values((n==null?void 0:n.fields)||{}).flat().filter(p=>l.includes(p.id)&&!!p.variableName)),we(()=>{if(ma.value&&(e.value.timeGranularity=_a[e.value.parameters[0].type[1]||e.value.parameters[0].type[0]],e.value.displayType="1"),e.value.parameters.length&&(e.value.conditionType=0,e.value.optionValueSource===0&&(e.value.optionValueSource=1)),e.value.displayType==="22"){const p=e.value.checkedFields.some(M=>{var I;return(I=e.value.parameters)==null?void 0:I.some(G=>[2,3].includes(G.deType)&&e.value.checkedFieldsMap[M]===G.id)});e.value.checkedFields.every(M=>{var I,G;return!((G=(I=e.value.checkedFieldsMapArr)==null?void 0:I[M])!=null&&G.length)})&&p&&(e.value.displayType="2")}ca()}),da(),e.value.displayType==="9"&&Je()},da=()=>{var n,l;if((n=e.value.checkedFields)!=null&&n.length){const[p]=e.value.checkedFields,T=Q.value.find(G=>G.componentId===p),M=(l=e.value.checkedFieldsMap)==null?void 0:l[p],I=Object.values((T==null?void 0:T.fields)||{}).flat().find(G=>M===G.id);if((I==null?void 0:I.deType)!==void 0){let G=e.value.displayType;if(["9","22"].includes(e.value.displayType))return;(I==null?void 0:I.deType)===1&&e.value.displayType==="7"||(e.value.displayType=`${[3,4].includes(I==null?void 0:I.deType)?2:I==null?void 0:I.deType}`),(I==null?void 0:I.deType)===7&&(e.value.displayType="0"),+G!=+e.value.displayType&&!([3,4].includes(+G)&&+e.value.displayType==2)&&ca()}}},ca=()=>{Qe(),we(()=>{var n,l;e.value.field.id="",(l=(n=S.value)==null?void 0:n.displayTypeChange)==null||l.call(n),+e.value.displayType==7&&["yearrange","monthrange","daterange","datetimerange"].includes(e.value.timeGranularity)&&(e.value.timeGranularityMultiple=e.value.timeGranularity),e.value.displayType==="9"&&Je()})},ma=H(()=>e.value.checkedFields.some(n=>{var l;return(l=e.value.parameters)==null?void 0:l.some(p=>p.deType===1&&!!p.variableName&&e.value.checkedFieldsMap[n]===p.id)})),ka=H(()=>{var n;return(n=e.value.parameters)==null?void 0:n.some(l=>[2,3].includes(l.deType)&&!!l.variableName)}),ut=H(()=>e.value.checkedFields.some(n=>{var l;return((l=e.value.checkedFieldsMapArrNum[n])==null?void 0:l.length)>0})),rt=H(()=>e.value.checkedFields.every(n=>{var l,p;return((p=(l=e.value.checkedFieldsMapArrNum)==null?void 0:l[n])==null?void 0:p.length)>0})?!1:e.value.checkedFields.some(n=>{var l;return(l=e.value.parameters)==null?void 0:l.some(p=>[2,3].includes(p.deType)&&e.value.checkedFieldsMap[n]===p.id)})),Ua=H(()=>e.value.checkedFields.some(n=>{var l;return((l=e.value.checkedFieldsMapArr[n])==null?void 0:l.length)>0})),$a=H(()=>{const n=a(Q).map(T=>Object.values((T==null?void 0:T.fields)||{}).flat()).flat(),l=Object.values(e.value.checkedFieldsMapArr||{}).flat(),p=n.find(T=>T.id===l[0]);return(p==null?void 0:p.type)||[]}),Ba=[{label:t("dynamic_time.year"),value:"year"},{label:t("chart.y_M"),value:"month"},{label:t("chart.y_M_d"),value:"date"},{label:t("chart.y_M_d_H_m_s"),value:"datetime"}],_a={"DATETIME-YEAR":"year","YYYY-MM":"month","YYYY/MM":"month","YYYY-MM-DD":"date","YYYY/MM/DD":"date","YYYY-MM-DD HH:mm:ss":"datetime","YYYY/MM/DD HH:mm:ss":"datetime"},ot=H(()=>{var T;if(!ma.value)return Ba;const[n,l]=(T=e.value.parameters)==null?void 0:T.filter(M=>M.deType===1&&!!M.variableName)[0].type;let p=!1;return Ba.reduce((M,I)=>(I.value===(_a[l]||_a[n])?(p=!0,M.push(I)):p||M.push(I),M),[])}),st=()=>{Qe(),L.value=!1},dt=()=>{Qn({}).then(n=>{var p;const l=n||[];((p=l[0])==null?void 0:p.id)==="0"?Ga(ft(l[0].children)):Ga(ft(l))})},Ga=n=>{const l=s.get("TreeSort-dataset")||"time_desc";U.value=vi(n,l)};let Ca="",Va="";const ct=n=>{var T,M,I;if(!((T=e.value.dataset)!=null&&T.id))return;let l=`${(M=e.value.dataset)==null?void 0:M.id}--${e.value.id}`,p=!1;for(let G in m){const[se,R]=m[G];(se!=null&&se.datasetId.includes(l)||R!=null&&R.datasetId.includes(l))&&(p=!0)}p&&(Va=(I=e.value.dataset)==null?void 0:I.id,Ca=n.id)},Ta=()=>{e.value.dataset.id=Ca,jl(`${Va}--${e.value.id}`),Ca="",Va="",Dt()},Dt=()=>{if(Ca&&Va){e.value.dataset.id=Va,vn.confirm(t("v_query.to_modify_it"),{confirmButtonType:"primary",type:"warning",confirmButtonText:t("commons.confirm"),cancelButtonText:t("commons.cancel"),autofocus:!1,showClose:!1}).then(()=>{Ta()});return}e.value.field.id="",e.value.displayId="",e.value.sortId="",tn(e.value.dataset.id,e.value)},mt=()=>{e.value.defaultValueCheck&&(e.value.defaultValue=e.value.multiple?[]:void 0,e.value.displayId||(e.value.displayId=e.value.field.id))},Ot=()=>{e.value.defaultValue=e.value.multiple?[]:void 0,vt(e.value.multiple)},vt=(n,l=!1)=>{l&&(e.value.defaultValue=n?[]:void 0);const{defaultValue:p}=e.value;Array.isArray(p)?e.value.selectValue=n?p:void 0:e.value.selectValue=n?p!==void 0?[p]:[]:p,e.value.multiple=n},Bl=(n,l,p)=>{const{intervalType:T,regularOrTrends:M,regularOrTrendsValue:I,relativeToCurrent:G,timeNum:se,relativeToCurrentType:R,around:ve,dynamicWindow:Re,maximumSingleQuery:ge,timeNumRange:Pe,relativeToCurrentTypeRange:Te,aroundRange:ta}=n.timeRange||{};let Se=!1;const Ke=n.timeGranularityMultiple.split("time").join("").split("range")[0],la=Ke==="date"?"day":Ke;if(l&&Re&&(Se=Me(l).add(ge,la).startOf(la).valueOf()-1e3<p),T==="none")return Re?Se:!1;let qe;if(G==="custom")qe=na(R,ve==="f"?"subtract":"add",se);else switch(G){case"thisYear":qe=ze("year");break;case"lastYear":qe=fa("year");break;case"thisMonth":qe=ze("month");break;case"lastMonth":qe=fa("month");break;case"today":qe=ze("day");break;case"yesterday":qe=fa("day");break;case"monthBeginning":qe=ze("month");break;case"yearBeginning":qe=ze("year");break}const Ze=M==="fixed"?I:qe;if(T==="start")return l<+new Date(Ze)||Se;if(T==="end")return p>+new Date(Ze)||Se;if(T==="timeInterval"){const He=M==="fixed"?new Date(Me(new Date(I[0])).startOf(Ke).format("YYYY/MM/DD HH:mm:ss")):na(R,ve==="f"?"subtract":"add",se),c=M==="fixed"?new Date(Me(new Date(I[1])).endOf(Ke).format("YYYY/MM/DD HH:mm:ss")):na(Te,ta==="f"?"subtract":"add",Pe);return l<+new Date(He)-1e3||p>+new Date(c)||Se}},Gl=hn(()=>Tn(()=>import("./QueryCascade-0.0.0-dataease.js"),[],import.meta.url)),qt=X(),Pl=()=>{const n=w.value.filter(l=>{var p;return[0,2,5].includes(+l.displayType)&&l.optionValueSource===1&&!!((p=l.checkedFields)!=null&&p.length)&&!!Object.values(l.checkedFieldsMap).filter(T=>!!T).length}).reduce((l,p)=>{var T,M,I;return l[p.id]={datasetId:p.dataset.id,name:p.name,queryId:p.id,fieldId:p.field.id,deType:(I=(((M=(T=ee[p.dataset.id])==null?void 0:T.fields)==null?void 0:M.dimensionList)||p.dataset.fields).find(G=>G.id===p.field.id))==null?void 0:I.deType},l},{});qt.value.init(n,m)},jl=n=>{for(let l in m){const[p,T]=m[l];p!=null&&p.datasetId.includes(n)?m[l]=[]:T!=null&&T.datasetId.includes(n)&&(m[l]=[p])}m=m.filter(l=>!!l.length)},Hl=[" ",t("report.week_mon"),t("report.week_tue"),t("report.week_wed"),t("report.week_thu"),t("report.week_fri")],zl=({defaultConditionValueF:n,defaultConditionValueS:l,conditionType:p})=>p===0?n==="":n===""||l==="",Nt=n=>{const{defaultConditionValueOperatorF:l,defaultConditionValueF:p,defaultConditionValueOperatorS:T,defaultConditionValueS:M}=n;n.conditionValueOperatorF=l,n.conditionValueF=p,n.conditionValueOperatorS=T,n.conditionValueS=M},Wl=()=>w.value.some(n=>{var I,G,se;if(n.auto)return!1;if(!((I=n.checkedFields)!=null&&I.length)||n.checkedFields.some(R=>!n.checkedFieldsMap[R]))return Le.error(t("v_query.be_linked_first")),!0;if(n.displayType==="22"&&n.defaultValueCheck){if(n.defaultNumValueEnd!==0&&!n.defaultNumValueEnd||n.defaultNumValueStart!==0&&!n.defaultNumValueStart)return Le.error(t("v_query.cannot_be_empty_de")),!0;if(!isNaN(n.defaultNumValueEnd)&&!isNaN(n.defaultNumValueStart)&&n.defaultNumValueEnd<n.defaultNumValueStart)return Le.error(""),!0}let l=null,p=t("v_query.cannot_be_performed"),T=0,M=0;if(n.checkedFields.some(R=>{var Pe,Te,ta,Se,Ke,la,qe,Ze,He,c,N,ke,jt,Ht,zt,Wt,Qt;if((Te=(Pe=n.checkedFieldsMapArrNum)==null?void 0:Pe[R])!=null&&Te.length&&(M===0&&(M=1),M===2)||!((Se=(ta=n.checkedFieldsMapArrNum)==null?void 0:ta[R])!=null&&Se.length)&&["22"].includes(n.displayType)&&n.parameters.length&&(M===0&&(M=2),M===1))return!0;if(((la=(Ke=n.checkedFieldsMapArrNum)==null?void 0:Ke[R])==null?void 0:la.length)===1&&n.displayType==="22")return p=t("v_query.numerical_parameter_configuration"),!0;if((Ze=(qe=n.checkedFieldsMapArr)==null?void 0:qe[R])!=null&&Ze.length&&["7","1"].includes(n.displayType)&&(T===0&&(T=1),T===2)||!((c=(He=n.checkedFieldsMapArr)==null?void 0:He[R])!=null&&c.length)&&["7","1"].includes(n.displayType)&&n.parameters.length&&(T===0&&(T=2),T===1))return!0;if(((ke=(N=n.checkedFieldsMapArr)==null?void 0:N[R])==null?void 0:ke.length)===1&&n.displayType==="7")return p=t("v_query.and_end_time"),!0;const ve=Q.value.find(ga=>ga.componentId===R),Re=(jt=n.checkedFieldsMap)==null?void 0:jt[R],ge=Ue(Object.values((ve==null?void 0:ve.fields)||{}).flat()).find(ga=>Re===ga.id);if(!ge)return!1;if(l===null)return l=ge,!1;if((l==null?void 0:l.deType)===(ge==null?void 0:ge.deType)&&(l==null?void 0:l.deType)===1){if(!((Ht=l.type)!=null&&Ht.length)&&!((zt=ge.type)!=null&&zt.length))return!1;if(((Wt=l.type)==null?void 0:Wt.length)!==((Qt=ge.type)==null?void 0:Qt.length))return p=t("v_query.format_is_inconsistent"),!0;for(let ga=0;ga<l.type.length;ga++)if(l.type[ga]!==ge.type[ga])return p=t("v_query.format_is_inconsistent"),!0}return l.deType!==(ge==null?void 0:ge.deType)}))return Le.error(p),!0;if(n.required){if(n.displayType==="8"){Nt(n);const R=zl(n);return R&&Le.error(t("v_query.cannot_be_empty_de")),R}if(!n.defaultValueCheck)return Le.error(t("v_query.cannot_be_empty_de")),!0;if(n.displayType==="22")return n.defaultNumValueEnd!==0&&!n.defaultNumValueEnd||n.defaultNumValueStart!==0&&!n.defaultNumValueStart?(Le.error(t("v_query.cannot_be_empty_de")),!0):!1;if(Array.isArray(n.defaultValue)&&!n.defaultValue.length||n.defaultValue!==0&&!n.defaultValue)return Le.error(t("v_query.cannot_be_empty_de")),!0}if(n.displayType==="8")return Nt(n),!1;if(!n.defaultValueCheck){const R=+n.displayType==7||n.multiple;n.selectValue=R?[]:void 0,n.defaultValue=R?[]:void 0}if(n.displayType==="1"){if(!n.defaultValueCheck)return!1;if(n.timeType==="fixed"&&!n.defaultValue)return Le.error(t("v_query.cannot_be_empty_time")),!0}if(+n.displayType==7){if(!n.defaultValueCheck)return!1;if(n.timeType==="fixed"){const[N,ke]=n.defaultValue||[];if(!N||!ke)return Le.error(t("v_query.cannot_be_empty_time")),!0}const{timeNum:R,relativeToCurrentType:ve,around:Re,relativeToCurrentRange:ge,timeGranularityMultiple:Pe,arbitraryTime:Te,timeGranularity:ta,timeNumRange:Se,relativeToCurrentTypeRange:Ke,aroundRange:la,arbitraryTimeRange:qe,timeType:Ze}=n;let He=Ze==="dynamic"?qa(R,ve,ta,Re,Te,Pe,"start-config"):new Date(n.defaultValue[0]),c=Ze==="dynamic"?qa(Se,Ke,ta,la,qe,Pe,"end-config"):new Date(n.defaultValue[1]);return ge&&ge!=="custom"&&([He,c]=Ft(ge)),+He>+c?(Le.error(t("v_query.the_start_time")),!0):n.setTimeRange&&Bl(n,Pe.includes("time")?Me(+He).startOf("day").valueOf():+He,Pe.includes("time")?Me(+c).startOf("day").valueOf():+c)?(Le.error(t("v_query.range_please_reset")),!0):!1}if([1].includes(+n.displayType))return!1;if(n.displayType!=="9"&&n.optionValueSource===2&&!((G=n.valueSource)!=null&&G.filter(R=>!!R).length))return Le.error(t("v_query.cannot_be_empty_input")),!0;if(!["9","22"].includes(n.displayType)&&n.optionValueSource===1&&!n.field.id)return Le.error((se=n.dataset)!=null&&se.id?t("v_query.the_data_set"):t("v_query.option_value_field")),!0}),Ql=()=>{var n,l;(n=S.value)==null||n.mult(),(l=S.value)==null||l.single(),Qe(),L.value=!1},Kl=u,Zl=()=>{var n,l;Wl()||((n=S.value)==null||n.mult(),(l=S.value)==null||l.single(),Qe(),L.value=!1,w.value.forEach(p=>{e.value=p,vt(["1","7"].includes(e.value.displayType)?e.value.displayType==="7":e.value.multiple)}),$e.value.propValue=[],we(()=>{w.value.forEach(p=>{m.forEach(T=>{T.forEach(M=>{if(M.datasetId.split("--")[1]===p.id&&p.defaultValueCheck){const I=p.mapValue;M.selectValue=Array.isArray(I)?[...I]:I,M.currentSelectValue=Array.isArray(I)?[...I]:I}})})}),$e.value.cascade=je(m),m=[],$e.value.propValue=je(w.value),W.recordSnapshotCache(),we(()=>{Kl("queryData")})}))},Et=()=>{d.value=je(e.value.valueSource),d.value.length||d.value.push(""),pe.value.hide()},Jl=()=>{if(d.value.some(n=>typeof n=="string"?!n.trim():!1)){Le.error(t("v_query.cannot_be_empty_input"));return}e.value.valueSource=je(d.value.filter(n=>typeof n=="string"?n.trim():!0)),Ot(),Et()},Xl=n=>{w.value=je(V.queryElement.propValue)||[],It(n)},en=()=>{w.value=je(V.queryElement.propValue)||[],yt(),It(w.value[w.value.length-1].id)},xt=(n,l)=>{let p="dimensionList";return n.some((T,M)=>(T||[]).some(I=>I.id===l)?(p=["dimensionList","quotaList","parameterList"][M],!0):!1),p},It=n=>{dt(),P.value=[],pt({id:n}),m=je($e.value.cascade||[]),L.value=!0;const l=B.value.map(M=>M.tableId);for(const M in ee)l.includes(M)||delete ee[M];const p=Object.keys(ee);l.every(M=>p.includes(M))&&(Q.value=B.value.map(M=>ee[M.tableId]?{...ee[M.tableId],componentId:M.id}:null).filter(M=>!!M));const T=[...new Set(B.value.map(M=>M.tableId).filter(M=>!!M))];T.length&&Promise.all([zn(T),Wn(T)]).then(([M,I])=>{M.filter(G=>!!G).forEach(G=>{G.activelist="dimensionList",G.fields.parameterList=I.filter(se=>{var R;return se.datasetGroupId===G.id&&!((R=se.params)!=null&&R.length)}),G.hasParameter=!!G.fields.parameterList.length,G.fields.dimensionList=(G.fields.dimensionList||[]).filter(se=>{var R;return!((R=se.params)!=null&&R.length)}),G.fields.quotaList=(G.fields.quotaList||[]).filter(se=>{var R;return!((R=se.params)!=null&&R.length)}),ee[G.id]=G}),Q.value=B.value.map(G=>{if(!ee[G.tableId])return null;const se=ee[G.tableId].fields||{},R=xt([se.dimensionList,se.quotaList,se.parameterList],e.value.checkedFieldsMap[G.id]);return{...ee[G.tableId],componentId:G.id,activelist:R}}).filter(G=>!!G)}).finally(()=>{Ge(e.value.checkedFields)})},Rt=()=>{d.value=Array.from(new Set(d.value))},an=()=>{Object.entries({timeType:"fixed",hideConditionSwitching:!1,required:!1,defaultMapValue:[],mapValue:[],parametersStart:null,conditionType:0,conditionValueOperatorF:"eq",conditionValueF:"",conditionValueOperatorS:"like",conditionValueS:"",resultMode:0,defaultConditionValueOperatorF:"eq",defaultConditionValueF:"",defaultConditionValueOperatorS:"like",defaultConditionValueS:"",parametersEnd:null,relativeToCurrent:"custom",timeNum:0,relativeToCurrentRange:"custom",relativeToCurrentType:"year",around:"f",arbitraryTime:new Date,timeNumRange:0,relativeToCurrentTypeRange:"year",aroundRange:"f",displayId:"",sortId:"",sort:"asc",arbitraryTimeRange:new Date,setTimeRange:!1,showEmpty:!1,defaultNumValueStart:null,defaultNumValueEnd:null,numValueEnd:null,numValueStart:null,timeRange:{intervalType:"none",dynamicWindow:!1,maximumSingleQuery:0,regularOrTrends:"fixed",regularOrTrendsValue:"",relativeToCurrent:"custom",timeNum:0,relativeToCurrentType:"year",around:"f",timeNumRange:0,relativeToCurrentTypeRange:"year",aroundRange:"f"},treeFieldList:[]}).forEach(([l,p])=>{e.value[l]??(e.value[l]=p)}),e.value.timeRange.relativeToCurrentRange||(e.value.timeRange.relativeToCurrentRange="custom")},pt=n=>{var T;if(Qe(),k.id)return;E.value=n.id;const l=w.value.find(M=>M.id===n.id);l.checkedFieldsMapArr||(l.checkedFieldsMapArr={},l.checkedFieldsMapArrNum={},l.checkedFieldsMapStart={},l.checkedFieldsMapStartNum={},l.checkedFieldsMapEnd={},l.checkedFieldsMapEndNum={},l.parametersArr={}),e.value=l,e.value.dataset.fields=[],we(()=>{S.value.changeMultiple(e.value.multiple)}),e.value.dataset.id&&Kt(e.value.dataset.id).then(M=>{e.value.dataset.fields=M.data}),e.value.checkedFieldsMapStart||(e.value.checkedFieldsMapStart={}),e.value.checkedFieldsMapStartNum||(e.value.checkedFieldsMapStartNum={}),e.value.checkedFieldsMapEnd||(e.value.checkedFieldsMapEnd={}),e.value.checkedFieldsMapEndNum||(e.value.checkedFieldsMapEndNum={}),e.value.checkedFieldsMapArr||(e.value.checkedFieldsMapArr={}),e.value.checkedFieldsMapArrNum||(e.value.checkedFieldsMapArrNum={}),e.value.parametersArr||(e.value.parametersArr={}),B.value.forEach(M=>{e.value.checkedFieldsMap[M.id]||(e.value.checkedFieldsMap[M.id]=""),e.value.checkedFieldsMapStart[M.id]||(e.value.checkedFieldsMapStart[M.id]=""),e.value.checkedFieldsMapStartNum[M.id]||(e.value.checkedFieldsMapStartNum[M.id]=""),e.value.checkedFieldsMapEnd[M.id]||(e.value.checkedFieldsMapEnd[M.id]=""),e.value.checkedFieldsMapEndNum[M.id]||(e.value.checkedFieldsMapEndNum[M.id]=""),e.value.checkedFieldsMapArr[M.id]||(e.value.checkedFieldsMapArr[M.id]=[]),e.value.checkedFieldsMapArrNum[M.id]||(e.value.checkedFieldsMapArrNum[M.id]=[]),e.value.parametersArr[M.id]||(e.value.parametersArr[M.id]=[])});const p=B.value.map(M=>M.id);e.value.checkedFields=e.value.checkedFields.filter(M=>p.includes(M)),(T=Q.value)!=null&&T.length&&(Q.value.forEach(M=>{const I=M.fields;M.activelist=xt([I.dimensionList,I.quotaList,I.parameterList],e.value.checkedFieldsMap[M.componentId])}),Ge(e.value.checkedFields)),vt(e.value.multiple),d.value=je(e.value.valueSource),d.value.length||d.value.push(""),an(),we(()=>{e.value.showError=Ut.value,e.value.auto&&(document.querySelector(".chart-field").scrollTop=0)})},tn=(n,l)=>{Kt(n).then(p=>{l.dataset.fields=p.data})},Lt=X(),Yt=()=>{var p;const[n]=e.value.checkedFields,l=Q.value.find(T=>T.componentId===n);Lt.value.init((p=l==null?void 0:l.fields)==null?void 0:p.dimensionList.filter(T=>T.deType===+e.value.field.deType),e.value.treeFieldList)},ln=n=>{e.value.treeFieldList=n},Ut=H(()=>{if(!e.value)return!1;const{optionValueSource:n,checkedFieldsMap:l,checkedFields:p,field:T,valueSource:M,displayType:I}=e.value,G=p.filter(se=>!!l[se]);if(!p.length||!G.length)return!0;if([1,7,8,22].includes(+I))return!1;if(I==="9"){let se=null;return p.some(R=>{const ve=(Q.value||[]).find(ge=>ge.componentId===R),Re=ve==null?void 0:ve.id;return Re?se===null?(se=Re,!1):se!==Re:!1})}return n===1&&!T.id||n===2&&!M.length}),Qe=()=>{var n;(n=S.value)==null||n.handleDialogClick()},nn=H(()=>{let n=[];if(!e.value)return n;switch(e.value.timeGranularity){case"year":n=[{label:t("dynamic_year.current"),value:"thisYear"},{label:t("dynamic_year.last"),value:"lastYear"}];break;case"month":n=[{label:t("cron.this_month"),value:"thisMonth"},{label:t("dynamic_month.last"),value:"lastMonth"}];break;case"date":n=[{label:t("dynamic_time.today"),value:"today"},{label:t("dynamic_time.yesterday"),value:"yesterday"},{label:t("dynamic_time.firstOfMonth"),value:"monthBeginning"},{label:t("dynamic_time.firstOfYear"),value:"yearBeginning"}];break;case"datetime":n=[{label:t("dynamic_time.today"),value:"today"},{label:t("dynamic_time.yesterday"),value:"yesterday"},{label:t("dynamic_time.firstOfMonth"),value:"monthBeginning"},{label:t("dynamic_time.firstOfYear"),value:"yearBeginning"}];break}return[...n,{label:t("dynamic_time.custom"),value:"custom"}]}),un=H(()=>{let n=[];if(!e.value)return n;switch(e.value.timeGranularityMultiple){case"yearrange":n=[{label:t("dynamic_year.current"),value:"thisYear"},{label:t("dynamic_year.last"),value:"lastYear"}];break;case"monthrange":n=[{label:t("cron.this_month"),value:"thisMonth"},{label:t("dynamic_month.dynamic_month"),value:"lastMonth"},{label:t("v_query.last_3_months"),value:"LastThreeMonths"},{label:t("v_query.last_6_months"),value:"LastSixMonths"},{label:t("v_query.last_12_months"),value:"LastTwelveMonths"}];break;case"daterange":case"datetimerange":n=[{label:t("dynamic_time.today"),value:"today"},{label:t("dynamic_time.yesterday"),value:"yesterday"},{label:t("v_query.last_3_days"),value:"LastThreeDays"},{label:t("v_query.month_to_date"),value:"monthBeginning"},{label:t("v_query.year_to_date"),value:"yearBeginning"}];break}return[...n,{label:t("dynamic_time.custom"),value:"custom"}]}),Bt=n=>{var l;e.value.relativeToCurrentType=["date","datetime"].includes(n)?"date":n,e.value.relativeToCurrent!=="custom"&&(e.value.relativeToCurrent=(l=nn.value[0])==null?void 0:l.value)},rn=()=>{Bt(e.value.timeGranularity),Gt(e.value.timeGranularityMultiple)},Gt=n=>{var l;Qe(),e.value.relativeToCurrentType=["daterange","datetimerange"].includes(n)?"date":n.split("range")[0],e.value.relativeToCurrentTypeRange=e.value.relativeToCurrentType,e.value.relativeToCurrentRange!=="custom"&&(e.value.relativeToCurrentRange=(l=un.value[0])==null?void 0:l.value),e.value.timeRange={intervalType:"none",dynamicWindow:!1,maximumSingleQuery:0,regularOrTrends:"fixed",regularOrTrendsValue:"",relativeToCurrent:"custom",relativeToCurrentRange:"custom",timeNum:0,relativeToCurrentType:e.value.relativeToCurrentRange,around:"f",timeNumRange:0,relativeToCurrentTypeRange:e.value.relativeToCurrentRange,aroundRange:"f"}};ce(()=>Ut.value,n=>{e.value.showError=n});const on=n=>{P.value.push(n)},Pt=(n,l,p)=>{switch(n){case"del":P.value=[],w.value.splice(p,1),e.value=null;break;case"rename":P.value=[],Object.assign(k,l),setTimeout(()=>{we(()=>{P.value[0].focus()})},400);break}},sn={label:"name",children:"children",value:"id",isLeaf:n=>{var l;return!((l=n.children)!=null&&l.length)}},ft=n=>n.filter(l=>{var p,T;return(p=l.children)!=null&&p.length&&!l.leaf?(l.children=ft(l.children),!!((T=l.children)!=null&&T.length)):l.leaf}),dn=()=>{var n;if(k.name.trim()===""){Le.error(t("v_query.cannot_be_empty_name")),(n=P.value[0])==null||n.focus();return}w.value.some(l=>k.id===l.id?(l.name=k.name,!0):!1),k.id=""},yt=()=>{w.value.push(_i())},cn=()=>{yt(),pt(w.value[w.value.length-1])};return h({setCondition:Xl,addCriteriaConfig:()=>(yt(),w.value[w.value.length-1].id),setConditionOut:en}),(n,l)=>{const p=Oa,T=ol,M=Oa,I=wn,G=Tt,se=At,R=at,ve=tt,Re=St,ge=Sn,Pe=Fn,Te=Ia,ta=Mn,Se=Xa,Ke=yl,la=fl,qe=pl,Ze=kn,He=Cn;return v(),$(oe,null,[i(qe,{class:"query-condition-configuration",modelValue:L.value,"onUpdate:modelValue":l[20]||(l[20]=c=>L.value=c),width:"1200px",title:a(t)("v_query.query_condition_setting"),onClick:l[21]||(l[21]=Ne(()=>{},["stop"])),"before-close":Ql,onMousedown:l[22]||(l[22]=Ne(()=>{},["stop"])),onMousedup:l[23]||(l[23]=Ne(()=>{},["stop"]))},{footer:o(()=>[b("div",xo,[i(Se,{class:"query-cascade",onClick:Pl},{default:o(()=>[J(F(a(t)("v_query.component_cascade_configuration")),1)]),_:1}),i(Se,{onClick:st},{default:o(()=>[J(F(a(t)("chart.cancel")),1)]),_:1}),i(Se,{onClick:Zl,type:"primary"},{default:o(()=>[J(F(a(t)("chart.confirm")),1)]),_:1})])]),default:o(()=>[b("div",{class:"container",onClick:Qe},[b("div",yr,[b("div",hr,[J(F(a(t)("v_query.query_condition"))+" ",1),i(T,{onClick:cn},{default:o(()=>[i(p,{name:"icon_add_outlined"},{default:o(()=>[i(a(Qa),{class:"svg-icon"})]),_:1})]),_:1})]),i(a(Jn),{tag:"div",list:w.value,handle:".handle"},{item:o(({element:c,index:N})=>[(v(),$("div",{key:c.id,onDblclick:Ne(ke=>Pt("rename",c,N),["stop"]),onClick:Ne(ke=>pt(c),["stop"]),class:Fe(["list-item_primary",c.id===E.value&&"active"])},[i(T,{class:"handle"},{default:o(()=>[i(p,{name:"icon_drag_outlined"},{default:o(()=>[i(a($n),{class:"svg-icon"})]),_:1})]),_:1}),b("div",{class:"label flex-align-center icon",title:c.name},[!c.auto&&c.showError?(v(),j(T,{key:0,style:{"font-size":"16px",color:"#f54a45"}},{default:o(()=>[i(M,{name:"icon_warning_filled"},{default:o(()=>[i(a(Nn),{class:"svg-icon"})]),_:1})]),_:1})):K("",!0),J(" "+F(c.name),1)],8,gr),b("div",br,[i(I,{onHandleCommand:ke=>Pt(ke,c,N),"menu-list":aa,"icon-name":a(An),placement:"bottom-end"},null,8,["onHandleCommand","icon-name"]),c.visible?(v(),j(T,{key:0,class:"hover-icon",onClick:Ne(ke=>c.visible=!c.visible,["stop"])},{default:o(()=>[i(p,{name:"icon_visible_outlined"},{default:o(()=>[i(a(Dn),{class:"svg-icon"})]),_:1})]),_:2},1032,["onClick"])):(v(),j(T,{key:1,class:"hover-icon",onClick:Ne(ke=>c.visible=!c.visible,["stop"])},{default:o(()=>[i(p,{name:"de_pwd_invisible"},{default:o(()=>[i(a(yi),{class:"svg-icon"})]),_:1})]),_:2},1032,["onClick"]))]),k.id===c.id?(v(),$("div",{key:0,onClick:l[1]||(l[1]=Ne(()=>{},["stop"])),class:"rename"},[i(G,{onBlur:dn,ref:on,modelValue:k.name,"onUpdate:modelValue":l[0]||(l[0]=ke=>k.name=ke)},null,8,["modelValue"])])):K("",!0)],42,_r))]),_:1},8,["list"])]),e.value?(v(),$("div",{key:0,class:Fe(["chart-field",e.value.auto&&"hidden"])},[e.value.auto?(v(),$("div",Vr)):K("",!0),b("div",Tr,[J(F(a(t)("v_query.chart_and_field"))+" ",1),i(ve,{class:"ml-4 larger-radio",modelValue:e.value.auto,"onUpdate:modelValue":l[2]||(l[2]=c=>e.value.auto=c)},{default:o(()=>[i(R,{disabled:!e.value.auto,label:!0},{default:o(()=>[b("div",kr,[J(F(a(t)("chart.margin_model_auto"))+" ",1),i(se,{effect:"dark",placement:"top"},{content:o(()=>[b("div",null,[J(F(a(t)("v_query.be_switched_to"))+" ",1),l[30]||(l[30]=b("br",null,null,-1)),J(" "+F(a(t)("v_query.to_automatic_again")),1)])]),default:o(()=>[i(T,{style:{"margin-left":"4px",color:"#646a73"}},{default:o(()=>[i(M,{name:"icon_info_outlined"},{default:o(()=>[i(a(En),{class:"svg-icon"})]),_:1})]),_:1})]),_:1})])]),_:1},8,["disabled"]),i(R,{label:!1},{default:o(()=>[J(F(a(t)("commons.custom")),1)]),_:1})]),_:1},8,["modelValue"])]),b("div",Cr,[i(Re,{modelValue:Y.value,"onUpdate:modelValue":l[3]||(l[3]=c=>Y.value=c),indeterminate:f.value,onChange:ia},{default:o(()=>[J(F(a(t)("dataset.check_all")),1)]),_:1},8,["modelValue","indeterminate"])]),b("div",Mr,[i(ta,{modelValue:e.value.checkedFields,"onUpdate:modelValue":l[4]||(l[4]=c=>e.value.checkedFields=c),onChange:te},{default:o(()=>[(v(!0),$(oe,null,he(Q.value,c=>(v(),$("div",{key:c.componentId,class:"list-item_field_de"},[i(Re,{label:c.componentId},{default:o(()=>[i(T,{class:"component-type"},{default:o(()=>[i(p,null,{default:o(()=>[(v(),j(Be(a(mi)[a(C)[c.componentId].type])))]),_:2},1024)]),_:2},1024),b("span",{title:a(C)[c.componentId].title,class:"checkbox-name ellipsis"},F(a(C)[c.componentId].title),9,Sr)]),_:2},1032,["label"]),b("span",{title:c.name,class:"dataset ellipsis"},F(c.name),9,Fr),e.value.checkedFields.includes(c.componentId)&&e.value.checkedFieldsMapArr&&e.value.checkedFieldsMapArr[c.componentId]&&e.value.checkedFieldsMapArr[c.componentId].length?(v(),j(a(De),{onChange:N=>Ce(N,c.componentId),onFocus:Qe,multiple:"","collapse-tags":"","collapse-tags-tooltip":"",key:"checkedFieldsMapArrTime","multiple-limit":2,class:"field-select--input",style:{"margin-left":"12px"},"popper-class":"field-select--dqp",modelValue:e.value.checkedFieldsMapArr[c.componentId],"onUpdate:modelValue":N=>e.value.checkedFieldsMapArr[c.componentId]=N,clearable:""},Ma({header:o(()=>[i(Pe,{stretch:"",class:"params-select--header",modelValue:c.activelist,"onUpdate:modelValue":N=>c.activelist=N},{default:o(()=>[i(ge,{disabled:"",label:a(t)("chart.dimension"),name:"dimensionList"},null,8,["label"]),i(ge,{disabled:"",label:a(t)("chart.quota"),name:"quotaList"},null,8,["label"]),i(ge,{label:a(t)("dataset.param"),name:"parameterList"},null,8,["label"])]),_:2},1032,["modelValue","onUpdate:modelValue"])]),default:o(()=>[(v(!0),$(oe,null,he(c.fields[c.activelist],N=>(v(),j(Te,{key:N.id,label:N.name||N.variableName,value:N.id,disabled:_(N)},{default:o(()=>[b("div",wr,[i(T,null,{default:o(()=>[i(p,{className:`field-icon-${a(be)[N.deType]}`},{default:o(()=>[(v(),j(Be(a(Xe)[a(be)[N.deType]]),{class:Fe(["svg-icon",`field-icon-${a(be)[N.deType]}`])},null,8,["class"]))]),_:2},1032,["className"])]),_:2},1024),b("span",{title:N.name||N.variableName,class:"ellipsis"},F(N.name||N.variableName),9,Ar),e.value.checkedFieldsMapArr[c.componentId].includes(N.id)&&c.activelist==="parameterList"?(v(),$("span",{key:0,onClick:Ne(ke=>me(c.componentId,N),["stop"]),class:"range-time_setting"},[J(F(e.value.checkedFieldsMapStart[c.componentId]===N.id?a(t)("dataset.start_time"):e.value.checkedFieldsMapEnd[c.componentId]===N.id?a(t)("dataset.end_time"):"")+" ",1),i(T,null,{default:o(()=>[i(p,null,{default:o(()=>[i(a(Sa),{class:"svg-icon"})]),_:1})]),_:1})],8,$r)):K("",!0)])]),_:2},1032,["label","value","disabled"]))),128))]),_:2},[e.value.checkedFieldsMap[c.componentId]?{name:"prefix",fn:o(()=>[i(T,null,{default:o(()=>[i(p,null,{default:o(()=>[(v(),j(Be(a(Xe)[a(be)[_e(e.value.checkedFieldsMap[c.componentId],Object.values(c.fields))]]),{class:Fe(`field-icon-${a(be)[_e(e.value.checkedFieldsMap[c.componentId],Object.values(c.fields))]}`)},null,8,["class"]))]),_:2},1024)]),_:2},1024)]),key:"0"}:void 0]),1032,["onChange","modelValue","onUpdate:modelValue"])):e.value.checkedFields.includes(c.componentId)&&e.value.checkedFieldsMapArrNum&&e.value.checkedFieldsMapArrNum[c.componentId]&&e.value.checkedFieldsMapArrNum[c.componentId].length?(v(),j(a(De),{onChange:N=>fe(N,c.componentId),onFocus:Qe,multiple:"","collapse-tags":"","collapse-tags-tooltip":"",key:"checkedFieldsMapArr","multiple-limit":2,class:"field-select--input",style:{"margin-left":"12px"},"popper-class":"field-select--dqp",modelValue:e.value.checkedFieldsMapArrNum[c.componentId],"onUpdate:modelValue":N=>e.value.checkedFieldsMapArrNum[c.componentId]=N,clearable:""},Ma({header:o(()=>[i(Pe,{stretch:"",class:"params-select--header",modelValue:c.activelist,"onUpdate:modelValue":N=>c.activelist=N},{default:o(()=>[i(ge,{disabled:"",label:a(t)("chart.dimension"),name:"dimensionList"},null,8,["label"]),i(ge,{disabled:"",label:a(t)("chart.quota"),name:"quotaList"},null,8,["label"]),i(ge,{label:a(t)("dataset.param"),name:"parameterList"},null,8,["label"])]),_:2},1032,["modelValue","onUpdate:modelValue"])]),default:o(()=>[(v(!0),$(oe,null,he(c.fields[c.activelist],N=>(v(),j(Te,{key:N.id,label:N.name||N.variableName,value:N.id,disabled:![2,3].includes(N.deType)},{default:o(()=>[b("div",Dr,[i(T,null,{default:o(()=>[i(p,{className:`field-icon-${a(be)[N.deType]}`},{default:o(()=>[(v(),j(Be(a(Xe)[a(be)[N.deType]]),{class:Fe(["svg-icon",`field-icon-${a(be)[N.deType]}`])},null,8,["class"]))]),_:2},1032,["className"])]),_:2},1024),b("span",{title:N.name||N.variableName,class:"ellipsis"},F(N.name||N.variableName),9,Or),e.value.checkedFieldsMapArrNum[c.componentId].includes(N.id)&&c.activelist==="parameterList"?(v(),$("span",{key:0,onClick:Ne(ke=>Ie(c.componentId,N),["stop"]),class:"range-time_setting"},[J(F(e.value.checkedFieldsMapStartNum[c.componentId]===N.id?a(t)("chart.min"):e.value.checkedFieldsMapEndNum[c.componentId]===N.id?a(t)("chart.max"):"")+" ",1),i(T,null,{default:o(()=>[i(p,null,{default:o(()=>[i(a(Sa),{class:"svg-icon"})]),_:1})]),_:1})],8,qr)):K("",!0)])]),_:2},1032,["label","value","disabled"]))),128))]),_:2},[e.value.checkedFieldsMap[c.componentId]?{name:"prefix",fn:o(()=>[i(T,null,{default:o(()=>[i(p,null,{default:o(()=>[(v(),j(Be(a(Xe)[a(be)[_e(e.value.checkedFieldsMap[c.componentId],Object.values(c.fields))]]),{class:Fe(`field-icon-${a(be)[_e(e.value.checkedFieldsMap[c.componentId],Object.values(c.fields))]}`)},null,8,["class"]))]),_:2},1024)]),_:2},1024)]),key:"0"}:void 0]),1032,["onChange","modelValue","onUpdate:modelValue"])):e.value.checkedFields.includes(c.componentId)?(v(),j(a(De),{key:2,onChange:N=>sa(c),onFocus:Qe,style:{"margin-left":"12px"},"popper-class":"field-select--dqp",modelValue:e.value.checkedFieldsMap[c.componentId],"onUpdate:modelValue":N=>e.value.checkedFieldsMap[c.componentId]=N,clearable:""},Ma({header:o(()=>[i(Pe,{stretch:"",class:"params-select--header",modelValue:c.activelist,"onUpdate:modelValue":N=>c.activelist=N},{default:o(()=>[i(ge,{label:a(t)("chart.dimension"),name:"dimensionList"},null,8,["label"]),i(ge,{disabled:e.value.displayType==="9",label:a(t)("chart.quota"),name:"quotaList"},null,8,["disabled","label"]),c.hasParameter?(v(),j(ge,{key:0,label:a(t)("dataset.param"),disabled:e.value.displayType==="9",name:"parameterList"},null,8,["label","disabled"])):K("",!0)]),_:2},1032,["modelValue","onUpdate:modelValue"])]),default:o(()=>[(v(!0),$(oe,null,he(c.fields[c.activelist],N=>(v(),j(Te,{key:N.id,label:N.name||N.variableName,value:N.id,disabled:N.desensitized||e.value.displayType==="9"&&N.deType===1||_(N)},{default:o(()=>[b("div",{class:"flex-align-center icon",title:N.desensitized?a(t)("v_query.as_query_conditions"):""},[i(T,null,{default:o(()=>[i(p,{className:`field-icon-${a(be)[N.deType]}`},{default:o(()=>[(v(),j(Be(a(Xe)[a(be)[N.deType]]),{class:Fe(["svg-icon",`field-icon-${a(be)[N.deType]}`])},null,8,["class"]))]),_:2},1032,["className"])]),_:2},1024),b("span",{title:N.name||N.variableName,class:"ellipsis"},F(N.name||N.variableName),9,Er),e.value.checkedFieldsMap[c.componentId]===N.id&&c.activelist==="parameterList"&&(ma.value||ka.value)?(v(),$("span",{key:0,onClick:Ne(()=>ka.value?Ie(c.componentId,N):me(c.componentId,N),["stop"]),class:"range-time_setting"},[J(F(ka.value?a(t)("chart.value_formatter_value"):a(t)("dataset.time"))+" ",1),i(T,null,{default:o(()=>[i(p,null,{default:o(()=>[i(a(Sa),{class:"svg-icon"})]),_:1})]),_:1})],8,xr)):K("",!0)],8,Nr)]),_:2},1032,["label","value","disabled"]))),128))]),_:2},[e.value.checkedFieldsMap[c.componentId]?{name:"prefix",fn:o(()=>[i(T,null,{default:o(()=>[i(p,null,{default:o(()=>[(v(),j(Be(a(Xe)[a(be)[_e(e.value.checkedFieldsMap[c.componentId],Object.values(c.fields))]]),{class:Fe(`field-icon-${a(be)[_e(e.value.checkedFieldsMap[c.componentId],Object.values(c.fields))]}`)},null,8,["class"]))]),_:2},1024)]),_:2},1024)]),key:"0"}:void 0]),1032,["onChange","modelValue","onUpdate:modelValue"])):(v(),$("span",Ir))]))),128))]),_:1},8,["modelValue"])])],2)):K("",!0),e.value?(v(),$("div",{key:1,class:Fe(["condition-configuration",e.value.auto&&"condition-configuration_hide"])},[e.value.auto?(v(),$("div",Rr)):K("",!0),b("div",Lr,[J(F(a(t)("v_query.query_condition_configuration"))+" ",1),i(Re,{disabled:e.value.auto,modelValue:e.value.required,"onUpdate:modelValue":l[5]||(l[5]=c=>e.value.required=c),label:a(t)("v_query.required_items")},null,8,["disabled","modelValue","label"])]),wa(b("div",Yr,[b("div",Ur,[b("div",Br,F(a(t)("v_query.display_type")),1),b("div",Gr,[i(a(De),{onFocus:Qe,onChange:ca,modelValue:e.value.displayType,"onUpdate:modelValue":l[6]||(l[6]=c=>e.value.displayType=c)},{default:o(()=>[i(Te,{disabled:!["0","8","9"].includes(e.value.displayType),label:a(t)("v_query.text_drop_down"),value:"0"},null,8,["disabled","label"]),i(Te,{disabled:!["0","8","9"].includes(e.value.displayType),label:a(t)("v_query.text_search"),value:"8"},null,8,["disabled","label"]),i(Te,{disabled:!["0","8","9"].includes(e.value.displayType)||!!e.value.parameters.length,label:a(t)("v_query.drop_down_tree"),value:"9"},null,8,["disabled","label"]),["2","22"].includes(e.value.displayType)?(v(),$(oe,{key:0},[i(Te,{disabled:!["2","22"].includes(e.value.displayType)||ut.value,label:a(t)("v_query.number_drop_down"),value:"2"},null,8,["disabled","label"]),i(Te,{disabled:!["2","22"].includes(e.value.displayType)||rt.value,label:a(t)("v_query.number_range"),value:"22"},null,8,["disabled","label"])],64)):(v(),j(Te,{key:1,disabled:e.value.displayType!=="5",label:a(t)("v_query.number_drop_down"),value:"5"},null,8,["disabled","label"])),i(Te,{disabled:!["1","7"].includes(e.value.displayType)||ma.value&&Ua.value,label:a(t)("dataset.time"),value:"1"},null,8,["disabled","label"]),i(Te,{disabled:!["1","7"].includes(e.value.displayType)||ma.value&&!Ua.value,label:a(t)("common.component.dateRange"),value:"7"},null,8,["disabled","label"])]),_:1},8,["modelValue"])])]),e.value.displayType==="9"?(v(),$("div",Pr,[b("div",jr,F(a(t)("v_query.of_option_values")),1),b("div",Hr,[i(ve,{class:"larger-radio",modelValue:e.value.resultMode,"onUpdate:modelValue":l[7]||(l[7]=c=>e.value.resultMode=c)},{default:o(()=>[i(R,{label:0},{default:o(()=>[J(F(a(t)("login.default_login")),1)]),_:1}),i(R,{label:1},{default:o(()=>[J(F(a(t)("chart.result_mode_all")),1)]),_:1})]),_:1},8,["modelValue"])])])):K("",!0),e.value.displayType==="9"?(v(),$("div",zr,[b("div",Wr,[J(F(a(t)("v_query.tree_structure_design"))+" ",1),e.value.treeFieldList&&e.value.treeFieldList.length?(v(),j(Se,{key:0,text:"",onClick:Yt},{icon:o(()=>[i(M,{name:"icon_edit_outlined"},{default:o(()=>[i(a(Sa),{class:"svg-icon"})]),_:1})]),_:1})):K("",!0)]),b("div",Qr,[e.value.treeFieldList&&e.value.treeFieldList.length?(v(!0),$(oe,{key:0},he(e.value.treeFieldList,(c,N)=>(v(),$("div",{key:c.id,class:"tree-field"},[b("span",Kr,F(a(t)("visualization.level"))+F(Hl[N+1]),1),b("span",Zr,[i(T,null,{default:o(()=>[i(p,{className:`field-icon-${a(be)[c.deType]}`},{default:o(()=>[(v(),j(Be(a(Xe)[a(be)[c.deType]]),{class:Fe([`field-icon-${a(be)[c.deType]}`,"svg-icon"])},null,8,["class"]))]),_:2},1032,["className"])]),_:2},1024)]),b("span",Jr,F(c.name),1)]))),128)):(v(),j(Se,{key:1,onClick:Yt,text:""},{icon:o(()=>[i(p,{name:"icon_add_outlined"},{default:o(()=>[i(a(Qa),{class:"svg-icon"})]),_:1})]),default:o(()=>[J(" "+F(a(t)("v_query.the_tree_structure")),1)]),_:1}))]),i(Fi,{ref_key:"treeDialog",ref:Lt,onSaveTree:ln},null,512)])):K("",!0),["1","7"].includes(e.value.displayType)?(v(),$("div",Xr,[b("div",eo,F(a(t)("v_query.time_granularity")),1),b("div",ao,[e.value.displayType==="7"&&!ma.value?(v(),j(a(De),{key:0,onChange:Gt,placeholder:a(t)("v_query.the_time_granularity"),onFocus:Qe,modelValue:e.value.timeGranularityMultiple,"onUpdate:modelValue":l[8]||(l[8]=c=>e.value.timeGranularityMultiple=c)},{default:o(()=>[i(Te,{label:a(t)("chart.y"),value:"yearrange"},null,8,["label"]),i(Te,{label:a(t)("chart.y_M"),value:"monthrange"},null,8,["label"]),i(Te,{label:a(t)("chart.y_M_d"),value:"daterange"},null,8,["label"]),i(Te,{label:a(t)("chart.y_M_d_H_m_s"),value:"datetimerange"},null,8,["label"])]),_:1},8,["placeholder","modelValue"])):(v(),j(a(De),{key:1,onChange:Bt,placeholder:a(t)("v_query.the_time_granularity"),modelValue:e.value.timeGranularity,"onUpdate:modelValue":l[9]||(l[9]=c=>e.value.timeGranularity=c)},{default:o(()=>[(v(!0),$(oe,null,he(ot.value,c=>(v(),j(Te,{key:c.value,label:c.label,value:c.value},null,8,["label","value"]))),128))]),_:1},8,["placeholder","modelValue"]))])])):K("",!0),["1","7","8","9","22"].includes(e.value.displayType)?K("",!0):(v(),$("div",to,[b("div",lo,F(a(t)("v_query.option_value_source")),1),b("div",no,[b("div",io,[i(ve,{class:"larger-radio",onChange:Ot,modelValue:e.value.optionValueSource,"onUpdate:modelValue":l[10]||(l[10]=c=>e.value.optionValueSource=c)},{default:o(()=>[i(R,{disabled:!!e.value.parameters.length,label:0},{default:o(()=>[J(F(a(t)("chart.margin_model_auto")),1)]),_:1},8,["disabled"]),i(R,{label:1},{default:o(()=>[J(F(a(t)("chart.select_dataset")),1)]),_:1}),i(R,{label:2},{default:o(()=>[J(F(a(t)("v_query.manual_input")),1)]),_:1})]),_:1},8,["modelValue"])]),e.value.optionValueSource===1?(v(),$(oe,{key:0},[b("div",uo,[i(Ke,{teleported:!1,modelValue:e.value.dataset.id,"onUpdate:modelValue":l[11]||(l[11]=c=>e.value.dataset.id=c),data:U.value,placeholder:a(t)("copilot.pls_choose_dataset"),onChange:Dt,onCurrentChange:ct,props:sn,placement:"bottom","render-after-expand":!1,filterable:"","popper-class":"dataset-tree"},{default:o(({node:c,data:N})=>[b("div",ro,[N.leaf?K("",!0):(v(),j(T,{key:0,size:"18px"},{default:o(()=>[i(p,{name:"dv-folder"},{default:o(()=>[i(a(On),{class:"svg-icon"})]),_:1})]),_:1})),N.leaf?(v(),j(T,{key:1,size:"18px"},{default:o(()=>[i(p,{name:"icon_dataset"},{default:o(()=>[i(a(qn),{class:"svg-icon"})]),_:1})]),_:1})):K("",!0),b("span",{class:"label-tree ellipsis",style:{"margin-left":"8px"},title:c.label},F(c.label),9,oo)])]),_:1},8,["modelValue","data","placeholder"])]),b("div",so,[b("span",co,F(a(t)("v_query.query_field")),1),i(a(De),{onChange:mt,placeholder:a(t)("v_query.query_field"),class:"search-field",modelValue:e.value.field.id,"onUpdate:modelValue":l[12]||(l[12]=c=>e.value.field.id=c)},Ma({default:o(()=>[(v(!0),$(oe,null,he(e.value.dataset.fields.filter(c=>c.deType===+e.value.displayType||[3,4].includes(c.deType)&&+e.value.displayType==2||c.deType===7&&+e.value.displayType==0),c=>(v(),j(Te,{key:c.id,label:c.name,value:c.id,disabled:c.desensitized},{default:o(()=>[b("div",{class:"flex-align-center icon",title:c.desensitized?a(t)("v_query.as_query_conditions"):""},[i(T,null,{default:o(()=>[i(p,{className:`field-icon-${a(be)[c.deType]}`},{default:o(()=>[(v(),j(Be(a(Xe)[a(be)[c.deType]]),{class:Fe(["svg-icon",`field-icon-${a(be)[c.deType]}`])},null,8,["class"]))]),_:2},1032,["className"])]),_:2},1024),b("span",null,F(c.name),1)],8,mo)]),_:2},1032,["label","value","disabled"]))),128))]),_:2},[e.value.field.id?{name:"prefix",fn:o(()=>[i(T,null,{default:o(()=>[i(p,null,{default:o(()=>[(v(),j(Be(a(Xe)[a(be)[_e(e.value.field.id,e.value.dataset.fields)]]),{class:Fe(["svg-icon",`field-icon-${a(be)[_e(e.value.field.id,e.value.dataset.fields)]}`])},null,8,["class"]))]),_:1})]),_:1})]),key:"0"}:void 0]),1032,["placeholder","modelValue"])]),b("div",vo,[b("span",po,F(a(t)("v_query.display_field")),1),i(a(De),{placeholder:a(t)("v_query.display_field"),class:"search-field",modelValue:e.value.displayId,"onUpdate:modelValue":l[13]||(l[13]=c=>e.value.displayId=c)},Ma({default:o(()=>[(v(!0),$(oe,null,he(e.value.dataset.fields.filter(c=>c.deType===+e.value.displayType||[3,4].includes(c.deType)&&+e.value.displayType==2||c.deType===7&&+e.value.displayType==0),c=>(v(),j(Te,{key:c.id,label:c.name,value:c.id,disabled:c.desensitized},{default:o(()=>[b("div",{class:"flex-align-center icon",title:c.desensitized?a(t)("v_query.as_query_conditions"):""},[i(T,null,{default:o(()=>[i(p,{className:`field-icon-${a(be)[c.deType]}`},{default:o(()=>[(v(),j(Be(a(Xe)[a(be)[c.deType]]),{class:Fe(["svg-icon",`field-icon-${a(be)[c.deType]}`])},null,8,["class"]))]),_:2},1032,["className"])]),_:2},1024),b("span",null,F(c.name),1)],8,fo)]),_:2},1032,["label","value","disabled"]))),128))]),_:2},[e.value.displayId?{name:"prefix",fn:o(()=>[i(T,null,{default:o(()=>[i(p,null,{default:o(()=>[(v(),j(Be(a(Xe)[a(be)[_e(e.value.displayId,e.value.dataset.fields)]]),{class:Fe(["svg-icon",`field-icon-${a(be)[_e(e.value.displayId,e.value.dataset.fields)]}`])},null,8,["class"]))]),_:1})]),_:1})]),key:"0"}:void 0]),1032,["placeholder","modelValue"])]),b("div",yo,[b("span",ho,F(a(t)("chart.total_sort_field")),1),i(a(De),{clearable:"",placeholder:a(t)("v_query.the_sorting_field"),modelValue:e.value.sortId,"onUpdate:modelValue":l[14]||(l[14]=c=>e.value.sortId=c),class:"sort-field",onChange:mt},Ma({default:o(()=>[(v(!0),$(oe,null,he(e.value.dataset.fields,c=>(v(),j(Te,{key:c.id,label:c.name,value:c.id,disabled:c.desensitized},{default:o(()=>[b("div",{class:"flex-align-center icon",title:c.desensitized?a(t)("v_query.as_query_conditions"):""},[i(T,null,{default:o(()=>[i(p,null,{default:o(()=>[(v(),j(Be(a(Xe)[a(be)[c.deType]]),{class:Fe([`field-icon-${a(be)[c.deType]}`,"svg-icon"])},null,8,["class"]))]),_:2},1024)]),_:2},1024),b("span",null,F(c.name),1)],8,_o)]),_:2},1032,["label","value","disabled"]))),128))]),_:2},[e.value.sortId?{name:"prefix",fn:o(()=>[i(T,null,{default:o(()=>[i(p,null,{default:o(()=>[(v(),j(Be(a(Xe)[a(be)[_e(e.value.sortId,e.value.dataset.fields)]]),{class:Fe(["svg-icon",`field-icon-${a(be)[_e(e.value.sortId,e.value.dataset.fields)]}`])},null,8,["class"]))]),_:1})]),_:1})]),key:"0"}:void 0]),1032,["placeholder","modelValue"]),i(a(De),{class:"sort-type",modelValue:e.value.sort,"onUpdate:modelValue":l[15]||(l[15]=c=>e.value.sort=c),onChange:mt},{default:o(()=>[i(Te,{label:a(t)("chart.asc"),value:"asc"},null,8,["label"]),i(Te,{label:a(t)("chart.desc"),value:"desc"},null,8,["label"])]),_:1},8,["modelValue"])])],64)):K("",!0),e.value.optionValueSource===2?(v(),$("div",go,[i(la,{placement:"bottom-start","popper-class":"manual-input",ref_key:"manual",ref:pe,width:358,trigger:"click"},{reference:o(()=>[i(Se,{text:""},{icon:o(()=>[i(p,{name:"icon_edit_outlined"},{default:o(()=>[i(a(Sa),{class:"svg-icon"})]),_:1})]),default:o(()=>[J(" "+F(a(t)("common.edit")),1)]),_:1})]),default:o(()=>[b("div",bo,[b("div",Vo,F(a(t)("auth.manual_input")),1),b("div",To,[b("span",null,F(a(t)("data_fill.form.option_value")),1),(v(!0),$(oe,null,he(d.value,(c,N)=>(v(),$("div",{key:N,class:"select-item"},[e.value.displayType==="2"?(v(),j(G,{key:0,maxlength:"20",onBlur:Rt,modelValue:d.value[N],"onUpdate:modelValue":ke=>d.value[N]=ke,modelModifiers:{number:!0}},null,8,["modelValue","onUpdate:modelValue"])):(v(),j(G,{key:1,maxlength:"20",onBlur:Rt,modelValue:d.value[N],"onUpdate:modelValue":ke=>d.value[N]=ke},null,8,["modelValue","onUpdate:modelValue"])),d.value.length!==1?(v(),j(Se,{key:2,onClick:ke=>d.value.splice(N,1),class:"value",text:""},{icon:o(()=>[i(p,{name:"icon_delete-trash_outlined"},{default:o(()=>[i(a(Mt),{class:"svg-icon"})]),_:1})]),_:2},1032,["onClick"])):K("",!0)]))),128))]),b("div",ko,[i(Se,{onClick:l[16]||(l[16]=c=>d.value.push("")),text:""},{icon:o(()=>[i(p,{name:"icon_add_outlined"},{default:o(()=>[i(a(Qa),{class:"svg-icon"})]),_:1})]),default:o(()=>[J(" "+F(a(t)("data_fill.form.add_option")),1)]),_:1})]),b("div",Co,[i(Se,{onClick:Et},{default:o(()=>[J(F(a(t)("chart.cancel")),1)]),_:1}),i(Se,{onClick:Jl,type:"primary"},{default:o(()=>[J(F(a(t)("chart.confirm")),1)]),_:1})])])]),_:1},512),e.value.valueSource.length?(v(),$("div",Mo,F(a(t)("v_query.configured")),1)):K("",!0)])):K("",!0)]),b("div",So,F(a(t)("v_query.of_option_values")),1),b("div",Fo,[i(ve,{class:"larger-radio",modelValue:e.value.resultMode,"onUpdate:modelValue":l[17]||(l[17]=c=>e.value.resultMode=c)},{default:o(()=>[i(R,{label:0},{default:o(()=>[J(F(a(t)("chart.default")),1)]),_:1}),i(R,{label:1},{default:o(()=>[J(F(a(t)("data_set.all")),1)]),_:1})]),_:1},8,["modelValue"])])])),e.value.displayType==="8"?(v(),$("div",wo,[b("div",Ao,F(a(t)("v_query.condition_type")),1),b("div",$o,[b("div",Do,[i(ve,{class:"larger-radio",modelValue:e.value.conditionType,"onUpdate:modelValue":l[18]||(l[18]=c=>e.value.conditionType=c)},{default:o(()=>[i(R,{label:0},{default:o(()=>[J(F(a(t)("v_query.single_condition")),1)]),_:1}),i(R,{label:1,disabled:!!e.value.parameters.length},{default:o(()=>[J(F(a(t)("v_query.with_condition")),1)]),_:1},8,["disabled"]),i(R,{label:2,disabled:!!e.value.parameters.length},{default:o(()=>[J(F(a(t)("v_query.or_condition")),1)]),_:1},8,["disabled"])]),_:1},8,["modelValue"])])])])):K("",!0),e.value.displayType==="8"?(v(),$("div",Oo,[i(Re,{modelValue:e.value.hideConditionSwitching,"onUpdate:modelValue":l[19]||(l[19]=c=>e.value.hideConditionSwitching=c),label:a(t)("v_query.hide_condition_switch")},null,8,["modelValue","label"])])):K("",!0),i(fr,{ref_key:"defaultConfigurationRef",ref:S,onHandleTimeTypeChange:rn,"cur-component":e.value},null,8,["cur-component"])],512),[[kt,Oe.value&&!Ye.value&&!We.value]]),Ye.value&&Oe.value?(v(),$("div",qo,[i(ht,{description:a(t)("v_query.cannot_be_performed"),"img-type":"error"},null,8,["description"])])):We.value&&Oe.value?(v(),$("div",No,[i(ht,{description:a(t)("v_query.cannot_be_displayed"),"img-type":"error"},null,8,["description"])])):Oe.value?K("",!0):(v(),$("div",Eo,[i(ht,{description:a(t)("v_query.be_linked_first"),"img-type":"noneWhite"},null,8,["description"])]))],2)):K("",!0)])]),_:1},8,["modelValue","title"]),i(qe,{title:ie.value,modelValue:ne.value,"onUpdate:modelValue":l[26]||(l[26]=c=>ne.value=c),width:"420px"},{footer:o(()=>[i(Se,{secondary:"",onClick:l[25]||(l[25]=c=>ne.value=!1)},{default:o(()=>[J(F(a(t)("chart.cancel")),1)]),_:1}),i(Se,{type:"primary",onClick:O},{default:o(()=>[J(F(a(t)("chart.confirm")),1)]),_:1})]),default:o(()=>[i(He,{"label-position":"top"},{default:o(()=>[i(Ze,{label:a(t)("v_query.time_type"),class:"form-item",prop:"name"},{default:o(()=>[i(ve,{modelValue:z.value,"onUpdate:modelValue":l[24]||(l[24]=c=>z.value=c)},{default:o(()=>[i(R,{label:0},{default:o(()=>[J(F(a(t)("data_set.time")),1)]),_:1}),i(R,{label:1},{default:o(()=>[J(F(a(t)("datasource.start_time")),1)]),_:1}),i(R,{label:2},{default:o(()=>[J(F(a(t)("datasource.end_time")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"])]),_:1})]),_:1},8,["title","modelValue"]),i(qe,{title:A.value,modelValue:ye.value,"onUpdate:modelValue":l[29]||(l[29]=c=>ye.value=c),width:"420px"},{footer:o(()=>[i(Se,{secondary:"",onClick:l[28]||(l[28]=c=>ye.value=!1)},{default:o(()=>[J(F(a(t)("dataset.cancel")),1)]),_:1}),i(Se,{type:"primary",onClick:ue},{default:o(()=>[J(F(a(t)("dataset.confirm")),1)]),_:1})]),default:o(()=>[i(He,{"label-position":"top"},{default:o(()=>[i(Ze,{label:a(t)("chart.map_line_type"),class:"form-item",prop:"name"},{default:o(()=>[i(ve,{modelValue:Ve.value,"onUpdate:modelValue":l[27]||(l[27]=c=>Ve.value=c)},{default:o(()=>[i(R,{label:0},{default:o(()=>[J(F(a(t)("chart.value_formatter_value")),1)]),_:1}),i(R,{label:1},{default:o(()=>[J(F(a(t)("chart.min")),1)]),_:1}),i(R,{label:2},{default:o(()=>[J(F(a(t)("chart.max")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"])]),_:1})]),_:1},8,["title","modelValue"]),i(a(Gl),{onSaveCascade:q,ref_key:"cascadeDialog",ref:qt},null,512)],64)}}});const Ro=Ra(),{componentData:rl,canvasViewInfo:Lo}=et(Ro),Yo=()=>{const r=()=>{let u=rl.value.filter(t=>!["VQuery","DeTabs"].includes(t.innerType)&&t.component!=="Group");return rl.value.forEach(t=>{t.innerType==="DeTabs"?t.propValue.forEach(s=>{u=[...u,...s.componentData.filter(g=>!["VQuery","DeTabs"].includes(g.innerType)&&g.component!=="Group")]}):t.component==="Group"&&(u=[...u,t.propValue.filter(s=>!["VQuery","DeTabs"].includes(s.innerType)&&s.component!=="Group")],t.propValue.forEach(s=>{s.innerType==="DeTabs"&&s.propValue.forEach(g=>{u=[...u,...g.componentData.filter(y=>!["VQuery","DeTabs"].includes(y.innerType)&&y.component!=="Group")]})}))}),u.flat()};return{datasetFieldList:H(()=>r().map(u=>{const t=Lo.value[u.id];if(!t)return null;const{id:s,title:g,tableId:y,type:C}=t;return s&&y?{id:s,type:C,title:g,tableId:y}:null}).filter(u=>!!u))}},Uo={class:"condition-type"},Bo={key:0,class:"condition-type"},Go=xe({__name:"TextSearch",props:{config:{type:Object,default:()=>({id:"",conditionType:0,conditionValueOperatorF:"eq",conditionValueF:"",conditionValueOperatorS:"like",conditionValueS:"",defaultConditionValueOperatorF:"eq",defaultConditionValueF:"",defaultConditionValueOperatorS:"like",defaultConditionValueS:""})},isConfig:{type:Boolean,default:!1}},setup(r){const h=Ee("placeholder"),{t:u}=oa(),t=H(()=>{var ee;return(ee=h==null?void 0:h.value)!=null&&ee.placeholderShow?C.config.placeholder:" "}),s=[{label:u("v_query.exact_match"),value:"eq"},{label:u("v_query.fuzzy_match"),value:"like"}],g=Ra(),{dvInfo:y}=et(g),C=r,{config:S}=ea(C),V=()=>{const{defaultConditionValueOperatorF:ee,defaultConditionValueF:W,defaultConditionValueOperatorS:Z,defaultConditionValueS:B}=S.value;S.value.conditionValueOperatorF=ee,S.value.conditionValueF=W,S.value.conditionValueOperatorS=Z,S.value.conditionValueS=B};ha(()=>{V()});const L=Ee("com-width",Function,!0),P=Ee("$custom-style-filter"),d=Ee("is-confirm-search",Function,!0),w=H(()=>({width:L()+"px"})),Y=()=>{if(!C.isConfig){we(()=>{d(S.value.id)});return}},k=H(()=>({width:L()-15+"px"}));return(ee,W)=>{const Z=Ia,B=De,re=Tt,m=cl("sapn");return v(),$("div",{class:"text-search-select",style:Ae({background:a(P).background})},[b("div",Uo,[a(S).hideConditionSwitching?K("",!0):(v(),j(B,{key:0,class:"condition-value-select",onChange:Y,effect:a(y).type==="dataV"?"dark":"","popper-class":"condition-value-select-popper",modelValue:a(S).conditionValueOperatorF,"onUpdate:modelValue":W[0]||(W[0]=q=>a(S).conditionValueOperatorF=q)},{default:o(()=>[(v(),$(oe,null,he(s,q=>i(Z,{key:q.value,label:q.label,value:q.value},null,8,["label","value"])),64))]),_:1},8,["effect","modelValue"])),i(re,{style:Ae(w.value),placeholder:t.value,onBlur:Y,class:"condition-value-input",modelValue:a(S).conditionValueF,"onUpdate:modelValue":W[1]||(W[1]=q=>a(S).conditionValueF=q)},null,8,["style","placeholder","modelValue"]),b("div",{style:Ae(k.value),class:"bottom-line"},null,4)]),[1,2].includes(a(S).conditionType)?(v(),$("div",Bo,[i(m,{class:"condition-type-tip"},{default:o(()=>[J(F(a(S).conditionType===1?a(u)("chart.and"):a(u)("chart.or")),1)]),_:1}),a(S).hideConditionSwitching?K("",!0):(v(),j(B,{key:0,class:"condition-value-select",onChange:Y,effect:a(y).type==="dataV"?"dark":"","popper-class":"condition-value-select-popper",modelValue:a(S).conditionValueOperatorS,"onUpdate:modelValue":W[2]||(W[2]=q=>a(S).conditionValueOperatorS=q)},{default:o(()=>[(v(),$(oe,null,he(s,q=>i(Z,{key:q.value,label:q.label,value:q.value},null,8,["label","value"])),64))]),_:1},8,["effect","modelValue"])),i(re,{style:Ae(w.value),onBlur:Y,placeholder:t.value,class:"condition-value-input",modelValue:a(S).conditionValueS,"onUpdate:modelValue":W[3]||(W[3]=q=>a(S).conditionValueS=q)},null,8,["style","placeholder","modelValue"]),b("div",{style:Ae(k.value),class:"bottom-line next-line"},null,4)])):K("",!0)],4)}}});const Po=Ya(Go,[["__scopeId","data-v-3fd988e4"]]),jo=xe({__name:"NumberInput",props:{config:{type:Object,default:()=>({id:"",defaultNumValueEnd:"",defaultNumValueStart:"",numValueEnd:"",numValueStart:"",defaultValueCheck:!1})},isConfig:{type:Boolean,default:!1}},setup(r){const h=Ee("placeholder"),u=H(()=>{var P;return(P=h==null?void 0:h.value)!=null&&P.placeholderShow?t.config.placeholder:" "}),t=r,{config:s}=ea(t),g=()=>{if(!s.value.defaultValueCheck){s.value.numValueEnd=void 0,s.value.numValueStart=void 0;return}const{defaultNumValueEnd:P,defaultNumValueStart:d}=s.value;s.value.numValueEnd=P,s.value.numValueStart=d};ha(()=>{g()});const y=Ee("com-width",Function,!0),C=Ee("$custom-style-filter"),S=Ee("is-confirm-search",Function,!0),V=H(()=>({width:y()+"px"})),L=()=>{if(!t.isConfig){we(()=>{S(s.value.id)});return}};return(P,d)=>{const w=wt;return v(),$("div",{class:"num-search-select",style:Ae({background:a(C).background})},[i(w,{placeholder:u.value,onChange:L,style:Ae(V.value),"controls-position":"right",modelValue:a(s).numValueStart,"onUpdate:modelValue":d[0]||(d[0]=Y=>a(s).numValueStart=Y)},null,8,["placeholder","style","modelValue"]),d[2]||(d[2]=b("div",{class:"num-value_line"},null,-1)),i(w,{placeholder:u.value,style:Ae(V.value),onChange:L,"controls-position":"right",modelValue:a(s).numValueEnd,"onUpdate:modelValue":d[1]||(d[1]=Y=>a(s).numValueEnd=Y)},null,8,["placeholder","style","modelValue"])],4)}}});const Ho=Ya(jo,[["__scopeId","data-v-27d4638b"]]),zo=xe({__name:"StyleInject",props:{config:{type:Object,default:()=>({selectValue:"",defaultValue:"",displayType:"",defaultValueCheck:!1,optionValueSource:0,multiple:!1,checkedFieldsMap:{}})},customStyle:{type:Object,default:()=>({border:"",background:"",text:""})}},setup(r){const h=r,u=t=>t==="8"?Po:t==="22"?Ho:["1","7"].includes(t)?Ll:t==="9"?Ul:Yl;return ua("$custom-style-filter",h.customStyle),(t,s)=>(v(),j(Be(u(r.config.displayType)),{config:r.config,"is-config":!1},null,8,["config"]))}}),Wo={key:0,class:"no-list-label flex-align-center"},Qo={class:"container flex-align-center"},Ko={class:"query-fields-container"},Zo={class:"label-wrapper"},Jo={key:0,class:"required"},Xo={key:0,class:"label-wrapper-tooltip"},es={class:"query-select"},as={key:0,class:"query-button"},ts=xe({__name:"Component",props:{view:{type:Object,default(){return{customStyle:""}}},element:{type:Object,default(){return{id:null,propValue:[]}}},showPosition:{type:String,required:!0,default:""},scale:{type:Number,required:!1,default:1}},setup(r){_n(A=>({"6a347c43":le.value}));const h=r,{element:u,view:t,scale:s}=ea(h),{t:g}=oa(),y=X(),C=Ra(),{curComponent:S,canvasViewInfo:V,mobileInPc:L,firstLoadMap:P}=et(C),d=X(!1),w=X(),k=ml({...{border:"",placeholderSize:14,placeholderShow:!0,background:"",text:"",layout:"horizontal",btnList:["sure"],titleLayout:"left",titleShow:!1,titleColor:"",textColorShow:!1,bgColorShow:!1,borderShow:!1,labelShow:!0,title:"",labelColor:"#1f2329",fontSize:"14",fontWeight:"",fontStyle:"",fontSizeBtn:"14",fontWeightBtn:"",fontStyleBtn:"",queryConditionWidth:227,nameboxSpacing:8,queryConditionSpacing:16,btnColor:"#3370ff",labelColorBtn:"#ffffff"}}),ee=vl(),W=H(()=>{const A={backgroundColor:k.btnColor,borderColor:k.btnColor,color:k.labelColorBtn};return k.fontSizeBtn&&(A.fontSize=k.fontSizeBtn+"px"),k.fontWeightBtn&&(A.fontWeight=k.fontWeightBtn),k.fontStyleBtn&&(A.fontStyle=k.fontStyleBtn),A}),Z=H(()=>{const A={backgroundColor:"transparent",borderColor:k.btnColor,color:k.btnColor};return k.fontSizeBtn&&(A.fontSize=k.fontSizeBtn+"px"),k.fontWeightBtn&&(A.fontWeight=k.fontWeightBtn),k.fontStyleBtn&&(A.fontStyle=k.fontStyleBtn),A}),B=H(()=>(V.value[u.value.id]||{}).customStyle),{datasetFieldList:re}=Yo(),m=A=>{const{borderShow:O,borderColor:ue,bgColorShow:de,btnList:D,titleLayout:Ie,labelColor:me,text:Ue,bgColor:sa,layout:da,titleShow:ca,titleColor:ma,title:ka,fontSize:ut,fontWeight:rt,fontStyle:Ua,fontSizeBtn:$a,fontWeightBtn:Ba,fontStyleBtn:_a,queryConditionWidth:ot,nameboxSpacing:st,queryConditionSpacing:dt,labelColorBtn:Ga,btnColor:Ca,placeholderSize:Va,placeholderShow:ct,labelShow:Ta}=A;k.background=de&&sa||"",k.border=O&&ue||"",k.btnList=[...D],k.layout=da,k.placeholderShow=ct??!0,k.placeholderSize=Va??14,we(()=>{y.value.style.setProperty("--ed-component-size",`${k.placeholderSize+18}px`)}),k.titleShow=ca,k.titleColor=ma,k.labelColor=Ta&&me||"",k.fontSize=Ta&&ut||"14",k.fontWeight=Ta&&rt||"",k.fontStyle=Ta&&Ua||"",k.title=ka,k.text=k.placeholderShow&&Ue||"",k.titleLayout=Ie,k.fontSizeBtn=$a||"14",k.fontWeightBtn=Ba,k.fontStyleBtn=_a,k.queryConditionWidth=ot??227,k.nameboxSpacing=st??8,k.queryConditionSpacing=dt??16,k.labelColorBtn=Ga||"#ffffff",k.labelShow=Ta??!0,k.btnColor=Ca||"#3370ff",ee.recordSnapshotCache()};ce(()=>t.value,A=>{var O,ue;(O=A==null?void 0:A.customStyle)!=null&&O.component&&m((ue=A==null?void 0:A.customStyle)==null?void 0:ue.component)},{deep:!0,immediate:!0}),ce(()=>B.value,A=>{A!=null&&A.component&&m(A==null?void 0:A.component)},{deep:!0,immediate:!0});const q=X([]);ce(()=>h.element.propValue,()=>{q.value=[...h.element.propValue]},{immediate:!0});const ae=()=>{S.value.id!==u.value.id&&(d.value=!1)},{emitter:e}=Da(),pe=xa([]);ha(()=>{pe.value=q.value.map(A=>A.id)});const E=A=>{pe.value=pe.value.filter(O=>O!==A)},f=A=>{let O="";const ue=(u.value.propValue||[]).filter(de=>de.id===A).reduce((de,D)=>{if(D.required)if(D.defaultValueCheck||(O=D.name),D.displayType==="8"){const{conditionValueF:me,conditionValueS:Ue,conditionType:sa}=D;sa===0?O=me===""?D.name:"":O=[me||"",Ue||""].filter(da=>da!=="").length<2?D.name:""}else D.displayType==="22"?(D.numValueStart!==0&&!D.numValueStart||D.numValueEnd!==0&&!D.numValueEnd)&&(O=D.name):(Array.isArray(D.selectValue)&&!D.selectValue.length||D.selectValue!==0&&!D.selectValue)&&(O=D.name);const Ie=Object.entries(D.checkedFieldsMap).filter(me=>D.checkedFields.includes(me[0])).filter(me=>!!me[1]).map(me=>me[0]);return de=[...new Set([...Ie,...de])],de},[]);if(O){Le.error(`${O}${g("v_query.before_querying")}`);return}ue.length&&ue.forEach(de=>{e.emit(`query-data-${de}`)})},U=()=>k.queryConditionWidth,Q=()=>h.element.cascade,$e=H(()=>({placeholderShow:k.placeholderShow}));ua("is-confirm-search",A=>{Ce.value||f(A)}),ua("unmount-select",pe),ua("release-unmount-select",E),ua("query-data-for-id",f),ua("com-width",U),ua("cascade-list",Q),ua("placeholder",$e),gn(()=>{e.off(`addQueryCriteria${u.value.id}`),e.off(`editQueryCriteria${u.value.id}`),e.off(`updateQueryCriteria${u.value.id}`),Vn.off("componentClick",ae)});const Oe=()=>{Array.isArray(u.value.propValue)&&u.value.propValue.forEach(A=>{if(A.auto){const O={datasetId:A.dataset.id,id:A.field.id},ue=[],de={};re.value.forEach(D=>{D.tableId===O.datasetId&&(ue.push(D.id),de[D.id]=O.id)}),A.checkedFields=ue,A.checkedFieldsMap=de}else{if(!A.dataset.id||A.parameters.length||A.optionValueSource!==1||![0,2,5].includes(+A.displayType))return;const O=re.value.map(ue=>ue.id);A.checkedFields.forEach(ue=>{O.includes(ue)||(A.checkedFieldsMap[ue]="")}),A.checkedFields=A.checkedFields.filter(ue=>O.includes(ue))}})};dl(()=>{e.on(`addQueryCriteria${u.value.id}`,Je),e.on(`editQueryCriteria${u.value.id}`,ia),e.on(`updateQueryCriteria${u.value.id}`,Oe),Oe()});const Ye=()=>{},We=A=>{JSON.parse(A.dataTransfer.getData("dimension")||"{}").forEach(ue=>{const de=[],D={};re.value.forEach(me=>{me.tableId===ue.datasetId&&(de.push(me.id),D[me.id]=ue.id)});const Ie=ue.deType===7?0:`${ue.deType}`;q.value.push({...Ml(ue),auto:!0,optionValueSource:1,checkedFields:de,checkedFieldsMap:D,displayType:Ie})}),u.value.propValue=[...q.value],ee.recordSnapshotCache()},aa=A=>{w.value.setCondition(A)},ia=()=>{if(!q.value.length){Je();return}aa(q.value[0].id)},Je=()=>{w.value.setConditionOut()},Ge=A=>{q.value.splice(A,1),u.value.propValue=[...q.value],ee.recordSnapshotCache()},te=()=>{(q.value||[]).reduce((A,O)=>{var de;O.conditionValueF=O.defaultConditionValueF,O.conditionValueOperatorF=O.defaultConditionValueOperatorF,O.conditionValueS=O.defaultConditionValueS,O.conditionValueOperatorS=O.defaultConditionValueOperatorS,O.displayType==="22"&&(O.numValueEnd=O.defaultNumValueEnd,O.numValueStart=O.defaultNumValueStart),O.defaultValueCheck||(O.defaultValue=O.multiple||+O.displayType==7?[]:void 0),O.selectValue=Array.isArray(O.defaultValue)?[...O.defaultValue]:O.defaultValue,O.optionValueSource===1&&((de=O.defaultMapValue)!=null&&de.length)&&(O.mapValue=Array.isArray(O.defaultMapValue)?[...O.defaultMapValue]:O.defaultMapValue),(h.element.cascade||[]).forEach(D=>{D.forEach(Ie=>{const me=Ie.datasetId.split("--")[1];O.id===me&&(Ie.currentSelectValue=Array.isArray(O.selectValue)?O.selectValue:[O.selectValue].filter(Ue=>![null,void 0].includes(Ue)),Da().emitter.emit(`${Ie.datasetId.split("--")[1]}-select`))})});const ue=Object.entries(O.checkedFieldsMap).filter(D=>O.checkedFields.includes(D[0])).filter(D=>!!D[1]).map(D=>D[0]);return A=[...new Set([...ue,...A])],A},[]),!Ce.value&&x()},_=()=>{(h.element.cascade||[]).forEach(A=>{A.forEach(O=>{var ue;(ue=O.currentSelectValue)!=null&&ue.length&&(Da().emitter.emit(`${O.datasetId.split("--")[1]}-select`),O.currentSelectValue=[])})}),(q.value||[]).reduce((A,O)=>{var de;if(!O.visible)return A;O.selectValue=O.multiple||+O.displayType==7?[]:void 0,O.optionValueSource===1&&((de=O.defaultMapValue)!=null&&de.length)&&(O.mapValue=O.multiple?[]:void 0),O.conditionValueF="",O.conditionValueS="",O.displayType==="22"&&(O.numValueEnd=void 0,O.numValueStart=void 0);const ue=Object.entries(O.checkedFieldsMap).filter(D=>O.checkedFields.includes(D[0])).filter(D=>!!D[1]).map(D=>D[0]);return A=[...new Set([...ue,...A])],A},[]),!Ce.value&&x()},fe=H(()=>q.value.filter(A=>A.visible)),Ce=H(()=>k.btnList.includes("sure"));ce(()=>Ce.value,(A,O)=>{!A&&O&&x()},{immediate:!1});const le=H(()=>`${k.placeholderSize}px`),x=()=>{let A="",O="";const ue=(u.value.propValue||[]).reduce((de,D)=>{if(D.required)if(D.defaultValueCheck||(A=D.name),D.displayType==="8"){const{conditionValueF:me,conditionValueS:Ue,conditionType:sa}=D;sa===0?A=me===""?D.name:"":A=[me||"",Ue||""].filter(da=>da!=="").length<2?D.name:""}else D.displayType==="22"?(D.numValueEnd!==0&&!D.numValueEnd||D.numValueStart!==0&&!D.numValueStart)&&(A=D.name):(Array.isArray(D.selectValue)&&!D.selectValue.length||D.selectValue!==0&&!D.selectValue)&&(A=D.name);D.displayType==="22"&&(!isNaN(D.numValueEnd)&&!isNaN(D.numValueStart)&&D.numValueEnd<D.numValueStart&&(O=D.name),[D.numValueEnd,D.numValueStart].filter(me=>![null,void 0,""].includes(me)).length===1&&(A=D.name));const Ie=Object.entries(D.checkedFieldsMap).filter(me=>D.checkedFields.includes(me[0])).filter(me=>!!me[1]).map(me=>me[0]);return de=[...new Set([...Ie,...de])],de},[]);if(A){Le.error(`${A}${g("v_query.before_querying")}`);return}if(O){Le.error(`${O}`);return}ue.length&&(C.setFirstLoadMap([...new Set([...ue,...P.value])]),ue.forEach(de=>{e.emit(`query-data-${de}`)}))},ne=H(()=>({textAlign:k.titleLayout||"left",color:k.titleColor||"#1f2329"})),z=H(()=>{const A={fontSize:k.fontSize+"px",lineHeight:+k.fontSize+8+"px"};return k.fontWeight&&(A.fontWeight=k.fontWeight),k.fontStyle&&(A.fontStyle=k.fontStyle),k.labelColor&&(A.color=k.labelColor),A}),ie=H(()=>({paddingTop:k.layout!=="horizontal"?k.nameboxSpacing+22+"px":"0"})),ye=H(()=>({marginRight:k.layout==="horizontal"?k.nameboxSpacing+"px":"8px"})),Ve=H(()=>({zoom:s.value}));return(A,O)=>{const ue=Xa,de=At,D=Oa,Ie=ol;return v(),$(oe,null,[b("div",{class:"v-query-container",ref_key:"vQueryRef",ref:y,style:Ae(Ve.value),onKeydown:O[0]||(O[0]=Ne(()=>{},["stop"])),onKeyup:O[1]||(O[1]=Ne(()=>{},["stop"]))},[k.titleShow?(v(),$("p",{key:0,class:"title",style:Ae(ne.value)},F(k.title),5)):K("",!0),b("div",{class:Fe(["v-query",k.layout,k.titleShow&&!!k.title&&"title-show"]),onDragover:Ne(Ye,["prevent","stop"]),onDrop:Ne(We,["prevent","stop"])},[fe.value.length?K("",!0):(v(),$("div",Wo,[b("div",Qo,[J(F(a(g)("v_query.here_or_click"))+" ",1),i(ue,{disabled:r.showPosition==="preview"||a(L),onClick:Je,text:""},{default:o(()=>[J(F(a(g)("v_query.add_query_condition")),1)]),_:1},8,["disabled"])])])),b("div",Ko,[(v(!0),$(oe,null,he(fe.value,(me,Ue)=>(v(),$("div",{class:"query-item",style:Ae({marginRight:`${k.queryConditionSpacing}px`}),key:me.id},[b("div",{class:"query-field",style:Ae(ie.value)},[b("div",{class:"label",style:Ae(ye.value)},[wa(b("div",Zo,[b("div",{class:"label-wrapper-text",style:Ae(z.value)},[i(de,{"popper-class":"label-wrapper-text_tooltip",effect:"dark",content:me.name,"show-arrow":!1,placement:"top-start"},{default:o(()=>[J(F(me.name),1)]),_:2},1032,["content"])],4),me.required?(v(),$("span",Jo,"*")):K("",!0)],512),[[kt,k.labelShow]]),r.showPosition!=="preview"&&!a(C).mobileInPc?(v(),$("div",Xo,[i(de,{effect:"dark",content:a(g)("v_query.set_filter_condition"),placement:"top"},{default:o(()=>[i(Ie,{onClick:sa=>aa(me.id)},{default:o(()=>[i(D,{name:"icon_edit_outlined"},{default:o(()=>[i(a(Sa),{class:"svg-icon"})]),_:1})]),_:2},1032,["onClick"])]),_:2},1032,["content"]),i(de,{effect:"dark",content:a(g)("v_query.delete_condition"),placement:"top"},{default:o(()=>[i(Ie,{style:{"margin-left":"8px"},onClick:sa=>Ge(Ue)},{default:o(()=>[i(D,{name:"icon_delete-trash_outlined"},{default:o(()=>[i(a(Mt),{class:"svg-icon"})]),_:1})]),_:2},1032,["onClick"])]),_:2},1032,["content"])])):K("",!0)],4),b("div",es,[k.queryConditionWidth!==0?(v(),j(zo,{key:0,customStyle:k,config:me},null,8,["customStyle","config"])):K("",!0)])],4)],4))),128)),fe.value.length?(v(),$("div",as,[k.btnList.includes("clear")?(v(),j(ue,{key:0,onClick:Ne(_,["stop"]),style:Ae(Z.value),plain:""},{default:o(()=>[J(F(a(g)("commons.clear")),1)]),_:1},8,["style"])):K("",!0),k.btnList.includes("reset")?(v(),j(ue,{key:1,onClick:Ne(te,["stop"]),style:Ae(Z.value),plain:""},{default:o(()=>[J(F(a(g)("chart.reset")),1)]),_:1},8,["style"])):K("",!0),Ce.value?(v(),j(ue,{key:2,onClick:Ne(x,["stop"]),style:Ae([{"margin-right":"7px"},W.value]),type:"primary"},{default:o(()=>[J(F(a(g)("commons.adv_search.search")),1)]),_:1},8,["style"])):K("",!0)])):K("",!0)])],34)],36),(v(),j(bn,{to:"body"},[i(Io,{"query-element":a(u),onQueryData:x,ref_key:"queryConfig",ref:w},null,8,["query-element"])]))],64)}}});const Hd=Ya(ts,[["__scopeId","data-v-555206d3"]]);export{Hd as default};
