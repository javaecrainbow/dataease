import{u as ce}from"./index-0.0.0-dataease.js";import{E as pe}from"./el-dialog-0.0.0-dataease.js";import{j as _e,w as x,y as fe,_ as ve,e as he,n as ge}from"./index-0.0.0-dataease2.js";import"./el-form-0.0.0-dataease.js";import{E as be}from"./el-tree-0.0.0-dataease.js";import"./el-checkbox-0.0.0-dataease.js";import"./el-tag-0.0.0-dataease.js";import"./el-select-0.0.0-dataease.js";import"./el-popper-0.0.0-dataease.js";import{E as ke}from"./el-tree-select-0.0.0-dataease.js";import{a as ye,E as De}from"./el-form-item-0.0.0-dataease.js";import{d as we,_ as j,r,w as Ve,m as E,ab as xe,f as v,g as T,i as s,k as n,a6 as H,a7 as k,j as c,U as Ee,a0 as C,N as h,M as K,ad as Te,ac as Ce,n as P}from"./vue-0.0.0-dataease.js";import{d as $}from"./dv-folder-0.0.0-dataease.js";import{i as Ne}from"./icon_search-outline_outlined-0.0.0-dataease.js";import{g as qe,H as Ie,I as Fe,J as Me}from"./dataset-0.0.0-dataease.js";import{n as Ue}from"./nothing-tree-0.0.0-dataease.js";import{_ as Be}from"./_plugin-vue_export-helper-0.0.0-dataease.js";import"./library-0.0.0-dataease.js";import"./lodash-0.0.0-dataease.js";import"./use-dialog-0.0.0-dataease.js";import"./refs-0.0.0-dataease.js";import"./axios-0.0.0-dataease.js";import"./echarts-0.0.0-dataease.js";import"./tinymce-0.0.0-dataease.js";import"./user-0.0.0-dataease.js";import"./index-0.0.0-dataease12.js";import"./index-0.0.0-dataease4.js";import"./index-0.0.0-dataease14.js";import"./strings-0.0.0-dataease.js";import"./index-0.0.0-dataease5.js";const Ae=["title"],Ge={key:2},Le={class:"tree-content"},Re={class:"custom-tree-node"},Se=["title"],je={key:0,class:"empty-search"},He=["src"],Ke=we({__name:"CreatDsGroup",emits:["finish"],setup(Pe,{expose:z,emit:J}){const{t:a}=_e(),u=j({tData:[],nameList:[]}),y=r(""),_=r(),m=r(),g=r(),i=r(""),N=r(),D=r("");let I=[],F=[];const o=j({pid:"",name:""}),M=r(!1),O=(t,e)=>(P(()=>{M.value=N.value.isEmpty}),t?e.name.includes(t):!0);Ve(D,t=>{Z.value=!t,N.value.filter(t),P(()=>{document.querySelectorAll(".node-text").forEach(e=>{const d=e.getAttribute("title");e.innerHTML=d.replace(t,`<span class="highLight">${t}</span>`)})})});const Q=E(()=>_.value==="folder"&&m.value?!1:!["rename","move"].includes(i.value)&&!!m.value),W=E(()=>_.value==="folder"?a("deDataset.folder_name"):a("dataset.name")),X=E(()=>{let t="";switch(_.value){case"folder":t=a("deDataset.new_folder");break;case"dataset":t=a("common.save")+a("auth.dataset");break}switch(i.value){case"move":t=a("chart.move_to");break;case"rename":t=a("chart.rename");break}return t}),Y=E(()=>i.value!=="move"),U=r(),B=r(!1),Z=r(!0),w=r(),q=r(!1),b=r(!1),ee=(t,e)=>e.name.includes(t),A=()=>{b.value=!1},G=t=>{t==null||t.forEach(e=>{var d;e.value=e.id,(d=e.children)!=null&&d.length&&G(e.children)})},te=(t,e)=>e!=null&&e.length?t==="0"&&e[0].id!=="0"?e[0].id:t:"",ae=(t,e,d,p)=>{m.value="",g.value="",i.value="",o.pid="",o.name="",D.value="",_.value=t,y.value=a(t==="folder"?"data_set.a_folder_name":"data_set.the_dataset_name"),t==="dataset"&&(I=e.union,F=e.allfields),e.id&&(qe({leaf:!1,weight:7}).then(f=>{G(f),u.tData=f||[],u.tData.length&&u.tData[0].name==="root"&&u.tData[0].id==="0"&&(u.tData[0].name=a("data_set.data_set")),e.id=te(e.id,u.tData),d?(m.value=e.pid,g.value=e.id,o.pid=e.pid,o.name=e.name):(o.pid=e.id,m.value=e.id)}),i.value=d),p&&(o.name=p),b.value=!0,U.value={name:[{required:!0,message:y.value,trigger:"change"},{required:!0,message:y.value,trigger:"blur"},{min:1,max:64,message:a("datasource.input_limit_1_64",[1,64]),trigger:"blur"}],pid:[{required:!0,message:a("common.please_select"),trigger:"blur"}]},setTimeout(()=>{w.value.clearValidate()},50)},oe=t=>{m.value=t.pid,g.value=t.id},L={label:"name",children:"children",isLeaf:t=>{var e;return!((e=t.children)!=null&&e.length)}},R=t=>{B.value=!1,o.pid=t.id},se=t=>t!==0&&!t?(x.error(a("data_set.the_destination_folder")),!1):!0,le=()=>{w.value.validate(t=>{if(t){const e={nodeType:_.value,name:o.name};switch(i.value){case"move":e.pid=B.value?"0":o.pid,e.id=g.value;break;case"rename":e.pid=m.value,e.id=g.value;break;default:e.pid=o.pid||m.value||"0";break}if(_.value==="dataset"&&(e.union=I,e.allFields=F),i.value==="move"&&!se(e.pid))return;q.value=!0,(i.value==="move"?Ie:e.id?Fe:Me)(e).then(p=>{switch(w.value.resetFields(),b.value=!1,ne("finish",p),i.value){case"move":x.success(a("data_set.moved_successfully"));break;case"rename":x.success(a("data_set.rename_successful"));break;default:ce().emitter.emit("onDatasetSave"),x.success(a("common.save_success"));break}}).finally(()=>{q.value=!1})}})};z({createInit:ae,editeInit:oe});const ne=J;return(t,e)=>{const d=fe,p=ye,V=ve,f=he,re=ke,ie=be,de=De,S=ge,ue=pe,me=xe("loading");return v(),T(ue,{title:X.value,modelValue:b.value,"onUpdate:modelValue":e[5]||(e[5]=l=>b.value=l),class:"create-dialog",width:i.value==="move"?"600px":"420px","before-close":A},{footer:s(()=>[n(S,{secondary:"",onClick:A},{default:s(()=>[H(k(c(a)("dataset.cancel")),1)]),_:1}),Ee((v(),T(S,{type:"primary",onClick:le},{default:s(()=>[H(k(c(a)("dataset.confirm")),1)]),_:1})),[[me,q.value]])]),default:s(()=>[n(de,{"label-position":"top","require-asterisk-position":"right",ref_key:"dataset",ref:w,onKeydown:e[4]||(e[4]=Te(Ce(()=>{},["stop","prevent"]),["enter"])),model:o,rules:U.value},{default:s(()=>[Y.value?(v(),T(p,{key:0,label:W.value,prop:"name"},{default:s(()=>[n(d,{placeholder:y.value,modelValue:o.name,"onUpdate:modelValue":e[0]||(e[0]=l=>o.name=l)},null,8,["placeholder","modelValue"])]),_:1},8,["label"])):C("",!0),Q.value?(v(),T(p,{key:1,label:c(a)("deDataset.folder"),prop:"pid"},{default:s(()=>[n(re,{modelValue:o.pid,"onUpdate:modelValue":e[1]||(e[1]=l=>o.pid=l),data:u.tData,"popper-class":"dataset-tree-select","render-after-expand":!1,style:{width:"100%"},props:L,onNodeClick:R,"filter-node-method":ee,filterable:""},{default:s(({data:{name:l}})=>[n(f,null,{default:s(()=>[n(V,{name:"dv-folder"},{default:s(()=>[n(c($),{class:"svg-icon"})]),_:1})]),_:1}),h("span",{title:l},k(l),9,Ae)]),_:1},8,["modelValue","data"])]),_:1},8,["label"])):C("",!0),i.value==="move"?(v(),K("div",Ge,[n(d,{style:{"margin-bottom":"12px"},modelValue:D.value,"onUpdate:modelValue":e[2]||(e[2]=l=>D.value=l),clearable:""},{prefix:s(()=>[n(f,null,{default:s(()=>[n(V,{name:"icon_search-outline_outlined"},{default:s(()=>[n(c(Ne),{class:"svg-icon"})]),_:1})]),_:1})]),_:1},8,["modelValue"]),h("div",Le,[n(ie,{ref_key:"treeRef",ref:N,"filter-node-method":O,filterable:"",modelValue:o.pid,"onUpdate:modelValue":e[3]||(e[3]=l=>o.pid=l),menu:"","empty-text":"",data:u.tData,props:L,onNodeClick:R},{default:s(({data:l})=>[h("span",Re,[n(f,{style:{"font-size":"18px"}},{default:s(()=>[n(V,{name:"dv-folder"},{default:s(()=>[n(c($),{class:"svg-icon"})]),_:1})]),_:1}),h("span",{class:"node-text",title:l.name},k(l.name),9,Se)])]),_:1},8,["modelValue","data"]),M.value?(v(),K("div",je,[h("img",{src:c(Ue)},null,8,He),h("span",null,k(c(a)("data_set.relevant_content_found")),1)])):C("",!0)])])):C("",!0)]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue","width"])}}});const yt=Be(Ke,[["__scopeId","data-v-b395e542"]]);export{yt as default};
