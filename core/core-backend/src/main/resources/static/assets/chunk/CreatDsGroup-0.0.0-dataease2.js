import{a as _e}from"./index-0.0.0-dataease.js";import{E as ve}from"./el-dialog-0.0.0-dataease.js";import{j as he,x as ge,w as B,y as ye,_ as be,e as we,n as ke}from"./index-0.0.0-dataease2.js";import"./el-form-0.0.0-dataease.js";import{E as De}from"./el-tree-0.0.0-dataease.js";import"./el-checkbox-0.0.0-dataease.js";import"./el-tag-0.0.0-dataease.js";import"./el-select-0.0.0-dataease.js";import"./el-popper-0.0.0-dataease.js";import{E as xe}from"./el-tree-select-0.0.0-dataease.js";import{a as Ve,E as Ee}from"./el-form-item-0.0.0-dataease.js";import{d as Ce,_ as z,r,w as Te,n as H,m as T,ab as Ne,U as Fe,f as k,g as M,i as s,k as l,a6 as O,a7 as D,j as f,ad as Ie,ac as qe,a0 as N,N as y,M as J}from"./vue-0.0.0-dataease.js";import{d as Q}from"./dv-folder-0.0.0-dataease.js";import{i as Be}from"./icon_search-outline_outlined-0.0.0-dataease.js";import{l as Me,a as Se,b as Ue,u as Pe}from"./datasource-0.0.0-dataease.js";import{n as Ae}from"./nothing-tree-0.0.0-dataease.js";import{_ as Ge}from"./_plugin-vue_export-helper-0.0.0-dataease.js";import"./library-0.0.0-dataease.js";import"./lodash-0.0.0-dataease.js";import"./use-dialog-0.0.0-dataease.js";import"./refs-0.0.0-dataease.js";import"./axios-0.0.0-dataease.js";import"./echarts-0.0.0-dataease.js";import"./tinymce-0.0.0-dataease.js";import"./user-0.0.0-dataease.js";import"./index-0.0.0-dataease12.js";import"./index-0.0.0-dataease4.js";import"./index-0.0.0-dataease14.js";import"./strings-0.0.0-dataease.js";import"./index-0.0.0-dataease5.js";const Re=["title"],Le={key:2},je={class:"tree-content"},Ke={class:"custom-tree-node"},$e=["title"],ze={key:0,class:"empty-search"},He=["src"],Oe=Ce({__name:"CreatDsGroup",emits:["finish","handleShowFinishPage"],setup(Je,{expose:W,emit:X}){const{t:o}=he(),{wsCache:F}=_e(),_=z({tData:[]}),b=r(),m=r(),w=r(),S=r(),u=r(""),I=r(),x=r(""),a=z({pid:"",name:""}),U=r(!1),Y=(t,e)=>(H(()=>{U.value=I.value.isEmpty}),t?e.name.includes(t):!0);Te(x,t=>{oe.value=!t,I.value.filter(t),H(()=>{document.querySelectorAll(".node-text").forEach(e=>{const i=e.getAttribute("title");e.innerHTML=i.replace(t,`<span class="highLight">${t}</span>`)})})});const Z=T(()=>b.value==="folder"&&m.value?!1:!["rename","move"].includes(u.value)&&!!m.value),ee=T(()=>b.value==="folder"?o("deDataset.folder_name"):o("data_source.data_source_name")),te=T(()=>{let t="";switch(b.value){case"folder":t=o("deDataset.new_folder");break;case"datasource":t=o("deDataset.create")+o("auth.datasource");break}switch(u.value){case"move":t=o("chart.move_to");break;case"rename":t=o("chart.rename");break}return t}),ae=T(()=>u.value!=="move"),V=r(""),P=r(),A=r(!1),oe=r(!0),E=r(),v=r(!1),g=r(!1),se=(t,e)=>{if(!e)return!1;e.name.includes(t)},G=()=>{g.value=!1},R=t=>{t.forEach(e=>{var i;e.value=e.id,(i=e.children)!=null&&i.length&&R(e.children)})};let p=null,L="";const le=(t,e,i,h)=>{m.value="",w.value="",u.value="",a.pid="",a.name="",b.value=t,x.value="",V.value=o(t==="folder"?"data_source.a_folder_name":"data_source.data_source_name_de"),L=e.type,t==="datasource"&&(p=e.request),e.id&&(i!=="rename"&&Me({leaf:!1,id:e.id,weight:7}).then(d=>{R(d),_.tData=d||[],_.tData.length&&_.tData[0].name==="root"&&_.tData[0].id==="0"&&(_.tData[0].name=o("data_source.data_source"))}),i?(m.value=e.pid,w.value=e.id,a.pid=e.pid,a.name=e.name,S.value=e.name):(a.pid=e.id,m.value=e.id)),u.value=e.id?i:"",h&&(a.name=h),g.value=!0,P.value={name:[{required:!0,message:V.value,trigger:"change"},{required:!0,message:V.value,trigger:"blur"},{min:1,max:64,message:o("datasource.input_limit_1_64",[1,64]),trigger:"blur"}],pid:[{required:!0,message:o("common.please_select"),trigger:"blur"}]},setTimeout(()=>{E.value.clearValidate()},50)},ne=t=>{m.value=t.pid,w.value=t.id},j={label:"name",children:"children",isLeaf:t=>{var e;return!((e=t.children)!=null&&e.length)}},K=t=>{A.value=!1,a.pid=t.id},C=()=>{F.set("ds-new-success",!0),E.value.resetFields(),p=null,a.pid="",a.name="",g.value=!1},re=()=>{v.value=!1},ie=t=>t!==0&&!t?(B.error(o("data_source.the_destination_folder")),!1):!0,ue=()=>{E.value.validate(t=>{if(t){const e={nodeType:b.value,name:a.name};switch(u.value){case"move":e.pid=A.value?"0":a.pid,e.id=w.value,e.action="move";break;case"rename":e.pid=m.value,e.id=w.value,e.action="rename";break;default:e.pid=a.pid||m.value||"0",e.action="create";break}if(u.value==="rename"&&S.value===e.name){C();return}if(u.value==="move"&&!ie(e.pid)||v.value)return;if(v.value=!0,p){let i={confirmButtonType:"danger",type:"warning",autofocus:!1,showClose:!1,tip:""};p.apiConfiguration="",Se(p).then(h=>{let d=p.id===""?Ue:Pe;h?ge.confirm(o("datasource.has_same_ds"),i).then(()=>{d({...p,name:a.name,pid:e.pid}).then(c=>{c!==void 0&&(F.set("ds-new-success",!0),q("handleShowFinishPage",{...c,pid:e.pid}),B.success(o("data_source.source_saved_successfully")),C())}).finally(()=>{v.value=!1})}).catch(()=>{v.value=!1,g.value=!1}):d({...p,name:a.name,pid:e.pid}).then(c=>{c!==void 0&&(F.set("ds-new-success",!0),q("handleShowFinishPage",{...c,pid:e.pid}),B.success(o("data_source.source_saved_successfully")),C())}).finally(()=>{v.value=!1})});return}q("finish",e,C,re,u.value,L)}})};W({createInit:le,editeInit:ne});const q=X;return(t,e)=>{const i=ye,h=Ve,d=be,c=we,de=xe,ce=De,me=Ee,$=ke,pe=ve,fe=Ne("loading");return Fe((k(),M(pe,{title:te.value,modelValue:g.value,"onUpdate:modelValue":e[5]||(e[5]=n=>g.value=n),width:u.value==="move"?"600px":"420px",class:"create-dialog","before-close":G},{footer:s(()=>[l($,{secondary:"",onClick:G},{default:s(()=>[O(D(f(o)("dataset.cancel")),1)]),_:1}),l($,{type:"primary",onClick:ue},{default:s(()=>[O(D(f(o)("dataset.confirm")),1)]),_:1})]),default:s(()=>[l(me,{"label-position":"top","require-asterisk-position":"right",ref_key:"datasource",ref:E,onKeydown:e[4]||(e[4]=Ie(qe(()=>{},["stop","prevent"]),["enter"])),model:a,rules:P.value},{default:s(()=>[ae.value?(k(),M(h,{key:0,label:ee.value,prop:"name"},{default:s(()=>[l(i,{placeholder:V.value,modelValue:a.name,"onUpdate:modelValue":e[0]||(e[0]=n=>a.name=n)},null,8,["placeholder","modelValue"])]),_:1},8,["label"])):N("",!0),Z.value?(k(),M(h,{key:1,label:f(o)("deDataset.folder"),prop:"pid"},{default:s(()=>[l(de,{modelValue:a.pid,"onUpdate:modelValue":e[1]||(e[1]=n=>a.pid=n),data:_.tData,"popper-class":"dataset-tree-select",style:{width:"100%"},"render-after-expand":!1,props:j,onNodeClick:K,"filter-method":se,filterable:""},{default:s(({data:{name:n}})=>[l(c,null,{default:s(()=>[l(d,{name:"dv-folder"},{default:s(()=>[l(f(Q),{class:"svg-icon"})]),_:1})]),_:1}),y("span",{title:n},D(n),9,Re)]),_:1},8,["modelValue","data"])]),_:1},8,["label"])):N("",!0),u.value==="move"?(k(),J("div",Le,[l(i,{style:{"margin-bottom":"12px"},modelValue:x.value,"onUpdate:modelValue":e[2]||(e[2]=n=>x.value=n),clearable:""},{prefix:s(()=>[l(c,null,{default:s(()=>[l(d,{name:"icon_search-outline_outlined"},{default:s(()=>[l(f(Be),{class:"svg-icon"})]),_:1})]),_:1})]),_:1},8,["modelValue"]),y("div",je,[l(ce,{ref_key:"treeRef",ref:I,"filter-node-method":Y,filterable:"",modelValue:a.pid,"onUpdate:modelValue":e[3]||(e[3]=n=>a.pid=n),menu:"","empty-text":"",data:_.tData,props:j,onNodeClick:K},{default:s(({data:n})=>[y("span",Ke,[l(c,{style:{"font-size":"18px"}},{default:s(()=>[l(d,{name:"dv-folder"},{default:s(()=>[l(f(Q),{class:"svg-icon"})]),_:1})]),_:1}),y("span",{class:"node-text",title:n.name},D(n.name),9,$e)])]),_:1},8,["modelValue","data"]),U.value?(k(),J("div",ze,[y("img",{src:f(Ae)},null,8,He),y("span",null,D(f(o)("data_source.relevant_content_found")),1)])):N("",!0)])])):N("",!0)]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue","width"])),[[fe,v.value]])}}});const Vt=Ge(Oe,[["__scopeId","data-v-d7a16439"]]);export{Vt as default};
