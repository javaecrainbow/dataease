import"./index-0.0.0-dataease.js";import{E as Y}from"./el-row-0.0.0-dataease.js";import"./el-popper-0.0.0-dataease.js";import{E as tt}from"./el-popover-0.0.0-dataease.js";import{j as et,_ as at,e as ot,y as st}from"./index-0.0.0-dataease2.js";import"./el-tooltip-0.0.0-dataease.js";import{d as nt,r as y,_ as E,o as it,a as lt,w as $,f as d,M as m,N as i,a7 as l,j as o,k as a,i as s,a6 as v,Z as B,aa as J,g as D,q as ct,V as dt,ac as w,a0 as rt,n as ut}from"./vue-0.0.0-dataease.js";import{i as b}from"./icon_info_outlined-0.0.0-dataease.js";import{i as j}from"./icon_search-outline_outlined-0.0.0-dataease.js";import{i as pt}from"./icon_adjustment_outlined-0.0.0-dataease.js";import{i as _t}from"./icon_edit_outlined-0.0.0-dataease.js";import{i as mt}from"./icon_delete-trash_outlined-0.0.0-dataease.js";import ft from"./CodeMirror-0.0.0-dataease.js";import{F as vt}from"./dataset-0.0.0-dataease.js";import{f as V}from"./attr-0.0.0-dataease20.js";import{i as gt}from"./field-list-0.0.0-dataease.js";import{d as N}from"./lodash-0.0.0-dataease.js";import{E as ht}from"./index-0.0.0-dataease4.js";import{_ as yt}from"./_plugin-vue_export-helper-0.0.0-dataease.js";import"./library-0.0.0-dataease.js";import"./row-0.0.0-dataease.js";import"./dropdown-0.0.0-dataease.js";import"./axios-0.0.0-dataease.js";import"./echarts-0.0.0-dataease.js";import"./tinymce-0.0.0-dataease.js";import"./user-0.0.0-dataease.js";const kt={class:"calcu-cont"},Ct={style:{flex:"1"}},xt={style:{"max-width":"488px"}},Dt={class:"mb8 field-exp"},wt={key:0},Nt={key:1},Tt={class:"padding-lr"},Ft={class:"mb8"},qt={class:"padding-lr-content"},St={class:"quota-btn_de"},Et={class:"field-height"},bt={key:0,class:"field-list"},Vt=["title","onClick"],Mt={key:2,class:"icon-right"},Lt={key:1,class:"class-na"},It={class:"padding-lr"},Ot={class:"mb8"},At={key:0},$t={key:1},Bt={class:"padding-lr-content"},Jt={key:0,style:{width:"100%"}},jt=["onClick"],zt={class:"pop-title"},Pt={class:"pop-info"},Qt={class:"pop-info"},Rt={key:1,class:"class-na"},Ut=nt({__name:"CustomAggrEdit",props:{crossDs:{type:Boolean,default:()=>!1}},setup(z,{expose:P}){const{t:c}=et(),M=y(),T=y(""),F=y(""),r=y(),L=z,I={originName:"",name:"",groupType:"d",type:"VARCHAR",deType:0,extField:2,id:"",params:[],checked:!0},u=E({functionData:[],quotaData:[]}),O=E({id:null,name:"",value:null}),Q=y(!1),f=E({...I}),R=()=>{const e=r.value.state.doc.toString(),t=[];f.originName=C("name","id",e,t)},C=(e,t,p,_)=>{let g=p;const k=u.quotaData.reduce((h,n)=>(h[n[e]]=n[t],h),{}),x=p.match(/\[(.+?)\]/g);return x&&x.forEach(h=>{const n=h.slice(1,-1);_&&_.push(k[n]),g=g.replace(`[${n}]`,`[${k[n]}]`)}),g};let q=[];const U=(e,t)=>{if(O.id=null,Object.assign(f,{...I,...e}),u.quotaData=t.concat(f.params||[]),q=N(t.concat(f.params||[])),!e.originName){r.value.dispatch({changes:{from:0,to:r.value.viewState.state.doc.length,insert:""}});return}ut(()=>{r.value.dispatch({changes:{from:0,to:r.value.viewState.state.doc.length,insert:C("id","name",e.originName)}})})},K=e=>{r.value.dispatch({changes:{from:r.value.viewState.state.selection.ranges[0].from,insert:e},selection:{anchor:r.value.viewState.state.selection.ranges[0].from}})};it(()=>{r.value=M.value.codeComInit()}),lt(()=>{var e,t;(t=(e=r.value).destroy)==null||t.call(e)});const H=e=>{r.value.dispatch({changes:{from:r.value.viewState.state.selection.ranges[0].from,insert:e},selection:{anchor:r.value.viewState.state.selection.ranges[0].from}})};let S=[];const Z=()=>{vt().then(e=>{S=N(e),u.functionData=N(e)})};$(()=>T.value,e=>{e&&e!==""?u.quotaData=JSON.parse(JSON.stringify(q.filter(t=>t.name.toLocaleLowerCase().includes(e.toLocaleLowerCase())&&t.extField===0))):u.quotaData=JSON.parse(JSON.stringify(q)).filter(t=>t.extField===0)}),$(()=>F.value,e=>{e&&e!==""?u.functionData=JSON.parse(JSON.stringify(S.filter(t=>t.func.toLocaleLowerCase().includes(e.toLocaleLowerCase())))):u.functionData=N(S)}),P({initEdit:U,setFieldForm:R,fieldForm:f});const G=y(""),W=()=>{const[e]=f.params;G.value="编辑计算参数",Object.assign(O,e||{}),Q.value=!0},X=()=>{const[e]=f.params;f.params=[];const t=r.value.state.doc.toString(),p=[];f.originName=C("name","id",t,p).replaceAll(`[${e.id}]`,""),u.quotaData=u.quotaData.filter(_=>_.id!==e.id),r.value.dispatch({changes:{from:0,to:r.value.viewState.state.doc.length,insert:C("id","name",f.originName)}})};return Z(),(e,t)=>{const p=at,_=ot,g=ht,k=st,x=tt,h=Y;return d(),m("div",{onKeydown:t[2]||(t[2]=w(()=>{},["stop"])),onKeyup:t[3]||(t[3]=w(()=>{},["stop"])),class:"calcu-field"},[i("div",kt,[i("div",Ct,[i("div",xt,[i("div",Dt,[i("span",null,l(o(c)("dataset.field_exp")),1),t[4]||(t[4]=i("span",null,"*",-1)),a(g,{class:"item",effect:"dark",placement:"top"},{content:s(()=>[L.crossDs?(d(),m("div",wt,l(o(c)("dataset.calc_tips.tip1")),1)):(d(),m("div",Nt,l(o(c)("dataset.calc_tips.tip1_1")),1)),i("div",null,l(o(c)("dataset.calc_tips.tip2")),1)]),default:s(()=>[a(_,{size:"16px"},{default:s(()=>[a(p,{name:"icon_info_outlined"},{default:s(()=>[a(o(b),{class:"svg-icon"})]),_:1})]),_:1})]),_:1})]),a(ft,{quotaMap:u.quotaData.map(n=>n.name),dimensionMap:[],ref_key:"myCm",ref:M,height:"500px","dom-id":"calcField"},null,8,["quotaMap"])])]),i("div",Tt,[i("span",Ft,[v(l(o(c)("dataset.click_ref_field"))+" ",1),a(g,{class:"item",effect:"dark",placement:"bottom"},{content:s(()=>[v(l(o(c)("dataset.calc_tips.tip3"))+" ",1),t[5]||(t[5]=i("br",null,null,-1)),v(" "+l(o(c)("dataset.calc_tips.tip4"))+" ",1),t[6]||(t[6]=i("br",null,null,-1)),v(" "+l(o(c)("dataset.calc_tips.tip5")),1)]),default:s(()=>[a(_,{size:"16px"},{default:s(()=>[a(p,{name:"icon_info_outlined"},{default:s(()=>[a(o(b),{class:"svg-icon"})]),_:1})]),_:1})]),_:1})]),i("div",qt,[a(k,{modelValue:T.value,"onUpdate:modelValue":t[0]||(t[0]=n=>T.value=n),placeholder:o(c)("dataset.edit_search"),clearable:""},{prefix:s(()=>[a(_,null,{default:s(()=>[a(p,{name:"icon_search-outline_outlined"},{default:s(()=>[a(o(j),{class:"svg-icon"})]),_:1})]),_:1})]),_:1},8,["modelValue","placeholder"]),i("div",St,[i("span",null,l(o(c)("chart.quota")),1)]),i("div",Et,[u.quotaData.length?(d(),m("div",bt,[(d(!0),m(B,null,J(u.quotaData,n=>(d(),m("span",{key:n.id,class:"item-quota flex-align-center ellipsis",title:n.name,onClick:A=>K("["+n.name+"]")},[n.groupType?(d(),D(_,{key:1},{default:s(()=>[a(p,{className:`field-icon-${o(V)[n.deType]}`},{default:s(()=>[(d(),D(ct(o(gt)[o(V)[n.deType]]),{class:dt(["svg-icon",`field-icon-${o(V)[n.deType]}`])},null,8,["class"]))]),_:2},1032,["className"])]),_:2},1024)):(d(),D(_,{key:0},{default:s(()=>[a(p,{name:"icon_adjustment_outlined"},{default:s(()=>[a(o(pt),{class:"svg-icon"})]),_:1})]),_:1})),v(" "+l(n.name)+" ",1),n.groupType?rt("",!0):(d(),m("div",Mt,[a(_,{onClick:w(W,["stop"]),class:"hover-icon"},{default:s(()=>[a(p,{name:"icon_edit_outlined"},{default:s(()=>[a(o(_t),{class:"svg-icon"})]),_:1})]),_:1}),a(_,{onClick:w(X,["stop"]),class:"hover-icon"},{default:s(()=>[a(p,{name:"icon_delete-trash_outlined"},{default:s(()=>[a(o(mt),{class:"svg-icon"})]),_:1})]),_:1})]))],8,Vt))),128))])):(d(),m("div",Lt,l(o(c)("dataset.na")),1))])])]),i("div",It,[i("span",Ot,[v(l(o(c)("dataset.click_ref_function"))+" ",1),a(g,{class:"item",effect:"dark",placement:"bottom"},{content:s(()=>[L.crossDs?(d(),m("div",At,[v(l(o(c)("dataset.calc_tips.tip6"))+" ",1),t[7]||(t[7]=i("br",null,null,-1)),v(" "+l(o(c)("dataset.calc_tips.tip8"))+" ",1),t[8]||(t[8]=i("br",null,null,-1)),t[9]||(t[9]=v(" https://calcite.apache.org/docs/reference.html "))])):(d(),m("div",$t,l(o(c)("dataset.calc_tips.tip7")),1))]),default:s(()=>[a(_,{size:"16px"},{default:s(()=>[a(p,{name:"icon_info_outlined"},{default:s(()=>[a(o(b),{class:"svg-icon"})]),_:1})]),_:1})]),_:1})]),i("div",Bt,[a(k,{modelValue:F.value,"onUpdate:modelValue":t[1]||(t[1]=n=>F.value=n),style:{"margin-bottom":"8px"},placeholder:o(c)("dataset.edit_search"),clearable:""},{prefix:s(()=>[a(_,null,{default:s(()=>[a(p,{name:"icon_search-outline_outlined"},{default:s(()=>[a(o(j),{class:"svg-icon"})]),_:1})]),_:1})]),_:1},8,["modelValue","placeholder"]),a(h,{class:"function-height"},{default:s(()=>[u.functionData.length?(d(),m("div",Jt,[(d(!0),m(B,null,J(u.functionData,(n,A)=>(d(),D(x,{key:A,class:"function-pop",placement:"right",width:"200",trigger:"hover","open-delay":500},{reference:s(()=>[i("span",{class:"function-style flex-align-center",onClick:Kt=>H(n.func)},l(n.func),9,jt)]),default:s(()=>[i("p",zt,l(n.name),1),i("p",Pt,l(n.func),1),i("p",Qt,l(n.desc),1)]),_:2},1024))),128))])):(d(),m("div",Rt,l(o(c)("chart.no_function")),1))]),_:1})])])])],32)}}});const ke=yt(Ut,[["__scopeId","data-v-286d8ea2"]]);export{ke as default};
