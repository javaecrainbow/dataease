import{u as we}from"./index-0.0.0-dataease.js";import"./el-footer-0.0.0-dataease.js";import{a as _e,c as he}from"./el-aside-0.0.0-dataease.js";import{v as ye,u as ge,_ as Se,w as ke,e as Ce,n as De}from"./index-0.0.0-dataease2.js";import{d as Pe,m as v,r,_ as Ae,ai as Ie,t as xe,o as Be,n as A,al as Ee,e as L,ab as Ne,f as n,M as W,N as $,g as i,W as I,j as o,a0 as c,k as f,i as d,V as x,U as j,Z as G,X as be,a6 as Me,a7 as z}from"./vue-0.0.0-dataease.js";import{i as Re}from"./icon_add_outlined-0.0.0-dataease.js";import Te from"./DeResourceTree-0.0.0-dataease.js";import{d as Ve}from"./dvMain-0.0.0-dataease.js";import{g as Oe}from"./DePreview-0.0.0-dataease.js";import{_ as qe}from"./PreviewHead.vue_vue_type_style_index_0_lang-0.0.0-dataease.js";import{E as H}from"./EmptyBackground-0.0.0-dataease.js";import U from"./DeResourceArrow-0.0.0-dataease.js";import{I as Fe,i as Le,o as We}from"./canvasUtils-0.0.0-dataease.js";import{useAppStoreWithOut as $e}from"./app-0.0.0-dataease.js";import{u as je}from"./useMoveLine-0.0.0-dataease.js";import{a as Ge,c as ze}from"./imgUtils-0.0.0-dataease.js";import{A as He}from"./AppExportForm-0.0.0-dataease.js";import{useUserStoreWithOut as Ue}from"./user-0.0.0-dataease.js";const Xe={class:"dv-preview dv-teleport-query"},ma=Pe({__name:"DashboardPreviewShow",props:{showPosition:{required:!1,type:String,default:"preview"},noClose:{required:!1,type:Boolean,default:!1}},setup(h,{expose:X}){const Z=Ue(),J=v(()=>Z.getName),B=r(null),w=Ve(),y=r(null),E=r(null),_=r(!0),K=ye(),Q=ge(),g=$e(),S=r(!0),p=r(!1),a=Ae({canvasDataPreview:null,canvasStylePreview:null,canvasViewInfoPreview:null,dvInfo:null,curPreviewGap:0}),{fullscreenFlag:Y,canvasViewDataInfo:N}=Ie(w),{width:k,node:ee}=je("DASHBOARD"),ae=h,{showPosition:l}=xe(ae),m=r(),b=v(()=>{var e;return(e=m.value)==null?void 0:e.hasData}),oe=v(()=>g.getIsDataEaseBi),te=v(()=>{var e;return(e=m.value)==null?void 0:e.rootManage}),M=v(()=>{var e;return(e=m.value)==null?void 0:e.mounted});Be(()=>{we({name:"canvasDownload",callback:function(){T("img")}})});function ne(){var e;(e=m.value)==null||e.createNewObject()}const R=(e,s)=>{const t=l.value==="multiplexing"?Fe:Le;S.value=!1,t(e,"dashboard",function({canvasDataResult:q,canvasStyleResult:F,dvInfo:C,canvasViewInfoPreview:D,curPreviewGap:P}){C.weight=s,a.canvasDataPreview=q,a.canvasStylePreview=F,a.canvasViewInfoPreview=D,a.dvInfo=C,a.curPreviewGap=P,S.value=!0,A(()=>{E.value.restore(),We({resourceId:e})})})},T=e=>{p.value=!0,A(()=>{const s=y.value.querySelector(".canvas-container");Ge(e,s,a.dvInfo.name,()=>{p.value=!1})})},se=e=>{e==="template"?V(e,null):e==="app"&&re()},re=()=>{const e=ie();e&&e.length>0?ke.warning(`当前仪表板中[${e}]属于模版图表，无法导出，请先设置数据集！`):B.value.init({appName:a.dvInfo.name,icon:null,version:"2.0",creator:J.value,required:"2.9.0",description:null})},ie=()=>{let e=",";return Object.keys(N.value).forEach(s=>{const t=N.value[s];t&&(t==null?void 0:t.dataFrom)==="template"&&(e=e+t.title+",")}),e.slice(1)},V=(e,s)=>{p.value=!0,A(()=>{const t=y.value.querySelector(".canvas-container");ze(e,t,a.dvInfo.name,s,()=>{p.value=!1})})},Ze=()=>{_.value=!_.value},le=()=>a,ce=e=>{R(e,a.dvInfo.weight)},ue=e=>{R(e.id,e.weight),l.value==="multiplexing"&&w.initCurMultiplexingComponents()},ve=v(()=>{var e;return!!((e=w.dvInfo)!=null&&e.name)});Ee(()=>{l.value==="preview"&&w.canvasDataInit()});const u=r(!0),O=e=>{u.value=e},de=()=>{g.setArrowSide(!0)},pe=()=>{g.setArrowSide(!1)},me=e=>{V("app",e)};return X({getPreviewStateInfo:le}),(e,s)=>{const t=_e,q=L("ArrowLeft"),F=Ce,C=L("ArrowRight"),D=De,P=he,fe=Ne("loading");return n(),W(G,null,[$("div",Xe,[h.noClose?c("",!0):(n(),i(U,{key:0,style:I({left:(u.value?o(k)-12:0)+"px"}),onChangeSideTreeStatus:O,isInside:!u.value},null,8,["style","isInside"])),f(t,{onMouseenter:de,onMouseleave:pe,class:x(["resource-area",{"close-side":!_.value,retract:!u.value}]),ref_key:"node",ref:ee,style:I({width:o(k)+"px"})},{default:d(()=>[h.noClose?c("",!0):(n(),i(U,{key:0,isInside:!u.value,style:I({left:(u.value?o(k)-12:0)+"px"}),onChangeSideTreeStatus:O},null,8,["isInside","style"])),j(f(Te,{ref_key:"resourceTreeRef",ref:m,"cur-canvas-type":"dashboard","show-position":o(l),onNodeClick:ue},null,8,["show-position"]),[[be,_.value]])]),_:1},8,["class","style"]),j((n(),i(P,{class:x(["preview-area",{"no-data":!b.value}])},{default:d(()=>[(o(l),c("",!0)),ve.value?(n(),W(G,{key:1},[o(l)==="preview"?(n(),i(qe,{key:0,onReload:ce,onDownload:T,onDownloadAsAppTemplate:se})):c("",!0),$("div",{ref_key:"previewCanvasContainer",ref:y,class:x(["content",{"de-screen-full":o(Y)}]),id:"de-preview-content"},[a.canvasStylePreview&&S.value?(n(),i(Oe,{key:0,ref_key:"dashboardPreview",ref:E,"dv-info":a.dvInfo,"cur-gap":a.curPreviewGap,"component-data":a.canvasDataPreview,"canvas-style-data":a.canvasStylePreview,"canvas-view-info":a.canvasViewInfoPreview,"show-position":o(l),"download-status":p.value},null,8,["dv-info","cur-gap","component-data","canvas-style-data","canvas-view-info","show-position","download-status"])):c("",!0)],2)],64)):b.value&&M.value?(n(),i(H,{key:2,description:"请在左侧选择仪表板","img-type":"select"})):M.value?(n(),i(H,{key:3,description:"暂无仪表板","img-type":"none"},{default:d(()=>[te.value&&!oe.value?(n(),i(D,{key:0,onClick:ne,type:"primary"},{icon:d(()=>[f(o(Se),{name:"icon_add_outlined"},{default:d(()=>[f(o(Re),{class:"svg-icon"})]),_:1})]),default:d(()=>[Me(" "+z(e.$t("commons.create"))+z(e.$t("chart.dashboard")),1)]),_:1})):c("",!0)]),_:1})):c("",!0)]),_:1},8,["class"])),[[fe,o(K).loadingMap[o(Q).currentPath]]])]),f(He,{ref_key:"appExportFormRef",ref:B,"dv-info":a.dvInfo,"component-data":a.canvasDataPreview,"canvas-view-info":a.canvasViewInfoPreview,onDownLoadApp:me},null,8,["dv-info","component-data","canvas-view-info"])],64)}}});export{ma as _};
