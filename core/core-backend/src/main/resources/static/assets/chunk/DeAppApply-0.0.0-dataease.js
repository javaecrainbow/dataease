import"./index-0.0.0-dataease.js";import{j as $,J as G,n as H,y as E,w as Q,_ as X,e as Y}from"./index-0.0.0-dataease2.js";import"./el-tag-0.0.0-dataease.js";import{E as ee,a as te}from"./el-select-0.0.0-dataease.js";import"./el-popper-0.0.0-dataease.js";import{E as ae}from"./el-row-0.0.0-dataease.js";import{E as oe}from"./el-col-0.0.0-dataease.js";import{d as re,r as se,ai as le,t as de,m as pe,_ as ne,f,g as b,i as o,j as d,N as p,k as a,a6 as h,ac as c,a7 as k,M as ie,aa as me,Z as ue}from"./vue-0.0.0-dataease.js";import{d as I}from"./dv-folder-0.0.0-dataease.js";import{d as fe}from"./dv-link-target-0.0.0-dataease.js";import{E as ce}from"./el-drawer-0.0.0-dataease.js";import"./el-form-0.0.0-dataease.js";import{a as _,E as _e}from"./el-form-item-0.0.0-dataease.js";import"./el-tree-0.0.0-dataease.js";import"./el-checkbox-0.0.0-dataease.js";import{E as A}from"./el-tree-select-0.0.0-dataease.js";import{e as ve}from"./dataVisualization-0.0.0-dataease.js";import{g as ye}from"./dataset-0.0.0-dataease.js";import ge from"./DatasetSelect-0.0.0-dataease.js";import{d as we}from"./dvMain-0.0.0-dataease.js";import{s as be}from"./snapshot-0.0.0-dataease.js";import{_ as he}from"./_plugin-vue_export-helper-0.0.0-dataease.js";import"./library-0.0.0-dataease.js";import"./lodash-0.0.0-dataease.js";import"./axios-0.0.0-dataease.js";import"./echarts-0.0.0-dataease.js";import"./tinymce-0.0.0-dataease.js";import"./user-0.0.0-dataease.js";import"./index-0.0.0-dataease4.js";import"./index-0.0.0-dataease14.js";import"./strings-0.0.0-dataease.js";import"./index-0.0.0-dataease5.js";import"./row-0.0.0-dataease.js";import"./use-dialog-0.0.0-dataease.js";import"./index-0.0.0-dataease12.js";import"./el-popover-0.0.0-dataease.js";import"./dropdown-0.0.0-dataease.js";import"./el-footer-0.0.0-dataease.js";import"./el-aside-0.0.0-dataease.js";import"./icon_dataset-0.0.0-dataease.js";import"./icon_done_outlined-0.0.0-dataease.js";import"./app-0.0.0-dataease.js";import"./treeSortUtils-0.0.0-dataease.js";import"./chart-0.0.0-dataease.js";import"./formatter-0.0.0-dataease.js";import"./dataVisualization-0.0.0-dataease2.js";import"./util-0.0.0-dataease.js";import"./util-0.0.0-dataease2.js";import"./chart-0.0.0-dataease2.js";import"./antv-0.0.0-dataease.js";import"./extends-0.0.0-dataease.js";import"./sysParameter-0.0.0-dataease.js";import"./TableTooltip-0.0.0-dataease.js";import"./_commonjs-dynamic-modules-0.0.0-dataease.js";import"./appearance-0.0.0-dataease.js";import"./font-0.0.0-dataease.js";import"./eventBus-0.0.0-dataease.js";const Te={class:"app-export"},Ve={class:"custom-tree-node"},De=["title"],Fe={class:"custom-tree-node"},xe=["title"],Ee={class:"apply",style:{width:"100%"}},ke=re({__name:"DeAppApply",props:{componentData:{type:Object,required:!0},canvasViewInfo:{type:Object,required:!0},curCanvasType:{type:String,required:!0},themes:{type:String,default:"dark"}},emits:["closeDraw","saveAppCanvas"],setup(S,{expose:C,emit:N}){const{t:n}=$(),T=N,V=se(null),q=we(),{dvInfo:m,appData:D}=le(q),F=be(),P=S,{componentData:Ie,canvasViewInfo:Ae,curCanvasType:v,themes:Se}=de(P),x=pe(()=>v.value==="dashboard"?n("work_branch.dashboard"):n("work_branch.big_data_screen")),U=()=>{const s="#/data/datasource?opt=create";window.open(s,"_blank")},t=ne({appApplyDrawer:!1,dvTree:[],dsTree:[],propsTree:{label:"name",children:"children",isLeaf:s=>{var e;return!((e=s.children)!=null&&e.length)}},appData:{datasourceInfo:[]},form:{pid:"",name:"新建",datasetFolderPid:null,datasetFolderName:null},rule:{name:[{required:!0,min:2,max:25,message:n("datasource.input_limit_2_25",[2,25]),trigger:"blur"}],pid:[{required:!0,message:"请选择所属文件夹",trigger:"blur"}],datasetFolderName:[{required:!0,min:2,max:25,message:n("datasource.input_limit_2_25",[2,25]),trigger:"blur"}],datasetFolderPid:[{required:!0,message:"请选择数据集分组所属文件夹",trigger:"blur"}]}}),M=()=>{const s={busiFlag:v.value,leaf:!1,weight:7};ve(s).then(l=>{const u=l||[];y(u),t.dvTree=u||[],t.dvTree.length&&t.dvTree[0].name==="root"&&t.dvTree[0].id==="0"&&(t.dvTree[0].name=v.value==="dataV"?n("work_branch.big_data_screen"):n("work_branch.dashboard"))}),ye({leaf:!1,weight:7}).then(l=>{y(l),t.dsTree=l||[],t.dsTree.length&&t.dsTree[0].name==="root"&&t.dsTree[0].id==="0"&&(t.dsTree[0].name="数据集")})},y=s=>{s.forEach(e=>{var l;e.value=e.id,(l=e.children)!=null&&l.length&&y(e.children)})},j=s=>{var e;t.appApplyDrawer=!0,t.form=s.base,t.appData.datasourceInfo=G((e=D.value)==null?void 0:e.datasourceInfo),M()},B=s=>{t.dvTree=[...t.dvTree].filter(e=>e.name.includes(s))},O=s=>{t.dsTree=[...t.dsTree].filter(e=>e.name.includes(s))},K=s=>{t.form.pid=s.id},R=s=>{t.form.datasetFolderPid=s.id},W=()=>{T("closeDraw"),F.recordSnapshotCache("renderChart"),t.appApplyDrawer=!1},z=()=>{var e;let s=!0;if(t.appData.datasourceInfo.forEach(l=>{l.systemDatasourceId||(s=!1)}),!s){Q.error("存在未配置的数据源");return}(e=V.value)==null||e.validate(l=>{if(l)D.value.datasourceInfo=t.appData.datasourceInfo,m.value.pid=t.form.pid,m.value.name=t.form.name,m.value.datasetFolderPid=t.form.datasetFolderPid,m.value.datasetFolderName=t.form.datasetFolderName,m.value.dataState="ready",F.recordSnapshotCache("renderChart"),T("saveAppCanvas");else return!1})};return C({init:j,close:W}),(s,e)=>{const l=X,u=Y,i=oe,g=ae,L=ee,J=te;return f(),b(d(ce),{title:"保存应用",modelValue:t.appApplyDrawer,"onUpdate:modelValue":e[8]||(e[8]=r=>t.appApplyDrawer=r),"custom-class":"de-app-drawer","show-close":!1,size:"500px",direction:"rtl","z-index":"1000"},{footer:o(()=>[p("div",Ee,[a(d(H),{type:"primary",onClick:z},{default:o(()=>e[13]||(e[13]=[h("保存")])),_:1})])]),default:o(()=>[p("div",Te,[a(d(_e),{ref_key:"appSaveForm",ref:V,model:t.form,rules:t.rule,class:"de-form-item app-form",size:"middle","label-width":"180px","label-position":"top"},{default:o(()=>[e[11]||(e[11]=p("div",{class:"de-row-rules",style:{margin:"0 0 16px"}},[p("span",null,"基本信息")],-1)),a(d(_),{label:x.value+"名称",prop:"name"},{default:o(()=>[a(d(E),{modelValue:t.form.name,"onUpdate:modelValue":e[0]||(e[0]=r=>t.form.name=r),autocomplete:"off",placeholder:"请输入名称"},null,8,["modelValue"])]),_:1},8,["label"]),a(d(_),{label:x.value+"所在位置",prop:"pid"},{default:o(()=>[a(d(A),{style:{width:"100%"},onKeydown:e[1]||(e[1]=c(()=>{},["stop"])),onKeyup:e[2]||(e[2]=c(()=>{},["stop"])),modelValue:t.form.pid,"onUpdate:modelValue":e[3]||(e[3]=r=>t.form.pid=r),data:t.dvTree,props:t.propsTree,onNodeClick:K,"filter-method":B,"render-after-expand":!1,filterable:""},{default:o(({data:{name:r}})=>[p("span",Ve,[a(u,null,{default:o(()=>[a(l,{name:"dv-folder"},{default:o(()=>[a(d(I),{class:"svg-icon"})]),_:1})]),_:1}),p("span",{title:r},k(r),9,De)])]),_:1},8,["modelValue","data","props"])]),_:1},8,["label"]),a(d(_),{label:"数据集分组名称",prop:"datasetFolderName"},{default:o(()=>[a(d(E),{modelValue:t.form.datasetFolderName,"onUpdate:modelValue":e[4]||(e[4]=r=>t.form.datasetFolderName=r),autocomplete:"off",placeholder:"请输入名称"},null,8,["modelValue"])]),_:1}),a(d(_),{label:"数据集分组位置",prop:"datasetFolderPid"},{default:o(()=>[a(d(A),{style:{width:"100%"},onKeydown:e[5]||(e[5]=c(()=>{},["stop"])),onKeyup:e[6]||(e[6]=c(()=>{},["stop"])),modelValue:t.form.datasetFolderPid,"onUpdate:modelValue":e[7]||(e[7]=r=>t.form.datasetFolderPid=r),data:t.dsTree,props:t.propsTree,onNodeClick:R,"filter-method":O,"render-after-expand":!1,filterable:""},{default:o(({data:{name:r}})=>[p("span",Fe,[a(u,null,{default:o(()=>[a(l,{name:"dv-folder"},{default:o(()=>[a(d(I),{class:"svg-icon"})]),_:1})]),_:1}),p("span",{title:r},k(r),9,xe)])]),_:1},8,["modelValue","data","props"])]),_:1}),e[12]||(e[12]=p("div",{class:"de-row-rules",style:{margin:"0 0 16px"}},[p("span",null,"数据源信息")],-1)),a(g,{class:"datasource-link"},{default:o(()=>[a(g,{class:"head"},{default:o(()=>[a(i,{span:11},{default:o(()=>e[9]||(e[9]=[h("应用数据源")])),_:1}),a(i,{span:2}),a(i,{span:11},{default:o(()=>e[10]||(e[10]=[h("系统数据源")])),_:1})]),_:1}),(f(!0),ie(ue,null,me(t.appData.datasourceInfo,(r,Z)=>(f(),b(g,{key:Z,class:"content"},{default:o(()=>[a(i,{span:11},{default:o(()=>[a(J,{style:{width:"100%"},modelValue:r.name,"onUpdate:modelValue":w=>r.name=w,disabled:""},{default:o(()=>[(f(),b(L,{key:r.name,label:r.name,value:r.name},null,8,["label","value"]))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024),a(i,{span:2,class:"icon-center"},{default:o(()=>[a(l,{name:"dv-link-target"},{default:o(()=>[a(d(fe),{class:"svg-icon",style:{width:"20px",height:"20px"}})]),_:1})]),_:1}),a(i,{span:11},{default:o(()=>[a(ge,{ref_for:!0,ref:"datasetSelector",modelValue:r.systemDatasourceId,"onUpdate:modelValue":w=>r.systemDatasourceId=w,style:{flex:"1"},"state-obj":t,themes:"light","source-type":"datasource",onAddDsWindow:U,"view-id":"0"},null,8,["modelValue","onUpdate:modelValue","state-obj"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1},8,["model","rules"])])]),_:1},8,["modelValue"])}}});const Pt=he(ke,[["__scopeId","data-v-7a8bd15f"]]);export{Pt as default};
