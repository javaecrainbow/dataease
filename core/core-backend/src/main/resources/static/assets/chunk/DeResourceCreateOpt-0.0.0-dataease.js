import"./index-0.0.0-dataease.js";import{E as $}from"./el-dialog-0.0.0-dataease.js";import{j,w as v,n as q,y as M}from"./index-0.0.0-dataease2.js";import{E as W}from"./el-row-0.0.0-dataease.js";import{E as A}from"./el-col-0.0.0-dataease.js";import{E as J}from"./el-radio-0.0.0-dataease.js";import{d as P,r as G,_ as H,m as T,w as K,ab as Q,f as d,g as c,i as a,U as X,k as o,a6 as p,a7 as f,j as _,N as Y,a0 as y,W as h,ac as Z}from"./vue-0.0.0-dataease.js";import{s as ee}from"./template-0.0.0-dataease.js";import{i as te}from"./imgUtils-0.0.0-dataease.js";import{h as ae}from"./dataVisualization-0.0.0-dataease.js";import oe from"./DeTemplatePreviewList-0.0.0-dataease.js";import{_ as le}from"./_plugin-vue_export-helper-0.0.0-dataease.js";import"./library-0.0.0-dataease.js";import"./lodash-0.0.0-dataease.js";import"./use-dialog-0.0.0-dataease.js";import"./refs-0.0.0-dataease.js";import"./axios-0.0.0-dataease.js";import"./echarts-0.0.0-dataease.js";import"./tinymce-0.0.0-dataease.js";import"./user-0.0.0-dataease.js";import"./row-0.0.0-dataease.js";import"./dvMain-0.0.0-dataease.js";import"./chart-0.0.0-dataease.js";import"./formatter-0.0.0-dataease.js";import"./dataVisualization-0.0.0-dataease2.js";import"./util-0.0.0-dataease.js";import"./util-0.0.0-dataease2.js";import"./chart-0.0.0-dataease2.js";import"./app-0.0.0-dataease.js";import"./antv-0.0.0-dataease.js";import"./extends-0.0.0-dataease.js";import"./sysParameter-0.0.0-dataease.js";import"./TableTooltip-0.0.0-dataease.js";import"./_commonjs-dynamic-modules-0.0.0-dataease.js";import"./appearance-0.0.0-dataease.js";import"./font-0.0.0-dataease.js";import"./el-tree-0.0.0-dataease.js";import"./index-0.0.0-dataease12.js";import"./el-checkbox-0.0.0-dataease.js";import"./dv-folder-0.0.0-dataease.js";import"./dv-dashboard-spine-0.0.0-dataease.js";import"./icon_operation-analysis_outlined-0.0.0-dataease.js";const ne=P({__name:"DeResourceCreateOpt",props:{curCanvasType:{type:String,required:!0}},emits:["finish"],setup(S,{expose:D,emit:b}){const{t:r}=j(),I=b,g=G(null),V=S,e=H({dialogShow:!1,loading:!1,inputType:"new_outer_template",fieldName:"name",tableRadio:null,keyWordSearch:"",columnLabel:r("visualization.belong_to_category"),templateList:[],importTemplateInfo:{snapshot:""},dvCreateInfo:{pid:-1,name:null,canvasStyleData:null,componentData:null,templateId:null,dynamicData:null,staticResource:null},templateSelected:!1}),k=T(()=>e.dvCreateInfo.name&&e.templateSelected),C=T(()=>e.importTemplateInfo.snapshot?{background:`url(${te(e.importTemplateInfo.snapshot)}) no-repeat`}:{});K(()=>e.inputType,()=>{w()});const w=()=>{e.templateSelected=!1,e.dvCreateInfo.name=null,e.dvCreateInfo.canvasStyleData=null,e.dvCreateInfo.componentData=null,e.importTemplateInfo.snapshot=null,e.dvCreateInfo.templateId=null},E=l=>{e.dvCreateInfo.templateId=l.id,l.nodeType==="folder"?(e.dvCreateInfo.name=null,e.importTemplateInfo.snapshot=null,e.templateSelected=!1):(e.dvCreateInfo.name=l.name,e.importTemplateInfo.snapshot=l.snapshot,e.templateSelected=!0)},x=()=>{const l={level:"0",leafDvType:V.curCanvasType,withChildren:!0};e.loading=!0,ee(l).then(t=>{e.templateList=t.data,e.loading=!1})},R=()=>{I("finish")},z=()=>{if(!e.dvCreateInfo.name)return v.warning(r("common.save_success")),!1;if(e.dvCreateInfo.name.length>50)return v.warning(r("common.char_can_not_more_50")),!1;if(!e.dvCreateInfo.templateId&&e.inputType==="new_inner_template")return v.warning("chart.template_can_not_empty"),!1;e.dvCreateInfo.newFrom=e.inputType,e.loading=!0,ae(e.dvCreateInfo).then(l=>{e.loading=!1,I("finish",l.data)}).catch(()=>{e.loading=!1})},N=l=>{const t=l.target.files[0],m=new FileReader;m.onload=s=>{e.templateSelected=!0;const u=s.target.result;e.importTemplateInfo=JSON.parse(u),e.dvCreateInfo.name=e.importTemplateInfo.name.name,e.dvCreateInfo.canvasStyleData=e.importTemplateInfo.canvasStyleData,e.dvCreateInfo.componentData=e.importTemplateInfo.componentData,e.dvCreateInfo.dynamicData=e.importTemplateInfo.dynamicData,e.dvCreateInfo.staticResource=e.importTemplateInfo.staticResource},m.readAsText(t)},L=()=>{g.value.click()},U=()=>{e.dialogShow=!1};return D({optInit:()=>{e.dialogShow=!0,w()}}),(l,t)=>{const m=J,s=A,u=q,i=W,B=M,F=$,O=Q("loading");return d(),c(F,{class:"create-dialog",title:"从模板新建",modelValue:e.dialogShow,"onUpdate:modelValue":t[5]||(t[5]=n=>e.dialogShow=n),width:"700","before-close":U,onSubmit:t[6]||(t[6]=Z(()=>{},["prevent"]))},{default:a(()=>[X((d(),c(i,{class:"create-main"},{default:a(()=>[o(i,null,{default:a(()=>[o(s,{span:18,style:{height:"40px"}},{default:a(()=>[o(m,{modelValue:e.inputType,"onUpdate:modelValue":t[0]||(t[0]=n=>e.inputType=n),label:"new_outer_template"},{default:a(()=>[p(f(_(r)("visualization.import_template")),1)]),_:1},8,["modelValue"]),o(m,{modelValue:e.inputType,"onUpdate:modelValue":t[1]||(t[1]=n=>e.inputType=n),label:"new_inner_template",onClick:x},{default:a(()=>[p(f(_(r)("visualization.copy_template")),1)]),_:1},8,["modelValue"])]),_:1}),e.inputType==="new_outer_template"?(d(),c(s,{key:0,span:6,class:"button-main"},{default:a(()=>[o(u,{class:"el-icon-upload",size:"small",type:"primary",onClick:L},{default:a(()=>[p(f(_(r)("visualization.upload_template")),1)]),_:1}),Y("input",{id:"input",ref_key:"files",ref:g,type:"file",accept:".DET2",hidden:"",onChange:N},null,544)]),_:1})):y("",!0)]),_:1}),o(i,{style:{"margin-top":"5px"}},{default:a(()=>[o(s,{span:4,class:"name-area"},{default:a(()=>t[7]||(t[7]=[p("名称")])),_:1}),o(s,{span:20},{default:a(()=>[o(B,{modelValue:e.dvCreateInfo.name,"onUpdate:modelValue":t[2]||(t[2]=n=>e.dvCreateInfo.name=n),clearable:"",size:"small"},null,8,["modelValue"])]),_:1})]),_:1}),e.inputType==="new_inner_template"?(d(),c(i,{key:0,class:"preview"},{default:a(()=>[o(s,{span:8,style:{height:"100%","overflow-y":"auto"}},{default:a(()=>[o(oe,{"template-list":e.templateList,onShowCurrentTemplateInfo:E},null,8,["template-list"])]),_:1}),o(s,{span:16,style:h(C.value),class:"preview-show"},null,8,["style"])]),_:1})):y("",!0),e.inputType==="new_outer_template"?(d(),c(i,{key:1,class:"preview",style:h(C.value)},null,8,["style"])):y("",!0),o(i,{class:"root-class"},{default:a(()=>[o(u,{size:"small",onClick:t[3]||(t[3]=n=>R())},{default:a(()=>[p(f(_(r)("commons.cancel")),1)]),_:1}),o(u,{type:"primary",size:"small",disabled:!k.value,onClick:t[4]||(t[4]=n=>z())},{default:a(()=>[p(f(_(r)("commons.confirm")),1)]),_:1},8,["disabled"])]),_:1})]),_:1})),[[O,e.loading]])]),_:1},8,["modelValue"])}}});const Ke=le(ne,[["__scopeId","data-v-3b88b67a"]]);export{Ke as default};
