import"./index-0.0.0-dataease.js";import{E as ye}from"./el-dialog-0.0.0-dataease.js";import{j as we,an as he,w as T,y as be,_ as ke,e as Ve,n as De}from"./index-0.0.0-dataease2.js";import"./el-form-0.0.0-dataease.js";import{E as Te}from"./el-tree-0.0.0-dataease.js";import"./el-checkbox-0.0.0-dataease.js";import"./el-tag-0.0.0-dataease.js";import"./el-select-0.0.0-dataease.js";import"./el-popper-0.0.0-dataease.js";import{E as Ee}from"./el-tree-select-0.0.0-dataease.js";import{a as Ce,E as Le}from"./el-form-item-0.0.0-dataease.js";import{d as Ne,t as Fe,_ as W,r,m as U,w as Re,ab as xe,f as _,g as E,i as n,ac as b,k as s,a6 as X,U as Ie,a0 as C,N as m,j as L,a7 as Y,M as Z,n as qe}from"./vue-0.0.0-dataease.js";import{d as ee}from"./dv-folder-0.0.0-dataease.js";import{i as Se}from"./icon_search-outline_outlined-0.0.0-dataease.js";import{n as Ue}from"./nothing-tree-0.0.0-dataease.js";import{e as Be,k as Ae,m as Me,n as Ke,o as Oe,j as je}from"./dataVisualization-0.0.0-dataease.js";import{_ as Ge}from"./_plugin-vue_export-helper-0.0.0-dataease.js";import"./library-0.0.0-dataease.js";import"./lodash-0.0.0-dataease.js";import"./use-dialog-0.0.0-dataease.js";import"./refs-0.0.0-dataease.js";import"./axios-0.0.0-dataease.js";import"./echarts-0.0.0-dataease.js";import"./tinymce-0.0.0-dataease.js";import"./user-0.0.0-dataease.js";import"./index-0.0.0-dataease12.js";import"./index-0.0.0-dataease4.js";import"./index-0.0.0-dataease14.js";import"./strings-0.0.0-dataease.js";import"./index-0.0.0-dataease5.js";const Pe={class:"custom-tree-node"},$e=["title"],ze={key:2},He={class:"tree-content"},Je={class:"custom-tree-node"},Qe=["title"],We={key:0,class:"empty-search"},Xe=["src"],Ye=Ne({__name:"DeResourceGroupOpt",props:{curCanvasType:{type:String,required:!0}},emits:["finish"],setup(te,{expose:ae,emit:oe}){const N=te,{curCanvasType:g}=Fe(N),{t:p}=we(),u=W({tData:[],nameList:[]}),B=r(!1),k=r(!1),A=r(),y=r(),w=r(),i=r(""),F=r(),c=r(""),R=r(""),a=W({pid:"",pName:null,name:"新建"}),M=U(()=>g.value==="dataV"?p("work_branch.big_data_screen"):p("work_branch.dashboard")),K={move:Ke,copy:Oe,newFolder:je},O=r(!1),le=(t,e)=>(qe(()=>{O.value=F.value.isEmpty}),t?e.name.includes(t):!0);Re(c,t=>{F.value.filter(t)});const ne=t=>!x||x.length===0?!1:x.some(e=>e===t),re=(t,e,o)=>{ne(e)?o(new Error("名称重复")):o()},se=U(()=>["newLeaf","copy","newLeafAfter"].includes(i.value)&&B.value),ie=U(()=>!["newLeafAfter","move"].includes(i.value));let x=[];const j=r(),I=r(),f=r(!1),q=r("");let G=[];const ue=t=>{u.tData=[...G].filter(e=>e.name.includes(t))},P=()=>{q.value=null,R.value="",a.name="新建",a.pid="",f.value=!1},$=t=>{t.forEach(e=>{var o;e.value=e.id,(o=e.children)!=null&&o.length&&$(e.children)})},de=t=>({newFolder:"新建文件夹",newLeaf:N.curCanvasType==="dataV"?"新建数据大屏":"新建仪表板",move:"移动到",copy:"复制"+M.value,rename:"重命名",newLeafAfter:"所属文件夹"})[t],V=r(""),me=(t,e,o,v=!1)=>{B.value=v,A.value=t;const d=e.leaf||t==="leaf"?M.value:"文件夹";V.value=e.leaf||t==="leaf"?N.curCanvasType==="dataV"?"请输入数据大屏名称":"请输入仪表板名称":"请输入文件夹名称",c.value="",q.value=de(o)+(o==="rename"?d:""),R.value=(o==="move"?"":d)+"名称";const h={busiFlag:g.value,leaf:!1,weight:7};["newFolder"].includes(o)?a.name="":o==="copy"?a.name=e.name+"_copy":a.name=e.name,Be(h).then(S=>{const D=S||[];$(D),u.tData=D||[],u.tData.length&&u.tData[0].name==="root"&&u.tData[0].id==="0"&&(u.tData[0].name=g.value==="dataV"?p("work_branch.big_data_screen"):p("work_branch.dashboard")),G=[...u.tData],o==="move"&&he(u.tData,e.id),["newLeaf","newFolder"].includes(o)?(a.pid=e.id,y.value=e.id):w.value=e.id}),i.value=o,f.value=!0,j.value={name:[{required:!0,message:V.value,trigger:"change"},{required:!0,message:V.value,trigger:"blur"},{min:1,max:64,message:p("commons.char_1_64"),trigger:"change"},{required:!0,trigger:"blur",validator:re}],pid:[{required:!0,message:p("common.please_select"),trigger:"blur"}]},setTimeout(()=>{I.value.clearValidate()},50)},pe=t=>{y.value=t.pid,w.value=t.id},z={label:"name",children:"children",isLeaf:t=>{var e;return!((e=t.children)!=null&&e.length)}},H=t=>{a.pid=t.id,a.pName=t.name},ce=t=>{if(t.pid!==0&&!t.pid)return T.error("请选择目标文件夹"),!1;if(c.value&&!a.pName.includes(c.value))return T.error("请选择目标文件夹"),!1;if(t.pid===t.id){T.warning("不能选择自身，请选择其他文件夹");return}return!0},fe=()=>{I.value.validate(async t=>{if(t){const e={nodeType:A.value,name:a.name,type:g.value};switch(i.value){case"move":e.pid=a.pid,e.id=w.value;break;case"copy":e.id=w.value,e.pid=a.pid||y.value||"0";break;case"rename":e.pid=y.value,e.id=w.value;break;default:e.pid=a.pid||y.value||"0";break}if(i.value==="move"&&!ce(e))return;["newLeaf","newLeafAfter","newFolder","rename","move","copy"].includes(i.value)&&await Ae({opt:i.value,...e}),i.value==="newLeaf"?(f.value=!1,J("finish",{opt:"newLeaf",...e})):(k.value=!0,(K[i.value]?K[i.value]:Me)(e).then(v=>{if(k.value=!1,f.value=!1,J("finish"),T.success("保存成功"),i.value==="copy"){const d=g.value==="dataV"?"#/dvCanvas?opt=copy&dvId=":"#/dashboard?opt=copy&resourceId=";window.open(d+v.data,"_blank")}}).finally(()=>{k.value=!1}))}})};ae({optInit:me,editeInit:pe});const J=oe;return(t,e)=>{const o=be,v=Ce,d=ke,h=Ve,S=Ee,D=Te,ve=Le,Q=De,_e=ye,ge=xe("loading");return _(),E(_e,{class:"create-dialog",title:q.value,modelValue:f.value,"onUpdate:modelValue":e[10]||(e[10]=l=>f.value=l),width:i.value==="move"?"600px":"420px","before-close":P,onSubmit:e[11]||(e[11]=b(()=>{},["prevent"]))},{footer:n(()=>[s(Q,{secondary:"",onClick:e[8]||(e[8]=l=>P())},{default:n(()=>e[13]||(e[13]=[X("取消 ")])),_:1}),s(Q,{type:"primary",onClick:e[9]||(e[9]=l=>fe())},{default:n(()=>e[14]||(e[14]=[X("确认 ")])),_:1})]),default:n(()=>[Ie((_(),E(ve,{"label-position":"top","require-asterisk-position":"right",ref_key:"resource",ref:I,model:a,rules:j.value},{default:n(()=>[ie.value?(_(),E(v,{key:0,label:R.value,prop:"name"},{default:n(()=>[s(o,{onKeydown:e[0]||(e[0]=b(()=>{},["stop"])),onKeyup:e[1]||(e[1]=b(()=>{},["stop"])),placeholder:V.value,modelValue:a.name,"onUpdate:modelValue":e[2]||(e[2]=l=>a.name=l)},null,8,["placeholder","modelValue"])]),_:1},8,["label"])):C("",!0),se.value?(_(),E(v,{key:1,label:"所属文件夹",prop:"pid"},{default:n(()=>[s(S,{style:{width:"100%"},onKeydown:e[3]||(e[3]=b(()=>{},["stop"])),onKeyup:e[4]||(e[4]=b(()=>{},["stop"])),modelValue:a.pid,"onUpdate:modelValue":e[5]||(e[5]=l=>a.pid=l),data:u.tData,props:z,onNodeClick:H,"filter-method":ue,"render-after-expand":!1,filterable:""},{default:n(({data:{name:l}})=>[m("span",Pe,[s(h,null,{default:n(()=>[s(d,{name:"dv-folder"},{default:n(()=>[s(L(ee),{class:"svg-icon"})]),_:1})]),_:1}),m("span",{title:l},Y(l),9,$e)])]),_:1},8,["modelValue","data"])]),_:1})):C("",!0),i.value==="move"?(_(),Z("div",ze,[s(o,{style:{"margin-bottom":"12px"},modelValue:c.value,"onUpdate:modelValue":e[6]||(e[6]=l=>c.value=l),clearable:""},{prefix:n(()=>[s(h,null,{default:n(()=>[s(d,{name:"icon_search-outline_outlined"},{default:n(()=>[s(L(Se),{class:"svg-icon"})]),_:1})]),_:1})]),_:1},8,["modelValue"]),m("div",He,[s(D,{ref_key:"treeRef",ref:F,"filter-node-method":le,filterable:"",modelValue:a.pid,"onUpdate:modelValue":e[7]||(e[7]=l=>a.pid=l),"empty-text":"",menu:"",data:u.tData,props:z,onNodeClick:H},{default:n(({data:l})=>[m("span",Je,[s(h,{style:{"font-size":"18px"}},{default:n(()=>[s(d,{name:"dv-folder"},{default:n(()=>[s(L(ee),{class:"svg-icon"})]),_:1})]),_:1}),m("span",{title:l.name},Y(l.name),9,Qe)])]),_:1},8,["modelValue","data"]),O.value?(_(),Z("div",We,[m("img",{src:L(Ue)},null,8,Xe),e[12]||(e[12]=m("span",null,"没有找到相关内容",-1))])):C("",!0)])])):C("",!0)]),_:1},8,["model","rules"])),[[ge,k.value]])]),_:1},8,["title","modelValue","width"])}}});const Nt=Ge(Ye,[["__scopeId","data-v-402f9c35"]]);export{Nt as default};
