import"./index-0.0.0-dataease.js";import"./el-form-0.0.0-dataease.js";import{j as z,w as m,x as A,y as M,n as $,e as j}from"./index-0.0.0-dataease2.js";import"./el-tag-0.0.0-dataease.js";import{E as L,a as J}from"./el-select-0.0.0-dataease.js";import"./el-popper-0.0.0-dataease.js";import{E as W}from"./el-row-0.0.0-dataease.js";import{a as X,E as Z}from"./el-form-item-0.0.0-dataease.js";import{d as G,r as H,_ as K,m as Q,e as Y,f as T,M as D,k as o,i as p,j as r,N as d,a6 as g,a7 as _,U as ee,W as te,X as ae,Z as oe,aa as ne,g as le}from"./vue-0.0.0-dataease.js";import{f as me,n as E,c as v,d as se}from"./template-0.0.0-dataease.js";import{i as pe}from"./imgUtils-0.0.0-dataease.js";import{_ as re}from"./_plugin-vue_export-helper-0.0.0-dataease.js";import"./library-0.0.0-dataease.js";import"./lodash-0.0.0-dataease.js";import"./axios-0.0.0-dataease.js";import"./echarts-0.0.0-dataease.js";import"./tinymce-0.0.0-dataease.js";import"./user-0.0.0-dataease.js";import"./index-0.0.0-dataease4.js";import"./index-0.0.0-dataease14.js";import"./strings-0.0.0-dataease.js";import"./index-0.0.0-dataease5.js";import"./row-0.0.0-dataease.js";import"./dvMain-0.0.0-dataease.js";import"./chart-0.0.0-dataease.js";import"./formatter-0.0.0-dataease.js";import"./dataVisualization-0.0.0-dataease2.js";import"./util-0.0.0-dataease.js";import"./util-0.0.0-dataease2.js";import"./chart-0.0.0-dataease2.js";import"./app-0.0.0-dataease.js";import"./antv-0.0.0-dataease.js";import"./extends-0.0.0-dataease.js";import"./sysParameter-0.0.0-dataease.js";import"./TableTooltip-0.0.0-dataease.js";import"./el-col-0.0.0-dataease.js";import"./_commonjs-dynamic-modules-0.0.0-dataease.js";import"./appearance-0.0.0-dataease.js";import"./font-0.0.0-dataease.js";const ie={class:"template-import"},ce={class:"flex-template"},fe={class:"custom-dropdown__empty"},de={class:"custom-option-line"},_e=35e6,ue=G({__name:"DeTemplateImport",props:{pid:{type:String,required:!0},templateCategories:{type:Array,required:!0},optType:{type:String,required:!0,default:"insert"},templateId:{type:String,required:!1}},emits:["closeEditTemplateDialog","refresh","addCategoryInfo"],setup(I,{emit:C}){const i=C,{t}=z(),x=H(null),c=I,e=K({categories:[],nameList:[],importTemplateInfo:{snapshot:""},templateInfoRules:{name:[{required:!0,message:t("commons.input_content"),trigger:"change"},{max:50,message:t("commons.char_can_not_more_50"),trigger:"change"}],categories:[{required:!0,message:t("commons.input_content"),trigger:"change"}]},recover:!1,templateInfo:{id:null,level:"1",pid:c.pid,categories:[],dvType:"dashboard",nodeType:"template",name:"",templateStyle:null,templateData:null,dynamicData:null,appData:null,staticResource:null,snapshot:"",version:null}}),w=Q(()=>e.templateInfo.snapshot?{background:`url(${pe(e.templateInfo.snapshot)}) no-repeat`}:{}),k=()=>{i("closeEditTemplateDialog")},b=()=>{if(!e.templateInfo.name)return m.warning(t("chart.name_can_not_empty")),!1;if(e.templateInfo.name.length>50)return m.warning(t("commons.char_can_not_more_50")),!1;if(!e.templateInfo.templateData)return m.warning(t("chart.template_can_not_empty")),!1;if(!e.templateInfo.categories.length)return m.warning(t("template_manage.please_select_catalog")),!1;c.optType==="insert"?S():R()},R=()=>{const n={pid:e.templateInfo.pid,id:e.templateInfo.id,name:e.templateInfo.name,categories:e.templateInfo.categories,optType:c.optType};E(n).then(a=>{a.data.indexOf("exist")>-1?m.warning(t("template_manage.exists_name_hint")):v(e.templateInfo).then(l=>{m.success(t("template_manage.edit_success")),i("refresh",y()),i("closeEditTemplateDialog")})})},y=()=>{const n=e.templateInfo.categories[0];let a="";return c.templateCategories.forEach(l=>{l.id===n&&(a=l.name)}),{optType:"refresh",refreshPid:n,refreshPName:a}},S=()=>{const n={pid:e.templateInfo.pid,name:e.templateInfo.name,categories:e.templateInfo.categories,optType:c.optType};se(n).then(a=>{a.data.indexOf("exist")>-1?A.confirm(t("template_manage.hint"),{tip:t("template_manage.cover_exists_hint"),confirmButtonType:"danger",type:"warning",autofocus:!1,showClose:!1}).then(()=>{v(e.templateInfo).then(()=>{m.success(t("template_manage.cover_success")),i("refresh",y()),i("closeEditTemplateDialog")})}):E(n).then(l=>{l.data.indexOf("exist")>-1?m.warning(t("template_manage.exists_name_hint")):v(e.templateInfo).then(f=>{m.success(t("template_manage.import_success")),i("refresh",y()),i("closeEditTemplateDialog")})})})},V=n=>{const a=n.target.files[0],l=new FileReader;if(a.size>_e){m.success(t("template_manage.template_size_hint"));return}l.onload=f=>{const u=f.target.result;e.importTemplateInfo=JSON.parse(u),e.templateInfo.name=e.importTemplateInfo.name,e.templateInfo.dvType=e.importTemplateInfo.dvType,e.templateInfo.templateStyle=e.importTemplateInfo.canvasStyleData,e.templateInfo.templateData=e.importTemplateInfo.componentData,e.templateInfo.snapshot=e.importTemplateInfo.snapshot,e.templateInfo.dynamicData=e.importTemplateInfo.dynamicData,e.templateInfo.appData=e.importTemplateInfo.appData,e.templateInfo.staticResource=e.importTemplateInfo.staticResource,e.templateInfo.nodeType=e.importTemplateInfo.nodeType||"template",e.templateInfo.version=e.importTemplateInfo.version},l.readAsText(a)},q=()=>{x.value.click()},B=()=>{i("refresh",{optType:"addCategory"})};return c.templateId&&me(c.templateId).then(n=>{e.templateInfo=n.data}),(n,a)=>{const l=M,f=$,u=X,h=W,F=L,N=Y("Plus"),P=j,O=J,U=Z;return T(),D("div",ie,[o(U,{ref:"templateImportForm",class:"de-form-item",model:e.templateInfo,rules:e.templateInfoRules,"label-position":"top"},{default:p(()=>[o(u,{label:r(t)("template_manage.template_name"),prop:"name"},{default:p(()=>[d("div",ce,[o(l,{modelValue:e.templateInfo.name,"onUpdate:modelValue":a[0]||(a[0]=s=>e.templateInfo.name=s),placeholder:r(t)("common.inputText")+r(t)("template_manage.template_name"),clearable:""},null,8,["modelValue","placeholder"]),o(f,{style:{"margin-left":"10px"},icon:"Upload",secondary:"",onClick:q},{default:p(()=>[g(_(r(t)("template_manage.import_template")),1)]),_:1}),d("input",{id:"input",ref_key:"filesRef",ref:x,type:"file",accept:".DET2,.DET2APP",hidden:"",onChange:V},null,544)])]),_:1},8,["label"]),ee(o(h,{class:"preview",style:te(w.value)},null,8,["style"]),[[ae,!!e.templateInfo.snapshot]]),o(u,{label:r(t)("template_manage.select_catalog"),prop:"categories",style:{"margin-top":"16px"}},{default:p(()=>[o(O,{modelValue:e.templateInfo.categories,"onUpdate:modelValue":a[1]||(a[1]=s=>e.templateInfo.categories=s),multiple:"",style:{width:"100%"},"popper-class":I.templateCategories.length?"custom-category-padding":"custom-category-empty custom-category-padding"},{default:p(()=>[(T(!0),D(oe,null,ne(I.templateCategories,s=>(T(),le(F,{key:s.id,label:s.name,value:s.id},null,8,["label","value"]))),128)),d("div",fe,[d("span",null,_(r(t)("template_manage.no_selectable_catalog")),1)]),d("div",de,[d("div",{onClick:B,class:"flex-align-center"},[o(P,null,{default:p(()=>[o(N)]),_:1}),g(" "+_(r(t)("template_manage.add_catalog")),1)])])]),_:1},8,["modelValue","popper-class"])]),_:1},8,["label"])]),_:1},8,["model","rules"]),o(h),o(h,{class:"de-root-class"},{default:p(()=>[o(f,{secondary:"",onClick:a[2]||(a[2]=s=>k())},{default:p(()=>[g(_(r(t)("commons.cancel")),1)]),_:1}),o(f,{type:"primary",onClick:a[3]||(a[3]=s=>b())},{default:p(()=>[g(_(r(t)("commons.confirm")),1)]),_:1})]),_:1})])}}});const tt=re(ue,[["__scopeId","data-v-2d8588b5"]]);export{tt as default};
