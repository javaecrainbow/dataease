import"./index-0.0.0-dataease.js";import{E as Fe}from"./el-dialog-0.0.0-dataease.js";import{j as $e,y as ze,_ as Ue,e as Me,n as Se}from"./index-0.0.0-dataease2.js";import"./el-popper-0.0.0-dataease.js";import{E as Ne}from"./el-popover-0.0.0-dataease.js";import"./el-tooltip-0.0.0-dataease.js";import{E as Pe}from"./el-input-number-0.0.0-dataease.js";import"./el-tag-0.0.0-dataease.js";import{E as Le,a as Oe}from"./el-select-0.0.0-dataease.js";import{b as Be,E as je}from"./el-dropdown-menu-0.0.0-dataease.js";import{d as Ae,r as v,t as Re,R as le,m as T,w as te,al as Ye,f as i,M as m,N as o,a7 as f,j as t,k as s,i as u,ac as Ke,Z as _,aa as k,W as ae,g as y,V as We,q as qe,a0 as $,a6 as z,U as Ge,aj as Ze,Y as He,n as Je}from"./vue-0.0.0-dataease.js";import{i as Qe}from"./icon_search-outline_outlined-0.0.0-dataease.js";import{i as B}from"./icon_delete-trash_outlined-0.0.0-dataease.js";import Xe from"./TimeDialog-0.0.0-dataease.js";import{E as el}from"./dataset-0.0.0-dataease.js";import{s as ll,t as tl,a as al,d as nl,v as ol,f as j}from"./options-0.0.0-dataease.js";import{i as sl}from"./field-list-0.0.0-dataease.js";import{E as il}from"./index-0.0.0-dataease4.js";import{_ as ul}from"./_plugin-vue_export-helper-0.0.0-dataease.js";import"./library-0.0.0-dataease.js";import"./lodash-0.0.0-dataease.js";import"./use-dialog-0.0.0-dataease.js";import"./refs-0.0.0-dataease.js";import"./axios-0.0.0-dataease.js";import"./echarts-0.0.0-dataease.js";import"./tinymce-0.0.0-dataease.js";import"./user-0.0.0-dataease.js";import"./dropdown-0.0.0-dataease.js";import"./index-0.0.0-dataease15.js";import"./index-0.0.0-dataease14.js";import"./strings-0.0.0-dataease.js";import"./index-0.0.0-dataease5.js";import"./el-form-0.0.0-dataease.js";import"./el-time-picker-0.0.0-dataease.js";import"./dayjs.min-0.0.0-dataease.js";import"./el-date-picker-0.0.0-dataease.js";import"./arrays-0.0.0-dataease.js";import"./el-form-item-0.0.0-dataease.js";import"./time-format-0.0.0-dataease.js";const rl={class:"white-nowrap"},dl={class:"filed-title"},ml={class:"dimension"},cl=["onClick"],pl={key:0,class:"white-nowrap flex-align-center",style:{position:"relative"}},vl={class:"filed-title"},fl={class:"filed-title"},_l={class:"de-panel clearfix"},yl={class:"mod-left"},Vl={class:"infinite-list autochecker-list",style:{height:"231px",overflow:"auto"}},kl=["onClick"],hl={class:"mod-left right-de"},gl={class:"right-top clearfix"},Tl={class:"right-btn"},bl={key:0,class:"de-el-dropdown-menu-manu"},wl={class:"text-area"},Cl=["placeholder"],xl={class:"text-area-btn"},El={class:"infinite-list autochecker-list",style:{overflow:"auto"}},Il={class:"right-menu-foot"},Dl={class:"footer-right"},Fl={class:"dialog-footer"},$l=Ae({__name:"FilterFiled",props:{index:{default:0},item:{default:()=>({term:"",fieldId:"",filterType:"",deType:0,enumValue:"",name:"",filterTypeTime:"dateValue",value:null,dynamicTimeSetting:null,timeValue:""})}},emits:["update:item","del"],setup(ne,{emit:oe}){const se=ne,{t:r}=$e(),A=v(),ie=v(),U=v(!1),w=v(""),C=v(""),x=v(""),M=v([]),b=v(),R=v(!1),c=v([]),E=v([]),S=v(""),{item:a}=Re(se),N=le("getAuthTargetType"),ue=le("filedList"),Y=T(()=>x.value?M.value.filter(n=>n.includes(x.value)):M.value),K=T(()=>c.value.join(",")),re=T(()=>["in","not in"].includes(a.value.term)?[{value:"${sysParams.roles}",label:r("auth.sysParams_type.role")}]:ll),de=T(()=>{const{deType:n}=a.value;return h.value==="sysParams"?tl:[0,5,7].includes(n)?al:n===1?nl:ol}),me=T(()=>w.value?W.value.filter(n=>n.name.includes(w.value)):W.value),W=T(()=>Object.values(ue.value||{}));te(K,()=>{Z()});const h=v("");te(()=>N==null?void 0:N.authTargetType,n=>{h.value===n||!n||(h.value=n)},{immediate:!0}),Ye(()=>{pe(),J(a.value.deType)});const ce=()=>{A.value.$el.click()},pe=()=>{const{name:n,enumValue:e,fieldId:d}=a.value,p=e.trim()?e.split(","):[];!n&&d&&(c.value=p),!(!n&&!d)&&(q(),C.value=a.value.name,c.value=p)},ve=()=>{!b.value&&!R.value&&(R.value=!0),b.value=!0},fe=()=>{a.value.term="",a.value.value=null,q()},_e=()=>{a.value.term="",a.value.timeValue=null},q=()=>{if(h.value==="sysParams")return;const{deType:n,filterType:e,fieldId:d}=a.value;e==="enum"&&[0,5,7].includes(n)&&el({fieldIds:[d]}).then(p=>{M.value=ke(p.data)})},g=v(!1),P=v(),G=()=>{g.value=!0,Je(()=>{P.value.init(a.value.dynamicTimeSetting||{})})},ye={year:"年",month:"月",date:"日",datetime:"日"},Ve=()=>{a.value.dynamicTimeSetting={...P.value.curComponent};const{timeGranularity:n,timeNum:e,relativeToCurrentType:d,around:p,arbitraryTime:V,relativeToCurrent:I}=a.value.dynamicTimeSetting;if(I!=="custom"){a.value.timeValue=[{label:"今年",value:"thisYear"},{label:"去年",value:"lastYear"},{label:"本月",value:"thisMonth"},{label:"上月",value:"lastMonth"},{label:"今天",value:"today"},{label:"昨天",value:"yesterday"},{label:"月初",value:"monthBeginning"},{label:"年初",value:"yearBeginning"}].find(L=>L.value===I).label,g.value=!1;return}a.value.timeValue=`${e}${ye[d]}${p==="f"?"前":"后"}`,n==="datetime"&&(a.value.timeValue+=new Date(V).toLocaleString().split(" ")[1]),g.value=!1},ke=n=>n?n.filter(e=>!!e):null,he=()=>{a.value.name=C.value||""},Z=()=>{a.value.enumValue=K.value||""},H=n=>{c.value.splice(n,1)},ge=({name:n,id:e,deType:d})=>{C.value=n,Object.assign(a.value,{fieldId:e,name:n,deType:d,filterType:"logic",enumValue:"",value:"",term:"",filterTypeTime:"dateValue",timeValue:"",dynamicTimeSetting:{}}),J(d),c.value=[]},J=n=>{E.value=[{value:"logic",label:r("deDataset.logic_filter")},{value:"enum",label:r("deDataset.enum_filter")}],(h.value==="sysParams"||[1,2,3].includes(n))&&(E.value=[E.value[0]])},Te=[{value:"dateValue",label:"固定值"},{value:"dynamicDate",label:"动态值"}],Q=()=>{c.value=[]},be=()=>{Y.value.forEach(n=>{c.value.includes(n)||c.value.push(n)})},we=()=>{const n=S.value.split(`
`).reduce((e,d)=>{const p=d.trim();return p&&e.add(p),e},new Set([]));n.size&&(c.value=[...new Set([...c.value,...Array.from(n)])]),b.value=!1},Ce=n=>{const e=c.value.findIndex(d=>d===n);e===-1?c.value.push(n):H(e)},xe=oe;return(n,e)=>{const d=ze,p=Ue,V=Me,I=Be,L=je,D=Le,F=Oe,Ee=Pe,X=il,Ie=Ne,ee=Se,De=Fe;return i(),m("div",rl,[o("div",{class:"filed",onMouseover:e[16]||(e[16]=l=>U.value=!0),onMouseleave:e[17]||(e[17]=l=>U.value=!1)},[o("span",dl,f(t(r)("auth.filter_fields")),1),s(L,{trigger:"click","hide-on-click":!1},{dropdown:u(()=>[s(I,{class:"de-el-dropdown-menu"},{default:u(()=>[s(d,{onKeydown:e[1]||(e[1]=Ke(()=>{},["stop"])),placeholder:t(r)("auth.enter_keywords"),size:"small",modelValue:w.value,"onUpdate:modelValue":e[2]||(e[2]=l=>w.value=l)},{prefix:u(()=>[s(V,null,{default:u(()=>[s(p,{name:"icon_search-outline_outlined"},{default:u(()=>[s(t(Qe),{class:"svg-icon"})]),_:1})]),_:1})]),_:1},8,["placeholder","modelValue"]),o("ul",ml,[(i(!0),m(_,null,k(me.value,l=>(i(),m("li",{onClick:O=>ge(l),style:ae({backgroundColor:C.value===l.name?"#f0f7ff":""}),key:l.id},[s(V,null,{default:u(()=>[s(p,{className:`field-icon-${t(j)[l.deType]}`},{default:u(()=>[(i(),y(qe(t(sl)[t(j)[l.deType]]),{class:We(["svg-icon",`field-icon-${t(j)[l.deType]}`])},null,8,["class"]))]),_:2},1032,["className"])]),_:2},1024),o("span",null,f(l.name),1)],12,cl))),128))])]),_:1})]),default:u(()=>[s(d,{placeholder:t(r)("auth.select_filter_fields"),modelValue:t(a).name,"onUpdate:modelValue":e[0]||(e[0]=l=>t(a).name=l),size:"small",onInput:he},null,8,["placeholder","modelValue"])]),_:1}),t(a).fieldId?(i(),m("div",pl,[t(a).deType!==1?(i(),m(_,{key:0},[o("span",vl,f(t(r)("auth.screen_method")),1),s(F,{size:"small",onChange:fe,modelValue:t(a).filterType,"onUpdate:modelValue":e[3]||(e[3]=l=>t(a).filterType=l),placeholder:t(r)("auth.select")},{default:u(()=>[(i(!0),m(_,null,k(E.value,l=>(i(),y(D,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"]),o("span",fl,f(t(r)("auth.fixed_value")),1)],64)):(i(),y(F,{key:1,size:"small",class:"w100",style:{"margin-left":"16px"},onChange:_e,modelValue:t(a).filterTypeTime,"onUpdate:modelValue":e[4]||(e[4]=l=>t(a).filterTypeTime=l),placeholder:t(r)("auth.select")},{default:u(()=>[(i(),m(_,null,k(Te,l=>s(D,{key:l.value,label:l.label,value:l.value},null,8,["label","value"])),64))]),_:1},8,["modelValue","placeholder"])),t(a).filterType==="logic"?(i(),m(_,{key:2},[s(F,{class:"w100",size:"small",modelValue:t(a).term,"onUpdate:modelValue":e[5]||(e[5]=l=>t(a).term=l),placeholder:t(r)("auth.default_method")},{default:u(()=>[(i(!0),m(_,null,k(de.value,l=>(i(),y(D,{key:l.value,label:t(r)(l.label),value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"]),h.value==="sysParams"?(i(),y(F,{key:0,class:"w70 mar5",size:"small",modelValue:t(a).value,"onUpdate:modelValue":e[6]||(e[6]=l=>t(a).value=l)},{default:u(()=>[(i(!0),m(_,null,k(re.value,l=>(i(),y(D,{key:l.value,label:t(r)(l.label),value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])):[2,3].includes(t(a).deType)&&!["null","empty","not_null","not_empty"].includes(t(a).term)?(i(),m(_,{key:1},[s(Ee,{class:"w70 mar5",size:"small",effect:"plain",modelValue:t(a).value,"onUpdate:modelValue":e[7]||(e[7]=l=>t(a).value=l),"controls-position":"right"},null,8,["modelValue"]),e[20]||(e[20]=o("div",{class:"bottom-line"},null,-1))],64)):["null","empty","not_null","not_empty"].includes(t(a).term)?$("",!0):(i(),m(_,{key:2},[t(a).deType===1&&t(a).filterTypeTime==="dynamicDate"&&!t(a).timeValue?(i(),y(d,{key:0,onClick:G,readonly:"",class:"w70 mar5",size:"small",modelValue:t(a).timeValue,"onUpdate:modelValue":e[8]||(e[8]=l=>t(a).timeValue=l)},null,8,["modelValue"])):t(a).deType===1&&t(a).filterTypeTime==="dynamicDate"?(i(),y(X,{key:1,class:"item",effect:"light",content:t(a).timeValue,placement:"top"},{default:u(()=>[s(d,{onClick:G,readonly:"",class:"w70 mar5",size:"small",modelValue:t(a).timeValue,"onUpdate:modelValue":e[9]||(e[9]=l=>t(a).timeValue=l)},null,8,["modelValue"])]),_:1},8,["content"])):(i(),y(d,{key:2,class:"w70 mar5",size:"small",modelValue:t(a).value,"onUpdate:modelValue":e[10]||(e[10]=l=>t(a).value=l)},null,8,["modelValue"])),e[21]||(e[21]=o("div",{class:"bottom-line"},null,-1))],64))],64)):(i(),y(Ie,{key:3,"popper-class":"de-el-dropdown-menu-fixed",width:"360px",trigger:"click",ref_key:"deElDropdownMenuFixed",ref:ie,"hide-on-click":!1},{reference:u(()=>[s(d,{modelValue:t(a).enumValue,"onUpdate:modelValue":e[11]||(e[11]=l=>t(a).enumValue=l),ref_key:"enumInput",ref:A,size:"small",onInput:Z,clearable:"",onClear:Q},null,8,["modelValue"])]),default:u(()=>[o("div",_l,[o("div",yl,[s(d,{placeholder:t(r)("auth.enter_keywords"),modelValue:x.value,"onUpdate:modelValue":e[12]||(e[12]=l=>x.value=l)},null,8,["placeholder","modelValue"]),o("ul",Vl,[(i(!0),m(_,null,k(Y.value,l=>(i(),m("li",{key:l,class:"infinite-list-item",onClick:O=>Ce(l)},[o("i",{class:"el-icon-check",style:ae({opacity:c.value.includes(l)?1:0})},null,4),o("label",null,f(l),1),e[22]||(e[22]=o("span",null,"+",-1))],8,kl))),128))]),o("button",{class:"select-all",onClick:be},f(t(r)("auth.select_all")),1)]),o("div",hl,[o("div",gl,[z(f(t(r)("auth.added"))+f(c.value.length)+" ",1),o("div",Tl,[o("span",{onClick:ve},[e[23]||(e[23]=o("i",{class:"el-icon-edit"},null,-1)),z(" "+f(t(r)("auth.manual_input")),1)]),s(He,{name:"el-zoom-in-top"},{default:u(()=>[b.value?(i(),m("div",bl,[o("div",wl,[Ge(o("textarea",{placeholder:t(r)("auth.please_fill"),class:"input","onUpdate:modelValue":e[13]||(e[13]=l=>S.value=l)},null,8,Cl),[[Ze,S.value]]),o("div",xl,[o("button",{type:"button",onClick:e[14]||(e[14]=l=>b.value=!1),class:"btn"},[o("span",null,f(t(r)("auth.close")),1)]),o("button",{type:"button",onClick:we,class:"btn right-add"},[o("span",null,f(t(r)("auth.add")),1)])])])])):$("",!0)]),_:1})])]),o("ul",El,[(i(!0),m(_,null,k(c.value,(l,O)=>(i(),m("li",{key:l,class:"infinite-list-item"},[s(X,{class:"item",effect:"light",content:l,placement:"top","open-delay":1e3},{default:u(()=>[o("label",null,f(l),1)]),_:2},1032,["content"]),s(V,{onClick:zl=>H(O),style:{opacity:"1"}},{default:u(()=>[s(p,{name:"icon_delete-trash_outlined"},{default:u(()=>[s(t(B),{class:"svg-icon"})]),_:1})]),_:2},1032,["onClick"])]))),128))]),o("div",Il,[e[24]||(e[24]=o("div",{class:"footer-left"}," ",-1)),o("div",{class:"confirm-btn",onClick:ce},f(t(r)("auth.sure")),1),o("div",Dl,[s(V,{onClick:Q},{default:u(()=>[s(p,{name:"icon_delete-trash_outlined"},{default:u(()=>[s(t(B),{class:"svg-icon"})]),_:1})]),_:1})])])])])]),_:1},512))])):$("",!0),U.value?(i(),y(V,{key:1,class:"font12",onClick:e[15]||(e[15]=l=>xe("del"))},{default:u(()=>[s(p,{name:"icon_delete-trash_outlined"},{default:u(()=>[s(t(B),{class:"svg-icon"})]),_:1})]),_:1})):$("",!0)],32),s(De,{class:"create-dialog","append-to-body":"",modelValue:g.value,"onUpdate:modelValue":e[19]||(e[19]=l=>g.value=l),title:"日期设置",width:"420"},{footer:u(()=>[o("div",Fl,[s(ee,{onClick:e[18]||(e[18]=l=>g.value=!1)},{default:u(()=>e[25]||(e[25]=[z("取消")])),_:1}),s(ee,{type:"primary",onClick:Ve},{default:u(()=>e[26]||(e[26]=[z(" 确定 ")])),_:1})])]),default:u(()=>[s(Xe,{ref_key:"timeDialog",ref:P},null,512)]),_:1},8,["modelValue"])])}}});const Vt=ul($l,[["__scopeId","data-v-0c648d2d"]]);export{Vt as default};
