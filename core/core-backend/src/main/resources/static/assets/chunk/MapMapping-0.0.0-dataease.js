import"./index-0.0.0-dataease.js";import{E as j}from"./el-pagination-0.0.0-dataease.js";import{y as K,e as q,n as G}from"./index-0.0.0-dataease2.js";import"./el-tag-0.0.0-dataease.js";import"./el-select-0.0.0-dataease.js";import"./el-popper-0.0.0-dataease.js";import{a as R,E as X}from"./el-table-column-0.0.0-dataease.js";import"./el-checkbox-0.0.0-dataease.js";import"./el-tooltip-0.0.0-dataease.js";import{d as H,t as L,w as Q,r as d,_ as C,m as W,o as Y,e as Z,f as D,M as ee,k as i,i as c,a6 as ae,N,j as l,U as V,X as k,V as I,a7 as te,g as ne,ad as re,ag as oe,n as le}from"./vue-0.0.0-dataease.js";import{p as se,j as ie}from"./util-0.0.0-dataease2.js";import{e as pe,o as me}from"./lodash-0.0.0-dataease.js";import{_ as ue}from"./_plugin-vue_export-helper-0.0.0-dataease.js";import"./library-0.0.0-dataease.js";import"./axios-0.0.0-dataease.js";import"./echarts-0.0.0-dataease.js";import"./tinymce-0.0.0-dataease.js";import"./user-0.0.0-dataease.js";import"./index-0.0.0-dataease4.js";import"./index-0.0.0-dataease14.js";import"./strings-0.0.0-dataease.js";import"./index-0.0.0-dataease5.js";import"./chart-0.0.0-dataease.js";import"./formatter-0.0.0-dataease.js";import"./chart-0.0.0-dataease2.js";import"./app-0.0.0-dataease.js";const de={style:{width:"100%"}},ce=["id"],ge=["title"],fe=H({__name:"MapMapping",props:{chart:{type:Object,required:!0},themes:{type:String,default:"dark"}},emits:["onMapMappingChange"],setup(S,{emit:F}){const $=S,A=F,{chart:_,themes:p}=L($);Q([()=>{var e;return(e=_.value)==null?void 0:e.senior.areaMapping},()=>{var e;return(e=_.value)==null?void 0:e.customAttr.map.id}],()=>{z()},{deep:!0});const h=d("body"),g=d(""),b=d(""),f=d(!1),w=d(""),x=d(null),M=C([]),v=W(()=>{var e;return(e=_.value)==null?void 0:e.customAttr.map.id}),o=C({mappingForm:{},currentData:[]}),s=C({pageSize:10,total:100,currentPage:1}),z=async()=>{var a;const e=JSON.parse(JSON.stringify(_.value));if(e!=null&&e.senior){let r=se(e.senior);o.mappingForm=r.areaMapping;let t=(a=o.mappingForm)==null?void 0:a[v.value];t||(t=await B(v.value));const m=[];me(t,(u,E)=>{m.push({originName:E,mappedName:u})}),o.currentData.splice(0,o.currentData.length,...m),s.total=o.currentData.length,y()}},B=async e=>e?(await ie(e)).features.reduce((r,t)=>(r[t.properties.name]=t.properties.name,r),{}):{},J=e=>{var a;h.value=`#area-${e.$index}-input`,b.value=e.row.originName,g.value=e.row.mappedName,f.value=!0,le((a=x.value)==null?void 0:a.focus)},P=()=>{h.value="body",f.value=!1;let e=o.mappingForm[v.value];e||(e=o.currentData.reduce((r,t)=>(r[t.originName]=t.mappedName,r),{})),e[b.value]!==g.value&&(e[b.value]=g.value,o.mappingForm[v.value]||(o.mappingForm[v.value]=e),T())},y=pe(()=>{const e=o.currentData.filter(t=>{var m,u;return(m=w.value)!=null&&m.trim()?(u=t.mappedName)==null?void 0:u.includes(w.value):!0}),a=(s.currentPage-1)*s.pageSize,r=a+s.pageSize;M.splice(0,M.length,...e.slice(a,r)),s.total=e.length},300),T=()=>{A("onMapMappingChange",o.mappingForm)};return Y(()=>{z()}),(e,a)=>{const r=R,t=K,m=Z("Edit"),u=q,E=G,U=X,O=j;return D(),ee("div",de,[i(U,{size:"mini",class:I(["area-map-table","area-map-table-"+l(p)]),"header-cell-class-name":"area-map-table-header-cell-"+l(p),"header-row-class-name":"area-map-table-header-row-"+l(p),"cell-class-name":"area-map-table-cell-"+l(p),"row-class-name":"area-map-table-row-"+l(p),data:M},{empty:c(()=>a[6]||(a[6]=[ae(" 暂无数据 ")])),default:c(()=>[i(r,{label:"图形",prop:"originName",width:"80","show-overflow-tooltip":""}),i(r,{width:"140"},{header:c(()=>[a[5]||(a[5]=N("span",null,"属性",-1)),i(t,{modelValue:w.value,"onUpdate:modelValue":a[0]||(a[0]=n=>w.value=n),size:"small",class:"area-filter",effect:l(p),onInput:l(y)},null,8,["modelValue","effect","onInput"])]),default:c(n=>[N("div",{id:`area-${n.$index}-input`},null,8,ce),V(i(E,{class:I(["area-edit-btn","area-edit-btn-"+l(p)]),size:"small",onClick:ve=>J(n)},{default:c(()=>[N("span",{title:n.row.mappedName},te(n.row.mappedName),9,ge),i(u,null,{default:c(()=>[i(m)]),_:1})]),_:2},1032,["class","onClick"]),[[k,!f.value||h.value!==`#area-${n.$index}-input`]])]),_:1})]),_:1},8,["class","header-cell-class-name","header-row-class-name","cell-class-name","row-class-name","data"]),i(O,{small:"","hide-on-single-page":"",layout:"prev, pager, next",class:"area-page","current-page":s.currentPage,"onUpdate:currentPage":a[1]||(a[1]=n=>s.currentPage=n),total:s.total,"page-size":s.pageSize,"pager-count":5,onCurrentChange:l(y)},null,8,["current-page","total","page-size","onCurrentChange"]),(D(),ne(oe,{to:h.value,disabled:!f.value},[V(N("div",null,[i(t,{modelValue:g.value,"onUpdate:modelValue":a[2]||(a[2]=n=>g.value=n),size:"small",ref_key:"areaNameInput",ref:x,effect:l(p),onBlur:a[3]||(a[3]=n=>P()),onKeyup:a[4]||(a[4]=re(n=>n.target.blur(),["enter"]))},null,8,["modelValue","effect"])],512),[[k,f.value]])],8,["to","disabled"]))])}}});const Ke=ue(fe,[["__scopeId","data-v-6da0bd5d"]]);export{Ke as default};
