import{u as pe}from"./index-0.0.0-dataease.js";import"./el-footer-0.0.0-dataease.js";import{a as me,c as fe}from"./el-aside-0.0.0-dataease.js";import{v as we,u as _e,_ as he,w as ye,n as Se,e as ge}from"./index-0.0.0-dataease2.js";import{d as ke,m as f,ai as Pe,r,_ as Ce,o as De,al as Ie,e as $,ab as Ae,f as o,M as S,N as xe,g as l,W as x,j as c,a0 as n,k as u,i as d,V as F,U as j,Z as G,n as B,X as Be,a6 as Ee,a7 as z}from"./vue-0.0.0-dataease.js";import{i as Ve}from"./icon_add_outlined-0.0.0-dataease.js";import Me from"./DeResourceTree-0.0.0-dataease.js";import{d as Ne}from"./dvMain-0.0.0-dataease.js";import U from"./DeResourceArrow-0.0.0-dataease.js";import{_ as Re}from"./PreviewHead.vue_vue_type_style_index_0_lang-0.0.0-dataease.js";import{E as H}from"./EmptyBackground-0.0.0-dataease.js";import{useAppStoreWithOut as Te}from"./app-0.0.0-dataease.js";import{I as Oe,i as be,o as qe}from"./canvasUtils-0.0.0-dataease.js";import{u as Le}from"./useMoveLine-0.0.0-dataease.js";import{a as We,c as $e}from"./imgUtils-0.0.0-dataease.js";import{M as Fe}from"./MultiplexPreviewShow-0.0.0-dataease.js";import{_ as je}from"./DvPreview.vue_vue_type_style_index_0_lang-0.0.0-dataease.js";import{A as Ge}from"./AppExportForm-0.0.0-dataease.js";import{useUserStoreWithOut as ze}from"./user-0.0.0-dataease.js";const Ue={class:"dv-preview"},He={key:1,class:"content multiplexing-content"},ma=ke({__name:"PreviewShow",props:{showPosition:{required:!1,type:String,default:"preview"},noClose:{required:!1,type:Boolean,default:!1}},setup(s,{expose:X}){const Z=ze(),J=f(()=>Z.getName),g=Ne(),{dvInfo:K,canvasViewDataInfo:E}=Pe(g),k=r(null),V=r(null),w=r(!0),Q=we(),Y=_e(),_=r(!0),p=r(!1),{width:P,node:ee}=Le("DASHBOARD"),M=r(null),C=s,m=r(),N=f(()=>{var e;return(e=m.value)==null?void 0:e.hasData}),R=f(()=>{var e;return(e=m.value)==null?void 0:e.mounted}),ae=f(()=>{var e;return(e=m.value)==null?void 0:e.rootManage}),D=Te(),oe=f(()=>D.getIsDataEaseBi);function te(){var e;(e=m.value)==null||e.createNewObject()}const T=(e,i)=>{const t=C.showPosition==="multiplexing"?Oe:be;_.value=!1,t(e,"dataV",function({canvasDataResult:L,canvasStyleResult:W,dvInfo:h,canvasViewInfoPreview:I,curPreviewGap:A}){h.weight=i,a.canvasDataPreview=L,a.canvasStylePreview=W,a.canvasViewInfoPreview=I,a.dvInfo=h,a.curPreviewGap=A,_.value=!0,C.showPosition==="preview"&&(g.updateCurDvInfo(h),B(()=>{var y;(y=V.value)==null||y.restore()})),B(()=>{qe({resourceId:e})})})},O=e=>{p.value=!0,setTimeout(()=>{const i=k.value.querySelector(".canvas-container");We(e,i,a.dvInfo.name,()=>{p.value=!1})},200)},b=(e,i)=>{p.value=!0,B(()=>{const t=k.value.querySelector(".canvas-container");$e(e,t,a.dvInfo.name,i,()=>{p.value=!1})})},ne=e=>{e==="template"?b(e,null):e==="app"&&se()},se=()=>{const e=ie();e&&e.length>0?ye.warning(`当前仪表板中[${e}]属于模版图表，无法导出，请先设置数据集！`):M.value.init({appName:a.dvInfo.name,icon:null,version:"2.0",creator:J.value,required:"2.9.0",description:null})},ie=()=>{let e=",";return Object.keys(E.value).forEach(i=>{const t=E.value[i];t&&(t==null?void 0:t.dataFrom)==="template"&&(e=e+t.title+",")}),e.slice(1)},Xe=()=>{w.value=!w.value},re=e=>{T(e,a.dvInfo.weight)},le=e=>{T(e.id,e.weight)},a=Ce({canvasDataPreview:null,canvasStylePreview:null,canvasViewInfoPreview:null,dvInfo:null,curPreviewGap:0}),v=r(!0),q=e=>{v.value=e},ce=()=>{D.setArrowSide(!0)},ve=()=>{D.setArrowSide(!1)},ue=()=>a,de=e=>{b("app",e)};return De(()=>{pe({name:"canvasDownload",callback:function(){O("img")}})}),X({getPreviewStateInfo:ue}),Ie(()=>{C.showPosition==="preview"&&g.canvasDataInit()}),(e,i)=>{const t=me,L=$("ArrowLeft"),W=ge,h=$("ArrowRight"),I=Se,A=fe,y=Ae("loading");return o(),S(G,null,[xe("div",Ue,[s.noClose?n("",!0):(o(),l(U,{key:0,style:x({left:(v.value?c(P)-12:0)+"px"}),onChangeSideTreeStatus:q,isInside:!v.value},null,8,["style","isInside"])),u(t,{class:F(["resource-area",{"close-side":!w.value,retract:!v.value}]),onMouseenter:ce,onMouseleave:ve,ref_key:"node",ref:ee,style:x({width:c(P)+"px"})},{default:d(()=>[s.noClose?n("",!0):(o(),l(U,{key:0,isInside:!v.value,style:x({left:(v.value?c(P)-12:0)+"px"}),onChangeSideTreeStatus:q},null,8,["isInside","style"])),j(u(Me,{ref_key:"resourceTreeRef",ref:m,"cur-canvas-type":"dataV","show-position":s.showPosition,onNodeClick:le},null,8,["show-position"]),[[Be,w.value]])]),_:1},8,["class","style"]),j((o(),l(A,{class:F(["preview-area",{"no-data":!N.value}])},{default:d(()=>[n("",!0),c(K).name?(o(),S(G,{key:1},[s.showPosition==="preview"?(o(),l(Re,{key:0,onReload:re,onDownload:O,onDownloadAsAppTemplate:ne})):n("",!0),s.showPosition==="multiplexing"&&_.value?(o(),S("div",He,[u(Fe,{"component-data":a.canvasDataPreview,"canvas-style-data":a.canvasStylePreview,"canvas-view-info":a.canvasViewInfoPreview,"dv-info":a.dvInfo},null,8,["component-data","canvas-style-data","canvas-view-info","dv-info"])])):n("",!0),s.showPosition==="preview"?(o(),S("div",{key:2,ref_key:"previewCanvasContainer",ref:k,class:"content"},[a.canvasStylePreview&&_.value?(o(),l(je,{key:0,ref_key:"dvPreviewRef",ref:V,"show-position":s.showPosition,"canvas-data-preview":a.canvasDataPreview,"canvas-style-preview":a.canvasStylePreview,"canvas-view-info-preview":a.canvasViewInfoPreview,"dv-info":a.dvInfo,"cur-preview-gap":a.curPreviewGap,"download-status":p.value},null,8,["show-position","canvas-data-preview","canvas-style-preview","canvas-view-info-preview","dv-info","cur-preview-gap","download-status"])):n("",!0)],512)):n("",!0)],64)):N.value&&R.value?(o(),l(H,{key:2,description:"请在左侧选择数据大屏","img-type":"select"})):R.value?(o(),l(H,{key:3,description:"暂无数据大屏","img-type":"none"},{default:d(()=>[ae.value&&!oe.value?(o(),l(I,{key:0,onClick:te,type:"primary"},{icon:d(()=>[u(c(he),{name:"icon_add_outlined"},{default:d(()=>[u(c(Ve),{class:"svg-icon"})]),_:1})]),default:d(()=>[Ee(" "+z(e.$t("commons.create"))+z(e.$t("work_branch.big_data_screen")),1)]),_:1})):n("",!0)]),_:1})):n("",!0)]),_:1},8,["class"])),[[y,c(Q).loadingMap[c(Y).currentPath]]])]),u(Ge,{ref_key:"appExportFormRef",ref:M,"dv-info":a.dvInfo,"component-data":a.canvasDataPreview,"canvas-view-info":a.canvasViewInfoPreview,onDownLoadApp:de},null,8,["dv-info","component-data","canvas-view-info"])],64)}}});export{ma as _};
