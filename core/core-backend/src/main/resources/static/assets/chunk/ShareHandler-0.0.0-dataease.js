import{p as z,b as $e,au as Be}from"./index-0.0.0-dataease.js";import{E as Ae}from"./el-dialog-0.0.0-dataease.js";import{j as Le,d as U,n as De,w as g,_ as ue,e as Ze,y as He}from"./index-0.0.0-dataease2.js";import{E as Ne}from"./el-date-picker-0.0.0-dataease.js";import"./el-popper-0.0.0-dataease.js";import{E as je}from"./el-checkbox-0.0.0-dataease.js";import{E as Ge}from"./el-switch-0.0.0-dataease.js";import"./el-tooltip-0.0.0-dataease.js";import{f as u,M as b,N as d,d as Fe,r as _,_ as Oe,m as ce,o as We,g as S,i as p,j as m,a0 as v,ac as $,V as Z,Z as Je,k as h,a6 as T,a7 as k,aw as Ke,n as pe}from"./vue-0.0.0-dataease.js";import{u as Qe,i as Xe}from"./share-0.0.0-dataease.js";import{i as Ye}from"./icon_admin_outlined-0.0.0-dataease.js";import{s as et,S as tt,a as ot}from"./ShareTicket-0.0.0-dataease.js";import{u as nt}from"./index-0.0.0-dataease16.js";import{E as at}from"./index-0.0.0-dataease4.js";import{_ as lt}from"./_plugin-vue_export-helper-0.0.0-dataease.js";import"./library-0.0.0-dataease.js";import"./lodash-0.0.0-dataease.js";import"./use-dialog-0.0.0-dataease.js";import"./refs-0.0.0-dataease.js";import"./axios-0.0.0-dataease.js";import"./echarts-0.0.0-dataease.js";import"./tinymce-0.0.0-dataease.js";import"./user-0.0.0-dataease.js";import"./dayjs.min-0.0.0-dataease.js";import"./arrays-0.0.0-dataease.js";import"./index-0.0.0-dataease15.js";import"./index-0.0.0-dataease5.js";import"./el-table-column-0.0.0-dataease.js";import"./el-tag-0.0.0-dataease.js";import"./icon_left_outlined-0.0.0-dataease.js";import"./de-copy-0.0.0-dataease.js";import"./icon_refresh_outlined-0.0.0-dataease.js";import"./dv-info-0.0.0-dataease.js";import"./icon_delete-trash_outlined-0.0.0-dataease.js";import"./icon_edit_outlined-0.0.0-dataease.js";import"./icon_add_outlined-0.0.0-dataease.js";const st={width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function rt(J,B){return u(),b("svg",st,B[0]||(B[0]=[d("path",{d:"M8.66634 4.00065C8.66634 4.25739 8.70262 4.50565 8.77034 4.7406L5.88342 6.4465C5.401 5.96502 4.7351 5.66732 3.99967 5.66732C2.52692 5.66732 1.33301 6.86123 1.33301 8.33398C1.33301 9.80674 2.52692 11.0007 3.99967 11.0007C4.81776 11.0007 5.5498 10.6323 6.03896 10.0523L9.71633 11.8175C9.68353 11.9846 9.66634 12.1573 9.66634 12.334C9.66634 13.8067 10.8602 15.0007 12.333 15.0007C13.8058 15.0007 14.9997 13.8067 14.9997 12.334C14.9997 10.8612 13.8058 9.66732 12.333 9.66732C11.5149 9.66732 10.7829 10.0357 10.2937 10.6156L6.61635 8.8505C6.64915 8.6834 6.66634 8.5107 6.66634 8.33398C6.66634 8.07725 6.63006 7.82898 6.56234 7.59404L9.44926 5.88814C9.93168 6.36961 10.5976 6.66732 11.333 6.66732C12.8058 6.66732 13.9997 5.47341 13.9997 4.00065C13.9997 2.52789 12.8058 1.33398 11.333 1.33398C9.86025 1.33398 8.66634 2.52789 8.66634 4.00065ZM12.6663 4.00065C12.6663 4.73703 12.0694 5.33398 11.333 5.33398C10.5966 5.33398 9.99967 4.73703 9.99967 4.00065C9.99967 3.26427 10.5966 2.66732 11.333 2.66732C12.0694 2.66732 12.6663 3.26427 12.6663 4.00065ZM12.333 13.6673C11.5966 13.6673 10.9997 13.0704 10.9997 12.334C10.9997 11.5976 11.5966 11.0007 12.333 11.0007C13.0694 11.0007 13.6663 11.5976 13.6663 12.334C13.6663 13.0704 13.0694 13.6673 12.333 13.6673ZM5.33301 8.33398C5.33301 9.07036 4.73605 9.66732 3.99967 9.66732C3.26329 9.66732 2.66634 9.07036 2.66634 8.33398C2.66634 7.5976 3.26329 7.00065 3.99967 7.00065C4.73605 7.00065 5.33301 7.5976 5.33301 8.33398Z",fill:"#646A73"},null,-1)]))}const it={render:rt},dt={class:"copy-link"},ut={class:"open-share flex-align-center"},ct={key:0,class:"custom-link-line"},pt={key:1,class:"exp-container"},mt={class:"checkbox-span"},ft={class:"inline-share-item-picker"},ht={key:1,class:"exp-error"},_t={key:2,class:"pwd-container"},vt={class:"checkbox-span"},wt={key:0,class:"auto-pwd-container"},kt={key:1,class:"inline-share-item"},bt={class:"share-pwd-opt"},gt={key:0,class:"share-ticket-container"},yt={class:"dialog-footer"},Ct=Fe({__name:"ShareHandler",props:{inGrid:z.bool.def(!1),resourceId:z.string.def(""),resourceType:z.string.def(""),weight:z.number.def(0),isButton:z.bool.def(!1)},emits:["loaded"],setup(J,{expose:B,emit:me}){const fe=Qe(),K=$e(),{toClipboard:Q}=nt(),{t:n}=Le(),f=J,y=_(null),H=_(),N=_(),X=_(null),R=_(!1),P=_(!1),C=_(!1),i=_(!1),Y=_(""),A=_(!1),M=_(!1),x=_(null),I=_(!1),a=Oe({detailInfo:{id:"",uuid:"",pwd:"",exp:0,autoPwd:!0,ticketRequire:!1}}),he=me,_e=ce(()=>`${n("work_branch.open_link_hint")}${f.resourceType==="dashboard"?n("work_branch.dashboard"):n("work_branch.big_data_screen")}`),V=ce(()=>fe.getSharePeRequire),ve=()=>{M.value=!0,pe(()=>{x!=null&&x.value&&x.value.input.focus()})},ee=async()=>{const e=a.detailInfo.uuid,t="link-uuid-error-msg";if(!e)return E(n("commons.cannot_be_null"),x,t),!1;const s=/^[a-zA-Z0-9]{8,16}$/.test(e);if(!s)E(n("work_branch.uuid_checker"),x,t);else{const r=await we(e);return E(r,x,t),!r}return s},we=async e=>{const t="/share/editUuid",o={resourceId:f.resourceId,uuid:e};return(await U.post({url:t,data:o})).data},te=async()=>{const e=await ee();M.value=!e},ke=async()=>{if(i.value&&C.value){if(!a.detailInfo.autoPwd&&F("link-pwd-error-msg")){g.warning(n("work_branch.error_password_hint"));return}try{await Q(a.detailInfo.pwd),g.success(n("common.copy_success"))}catch{g.warning(n("common.copy_unsupported"))}}else g.warning(n("common.copy_unsupported"))},be=async()=>{if(i.value)try{if(F("link-uuid-error-msg")){g.warning(n("work_branch.error_link_hint"));return}if(C.value&&!a.detailInfo.autoPwd&&F("link-pwd-error-msg")){g.warning(n("work_branch.error_password_hint"));return}if(V.value&&!G())return;oe(),await Q(Y.value),g.success(n("common.copy_success"))}catch{g.warning(n("common.copy_unsupported"))}else g.warning(n("common.copy_unsupported"));R.value=!1},ge=e=>e.getTime()<new Date().getTime(),ye=()=>{X.value=Be.service({target:".share-dialog-container"})},Ce=()=>{var e;(e=X.value)==null||e.close()},j=()=>{R.value=!0,L(G)},L=e=>{ye();const o=`/share/detail/${f.resourceId}`;U.get({url:o}).then(s=>{a.detailInfo={...s.data},xe()}).finally(()=>{Ce(),e&&e()})},xe=()=>{a.detailInfo.id&&a.detailInfo.uuid&&(i.value=!0,oe()),C.value=!!a.detailInfo.pwd,P.value=!!a.detailInfo.exp},Ie=()=>{const t=`/share/switcher/${f.resourceId}`;U.post({url:t}).then(()=>{L(null)})},oe=()=>{Y.value=ne()+a.detailInfo.uuid},ne=()=>{let e="/";if(K.baseUrl)e=K.baseUrl+"#";else{const t=window.location.href;e=t.substring(0,t.indexOf("#")+1)}return(e.includes("oidcbi/")||e.includes("casbi/"))&&(e=e.replace("oidcbi/",""),e=e.replace("casbi/","")),e+ot},Ee=e=>{let t=0;if(e){const o=new Date;o.setTime(o.getTime()+3600*1e3),t=o.getTime(),a.detailInfo.exp=t}le(),ae(t)},ae=e=>{if(P.value&&e<new Date().getTime()){A.value=!0;return}A.value=!1;const t=f.resourceId,o="/share/editExp",s={resourceId:t,exp:e};U.post({url:o,data:s}).then(()=>{L(null)})},Ve=async e=>{if(!i.value){I.value=!1,e();return}if(V.value&&!G())return;const t=re(),o=await ee();t&&o&&(I.value=!1,e())},G=()=>{if(i.value&&V.value){const e=le(),t=se();return e&&t}return!0},le=()=>!V.value||P.value?(D(null,H),!0):(D(n("common.required"),H),!1),se=()=>!V.value||C.value?(D(null,N),!0):(D(n("common.required"),N),!1),re=()=>{if(!i.value||a.detailInfo.autoPwd)return E(null,y),!0;const e=a.detailInfo.pwd;if(!e)return E(n("work_branch.password_null_hint"),y),!1;const t=/^(?=.*[A-Za-z])(?=.*\d)(?=.*[!@#$%^&*()_+])[A-Za-z\d!@#$%^&*()_+]{4,10}$/;return new RegExp(t).test(e)?(E(null,y),O(e,!1),!0):(E(n("work_branch.password_hint"),y),!1)},D=(e,t,o)=>{if(!t.value)return;o=o||"checkbox-span-require";const s=`.${o}`,r=t.value.$el;if(e){r.style.color="red",r.children[0].children[1].style.borderColor="red";const l=r.children[1].children[0].querySelector(s);if(l)l.innerText=e;else{const w=document.createElement("span");w.className=o,w.innerText=e,r.children[1].children[0].appendChild(w)}}else{r.style=null,r.children[0].children[1].style.borderColor=null;const l=r.children[1].children[0].querySelector(s);l&&r.children[1].children[0].removeChild(l)}},E=(e,t,o)=>{o=o||"link-pwd-error-msg";const s=`.${o}`,r=t||y;if(!r.value)return;const l=r.value.input;if(e){l.style.color="red",l.style.borderColor="red",l.parentElement.style["box-shadow"]="0 0 0 1px red inset";const w=l.parentElement.querySelector(s);if(w)w.innerText=e;else{const q=document.createElement("div");q.className=o,q.innerText=e,l.parentElement.appendChild(q)}}else{l.style=null,l.style.borderColor=null;const w=l.parentElement.querySelector(s);w&&(l.parentElement.style=null,l.parentElement.removeChild(w))}},F=e=>{var t;return(t=document.getElementsByClassName(e))==null?void 0:t.length},qe=e=>{e?(E(null,y),ie()):(a.detailInfo.pwd="",pe(()=>{y.value.input.focus()}))},Se=e=>{let t="";e&&(t=de()),se(),O(t,!0)},ie=()=>{const e=de();O(e,!0)},O=(e,t)=>{const o=f.resourceId,s="/share/editPwd",r={resourceId:o,pwd:e,autoPwd:t};U.post({url:s,data:r}).then(()=>{L(null)})},de=()=>{const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*()_+";let o="";const s="!@#$%^&*()_+";let r=!1;for(let l=0;l<10;l++)l===0?o+=t.charAt(Math.floor(Math.random()*t.length)):!r&&l<10-2?(o+=s.charAt(Math.floor(Math.random()*s.length)),r=!0):o+=t.charAt(Math.floor(Math.random()*t.length));return o=o.split("").sort(()=>.5-Math.random()).join(""),o},Te=()=>{I.value=!0},Re=()=>{I.value=!1},Pe=e=>{a.detailInfo.ticketRequire=e};return B({execute:()=>{j()}}),We(()=>{if(!f.inGrid&&f.weight>=7){const e={label:n("visualization.share"),command:"share",svgName:it};he("loaded",e)}}),(e,t)=>{const o=ue,s=Ze,r=at,l=De,w=Ge,q=He,Me=ue,W=je,ze=Ne,Ue=Ae;return u(),b(Je,null,[f.weight>=7&&f.inGrid?(u(),S(r,{key:0,effect:"dark",content:m(n)("visualization.share"),placement:"top"},{default:p(()=>[h(s,{class:"hover-icon hover-icon-in-table share-button-icon",onClick:$(j,["stop"])},{default:p(()=>[h(o,{name:"icon_share-label_outlined"},{default:p(()=>[h(m(Xe),{class:"svg-icon"})]),_:1})]),_:1})]),_:1},8,["content"])):v("",!0),f.weight>=7&&f.isButton?(u(),S(l,{key:1,onClick:$(j,["stop"]),icon:"Share"},{default:p(()=>[T(k(m(n)("visualization.share")),1)]),_:1})):v("",!0),R.value&&f.weight>=7?(u(),S(Ue,{key:2,class:Z(["copy-link_dialog",{"hidden-footer":!i.value||I.value,"is-ticket-dialog":i.value&&I.value}]),modelValue:R.value,"onUpdate:modelValue":t[7]||(t[7]=c=>R.value=c),"close-on-click-modal":!0,"append-to-body":!0,"before-close":Ve,title:m(n)("work_branch.public_link_share"),width:"480px","show-close":!1},{footer:p(()=>[d("span",yt,[h(l,{secondary:"",onClick:Te},{default:p(()=>[T(k(m(n)("work_branch.ticket_setting")),1)]),_:1}),h(l,{disabled:!i.value||A.value,type:"primary",onClick:$(be,["stop"])},{default:p(()=>[T(k(m(n)("visualization.copy_link")),1)]),_:1},8,["disabled"])])]),default:p(()=>[d("div",{class:Z(["share-dialog-container",{"hidden-link-container":I.value}])},[d("div",dt,[d("div",ut,[h(w,{size:"small",modelValue:i.value,"onUpdate:modelValue":t[0]||(t[0]=c=>i.value=c),onChange:Ie},null,8,["modelValue"]),T(" "+k(_e.value),1)]),i.value?(u(),b("div",ct,[h(q,{ref_key:"linkUuidRef",ref:x,placeholder:"",modelValue:a.detailInfo.uuid,"onUpdate:modelValue":t[1]||(t[1]=c=>a.detailInfo.uuid=c),disabled:!M.value,onBlur:te},Ke({_:2},[M.value?void 0:{name:"prefix",fn:p(()=>[T(k(ne()),1)]),key:"0"}]),1032,["modelValue","disabled"]),M.value?(u(),S(l,{key:0,text:"",onClick:te},{default:p(()=>[T(k(m(n)("components.complete")),1)]),_:1})):(u(),S(l,{key:1,onClick:ve,size:"default",plain:""},{icon:p(()=>[h(Me,{name:"icon_admin_outlined"},{default:p(()=>[h(m(Ye),{class:"svg-icon"})]),_:1})]),_:1}))])):v("",!0),i.value?(u(),b("div",pt,[h(W,{ref_key:"expCheckbox",ref:H,disabled:!i.value,modelValue:P.value,"onUpdate:modelValue":t[2]||(t[2]=c=>P.value=c),onChange:Ee},{default:p(()=>[d("div",mt,[d("span",null,k(m(n)("visualization.over_time")),1),d("span",{class:Z(["pe-require",{"pe-tips-hidden":!V.value}])},t[8]||(t[8]=[d("span",null,"*",-1)]),2)])]),_:1},8,["disabled","modelValue"]),d("div",ft,[a.detailInfo.exp?(u(),S(ze,{key:0,clearable:!1,size:"small",class:"share-exp-picker",modelValue:a.detailInfo.exp,"onUpdate:modelValue":t[3]||(t[3]=c=>a.detailInfo.exp=c),type:"datetime",placeholder:"",shortcuts:m(et),onChange:ae,"disabled-date":ge,"value-format":"x"},null,8,["modelValue","shortcuts"])):v("",!0),A.value?(u(),b("span",ht,k(m(n)("work_branch.share_time_limit")),1)):v("",!0)])])):v("",!0),i.value?(u(),b("div",_t,[h(W,{ref_key:"pwdCheckbox",ref:N,disabled:!i.value,modelValue:C.value,"onUpdate:modelValue":t[4]||(t[4]=c=>C.value=c),onChange:Se},{default:p(()=>[d("div",vt,[d("span",null,k(m(n)("visualization.passwd_protect")),1),d("span",{class:Z(["pe-require",{"pe-tips-hidden":!V.value}])},t[9]||(t[9]=[d("span",null,"*",-1)]),2)])]),_:1},8,["disabled","modelValue"]),C.value?(u(),b("div",wt,[h(W,{disabled:!i.value,modelValue:a.detailInfo.autoPwd,"onUpdate:modelValue":t[5]||(t[5]=c=>a.detailInfo.autoPwd=c),onChange:qe,label:m(n)("visualization.auto_pwd")},null,8,["disabled","modelValue","label"])])):v("",!0),C.value?(u(),b("div",kt,[h(q,{ref_key:"pwdRef",ref:y,modelValue:a.detailInfo.pwd,"onUpdate:modelValue":t[6]||(t[6]=c=>a.detailInfo.pwd=c),readonly:a.detailInfo.autoPwd,size:"small",onBlur:re},{append:p(()=>[d("div",bt,[a.detailInfo.autoPwd?(u(),b("div",{key:0,onClick:$(ie,["stop"]),class:"share-reset-container"},[d("span",null,k(m(n)("commons.reset")),1)])):v("",!0),d("div",{onClick:$(ke,["stop"]),class:"share-reset-container"},[d("span",null,k(m(n)("commons.copy")),1)])])]),_:1},8,["modelValue","readonly"])])):v("",!0)])):v("",!0)])],2),i.value&&I.value?(u(),b("div",gt,[h(tt,{uuid:a.detailInfo.uuid,"resource-id":f.resourceId,"ticket-require":a.detailInfo.ticketRequire,onRequireChange:Pe,onClose:Re},null,8,["uuid","resource-id","ticket-require"])])):v("",!0)]),_:1},8,["class","modelValue","title"])):v("",!0)],64)}}});const ro=lt(Ct,[["__scopeId","data-v-8387c0f6"]]);export{ro as default};
