import{p as $,b as ae}from"./index-0.0.0-dataease.js";import{E as ie,a as ce}from"./el-table-column-0.0.0-dataease.js";import{E as le}from"./el-checkbox-0.0.0-dataease.js";import"./el-tag-0.0.0-dataease.js";import"./el-tooltip-0.0.0-dataease.js";import"./el-popper-0.0.0-dataease.js";import{j as O,d as h,n as re,w as L,_ as M,e as de,y as ue,x as me}from"./index-0.0.0-dataease2.js";import{f as _,M as x,N as r,d as pe,t as _e,r as U,_ as fe,o as ke,k as o,i as s,a7 as b,j as l,B as he,ac as p,a6 as z,g as w}from"./vue-0.0.0-dataease.js";import{i as be}from"./icon_left_outlined-0.0.0-dataease.js";import{d as ge}from"./de-copy-0.0.0-dataease.js";import{i as ve}from"./icon_refresh_outlined-0.0.0-dataease.js";import{d as ye}from"./dv-info-0.0.0-dataease.js";import{i as Ce}from"./icon_delete-trash_outlined-0.0.0-dataease.js";import{i as we}from"./icon_edit_outlined-0.0.0-dataease.js";import{i as xe}from"./icon_add_outlined-0.0.0-dataease.js";import{u as Te}from"./index-0.0.0-dataease16.js";import{E as $e}from"./index-0.0.0-dataease4.js";import{_ as Ee}from"./_plugin-vue_export-helper-0.0.0-dataease.js";const Ne="/de-link/",{t:E}=O(),_t=[{text:E("commons.date.one_hour"),value:()=>{const d=new Date;return d.setTime(d.getTime()+3600*1e3),d}},{text:E("commons.date.one_day"),value:()=>{const d=new Date;return d.setTime(d.getTime()+3600*1e3*24),d}},{text:E("commons.date.one_week"),value:()=>{const d=new Date;return d.setTime(d.getTime()+7*3600*1e3*24),d}}],Se={width:"24",height:"24",viewBox:"0 0 24 24",fill:"",xmlns:"http://www.w3.org/2000/svg"};function De(d,y){return _(),x("svg",Se,y[0]||(y[0]=[r("path",{d:"M12 21C16.9706 21 21 16.9706 21 12C21 7.02944 16.9706 3 12 3C7.02944 3 3 7.02944 3 12C3 16.9706 7.02944 21 12 21ZM12 23C5.92487 23 1 18.0751 1 12C1 5.92487 5.92487 1 12 1C18.0751 1 23 5.92487 23 12C23 18.0751 18.0751 23 12 23ZM10.84 14.2799L16.1433 8.97665C16.3386 8.78138 16.6551 8.78138 16.8504 8.97665L17.5575 9.68375C17.7528 9.87901 17.7528 10.1956 17.5575 10.3909L11.1936 16.7548C10.9983 16.9501 10.6817 16.9501 10.4864 16.7548L6.82603 13.0944C6.63077 12.8991 6.63077 12.5826 6.82603 12.3873L7.53314 11.6802C7.7284 11.4849 8.04498 11.4849 8.24024 11.6802L10.84 14.2799Z",fill:""},null,-1)]))}const Ie={render:De},Be={class:"ticket"},Ve={class:"ticket-model"},qe={class:"ticket-model-start"},Re={class:"back-tips"},Ae={class:"ticket-title"},Le={class:"ticket-model-end"},Me={class:"ticket-add"},Ue={class:"ticket-table"},ze={class:"ticket-row"},Oe=["title"],je={class:"ticket-exp-head"},Je={class:"exp-tips-span"},Ze={key:1},He={key:1},Pe={class:"ticket-row"},Fe={class:"ticket-btn"},Ge=pe({__name:"ShareTicket",props:{uuid:$.string.def(""),resourceId:$.string.def(null),ticketRequire:$.bool},emits:["close","requireChange"],setup(d,{emit:y}){const N=ae(),{toClipboard:j}=Te(),{t:m}=O(),g=d,{ticketRequire:T}=_e(g),S=U({}),D=U({}),f=fe({tableData:[]}),I=y,B=()=>{I("close")},J=(e,t)=>{e&&(S.value[t]=e)},Z=(e,t)=>{e&&(D.value[t]=e)},H=e=>{const t="/ticket/enableTicket",a={resourceId:g.resourceId,require:e};h.post({url:t,data:a}).then(()=>{I("requireChange",e)})},P=e=>(e||f.tableData.length||0)>4?(me.confirm(m("chart.tips"),{confirmButtonType:"primary",type:"warning",confirmButtonText:m("common.roger_that"),cancelButtonText:m("dataset.cancel"),autofocus:!1,showClose:!1,showCancelButton:!1,tip:m("work_branch.max_ticket_count")}),!1):!0,F=()=>{if(!P())return;const e={ticket:"",exp:30,args:"",uuid:g.uuid},t="/ticket/saveTicket";h.post({url:t,data:e}).then(a=>{e.ticket=a.data,e.isEdit=!1,f.tableData.splice(0,0,e)})},G=()=>K()+g.uuid,K=()=>{let e="/";if(N.baseUrl)e=N.baseUrl+"#";else{const t=window.location.href;e=t.substring(0,t.indexOf("#")+1)}return(e.includes("oidcbi/")||e.includes("casbi/"))&&(e=e.replace("oidcbi/",""),e=e.replace("casbi/","")),e+Ne},Q=async e=>{const t=`${G()}?ticket=${e}`;try{await j(t),L.success(m("common.copy_success"))}catch(a){L.warning(m("common.copy_unsupported"),a)}},W=e=>{const t="/ticket/saveTicket",a=JSON.parse(JSON.stringify(e));a.generateNew=!0,h.post({url:t,data:a}).then(i=>{e.ticket=i.data})},X=(e,t)=>{e===null||e===""||(f.tableData[t].exp=e.replace(/[^\d]/g,""))},V=(e,t)=>{const i=S.value[t].input;return e===null||e===""||typeof e>"u"?(f.tableData[t].exp=0,!0):e>1440||e<0?(i.style.color="red",i.parentNode.setAttribute("style","box-shadow: 0 0 0 1px red inset;"),!1):(i.style.color=null,i.parentNode.removeAttribute("style"),!0)},q=(e,t)=>{const i=D.value[t].input;if(e===null||e===""||typeof e>"u"){i.style.color=null,i.parentNode.removeAttribute("style");const u=i.parentNode.querySelector(".error-msg");return u&&i.parentNode.removeChild(u),!0}try{JSON.parse(e),i.style.color=null,i.parentNode.removeAttribute("style");const u=i.parentNode.querySelector(".error-msg");return u&&i.parentNode.removeChild(u),!0}catch{if(i.style.color="red",i.parentNode.setAttribute("style","box-shadow: 0 0 0 1px red inset;"),!i.parentNode.querySelector(".error-msg")){const v=document.createElement("div");v.className="error-msg",v.innerText="格式错误",i.parentNode.appendChild(v)}return!1}},Y=(e,t)=>{const a={ticket:e.ticket},i="/ticket/delTicket";h.post({url:i,data:a}).then(()=>{f.tableData.splice(t,1)})},ee=(e,t)=>{const a="/ticket/saveTicket";V(e.exp,t)&&q(e.args,t)&&h.post({url:a,data:e}).then(()=>{e.isEdit=!1})},te=e=>{e.isEdit=!0},oe=()=>{B()},ne=()=>{const t=`/ticket/query/${g.resourceId}`;h.get({url:t}).then(a=>{f.tableData=a.data||[]})};return ke(()=>{ne()}),(e,t)=>{const a=M,i=de,u=$e,R=le,v=M,k=re,C=ce,A=ue,se=ie;return _(),x("div",Be,[r("div",Ve,[r("div",qe,[o(u,{class:"item",effect:"dark",content:e.$t("link_ticket.back"),placement:"top"},{default:s(()=>[r("span",Re,[o(i,{class:"custom-el-icon back-icon",onClick:p(B,["stop"])},{default:s(()=>[o(a,{class:"toolbar-icon",name:"icon_left_outlined"},{default:s(()=>[o(l(be),{class:"svg-icon toolbar-icon"})]),_:1})]),_:1})])]),_:1},8,["content"]),r("span",Ae,b("Ticket "+l(m)("commons.setting")),1)]),r("div",Le,[o(R,{modelValue:l(T),"onUpdate:modelValue":t[0]||(t[0]=n=>he(T)?T.value=n:null),onChange:H,label:l(m)("link_ticket.require")},null,8,["modelValue","label"])])]),r("div",Me,[o(k,{onClick:p(F,["stop"]),text:""},{icon:s(()=>[o(v,{name:"icon_add_outlined"},{default:s(()=>[o(l(xe),{class:"svg-icon"})]),_:1})]),default:s(()=>[z(" "+b(l(m)("commons.create")),1)]),_:1})]),r("div",Ue,[o(se,{data:f.tableData,style:{width:"100%"},size:"small"},{default:s(()=>[o(C,{prop:"ticket",label:"Ticket",width:"130"},{default:s(n=>[r("div",ze,[r("span",{title:n.row.ticket},b(n.row.ticket),9,Oe),o(u,{class:"item",effect:"dark",content:e.$t("commons.copy"),placement:"top"},{default:s(()=>[o(k,{text:"",onClick:p(c=>Q(n.row.ticket),["stop"])},{icon:s(()=>[o(a,{name:"de-copy"},{default:s(()=>[o(l(ge),{class:"svg-icon"})]),_:1})]),_:2},1032,["onClick"])]),_:2},1032,["content"]),o(u,{class:"item",effect:"dark",content:`${e.$t("link_ticket.refresh")} ticket`,placement:"top"},{default:s(()=>[o(k,{text:"",onClick:p(c=>W(n.row),["stop"])},{icon:s(()=>[o(a,{name:"icon_refresh_outlined"},{default:s(()=>[o(l(ve),{class:"svg-icon"})]),_:1})]),_:2},1032,["onClick"])]),_:2},1032,["content"])])]),_:1}),o(C,{prop:"exp",label:e.$t("visualization.over_time"),width:"100"},{header:s(()=>[r("div",je,[r("span",null,b(l(m)("visualization.over_time")),1),o(u,{class:"item",effect:"dark",content:l(m)("link_ticket.time_tips"),placement:"top"},{default:s(()=>[r("span",Je,[o(a,{name:"dv-info"},{default:s(()=>[o(l(ye),{class:"svg-icon"})]),_:1})])]),_:1},8,["content"])])]),default:s(n=>[n.row.isEdit?(_(),w(A,{key:0,ref:c=>J(c,n.$index),modelValue:n.row.exp,"onUpdate:modelValue":c=>n.row.exp=c,type:"number",placeholder:e.$t("commons.input_content"),min:"0",max:"1440",size:"small",onInput:c=>X(c,n.$index),onChange:c=>V(c,n.$index)},null,8,["modelValue","onUpdate:modelValue","placeholder","onInput","onChange"])):(_(),x("span",Ze,b(n.row.exp),1))]),_:1},8,["label"]),o(C,{prop:"args",label:e.$t("dataset.param")},{default:s(n=>[n.row.isEdit?(_(),w(A,{key:0,ref:c=>Z(c,n.$index),modelValue:n.row.args,"onUpdate:modelValue":c=>n.row.args=c,type:"text",placeholder:e.$t("commons.input_content"),maxlength:"200",size:"small",onChange:c=>q(c,n.$index)},null,8,["modelValue","onUpdate:modelValue","placeholder","onChange"])):(_(),x("span",He,b(n.row.args||"-"),1))]),_:1},8,["label"]),o(C,{label:e.$t("commons.operating"),width:"80"},{default:s(n=>[r("div",Pe,[o(u,{class:"item",effect:"dark",content:l(m)("commons.delete"),placement:"top"},{default:s(()=>[o(k,{text:"",onClick:p(c=>Y(n.row,n.$index),["stop"])},{icon:s(()=>[o(a,{name:"icon_delete-trash_outlined"},{default:s(()=>[o(l(Ce),{class:"svg-icon"})]),_:1})]),_:2},1032,["onClick"])]),_:2},1032,["content"]),o(u,{class:"item",effect:"dark",content:n.row.isEdit?e.$t("commons.save"):e.$t("commons.edit"),placement:"top"},{default:s(()=>[n.row.isEdit?(_(),w(k,{key:1,text:"",onClick:p(c=>ee(n.row,n.$index),["stop"])},{icon:s(()=>[o(a,{name:"edit-done"},{default:s(()=>[o(l(Ie),{class:"svg-icon"})]),_:1})]),_:2},1032,["onClick"])):(_(),w(k,{key:0,text:"",onClick:p(c=>te(n.row),["stop"])},{icon:s(()=>[o(a,{name:"icon_edit_outlined"},{default:s(()=>[o(l(we),{class:"svg-icon"})]),_:1})]),_:2},1032,["onClick"]))]),_:2},1032,["content"])])]),_:1},8,["label"])]),_:1},8,["data"])]),r("div",Fe,[o(k,{type:"primary",onClick:p(oe,["stop"])},{default:s(()=>t[1]||(t[1]=[z(" 完成 ")])),_:1})])])}}});const Ke=Ee(Ge,[["__scopeId","data-v-c1b24e9f"]]),ft=Object.freeze(Object.defineProperty({__proto__:null,default:Ke},Symbol.toStringTag,{value:"Module"}));export{Ke as S,Ne as a,ft as b,_t as s};
