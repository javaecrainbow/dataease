import"./index-0.0.0-dataease.js";import{E as G}from"./el-dialog-0.0.0-dataease.js";import{j as H,w as _,y as K,_ as P,n as Q}from"./index-0.0.0-dataease2.js";import"./el-form-0.0.0-dataease.js";import{E as Y}from"./el-upload-0.0.0-dataease.js";import"./el-progress-0.0.0-dataease.js";import{a as Z,E as ee}from"./el-form-item-0.0.0-dataease.js";import{d as te,_ as U,r as m,ab as ae,f as g,g as v,i as l,N as oe,k as s,a6 as y,a7 as h,j as n,U as u,ac as le,a0 as B,X as D}from"./vue-0.0.0-dataease.js";import{i as se}from"./icon_upload_outlined-0.0.0-dataease.js";import{u as ie,e as ne}from"./font-0.0.0-dataease.js";import re from"./FontInfo-0.0.0-dataease.js";import{d as T}from"./lodash-0.0.0-dataease.js";const me={class:"dialog-footer"},Fe=te({__name:"UploadDetail",emits:["finish"],setup(ue,{expose:S,emit:j}){const i=U({fileList:null}),f=m(!1),I=m(),{t:o}=H(),V=()=>{const a=new FormData;return a.append("file",i.fileList.raw),f.value=!0,ie(a).then(e=>{var r;t.size=e.data.size,t.sizeType=e.data.sizeType,t.fileTransName=e.data.fileTransName,t.fileName=i.fileList.raw.name,(r=I.value)==null||r.clearFiles()}).catch(e=>{e.code==="ECONNABORTED"&&_({type:"error",message:e.message,showClose:!0})}).finally(()=>{f.value=!1})},b=m(""),c=m(!1),d=m(""),E={id:null,name:"",fileName:"",fileTransName:"",size:0,sizeType:"",isDefault:0,isBuiltin:0,updateTime:0},t=U(T(E)),A=(a,e,r)=>{b.value=a||o("system.add_font"),d.value=e,c.value=!0,Object.assign(t,T(E)),Object.assign(t,JSON.parse(JSON.stringify(r)))},q=()=>{i.fileList=null},N=m(),M={name:[{required:!0,message:o("system.the_font_name"),trigger:"blur"},{min:1,max:50,message:o("system.character_length_1_50"),trigger:"blur"}]};S({init:A});const z=a=>a.name.endsWith(".ttf")?!0:(_.error(o("system.in_ttf_format")),!1),x=a=>{var e;(e=a.raw)!=null&&e.name.endsWith(".ttf")&&(i.fileList=a)},L=a=>{a.toString().replace("Error: ","")},R=j,F=()=>{Object.assign(t,T(E)),N.value.clearValidate(),i.fileList=null,c.value=!1},J=()=>{N.value.validate(a=>{if(a){if(d.value==="uploadFile"&&t.fileTransName===""){_.error(o("system.upload_font_file_de"));return}ne(t).then(()=>{_.success(b.value+o("data_set.success")),F(),R("finish")})}})};return(a,e)=>{const r=K,k=Z,W=P,p=Q,C=Y,X=ee,$=G,O=ae("loading");return g(),v($,{class:"create-dialog add-form_font_dialog",modelValue:c.value,"onUpdate:modelValue":e[2]||(e[2]=w=>c.value=w),"before-close":F,title:b.value,width:"420"},{footer:l(()=>[oe("div",me,[s(p,{onClick:F},{default:l(()=>[y(h(n(o)("userimport.cancel")),1)]),_:1}),u((g(),v(p,{type:"primary",onClick:J},{default:l(()=>[y(h(n(o)("userimport.sure")),1)]),_:1})),[[O,f.value]])])]),default:l(()=>[s(X,{onSubmit:e[1]||(e[1]=le(()=>{},["prevent"])),ref_key:"ruleFormRef",ref:N,model:t,"label-position":"top",rules:M,"label-width":"auto",class:"demo-ruleForm"},{default:l(()=>[d.value!=="uploadFile"?(g(),v(k,{key:0,label:n(o)("system.font_name"),prop:"name"},{default:l(()=>[s(r,{placeholder:n(o)("system.the_font_name"),modelValue:t.name,"onUpdate:modelValue":e[0]||(e[0]=w=>t.name=w),modelModifiers:{trim:!0}},null,8,["placeholder","modelValue"])]),_:1},8,["label"])):B("",!0),d.value!=="rename"?u((g(),v(k,{key:1,label:n(o)("system.font_file_de")},{default:l(()=>[u(s(C,{action:"",multiple:!1,ref:"uploadAgain","show-file-list":!1,accept:".ttf","on-change":x,"before-upload":z,"http-request":V,"on-error":L,name:"file"},{trigger:l(()=>[s(p,{secondary:""},{icon:l(()=>[s(W,{name:"icon_upload_outlined"},{default:l(()=>[s(n(se),{class:"svg-icon"})]),_:1})]),default:l(()=>[y(" "+h(n(o)("system.upload_font_file")),1)]),_:1})]),_:1},512),[[D,!i.fileList]]),u(s(re,{onDel:q,size:t.size+" "+t.sizeType,name:t.fileName},null,8,["size","name"]),[[D,i.fileList]]),u(s(C,{action:"",multiple:!1,ref:"uploadAgain","before-upload":z,"show-file-list":!1,accept:".ttf","on-change":x,"http-request":V,"on-error":L,name:"file"},{trigger:l(()=>[s(p,{text:""},{default:l(()=>[y(h(n(o)("data_source.reupload")),1)]),_:1})]),_:1},512),[[D,i.fileList]])]),_:1},8,["label"])),[[O,f.value]]):B("",!0)]),_:1},8,["model"])]),_:1},8,["modelValue","title"])}}});export{Fe as _};
