import{i as G,h as ae,ah as be,S as me,n as Ce,P as Ee,ay as ee,a3 as $e,M as we}from"./index-0.0.0-dataease.js";import{e as ge,z as Le,aB as Se,a0 as le,aa as ie,a8 as De,E as U,az as W,aA as Me}from"./index-0.0.0-dataease2.js";import{d as J,h as Ve,R as ke,m as N,e as w,f as k,M as _,a0 as O,g as A,ac as de,i as K,k as x,Z as se,V as S,N as Pe,r as q,aa as ye,a6 as Te,a7 as re,D as He,at as ce,Q as Ie,S as Ae,_ as _e,w as Y,aL as ze,o as Be,n as Oe}from"./vue-0.0.0-dataease.js";import{E as qe}from"./el-checkbox-0.0.0-dataease.js";import{E as Fe}from"./el-radio-0.0.0-dataease.js";import{g as Ue}from"./index-0.0.0-dataease4.js";import{c as ue}from"./strings-0.0.0-dataease.js";import{k as j,P as Ke,d as xe}from"./lodash-0.0.0-dataease.js";import{u as he,c as pe}from"./arrays-0.0.0-dataease.js";var Ze=J({name:"NodeContent",setup(){return{ns:G("cascader-node")}},render(){const{ns:e}=this,{node:n,panel:a}=this.$parent,{data:s,label:t}=n,{renderLabelFn:i}=a;return Ve("span",{class:e.e("label")},i?i({node:n,data:s}):t)}});const te=Symbol(),je=J({name:"ElCascaderNode",components:{ElCheckbox:qe,ElRadio:Fe,NodeContent:Ze,ElIcon:ge,Check:be,Loading:me,ArrowRight:Ce},props:{node:{type:Object,required:!0},menuId:String},emits:["expand"],setup(e,{emit:n}){const a=ke(te),s=G("cascader-node"),t=N(()=>a.isHoverMenu),i=N(()=>a.config.multiple),l=N(()=>a.config.checkStrictly),r=N(()=>{var h;return(h=a.checkedNodes[0])==null?void 0:h.uid}),u=N(()=>e.node.isDisabled),p=N(()=>e.node.isLeaf),f=N(()=>l.value&&!p.value||!u.value),y=N(()=>E(a.expandingNode)),b=N(()=>l.value&&a.checkedNodes.some(E)),E=h=>{var $;const{level:I,uid:Q}=e.node;return(($=h==null?void 0:h.pathNodes[I-1])==null?void 0:$.uid)===Q},D=()=>{y.value||a.expandNode(e.node)},z=h=>{const{node:$}=e;h!==$.checked&&a.handleCheckChange($,h)},L=()=>{a.lazyLoad(e.node,()=>{p.value||D()})},T=h=>{t.value&&(H(),!p.value&&n("expand",h))},H=()=>{const{node:h}=e;!f.value||h.loading||(h.loaded?D():L())},B=()=>{t.value&&!p.value||(p.value&&!u.value&&!l.value&&!i.value?M(!0):H())},F=h=>{l.value?(z(h),e.node.loaded&&D()):M(h)},M=h=>{e.node.loaded?(z(h),!l.value&&D()):L()};return{panel:a,isHoverMenu:t,multiple:i,checkStrictly:l,checkedNodeId:r,isDisabled:u,isLeaf:p,expandable:f,inExpandingPath:y,inCheckedPath:b,ns:s,handleHoverExpand:T,handleExpand:H,handleClick:B,handleCheck:M,handleSelectCheck:F}}}),Re=["id","aria-haspopup","aria-owns","aria-expanded","tabindex"],Xe=Pe("span",null,null,-1);function Ge(e,n,a,s,t,i){const l=w("el-checkbox"),r=w("el-radio"),u=w("node-content"),p=w("loading"),f=w("el-icon"),y=w("arrow-right"),b=w("check");return k(),_("li",{id:`${e.menuId}-${e.node.uid}`,role:"menuitem","aria-haspopup":!e.isLeaf,"aria-owns":e.isLeaf?null:e.menuId,"aria-expanded":e.inExpandingPath,tabindex:e.expandable?-1:void 0,class:S([e.ns.b(),e.ns.is("selectable",e.checkStrictly),e.ns.is("active",e.node.checked),e.ns.is("disabled",!e.expandable),e.inExpandingPath&&"in-active-path",e.inCheckedPath&&"in-checked-path"]),onMouseenter:n[2]||(n[2]=(...E)=>e.handleHoverExpand&&e.handleHoverExpand(...E)),onFocus:n[3]||(n[3]=(...E)=>e.handleHoverExpand&&e.handleHoverExpand(...E)),onClick:n[4]||(n[4]=(...E)=>e.handleClick&&e.handleClick(...E))},[O(" prefix "),e.multiple?(k(),A(l,{key:0,"model-value":e.node.checked,indeterminate:e.node.indeterminate,disabled:e.isDisabled,onClick:n[0]||(n[0]=de(()=>{},["stop"])),"onUpdate:modelValue":e.handleSelectCheck},null,8,["model-value","indeterminate","disabled","onUpdate:modelValue"])):e.checkStrictly?(k(),A(r,{key:1,"model-value":e.checkedNodeId,label:e.node.uid,disabled:e.isDisabled,"onUpdate:modelValue":e.handleSelectCheck,onClick:n[1]||(n[1]=de(()=>{},["stop"]))},{default:K(()=>[O(`
        Add an empty element to avoid render label,
        do not use empty fragment here for https://github.com/vuejs/vue-next/pull/2485
      `),Xe]),_:1},8,["model-value","label","disabled","onUpdate:modelValue"])):O("v-if",!0),O(" content "),x(u),O(" postfix "),e.isLeaf?e.isLeaf&&e.node.checked?(k(),A(f,{key:3,class:S(e.ns.e("postfix"))},{default:K(()=>[x(b)]),_:1},8,["class"])):O("v-if",!0):(k(),_(se,{key:2},[e.node.loading?(k(),A(f,{key:0,class:S([e.ns.is("loading"),e.ns.e("postfix")])},{default:K(()=>[x(p)]),_:1},8,["class"])):(k(),A(f,{key:1,class:S(["arrow-right",e.ns.e("postfix")])},{default:K(()=>[x(y)]),_:1},8,["class"]))],64))],42,Re)}var Je=ae(je,[["render",Ge],["__file","/Users/st/Desktop/vue/nxx-ui/packages/components/cascader-panel/src/node.vue"]]);const Qe=J({name:"ElCascaderMenu",components:{Loading:me,ElIcon:ge,ElScrollbar:Ee,ElCascaderNode:Je},props:{nodes:{type:Array,required:!0},index:{type:Number,required:!0}},setup(e){const n=He(),a=G("cascader-menu"),{t:s}=Le(),t=Ue();let i=null,l=null;const r=ke(te),u=q(null),p=N(()=>!e.nodes.length),f=N(()=>!r.initialLoaded),y=N(()=>`cascader-menu-${t}-${e.index}`),b=L=>{i=L.target},E=L=>{if(!(!r.isHoverMenu||!i||!u.value))if(i.contains(L.target)){D();const T=n.vnode.el,{left:H}=T.getBoundingClientRect(),{offsetWidth:B,offsetHeight:F}=T,M=L.clientX-H,h=i.offsetTop,$=h+i.offsetHeight;u.value.innerHTML=`
          <path style="pointer-events: auto;" fill="transparent" d="M${M} ${h} L${B} 0 V${h} Z" />
          <path style="pointer-events: auto;" fill="transparent" d="M${M} ${$} L${B} ${F} V${$} Z" />
        `}else l||(l=window.setTimeout(z,r.config.hoverThreshold))},D=()=>{l&&(clearTimeout(l),l=null)},z=()=>{u.value&&(u.value.innerHTML="",D())};return{ns:a,panel:r,hoverZone:u,isEmpty:p,isLoading:f,menuId:y,t:s,handleExpand:b,handleMouseMove:E,clearHoverZone:z}}});function We(e,n,a,s,t,i){const l=w("el-cascader-node"),r=w("loading"),u=w("el-icon"),p=w("el-scrollbar");return k(),A(p,{key:e.menuId,tag:"ul",role:"menu",class:S(e.ns.b()),"wrap-class":e.ns.e("wrap"),"view-class":[e.ns.e("list"),e.ns.is("empty",e.isEmpty)],onMousemove:e.handleMouseMove,onMouseleave:e.clearHoverZone},{default:K(()=>{var f;return[(k(!0),_(se,null,ye(e.nodes,y=>(k(),A(l,{key:y.uid,node:y,"menu-id":e.menuId,onExpand:e.handleExpand},null,8,["node","menu-id","onExpand"]))),128)),e.isLoading?(k(),_("div",{key:0,class:S(e.ns.e("empty-text"))},[x(u,{size:"14",class:S(e.ns.is("loading"))},{default:K(()=>[x(r)]),_:1},8,["class"]),Te(" "+re(e.t("el.cascader.loading")),1)],2)):e.isEmpty?(k(),_("div",{key:1,class:S(e.ns.e("empty-text"))},re(e.t("el.cascader.noData")),3)):(f=e.panel)!=null&&f.isHoverMenu?(k(),_("svg",{key:2,ref:"hoverZone",class:S(e.ns.e("hover-zone"))},null,2)):O("v-if",!0)]}),_:1},8,["class","wrap-class","view-class","onMousemove","onMouseleave"])}var Ye=ae(Qe,[["render",We],["__file","/Users/st/Desktop/vue/nxx-ui/packages/components/cascader-panel/src/menu.vue"]]);let en=0;const nn=e=>{const n=[e];let{parent:a}=e;for(;a;)n.unshift(a),a=a.parent;return n};class Z{constructor(n,a,s,t=!1){this.data=n,this.config=a,this.parent=s,this.root=t,this.uid=en++,this.checked=!1,this.indeterminate=!1,this.loading=!1;const{value:i,label:l,children:r}=a,u=n[r],p=nn(this);this.level=t?0:s?s.level+1:1,this.value=n[i],this.label=n[l],this.pathNodes=p,this.pathValues=p.map(f=>f.value),this.pathLabels=p.map(f=>f.label),this.childrenData=u,this.children=(u||[]).map(f=>new Z(f,a,this)),this.loaded=!a.lazy||this.isLeaf||!ee(u)}get isDisabled(){const{data:n,parent:a,config:s}=this,{disabled:t,checkStrictly:i}=s;return(ce(t)?t(n,this):!!n[t])||!i&&(a==null?void 0:a.isDisabled)}get isLeaf(){const{data:n,config:a,childrenData:s,loaded:t}=this,{lazy:i,leaf:l}=a,r=ce(l)?l(n,this):n[l];return $e(r)?i&&!t?!1:!(Array.isArray(s)&&s.length):!!r}get valueByOption(){return this.config.emitPath?this.pathValues:this.value}appendChild(n){const{childrenData:a,children:s}=this,t=new Z(n,this.config,this);return Array.isArray(a)?a.push(n):this.childrenData=[n],s.push(t),t}calcText(n,a){const s=n?this.pathLabels.join(a):this.label;return this.text=s,s}broadcast(n,...a){const s=`onParent${ue(n)}`;this.children.forEach(t=>{t&&(t.broadcast(n,...a),t[s]&&t[s](...a))})}emit(n,...a){const{parent:s}=this,t=`onChild${ue(n)}`;s&&(s[t]&&s[t](...a),s.emit(n,...a))}onParentCheck(n){this.isDisabled||this.setCheckState(n)}onChildCheck(){const{children:n}=this,a=n.filter(t=>!t.isDisabled),s=a.length?a.every(t=>t.checked):!1;this.setCheckState(s)}setCheckState(n){const a=this.children.length,s=this.children.reduce((t,i)=>{const l=i.checked?1:i.indeterminate?.5:0;return t+l},0);this.checked=this.loaded&&this.children.filter(t=>!t.isDisabled).every(t=>t.loaded&&t.checked)&&n,this.indeterminate=this.loaded&&s!==a&&s>0}doCheck(n){if(this.checked===n)return;const{checkStrictly:a,multiple:s}=this.config;a||!s?this.checked=n:(this.broadcast("check",n),this.setCheckState(n),this.emit("check"))}}const ne=(e,n)=>e.reduce((a,s)=>(s.isLeaf?a.push(s):(!n&&a.push(s),a=a.concat(ne(s.children,n))),a),[]);class fe{constructor(n,a){this.config=a;const s=(n||[]).map(t=>new Z(t,this.config));this.nodes=s,this.allNodes=ne(s,!1),this.leafNodes=ne(s,!0)}getNodes(){return this.nodes}getFlattedNodes(n){return n?this.leafNodes:this.allNodes}appendNode(n,a){const s=a?a.appendChild(n):new Z(n,this.config);a||this.nodes.push(s),this.allNodes.push(s),s.isLeaf&&this.leafNodes.push(s)}appendNodes(n,a){n.forEach(s=>this.appendNode(s,a))}getNodeByValue(n,a=!1){return!n&&n!==0?null:this.getFlattedNodes(a).find(t=>j(t.value,n)||j(t.pathValues,n))||null}getSameNode(n){return n&&this.getFlattedNodes(!1).find(({value:s,level:t})=>j(n.value,s)&&n.level===t)||null}}const an={modelValue:[Number,String,Array],options:{type:Array,default:()=>[]},props:{type:Object,default:()=>({})}},sn={expandTrigger:"click",multiple:!1,checkStrictly:!1,emitPath:!0,lazy:!1,lazyLoad:Ie,value:"value",label:"label",children:"children",leaf:"leaf",disabled:"disabled",hoverThreshold:500},tn=e=>N(()=>({...sn,...e.props})),ve=e=>{if(!e)return 0;const n=e.id.split("-");return Number(n[n.length-2])},on=e=>{if(!e)return;const n=e.querySelector("input");n?n.click():Se(e)&&e.click()},ln=(e,n)=>{const a=n.slice(0),s=a.map(i=>i.uid),t=e.reduce((i,l)=>{const r=s.indexOf(l.uid);return r>-1&&(i.push(l),a.splice(r,1),s.splice(r,1)),i},[]);return t.push(...a),t},dn=J({name:"ElCascaderPanel",components:{ElCascaderMenu:Ye},props:{...an,border:{type:Boolean,default:!0},renderLabel:Function},emits:[le,ie,"close","expand-change"],setup(e,{emit:n,slots:a}){let s=!1;const t=G("cascader"),i=tn(e);let l=null;const r=q(!0),u=q([]),p=q(null),f=q([]),y=q(null),b=q([]),E=N(()=>i.value.expandTrigger==="hover"),D=N(()=>e.renderLabel||a.default),z=()=>{const{options:o}=e,d=i.value;s=!1,l=new fe(o,d),f.value=[l.getNodes()],d.lazy&&ee(e.options)?(r.value=!1,L(void 0,c=>{c&&(l=new fe(c,d),f.value=[l.getNodes()]),r.value=!0,I(!1,!0)})):I(!1,!0)},L=(o,d)=>{const c=i.value;o=o||new Z({},c,void 0,!0),o.loading=!0;const v=m=>{const g=o,V=g.root?null:g;m&&(l==null||l.appendNodes(m,V)),g.loading=!1,g.loaded=!0,g.childrenData=g.childrenData||[],d&&d(m)};c.lazyLoad(o,v)},T=(o,d)=>{var c;const{level:v}=o,m=f.value.slice(0,v);let g;o.isLeaf?g=o.pathNodes[v-2]:(g=o,m.push(o.children)),((c=y.value)==null?void 0:c.uid)!==(g==null?void 0:g.uid)&&(y.value=o,f.value=m,!d&&n("expand-change",(o==null?void 0:o.pathValues)||[]))},H=(o,d,c=!0)=>{const{checkStrictly:v,multiple:m}=i.value,g=b.value[0];s=!0,!m&&(g==null||g.doCheck(!1)),o.doCheck(d),$(),c&&!m&&!v&&n("close"),!c&&!m&&!v&&B(o)},B=o=>{o&&(o=o.parent,B(o),o&&T(o))},F=o=>l==null?void 0:l.getFlattedNodes(o),M=o=>{var d;return(d=F(o))==null?void 0:d.filter(c=>c.checked!==!1)},h=()=>{b.value.forEach(o=>o.doCheck(!1)),$()},$=()=>{var o;const{checkStrictly:d,multiple:c}=i.value,v=b.value,m=M(!d),g=ln(v,m),V=g.map(C=>C.valueByOption);b.value=g,p.value=c?V:(o=V[0])!=null?o:null},I=(o=!1,d=!1)=>{const{modelValue:c}=e,{lazy:v,multiple:m,checkStrictly:g}=i.value,V=!g;if(!(!r.value||s||!d&&j(c,p.value)))if(v&&!o){const R=he(Ke(pe(c))).map(P=>l==null?void 0:l.getNodeByValue(P)).filter(P=>!!P&&!P.loaded&&!P.loading);R.length?R.forEach(P=>{L(P,()=>I(!1,d))}):I(!0,d)}else{const C=m?pe(c):[c],R=he(C.map(P=>l==null?void 0:l.getNodeByValue(P,V)));Q(R,d),p.value=xe(c)}},Q=(o,d=!0)=>{const{checkStrictly:c}=i.value,v=b.value,m=o.filter(C=>!!C&&(c||C.isLeaf)),g=l==null?void 0:l.getSameNode(y.value),V=d&&g||m[0];V?V.pathNodes.forEach(C=>T(C,!0)):y.value=null,v.forEach(C=>C.doCheck(!1)),m.forEach(C=>C.doCheck(!0)),b.value=m,Oe(oe)},oe=()=>{we&&u.value.forEach(o=>{const d=o==null?void 0:o.$el;if(d){const c=d.querySelector(`.${t.namespace.value}-scrollbar__wrap`),v=d.querySelector(`.${t.b("node")}.${t.is("active")}`)||d.querySelector(`.${t.b("node")}.in-active-path`);De(c,v)}})},Ne=o=>{const d=o.target,{code:c}=o;switch(c){case U.up:case U.down:{o.preventDefault();const v=c===U.up?-1:1;W(Me(d,v,`.${t.b("node")}[tabindex="-1"]`));break}case U.left:{o.preventDefault();const v=u.value[ve(d)-1],m=v==null?void 0:v.$el.querySelector(`.${t.b("node")}[aria-expanded="true"]`);W(m);break}case U.right:{o.preventDefault();const v=u.value[ve(d)+1],m=v==null?void 0:v.$el.querySelector(`.${t.b("node")}[tabindex="-1"]`);W(m);break}case U.enter:on(d);break}};return Ae(te,_e({config:i,expandingNode:y,checkedNodes:b,isHoverMenu:E,initialLoaded:r,renderLabelFn:D,lazyLoad:L,expandNode:T,handleCheckChange:H})),Y([i,()=>e.options],z,{deep:!0,immediate:!0}),Y(()=>e.modelValue,()=>{s=!1,I()},{deep:!0}),Y(()=>p.value,o=>{j(o,e.modelValue)||(n(le,o),n(ie,o))}),ze(()=>u.value=[]),Be(()=>!ee(e.modelValue)&&I()),{ns:t,menuList:u,menus:f,checkedNodes:b,handleKeyDown:Ne,handleCheckChange:H,getFlattedNodes:F,getCheckedNodes:M,clearCheckedNodes:h,calculateCheckedValue:$,scrollToExpandingNode:oe}}});function rn(e,n,a,s,t,i){const l=w("el-cascader-menu");return k(),_("div",{class:S([e.ns.b("panel"),e.ns.is("bordered",e.border)]),onKeydown:n[0]||(n[0]=(...r)=>e.handleKeyDown&&e.handleKeyDown(...r))},[(k(!0),_(se,null,ye(e.menus,(r,u)=>(k(),A(l,{key:u,ref_for:!0,ref:p=>e.menuList[u]=p,index:u,nodes:[...r]},null,8,["index","nodes"]))),128))],34)}var X=ae(dn,[["render",rn],["__file","/Users/st/Desktop/vue/nxx-ui/packages/components/cascader-panel/src/index.vue"]]);X.install=e=>{e.component(X.name,X)};const cn=X,Nn=cn;export{an as C,Nn as E,cn as _};
