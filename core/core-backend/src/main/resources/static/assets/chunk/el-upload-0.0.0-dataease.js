import{Q as E,d as F,r as ae,f as b,g as L,i as w,M as S,Z as pe,aa as fe,V as g,j as t,ad as oe,p as R,a0 as k,N as B,ac as T,k as U,a7 as G,W as ve,aB as me,I as ye,R as ge,s as I,w as J,aq as he,m as Q,a as be,S as ke,T as Ee,aw as Z,a5 as Y}from"./vue-0.0.0-dataease.js";import{m as V,z as $e,e as _,a1 as Re}from"./index-0.0.0-dataease2.js";import{t as X,l as q,x as y,i as j,aq as we,T as Ce,ah as Ue,E as Se,H as Le,ar as Fe,h as A,as as Pe,at as _e,a6 as Te,w as De}from"./index-0.0.0-dataease.js";import{E as Oe}from"./el-progress-0.0.0-dataease.js";import{h as ne}from"./lodash-0.0.0-dataease.js";const le=Symbol("uploadContextKey"),Be="ElUpload";class je extends Error{constructor(r,s,n,d){super(r),this.name="UploadAjaxError",this.status=s,this.method=n,this.url=d}}function x(a,r,s){let n;return s.response?n=`${s.response.error||s.response}`:s.responseText?n=`${s.responseText}`:n=`fail to ${r.method} ${a} ${s.status}`,new je(n,s.status,r.method,a)}function qe(a){const r=a.responseText||a.response;if(!r)return r;try{return JSON.parse(r)}catch{return r}}const Ne=a=>{typeof XMLHttpRequest>"u"&&X(Be,"XMLHttpRequest is undefined");const r=new XMLHttpRequest,s=a.action;r.upload&&r.upload.addEventListener("progress",c=>{const v=c;v.percent=c.total>0?c.loaded/c.total*100:0,a.onProgress(v)});const n=new FormData;if(a.data)for(const[c,v]of Object.entries(a.data))Array.isArray(v)?n.append(c,...v):n.append(c,v);n.append(a.filename,a.file,a.file.name),r.addEventListener("error",()=>{a.onError(x(s,a,r))}),r.addEventListener("load",()=>{if(r.status<200||r.status>=300)return a.onError(x(s,a,r));a.onSuccess(qe(r))}),r.open(a.method,s,!0),a.withCredentials&&"withCredentials"in r&&(r.withCredentials=!0);const d=a.headers||{};if(d instanceof Headers)d.forEach((c,v)=>r.setRequestHeader(v,c));else for(const[c,v]of Object.entries(d))ne(v)||r.setRequestHeader(c,String(v));return r.send(n),r},re=["text","picture","picture-card"];let Ae=1;const W=()=>Date.now()+Ae++,ie=q({action:{type:String,default:"#"},headers:{type:y(Object)},method:{type:String,default:"post"},data:{type:Object,default:()=>V({})},multiple:{type:Boolean,default:!1},name:{type:String,default:"file"},drag:{type:Boolean,default:!1},withCredentials:Boolean,showFileList:{type:Boolean,default:!0},accept:{type:String,default:""},type:{type:String,default:"select"},fileList:{type:y(Array),default:()=>V([])},autoUpload:{type:Boolean,default:!0},listType:{type:String,values:re,default:"text"},httpRequest:{type:y(Function),default:Ne},disabled:Boolean,limit:Number}),Me=q({...ie,beforeUpload:{type:y(Function),default:E},beforeRemove:{type:y(Function)},onRemove:{type:y(Function),default:E},onChange:{type:y(Function),default:E},onPreview:{type:y(Function),default:E},onSuccess:{type:y(Function),default:E},onProgress:{type:y(Function),default:E},onError:{type:y(Function),default:E},onExceed:{type:y(Function),default:E}}),He=q({files:{type:y(Array),default:()=>V([])},disabled:{type:Boolean,default:!1},handlePreview:{type:y(Function),default:E},listType:{type:String,values:re,default:"text"}}),Ke={remove:a=>!!a},ze=["onKeydown"],Ie=["src"],Ve=["onClick"],We=["onClick"],Xe=["onClick"],Ge=F({name:"ElUploadList"}),Je=F({...Ge,props:He,emits:Ke,setup(a,{emit:r}){const{t:s}=$e(),n=j("upload"),d=j("icon"),c=j("list"),v=ae(!1),C=u=>{r("remove",u)};return(u,m)=>(b(),L(me,{tag:"ul",class:g([t(n).b("list"),t(n).bm("list",u.listType),t(n).is("disabled",u.disabled)]),name:t(c).b()},{default:w(()=>[(b(!0),S(pe,null,fe(u.files,p=>(b(),S("li",{key:p.uid||p.name,class:g([t(n).be("list","item"),t(n).is(p.status),{focusing:v.value}]),tabindex:"0",onKeydown:oe($=>!u.disabled&&C(p),["delete"]),onFocus:m[0]||(m[0]=$=>v.value=!0),onBlur:m[1]||(m[1]=$=>v.value=!1),onClick:m[2]||(m[2]=$=>v.value=!1)},[R(u.$slots,"default",{file:p},()=>[u.listType==="picture"||p.status!=="uploading"&&u.listType==="picture-card"?(b(),S("img",{key:0,class:g(t(n).be("list","item-thumbnail")),src:p.url,alt:""},null,10,Ie)):k("v-if",!0),p.status==="uploading"||u.listType!=="picture-card"?(b(),S("div",{key:1,class:g(t(n).be("list","item-info"))},[B("a",{class:g(t(n).be("list","item-name")),onClick:T($=>u.handlePreview(p),["prevent"])},[U(t(_),{class:g(t(d).m("document"))},{default:w(()=>[U(t(we))]),_:1},8,["class"]),B("span",{class:g(t(n).be("list","item-file-name"))},G(p.name),3)],10,Ve),p.status==="uploading"?(b(),L(t(Oe),{key:0,type:u.listType==="picture-card"?"circle":"line","stroke-width":u.listType==="picture-card"?6:2,percentage:Number(p.percentage),style:ve(u.listType==="picture-card"?"":"margin-top: 0.5rem")},null,8,["type","stroke-width","percentage","style"])):k("v-if",!0)],2)):k("v-if",!0),B("label",{class:g(t(n).be("list","item-status-label"))},[u.listType==="text"?(b(),L(t(_),{key:0,class:g([t(d).m("upload-success"),t(d).m("circle-check")])},{default:w(()=>[U(t(Ce))]),_:1},8,["class"])):["picture-card","picture"].includes(u.listType)?(b(),L(t(_),{key:1,class:g([t(d).m("upload-success"),t(d).m("check")])},{default:w(()=>[U(t(Ue))]),_:1},8,["class"])):k("v-if",!0)],2),u.disabled?k("v-if",!0):(b(),L(t(_),{key:2,class:g(t(d).m("close")),onClick:$=>C(p)},{default:w(()=>[U(t(Se))]),_:2},1032,["class","onClick"])),k(" Due to close btn only appears when li gets focused disappears after li gets blurred, thus keyboard navigation can never reach close btn"),k(" This is a bug which needs to be fixed "),k(" TODO: Fix the incorrect navigation interaction "),u.disabled?k("v-if",!0):(b(),S("i",{key:3,class:g(t(d).m("close-tip"))},G(t(s)("el.upload.deleteTip")),3)),u.listType==="picture-card"?(b(),S("span",{key:4,class:g(t(n).be("list","item-actions"))},[B("span",{class:g(t(n).be("list","item-preview")),onClick:$=>u.handlePreview(p)},[U(t(_),{class:g(t(d).m("zoom-in"))},{default:w(()=>[U(t(Le))]),_:1},8,["class"])],10,We),u.disabled?k("v-if",!0):(b(),S("span",{key:0,class:g(t(n).be("list","item-delete")),onClick:$=>C(p)},[U(t(_),{class:g(t(d).m("delete"))},{default:w(()=>[U(t(Fe))]),_:1},8,["class"])],10,Xe))],2)):k("v-if",!0)])],42,ze))),128)),R(u.$slots,"append")]),_:3},8,["class","name"]))}});var ee=A(Je,[["__file","/Users/st/Desktop/vue/nxx-ui/packages/components/upload/src/upload-list.vue"]]);const Qe=q({disabled:{type:Boolean,default:!1}}),Ze={file:a=>ye(a)},Ye=["onDrop","onDragover"],ue="ElUploadDrag",xe=F({name:ue}),et=F({...xe,props:Qe,emits:Ze,setup(a,{emit:r}){const s=a,n=ge(le);n||X(ue,"usage: <el-upload><el-upload-dragger /></el-upload>");const d=j("upload"),c=ae(!1),v=u=>{if(s.disabled)return;c.value=!1;const m=Array.from(u.dataTransfer.files),p=n.accept.value;if(!p){r("file",m);return}const $=m.filter(l=>{const{type:e,name:o}=l,f=o.includes(".")?`.${o.split(".").pop()}`:"",h=e.replace(/\/.*$/,"");return p.split(",").map(i=>i.trim()).filter(i=>i).some(i=>i.startsWith(".")?f===i:/\/\*$/.test(i)?h===i.replace(/\/\*$/,""):/^[^/]+\/[^/]+$/.test(i)?e===i:!1)});r("file",$)},C=()=>{s.disabled||(c.value=!0)};return(u,m)=>(b(),S("div",{class:g([t(d).b("dragger"),t(d).is("dragover",c.value)]),onDrop:T(v,["prevent"]),onDragover:T(C,["prevent"]),onDragleave:m[0]||(m[0]=T(p=>c.value=!1,["prevent"]))},[R(u.$slots,"default")],42,Ye))}});var tt=A(et,[["__file","/Users/st/Desktop/vue/nxx-ui/packages/components/upload/src/upload-dragger.vue"]]);const st=q({...ie,beforeUpload:{type:y(Function),default:E},onRemove:{type:y(Function),default:E},onStart:{type:y(Function),default:E},onSuccess:{type:y(Function),default:E},onProgress:{type:y(Function),default:E},onError:{type:y(Function),default:E},onExceed:{type:y(Function),default:E}}),at=["onKeydown"],ot=["name","multiple","accept"],nt=F({name:"ElUploadContent",inheritAttrs:!1}),lt=F({...nt,props:st,setup(a,{expose:r}){const s=a,n=j("upload"),d=I({}),c=I(),v=e=>{if(e.length===0)return;const{autoUpload:o,limit:f,fileList:h,multiple:i,onStart:N,onExceed:P}=s;if(f&&h.length+e.length>f){P(e,h);return}i||(e=e.slice(0,1));for(const M of e){const D=M;D.uid=W(),N(D),o&&C(D)}},C=async e=>{if(c.value.value="",!s.beforeUpload)return u(e);let o;try{o=await s.beforeUpload(e)}catch{o=!1}if(o===!1){s.onRemove(e);return}let f=e;o instanceof Blob&&(o instanceof File?f=o:f=new File([o],e.name,{type:e.type})),u(Object.assign(f,{uid:e.uid}))},u=e=>{const{headers:o,data:f,method:h,withCredentials:i,name:N,action:P,onProgress:M,onSuccess:D,onError:de,httpRequest:ce}=s,{uid:H}=e,K={headers:o||{},withCredentials:i,file:e,data:f,method:h,filename:N,action:P,onProgress:O=>{M(O,e)},onSuccess:O=>{D(O,e),delete d.value[H]},onError:O=>{de(O,e),delete d.value[H]}},z=ce(K);d.value[H]=z,z instanceof Promise&&z.then(K.onSuccess,K.onError)},m=e=>{const o=e.target.files;o&&v(Array.from(o))},p=()=>{s.disabled||(c.value.value="",c.value.click())},$=()=>{p()};return r({abort:e=>{Pe(d.value).filter(e?([f])=>String(e.uid)===f:()=>!0).forEach(([f,h])=>{h instanceof XMLHttpRequest&&h.abort(),delete d.value[f]})},upload:C}),(e,o)=>(b(),S("div",{class:g([t(n).b(),t(n).m(e.listType),t(n).is("drag",e.drag)]),tabindex:"0",onClick:p,onKeydown:oe(T($,["self"]),["enter","space"])},[e.drag?(b(),L(tt,{key:0,disabled:e.disabled,onFile:v},{default:w(()=>[R(e.$slots,"default")]),_:3},8,["disabled"])):R(e.$slots,"default",{key:1}),B("input",{ref_key:"inputRef",ref:c,class:g(t(n).e("input")),name:e.name,multiple:e.multiple,accept:e.accept,type:"file",onChange:m,onClick:o[0]||(o[0]=T(()=>{},["stop"]))},null,42,ot)],42,at))}});var te=A(lt,[["__file","/Users/st/Desktop/vue/nxx-ui/packages/components/upload/src/upload-content.vue"]]);const se="ElUpload",rt=a=>{var r;(r=a.url)!=null&&r.startsWith("blob:")&&URL.revokeObjectURL(a.url)},it=(a,r)=>{const s=_e(a,"fileList",void 0,{passive:!0}),n=l=>s.value.find(e=>e.uid===l.uid);function d(l){var e;(e=r.value)==null||e.abort(l)}function c(l=["ready","uploading","success","fail"]){s.value=s.value.filter(e=>!l.includes(e.status))}const v=(l,e)=>{const o=n(e);o&&(console.error(l),o.status="fail",s.value.splice(s.value.indexOf(o),1),a.onError(l,o,s.value),a.onChange(o,s.value))},C=(l,e)=>{const o=n(e);o&&(a.onProgress(l,o,s.value),o.status="uploading",o.percentage=Math.round(l.percent))},u=(l,e)=>{const o=n(e);o&&(o.status="success",o.response=l,a.onSuccess(l,o,s.value),a.onChange(o,s.value))},m=l=>{ne(l.uid)&&(l.uid=W());const e={name:l.name,percentage:0,status:"ready",size:l.size,raw:l,uid:l.uid};if(a.listType==="picture-card"||a.listType==="picture")try{e.url=URL.createObjectURL(l)}catch(o){Te(se,o.message),a.onError(o,e,s.value)}s.value=[...s.value,e],a.onChange(e,s.value)},p=async l=>{const e=l instanceof File?n(l):l;e||X(se,"file to be removed not found");const o=f=>{d(f);const h=s.value;h.splice(h.indexOf(f),1),a.onRemove(f,h),rt(f)};a.beforeRemove?await a.beforeRemove(e,s.value)!==!1&&o(e):o(e)};function $(){s.value.filter(({status:l})=>l==="ready").forEach(({raw:l})=>{var e;return l&&((e=r.value)==null?void 0:e.upload(l))})}return J(()=>a.listType,l=>{l!=="picture-card"&&l!=="picture"||(s.value=s.value.map(e=>{const{raw:o,url:f}=e;if(!f&&o)try{e.url=URL.createObjectURL(o)}catch(h){a.onError(h,e,s.value)}return e}))}),J(s,l=>{for(const e of l)e.uid||(e.uid=W()),e.status||(e.status="success")},{immediate:!0,deep:!0}),{uploadFiles:s,abort:d,clearFiles:c,handleError:v,handleProgress:C,handleStart:m,handleSuccess:u,handleRemove:p,submit:$}},ut=F({name:"ElUpload"}),dt=F({...ut,props:Me,setup(a,{expose:r}){const s=a,n=he(),d=Re(),c=I(),{abort:v,submit:C,clearFiles:u,uploadFiles:m,handleStart:p,handleError:$,handleRemove:l,handleSuccess:e,handleProgress:o}=it(s,c),f=Q(()=>s.listType==="picture-card"),h=Q(()=>({...s,fileList:m.value,onStart:p,onProgress:o,onSuccess:e,onError:$,onRemove:l}));return be(()=>{m.value.forEach(({url:i})=>{i!=null&&i.startsWith("blob:")&&URL.revokeObjectURL(i)})}),ke(le,{accept:Ee(s,"accept")}),r({abort:v,submit:C,clearFiles:u,handleStart:p,handleRemove:l}),(i,N)=>(b(),S("div",null,[t(f)&&i.showFileList?(b(),L(ee,{key:0,disabled:t(d),"list-type":i.listType,files:t(m),"handle-preview":i.onPreview,onRemove:t(l)},Z({append:w(()=>[U(te,Y({ref_key:"uploadRef",ref:c},t(h)),{default:w(()=>[t(n).trigger?R(i.$slots,"trigger",{key:0}):k("v-if",!0),!t(n).trigger&&t(n).default?R(i.$slots,"default",{key:1}):k("v-if",!0)]),_:3},16)]),_:2},[i.$slots.file?{name:"default",fn:w(({file:P})=>[R(i.$slots,"file",{file:P})])}:void 0]),1032,["disabled","list-type","files","handle-preview","onRemove"])):k("v-if",!0),!t(f)||t(f)&&!i.showFileList?(b(),L(te,Y({key:1,ref_key:"uploadRef",ref:c},t(h)),{default:w(()=>[t(n).trigger?R(i.$slots,"trigger",{key:0}):k("v-if",!0),!t(n).trigger&&t(n).default?R(i.$slots,"default",{key:1}):k("v-if",!0)]),_:3},16)):k("v-if",!0),i.$slots.trigger?R(i.$slots,"default",{key:2}):k("v-if",!0),R(i.$slots,"tip"),!t(f)&&i.showFileList?(b(),L(ee,{key:3,disabled:t(d),"list-type":i.listType,files:t(m),"handle-preview":i.onPreview,onRemove:t(l)},Z({_:2},[i.$slots.file?{name:"default",fn:w(({file:P})=>[R(i.$slots,"file",{file:P})])}:void 0]),1032,["disabled","list-type","files","handle-preview","onRemove"])):k("v-if",!0)]))}});var ct=A(dt,[["__file","/Users/st/Desktop/vue/nxx-ui/packages/components/upload/src/upload.vue"]]);const gt=De(ct);export{gt as E};
