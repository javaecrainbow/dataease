import{j as ve,k as fe,w as Te,e as be,n as we,y as ye,_ as ke}from"./index-0.0.0-dataease2.js";import{a as Se,b as ge,u as Ce}from"./index-0.0.0-dataease.js";import{E as xe}from"./el-tree-0.0.0-dataease.js";import"./el-checkbox-0.0.0-dataease.js";import"./el-tag-0.0.0-dataease.js";import{E as Fe,a as Ee}from"./el-select-0.0.0-dataease.js";import"./el-popper-0.0.0-dataease.js";import{E as Me}from"./el-row-0.0.0-dataease.js";import{E as Pe}from"./el-divider-0.0.0-dataease.js";import{d as Ie,r as B,m as w,_ as Ae,w as E,o as Ve,n as C,e as Z,ab as Ue,f as m,M as y,U as _,X as v,g as h,i as o,k as l,N as f,a7 as T,a6 as M,j as u,a0 as x,Z as k,aa as P,V as Ne}from"./vue-0.0.0-dataease.js";import{n as Oe,a as Re}from"./templateMarket-0.0.0-dataease.js";import{useAppStoreWithOut as Le}from"./app-0.0.0-dataease.js";import{e as We}from"./antv-0.0.0-dataease.js";import ze from"./MarketPreviewV2-0.0.0-dataease.js";import{i as $}from"./imgUtils-0.0.0-dataease.js";import J from"./CategoryTemplateV2-0.0.0-dataease.js";import{i as De}from"./interactive-0.0.0-dataease.js";import{g as j}from"./base64-0.0.0-dataease.js";import{_ as Be}from"./_plugin-vue_export-helper-0.0.0-dataease.js";import"./axios-0.0.0-dataease.js";import"./lodash-0.0.0-dataease.js";import"./library-0.0.0-dataease.js";import"./echarts-0.0.0-dataease.js";import"./tinymce-0.0.0-dataease.js";import"./user-0.0.0-dataease.js";import"./index-0.0.0-dataease12.js";import"./index-0.0.0-dataease4.js";import"./index-0.0.0-dataease14.js";import"./strings-0.0.0-dataease.js";import"./index-0.0.0-dataease5.js";import"./row-0.0.0-dataease.js";import"./el-col-0.0.0-dataease.js";import"./el-collapse-item-0.0.0-dataease.js";import"./el-tooltip-0.0.0-dataease.js";import"./icon_left_outlined-0.0.0-dataease.js";import"./TemplateMarketPreviewItem-0.0.0-dataease.js";import"./dvMain-0.0.0-dataease.js";import"./chart-0.0.0-dataease.js";import"./formatter-0.0.0-dataease.js";import"./dataVisualization-0.0.0-dataease2.js";import"./util-0.0.0-dataease.js";import"./util-0.0.0-dataease2.js";import"./chart-0.0.0-dataease2.js";import"./extends-0.0.0-dataease.js";import"./sysParameter-0.0.0-dataease.js";import"./TableTooltip-0.0.0-dataease.js";import"./_commonjs-dynamic-modules-0.0.0-dataease.js";import"./appearance-0.0.0-dataease.js";import"./font-0.0.0-dataease.js";import"./TemplateMarketV2Item-0.0.0-dataease.js";import"./dataVisualization-0.0.0-dataease.js";import"./dataset-0.0.0-dataease.js";import"./datasource-0.0.0-dataease.js";const Ze=["src"],$e={class:"template-left"},Je={id:"template-show-area",class:"template-right"},je={style:{"text-align":"center"}},qe=Ie({__name:"index",emits:["close"],setup(He,{expose:q,emit:H}){const{t:n}=ve(),{wsCache:O}=Se(),S=ge(),R=Le(),X=De(),c=B("full"),G=H,L=()=>{G("close")},K=w(()=>e.curPosition==="branch"?n("work_branch.template_center"):n("work_branch.new_using_template")),Q=w(()=>R.getIsDataEaseBi||R.getIsIframe),e=Ae({initReady:!0,curPosition:"branch",pid:null,treeProps:{value:"label",label:"label"},templateType:"all",templateSourceType:"all",templateClassifyType:"all",treeShow:!0,templateClassifyOptions:[{value:"all",label:n("visualization.all_type")},{value:"app",label:n("visualization.apply_template")},{value:"template",label:n("visualization.style_template")}],templateSourceOptions:[{value:"all",label:n("work_branch.all_source")},{value:"market",label:n("visualization.template_market")},{value:"manage",label:n("template_manage.name")}],templateTypeOptions:[{value:"all",label:n("work_branch.all_types")},{value:"PANEL",label:n("work_branch.dashboard")},{value:"SCREEN",label:n("work_branch.big_data_screen")}],loading:!1,hasResult:!0,templateMiniWidth:250,templateCurWidth:310,templateSpan:"25%",previewVisible:!1,templatePreviewId:"",marketTabs:[],marketActiveTab:null,searchText:null,dvCreateForm:{resourceName:null,name:null,pid:null,nodeType:"panel",templateUrl:null,newFrom:"new_market_template",templateId:null,panelType:"self",panelStyle:{},panelData:"[]"},panelGroupList:[],curApplyTemplate:null,folderSelectShow:!1,baseUrl:"https://dataease.io/templates",currentMarketTemplateShowList:[],curTemplateShowFilter:[],curTemplateIndex:0,curTemplate:null,networkStatus:!0,rule:{name:[{required:!0,message:n("visualization.template_name_tips"),trigger:"blur"}],pid:[{required:!0,message:"",trigger:"blur"}]}}),I=w(()=>{var a,s,i,d;const t=X.getData;return{PANEL:((a=t[0])==null?void 0:a.menuAuth)&&((s=t[0])==null?void 0:s.anyManage),SCREEN:((i=t[1])==null?void 0:i.menuAuth)&&((d=t[1])==null?void 0:d.anyManage)}}),W=w(()=>{let t;return e.templateSourceType==="all"?t=e.marketTabs:t=e.marketTabs.filter(a=>a.source==="public"||a.source===e.templateSourceType),t}),Y=w(()=>e.curTemplate.thumbnail.indexOf("http")>-1||e.curTemplate.thumbnail.indexOf("static-resource")>-1?$(e.curTemplate.thumbnail):$(e.baseUrl+e.curTemplate.thumbnail)),ee=w(()=>e.curPosition==="branch"&&c.value!=="marketPreview"),te=t=>{e.initReady=!1,e.curPosition=t.curPosition,e.templateType=t.templateType,c.value="full",e.pid=t.pid,C(()=>{e.initReady=!0})};E(()=>e.searchText,()=>{b()}),E(()=>e.templateType,()=>{b()}),E(()=>e.templateSourceType,()=>{e.treeShow=!1,b(),C(()=>{e.treeShow=!0,A()})}),E(()=>e.templateClassifyType,()=>{e.treeShow=!1,b(),C(()=>{e.treeShow=!0,A()})});const ae=t=>{e.marketActiveTab=t.label,b()},le=()=>{c.value="full"},re=async()=>{await Re().then(t=>{e.baseUrl=t.data.baseUrl,e.currentMarketTemplateShowList=t.data.contents,e.marketTabs=t.data.categories,e.marketActiveTab=e.marketTabs[1].label,A(),b()}).catch(()=>{e.networkStatus=!1})},A=()=>{C(()=>{const t=document.querySelector(".custom-market-tree"),a=document.createElement("hr");a.classList.add("custom-line"),t.firstElementChild.appendChild(a)})},oe=()=>{e.curTemplateIndex>0&&(e.curTemplateIndex--,e.curTemplate=e.curTemplateShowFilter[e.curTemplateIndex])},ne=()=>{e.curTemplateIndex<e.curTemplateShowFilter.length-1&&(e.curTemplateIndex++,e.curTemplate=e.curTemplateShowFilter[e.curTemplateIndex])},F=t=>{e.curApplyTemplate=t,e.dvCreateForm.name=t.title,e.dvCreateForm.nodeType=t.templateType,t.source==="market"?(e.dvCreateForm.newFrom="new_market_template",e.dvCreateForm.templateUrl=t.metas.theme_repo,e.dvCreateForm.resourceName=t.id):(e.dvCreateForm.newFrom="new_inner_template",e.dvCreateForm.templateId=t.id),se()},se=t=>{if(e.dvCreateForm.newFrom==="new_market_template"&&!e.dvCreateForm.templateUrl)return Te.warning(n("template_manage.get_download_link_hint")),!1;const a={newFrom:e.dvCreateForm.newFrom,templateUrl:e.dvCreateForm.templateUrl,resourceName:e.dvCreateForm.resourceName,templateId:e.dvCreateForm.templateId};e.curApplyTemplate.recentUseTime=Date.now(),e.curApplyTemplate.categoryNames.push(n("work_branch.recent"));const s=(["dataV","SCREEN"].includes(e.dvCreateForm.nodeType)?"#/dvCanvas?opt=create&createType=template":"#/dashboard?opt=create&createType=template")+"&templateParams="+encodeURIComponent(j.encode(JSON.stringify(a)));let i=null;if(Q.value){S.clearState(),S.setCreateType("template"),S.setTemplateParams(encodeURIComponent(j.encode(JSON.stringify(a)))),S.setOpt("create"),e.pid&&S.setPid(e.pid),Ce().emitter.emit("changeCurrentComponent",["dataV","SCREEN"].includes(e.dvCreateForm.nodeType)?"VisualizationEditor":"DashboardEditor");return}e.pid?i=window.open(s+`&pid=${e.pid}`,"_blank"):i=window.open(s,"_blank"),ie(i)},g=B(null),ie=t=>{if(g!=null&&g.value){const a={methodName:"initOpenHandler",args:t};g.value.invokeMethod(a)}},b=()=>{let t=!1;e.currentMarketTemplateShowList.forEach(a=>{a.showFlag=pe(a),a.showFlag&&(t=!0)}),e.currentMarketTemplateShowList.length>0&&(e.hasResult=t)},pe=t=>{let a=!1,s=!1,i=!1,d=!1;return(!e.searchText||t.title.indexOf(e.searchText)>-1)&&(a=!0),(e.templateType==="all"||t.templateType===e.templateType)&&(s=!0),(e.templateSourceType==="all"||t.source===e.templateSourceType)&&(i=!0),(e.templateClassifyType==="all"||t.classify===e.templateClassifyType)&&(d=!0),a&&s&&i&&d},V=t=>{e.curPosition==="branch"?(e.templatePreviewId=t,c.value="marketPreview"):(e.curTemplateShowFilter=e.marketActiveTab===n("work_branch.recommend")?e.currentMarketTemplateShowList.filter(a=>a.showFlag):e.currentMarketTemplateShowList.filter(a=>{var s;return a.showFlag&&((s=a.categoryNames)==null?void 0:s.includes(e.marketActiveTab))}),e.curTemplateIndex=e.curTemplateShowFilter.findIndex(a=>a.id===t),e.curTemplate=e.curTemplateShowFilter[e.curTemplateIndex],c.value="createPreview")};Ve(()=>{me(),re();const t=We(),a=document.getElementById("template-show-area");a&&t.listenTo(a,()=>{C(()=>{const s=a.offsetWidth-26,i=Math.trunc(s/e.templateMiniWidth);e.templateSpan=100/Math.trunc(s/e.templateMiniWidth)+"%",e.templateCurWidth=Math.trunc(s/i)-33})})});const me=()=>{const t=O.get("template-preview-id");t&&(V(t),O.delete("template-preview-id"))};return q({optInit:te}),(t,a)=>{const s=Z("ArrowLeft"),i=be,d=we,z=Pe,D=Z("Close"),p=Me,ue=ye,U=Fe,N=Ee,ce=xe,de=ke,he=Ue("loading");return m(),y(k,null,[_((m(),h(p,{class:Ne(["template-outer-body",{"template-outer-body-padding":ee.value}])},{default:o(()=>[_(l(ze,{"preview-id":e.templatePreviewId,"create-auth":I.value,onClosePreview:le,onTemplateApply:F},null,8,["preview-id","create-auth"]),[[v,c.value==="marketPreview"]]),c.value==="createPreview"?(m(),h(p,{key:0,class:"main-container"},{default:o(()=>[l(p,{class:"market-head"},{default:o(()=>[l(i,{class:"custom-back-icon hover-icon",onClick:a[0]||(a[0]=r=>c.value="full")},{default:o(()=>[l(s)]),_:1}),f("span",null,T(e.curTemplate.title),1),l(p,{class:"head-right"},{default:o(()=>[l(d,{secondary:"",disabled:e.curTemplateIndex===0,style:{float:"right"},onClick:oe},{default:o(()=>[M(T(u(n)("work_branch.last")),1)]),_:1},8,["disabled"]),l(d,{disabled:e.curTemplateIndex===e.curTemplateShowFilter.length-1,style:{float:"right"},secondary:"",onClick:ne},{default:o(()=>[M(T(u(n)("work_branch.next")),1)]),_:1},8,["disabled"]),l(d,{style:{float:"right"},type:"primary",onClick:a[1]||(a[1]=r=>F(e.curTemplate))},{default:o(()=>[M(T(u(n)("visualization.apply_this_template")),1)]),_:1}),l(z,{class:"custom-divider-line",direction:"vertical"}),l(i,{class:"custom-market-icon hover-icon_custom",onClick:L},{default:o(()=>[l(D)]),_:1})]),_:1})]),_:1}),l(p,{class:"template-area"},{default:o(()=>[l(p,{class:"img-main-create"},{default:o(()=>[f("img",{style:{height:"100%"},src:Y.value,alt:""},null,8,Ze)]),_:1})]),_:1})]),_:1})):x("",!0),_(l(p,{class:"main-container"},{default:o(()=>[l(p,{class:"market-head"},{default:o(()=>[f("span",null,T(K.value),1),l(p,{class:"head-right"},{default:o(()=>[l(ue,{class:"title-search",modelValue:e.searchText,"onUpdate:modelValue":a[2]||(a[2]=r=>e.searchText=r),"prefix-icon":"Search",placeholder:u(n)("visualization.enter_template_name_tips"),clearable:!0},null,8,["modelValue","placeholder"]),l(N,{class:"title-type",modelValue:e.templateSourceType,"onUpdate:modelValue":a[3]||(a[3]=r=>e.templateSourceType=r),placeholder:"Select"},{default:o(()=>[(m(!0),y(k,null,P(e.templateSourceOptions,r=>(m(),h(U,{key:r.value,label:r.label,value:r.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),["branchCreate","branch"].includes(e.curPosition)?(m(),h(N,{key:0,class:"title-type",modelValue:e.templateType,"onUpdate:modelValue":a[4]||(a[4]=r=>e.templateType=r),placeholder:"Select"},{default:o(()=>[(m(!0),y(k,null,P(e.templateTypeOptions,r=>(m(),h(U,{key:r.value,label:r.label,value:r.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])):x("",!0),l(N,{class:"title-type",modelValue:e.templateClassifyType,"onUpdate:modelValue":a[5]||(a[5]=r=>e.templateClassifyType=r),placeholder:"Select"},{default:o(()=>[(m(!0),y(k,null,P(e.templateClassifyOptions,r=>(m(),h(U,{key:r.value,label:r.label,value:r.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),["branchCreate","create"].includes(e.curPosition)?(m(),y(k,{key:1},[l(z,{class:"custom-divider-line",direction:"vertical"}),l(i,{class:"custom-market-icon hover-icon_custom",onClick:L},{default:o(()=>[l(D)]),_:1})],64)):x("",!0)]),_:1})]),_:1}),l(p,{class:"template-area"},{default:o(()=>[f("div",$e,[e.treeShow?(m(),h(ce,{key:0,menu:"",class:"custom-market-tree",modelValue:e.marketActiveTab,"onUpdate:modelValue":a[6]||(a[6]=r=>e.marketActiveTab=r),data:W.value,props:e.treeProps,"node-key":"label","default-expand-all":"","highlight-current":"","current-node-key":e.marketActiveTab,onNodeClick:ae},null,8,["modelValue","data","props","current-node-key"])):x("",!0)]),_(f("div",Je,[_(l(p,null,{default:o(()=>[l(J,{"search-text":e.searchText,label:e.marketActiveTab,"full-template-show-list":e.currentMarketTemplateShowList,"template-span":e.templateSpan,"base-url":e.baseUrl,"template-cur-width":e.templateCurWidth,"cur-position":e.curPosition,"create-auth":I.value,onTemplateApply:F,onTemplatePreview:V},null,8,["search-text","label","full-template-show-list","template-span","base-url","template-cur-width","cur-position","create-auth"])]),_:1},512),[[v,e.marketActiveTab!==u(n)("work_branch.recommend")]]),_(l(p,null,{default:o(()=>[(m(!0),y(k,null,P(W.value,(r,_e)=>(m(),h(p,{style:{display:"inline",width:"100%","margin-bottom":"16px"},key:_e},{default:o(()=>[r.label!==u(n)("work_branch.recent")?(m(),h(J,{key:0,"search-text":e.searchText,label:r.label,"full-template-show-list":e.currentMarketTemplateShowList,"template-span":e.templateSpan,"base-url":e.baseUrl,"template-cur-width":e.templateCurWidth,"cur-position":e.curPosition,"create-auth":I.value,onTemplateApply:F,onTemplatePreview:V},null,8,["search-text","label","full-template-show-list","template-span","base-url","template-cur-width","cur-position","create-auth"])):x("",!0)]),_:2},1024))),128))]),_:1},512),[[v,e.marketActiveTab===u(n)("work_branch.recommend")]])],512),[[v,e.networkStatus&&e.hasResult]]),_(l(p,{class:"template-empty"},{default:o(()=>[f("div",je,[l(de,{name:"no_result"},{default:o(()=>[l(u(Oe),{style:{"margin-bottom":"16px","font-size":"75px"},class:"svg-icon"})]),_:1}),a[7]||(a[7]=f("br",null,null,-1)),f("span",null,T(u(n)("work_branch.relevant_templates_found")),1)])]),_:1},512),[[v,e.networkStatus&&!e.hasResult]]),_(l(p,{class:"template-empty"},{default:o(()=>[M(T(u(n)("visualization.market_network_tips")),1)]),_:1},512),[[v,!e.networkStatus]])]),_:1})]),_:1},512),[[v,c.value==="full"]])]),_:1},8,["class"])),[[he,e.loading],[v,e.initReady]]),l(u(fe),{ref_key:"openHandler",ref:g,jsname:"L2NvbXBvbmVudC9lbWJlZGRlZC1pZnJhbWUvT3BlbkhhbmRsZXI="},null,512)],64)}}});const Ht=Be(qe,[["__scopeId","data-v-06666f70"]]);export{Ht as default};
