import{z as fe}from"./index-0.0.0-dataease.js";import{E as me}from"./el-tree-0.0.0-dataease.js";import"./el-checkbox-0.0.0-dataease.js";import{x as _e,e as ee,y as ve,j as he,_ as ge}from"./index-0.0.0-dataease2.js";import"./el-tag-0.0.0-dataease.js";import"./el-select-0.0.0-dataease.js";import"./el-popper-0.0.0-dataease.js";import{E as Ce}from"./el-tree-select-0.0.0-dataease.js";import"./el-tooltip-0.0.0-dataease.js";import{f as d,M as L,a8 as ye,N as s,d as xe,s as D,r as u,m as te,w as we,k as o,i as l,a6 as V,a7 as h,j as n,W as oe,Z as ke,aa as Le,g as f,a0 as k,V as _,ac as Ee,ad as Me,n as le,q as N,U as ae,X as se}from"./vue-0.0.0-dataease.js";import{c as Be}from"./copilot-0.0.0-dataease.js";import{i as Ie}from"./icon_right_outlined-0.0.0-dataease.js";import{i as Te}from"./icon_left_outlined-0.0.0-dataease.js";import{d as $e}from"./dv-folder-0.0.0-dataease.js";import{i as Fe}from"./icon_dataset-0.0.0-dataease.js";import{i as ie}from"./icon_expand-right_filled-0.0.0-dataease.js";import{g as Se,a as be,c as qe,b as De,d as Ve}from"./dataset-0.0.0-dataease.js";import{f as I}from"./attr-0.0.0-dataease20.js";import R from"./DialogueChart-0.0.0-dataease.js";import{i as ne}from"./field-list-0.0.0-dataease.js";import{d as Ne}from"./lodash-0.0.0-dataease.js";import{E as Re}from"./index-0.0.0-dataease4.js";import{_ as ze}from"./_plugin-vue_export-helper-0.0.0-dataease.js";import"./library-0.0.0-dataease.js";import"./index-0.0.0-dataease12.js";import"./axios-0.0.0-dataease.js";import"./echarts-0.0.0-dataease.js";import"./tinymce-0.0.0-dataease.js";import"./user-0.0.0-dataease.js";import"./index-0.0.0-dataease14.js";import"./strings-0.0.0-dataease.js";import"./index-0.0.0-dataease5.js";import"./el-divider-0.0.0-dataease.js";import"./el-empty-0.0.0-dataease.js";import"./el-virtual-list-0.0.0-dataease.js";import"./el-table-v2-0.0.0-dataease.js";import"./browser-0.0.0-dataease.js";import"./antv-0.0.0-dataease.js";import"./imgUtils-0.0.0-dataease.js";import"./dvMain-0.0.0-dataease.js";import"./chart-0.0.0-dataease.js";import"./formatter-0.0.0-dataease.js";import"./dataVisualization-0.0.0-dataease2.js";import"./util-0.0.0-dataease.js";import"./util-0.0.0-dataease2.js";import"./chart-0.0.0-dataease2.js";import"./app-0.0.0-dataease.js";import"./extends-0.0.0-dataease.js";import"./sysParameter-0.0.0-dataease.js";import"./TableTooltip-0.0.0-dataease.js";import"./el-col-0.0.0-dataease.js";import"./row-0.0.0-dataease.js";import"./el-row-0.0.0-dataease.js";import"./_commonjs-dynamic-modules-0.0.0-dataease.js";import"./appearance-0.0.0-dataease.js";import"./font-0.0.0-dataease.js";const Ae={width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function Ue(T,c){return d(),L("svg",Ae,c[0]||(c[0]=[ye('<path d="M20.1716 1.68834C20.6753 1.53273 21.0458 2.16193 20.6652 2.52691L12.2658 10.5836C11.0058 11.7921 9.32754 12.4668 7.5817 12.4668C5.68044 12.4668 3.8669 11.667 2.58487 10.263L1.45879 9.02985C1.33225 8.90313 1.24137 8.74527 1.19534 8.5722C1.14931 8.39913 1.14974 8.21698 1.19661 8.04413C1.24347 7.87129 1.3351 7.71386 1.46225 7.58775C1.5894 7.46164 1.74757 7.3713 1.92079 7.32585L20.1716 1.68834Z" fill="url(#paint0_linear_15885_149847)"></path><path d="M12 16.1851C12 14.2766 12.7377 12.4419 14.0588 11.0646L21.4664 3.34177C21.8268 2.96601 22.4499 3.32266 22.3084 3.82374L17.143 22.1182C17.0971 22.291 17.0064 22.4487 16.8801 22.5754C16.7538 22.7021 16.5964 22.7932 16.4237 22.8397C16.251 22.8862 16.0691 22.8864 15.8964 22.8402C15.7236 22.794 15.566 22.7031 15.4395 22.5767L14.4439 21.6791C12.8881 20.2764 12 18.2799 12 16.1851Z" fill="url(#paint1_linear_15885_149847)"></path><defs><linearGradient id="paint0_linear_15885_149847" x1="22.3289" y1="13.1532" x2="1.16113" y2="13.1532" gradientUnits="userSpaceOnUse"><stop stop-color="#9258F7"></stop><stop offset="1" stop-color="#3370FF"></stop></linearGradient><linearGradient id="paint1_linear_15885_149847" x1="22.3289" y1="13.1532" x2="1.16113" y2="13.1532" gradientUnits="userSpaceOnUse"><stop stop-color="#9258F7"></stop><stop offset="1" stop-color="#3370FF"></stop></linearGradient></defs>',3)]))}const Ge={render:Ue},Ze={width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function Oe(T,c){return d(),L("svg",Ze,c[0]||(c[0]=[s("path",{d:"M20.1716 1.68834C20.6753 1.53273 21.0458 2.16193 20.6652 2.52691L12.2658 10.5836C11.0058 11.7921 9.32754 12.4668 7.5817 12.4668C5.68044 12.4668 3.8669 11.667 2.58487 10.263L1.45879 9.02985C1.33225 8.90313 1.24137 8.74527 1.19534 8.5722C1.14931 8.39913 1.14974 8.21698 1.19661 8.04413C1.24347 7.87129 1.3351 7.71386 1.46225 7.58775C1.5894 7.46164 1.74757 7.3713 1.92079 7.32585L20.1716 1.68834Z",fill:"#BBBFC4"},null,-1),s("path",{d:"M12 16.1851C12 14.2766 12.7377 12.4419 14.0588 11.0646L21.4664 3.34177C21.8268 2.96601 22.4499 3.32266 22.3084 3.82374L17.143 22.1182C17.0971 22.291 17.0064 22.4487 16.8801 22.5754C16.7538 22.7021 16.5964 22.7932 16.4237 22.8397C16.251 22.8862 16.0691 22.8864 15.8964 22.8402C15.7236 22.794 15.566 22.7031 15.4395 22.5767L14.4439 21.6791C12.8881 20.2764 12 18.2799 12 16.1851Z",fill:"#BBBFC4"},null,-1)]))}const We={render:Oe},je={width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function He(T,c){return d(),L("svg",je,c[0]||(c[0]=[s("path",{d:"M5.29008 5.22068L5.29008 5.22068C3.5148 6.99712 2.49805 9.40416 2.49805 11.97C2.49805 17.2342 6.75182 21.5024 12.0004 21.5024C17.249 21.5024 21.5027 17.2342 21.5027 11.97C21.5027 11.6777 21.3866 11.3973 21.1799 11.1906C20.9731 10.9838 20.6928 10.8677 20.4004 10.8677C20.108 10.8677 19.8276 10.9838 19.6209 11.1906C19.4142 11.3973 19.298 11.6777 19.298 11.97C19.298 16.0178 16.0303 19.2977 12.0004 19.2977C7.97048 19.2977 4.70273 16.0178 4.70273 11.97M5.29008 5.22068L4.80039 11.97M5.29008 5.22068C5.39243 5.11826 5.51394 5.037 5.64769 4.98154C5.78145 4.92608 5.92481 4.89751 6.0696 4.89746C6.2144 4.89741 6.35778 4.92588 6.49157 4.98124C6.62536 5.0366 6.74694 5.11777 6.84936 5.22012C6.95178 5.32247 7.03304 5.44398 7.0885 5.57774C7.14396 5.71149 7.17253 5.85485 7.17258 5.99965C7.17263 6.14444 7.14417 6.28782 7.0888 6.42161C7.03344 6.55541 6.95227 6.67698 6.84992 6.7794M5.29008 5.22068L6.919 6.84843M4.70273 11.97H4.80039M4.70273 11.97C4.70273 11.9701 4.70273 11.9702 4.70273 11.9702L4.80039 11.97M4.70273 11.97C4.701 11.0061 4.88979 10.0512 5.25827 9.16045C5.62676 8.26965 6.16768 7.46047 6.84992 6.7794M4.80039 11.97C4.79865 11.0189 4.98493 10.0767 5.34851 9.19778C5.7121 8.31884 6.24582 7.52042 6.919 6.84843M6.84992 6.7794L6.919 6.84843M6.84992 6.7794C6.84995 6.77937 6.84998 6.77935 6.85001 6.77932L6.919 6.84843",fill:"#3370FF",stroke:"#3370FF","stroke-width":"0.195312"},null,-1)]))}const Ke={render:He},Pe={class:"copilot"},Qe={class:"copilot-analysis"},Xe={class:"copilot-service"},Je={class:"dialogue"},Ye={class:"title-dataset_select"},et={style:{margin:"0 16px"},class:"tree-select"},tt={class:"content"},ot=["title"],lt={class:"preview-field"},at={class:"custom-tree-node father"},st=["title"],it={class:"custom-tree-node father"},nt=["title"],rt=xe({__name:"index",setup(T){const{t:c}=he(),z=D([]),A=D([]),E=D([]),m=u([]),p=u(""),g=u(""),M=u(!1),U={children:"children",label:"name"},re={label:"name",children:"children",value:"id",isLeaf:t=>{var e;return!((e=t.children)!=null&&e.length)}},C=u(!0),y=u(!0),$=t=>t.filter(e=>{var a,r;return(a=e.children)!=null&&a.length&&!e.leaf?(e.children=$(e.children),!!((r=e.children)!=null&&r.length)):e.leaf}),G=te(()=>{var t;return((t=E.value[0])==null?void 0:t.id)==="0"?$(E.value[0].children):$(E.value)}),F=te(()=>g.value.trim().length&&!!p.value),ce=async()=>{await Se({}).then(t=>{E.value=t||[]}),be().then(t=>{var a;const e=t||[];B=((a=e[e.length-1])==null?void 0:a.history)||[],m.value=Ne(e).map(r=>({...r,loading:!1})),e.length&&(p.value=e[0].datasetGroupId,v=p.value,p.value&&b(p.value),v&&!x&&le(()=>{O(G.value)}))})},S=u();let v="",Z="",x="";const O=t=>t.filter(e=>{var a,r;return e.id===v&&(x=e.name),(a=e.children)!=null&&a.length&&!e.leaf?(e.children=O(e.children),!!((r=e.children)!=null&&r.length)):e.leaf}),de=()=>{if(v&&m.value.length){Z=p.value,p.value=v;const t=c("copilot.ds_prefix")+x+c("copilot.ds_suffix");_e.confirm(c("copilot.confirm"),{confirmButtonType:"primary",type:"warning",tip:t,autofocus:!1,showClose:!1}).then(()=>{p.value=Z,v=p.value,x=S.value.getCurrentNode().name,b(p.value),qe().then(()=>{m.value=[],B=[]})})}else v=p.value,x=S.value.getCurrentNode().name,b(p.value)},b=t=>{De(t).then(e=>{var a,r;A.value=((a=e.data)==null?void 0:a.dimensionList)||[],z.value=((r=e.data)==null?void 0:r.quotaList)||[]})};ce();let B=[];const W=u(),q=u(!1),{height:j}=fe(W);we(()=>j.value,t=>{q.value=t>48});const H=t=>{M.value=t,m.value.forEach(e=>{e.loading=!0}),setTimeout(()=>{m.value.forEach(e=>{e.loading=!1})},300)},w=u(!1),K=u(),P=t=>{if((t==null?void 0:t.keyCode)===229)return;(t==null?void 0:t.keyCode)===13&&t.preventDefault();let e=g.value;!F.value||w.value||(g.value="",K.value.blur(),le(()=>{q.value=!1}),m.value.push({msgType:"user",chart:{},id:`${+new Date}`,question:e,chartData:{data:{},title:""},msgStatus:1}),w.value=!0,Ve({datasetGroupId:p.value,question:e,history:B}).then(a=>{m.value.push({...a||{},loading:!1}),B=a.history||[]}).finally(()=>{w.value=!1}))};return(t,e)=>{const a=ge,r=ee,pe=ve,Q=Re,ue=Ce,X=ee,J=me;return d(),L("div",Pe,[s("div",Qe,[o(r,{style:{"margin-right":"8px","font-size":"24px"}},{default:l(()=>[o(a,{name:"copilot"},{default:l(()=>[o(n(Be),{class:"svg-icon"})]),_:1})]),_:1}),V(" "+h(n(c)("copilot.talking_analysis")),1)]),s("div",Xe,[s("div",Je,[s("div",{class:"copilot-dialogue",style:oe({height:`calc(100vh - ${n(j)+152}px)`})},[o(R,{key:"isWelcome",isWelcome:""}),(d(!0),L(ke,null,Le(m.value,i=>(d(),f(R,{copilotInfo:i,key:i.id},null,8,["copilotInfo"]))),128)),w.value?(d(),f(R,{key:"isAnswer",isAnswer:""})):k("",!0)],4),s("div",{class:_(["question-input",q.value&&"over-height"]),ref_key:"questionInputRef",ref:W},[o(pe,{modelValue:g.value,"onUpdate:modelValue":e[0]||(e[0]=i=>g.value=i),onKeydown:[e[1]||(e[1]=Ee(()=>{},["stop"])),Me(P,["enter"])],ref_key:"inputRef",ref:K,autosize:{minRows:1,maxRows:8},type:"textarea",placeholder:t.$t("common.inputText")},null,8,["modelValue","placeholder"]),w.value?(d(),f(r,{key:0,class:"copilot-icon circular-input_icon"},{default:l(()=>[o(a,{name:"icon_loading_outlined"},{default:l(()=>[o(n(Ke),{class:"svg-icon"})]),_:1})]),_:1})):(d(),f(r,{key:1,class:_(["copilot-icon",F.value&&"active"]),onClick:P},{default:l(()=>[o(a,null,{default:l(()=>[(d(),f(N(F.value?n(Ge):n(We)),{class:"svg-icon"}))]),_:1})]),_:1},8,["class"]))],2)]),s("div",{class:"dataset-select",style:oe({width:M.value?0:"280px"})},[o(Q,{effect:"dark",content:n(c)("relation.retract"),placement:"left"},{default:l(()=>[ae(s("p",{class:"arrow-right",onClick:e[2]||(e[2]=i=>H(!0))},[o(r,null,{default:l(()=>[o(a,{name:"icon_right_outlined"},{default:l(()=>[o(n(Ie),{class:"svg-icon"})]),_:1})]),_:1})],512),[[se,!M.value]])]),_:1},8,["content"]),o(Q,{effect:"dark",content:n(c)("relation.expand"),placement:"left"},{default:l(()=>[ae(s("p",{class:"left-outlined",onClick:e[3]||(e[3]=i=>H(!1))},[o(r,null,{default:l(()=>[o(a,{name:"icon_left_outlined"},{default:l(()=>[o(n(Te),{class:"svg-icon"})]),_:1})]),_:1})],512),[[se,M.value]])]),_:1},8,["content"]),s("div",Ye,h(n(c)("copilot.choose_dataset")),1),s("div",et,[o(ue,{modelValue:p.value,"onUpdate:modelValue":e[4]||(e[4]=i=>p.value=i),data:G.value,placeholder:n(c)("copilot.pls_choose_dataset"),onChange:de,props:re,style:{width:"100%"},ref_key:"treeSelectRef",ref:S,placement:"bottom","render-after-expand":!1,filterable:"","popper-class":"dataset-tree"},{default:l(({node:i,data:Y})=>[s("div",tt,[Y.leaf?k("",!0):(d(),f(r,{key:0,size:"18px"},{default:l(()=>[o(a,{name:"dv-folder"},{default:l(()=>[o(n($e),{class:"svg-icon"})]),_:1})]),_:1})),Y.leaf?(d(),f(r,{key:1,size:"18px"},{default:l(()=>[o(a,{name:"icon_dataset"},{default:l(()=>[o(n(Fe),{class:"svg-icon"})]),_:1})]),_:1})):k("",!0),s("span",{class:"label ellipsis",style:{"margin-left":"8px"},title:i.label},h(i.label),9,ot)])]),_:1},8,["modelValue","data","placeholder"])]),s("div",lt,[s("div",{class:_(["field-d",{open:C.value}])},[s("div",{class:_(["title",{expanded:C.value}]),onClick:e[5]||(e[5]=i=>C.value=!C.value)},[o(X,{class:"expand"},{default:l(()=>[o(a,{name:"icon_expand-right_filled"},{default:l(()=>[o(n(ie),{class:"svg-icon"})]),_:1})]),_:1}),V("  "+h(t.$t("chart.dimension")),1)],2),C.value?(d(),f(J,{key:0,data:A.value,props:U},{default:l(({data:i})=>[s("span",at,[o(r,null,{default:l(()=>[o(a,null,{default:l(()=>[(d(),f(N(n(ne)[n(I)[i.deExtractType]]),{class:_(["svg-icon",`field-icon-${n(I)[[2,3].includes(i.deExtractType)?2:0]}`])},null,8,["class"]))]),_:2},1024)]),_:2},1024),s("span",{title:i.name,class:"label-tooltip"},h(i.name),9,st)])]),_:1},8,["data"])):k("",!0)],2),s("div",{class:_(["field-q",{open:y.value}])},[s("div",{class:_(["title",{expanded:y.value}]),onClick:e[6]||(e[6]=i=>y.value=!y.value)},[o(X,{class:"expand"},{default:l(()=>[o(a,{name:"icon_expand-right_filled"},{default:l(()=>[o(n(ie),{class:"svg-icon"})]),_:1})]),_:1}),V("  "+h(t.$t("chart.quota")),1)],2),y.value?(d(),f(J,{key:0,data:z.value,props:U},{default:l(({data:i})=>[s("span",it,[o(r,null,{default:l(()=>[o(a,null,{default:l(()=>[(d(),f(N(n(ne)[n(I)[i.deExtractType]]),{class:_(["svg-icon",`field-icon-${n(I)[[2,3].includes(i.deExtractType)?2:0]}`])},null,8,["class"]))]),_:2},1024)]),_:2},1024),s("span",{title:i.name,class:"label-tooltip"},h(i.name),9,nt)])]),_:1},8,["data"])):k("",!0)],2)])],4)])])}}});const p1=ze(rt,[["__scopeId","data-v-232a73df"]]);export{p1 as default};
