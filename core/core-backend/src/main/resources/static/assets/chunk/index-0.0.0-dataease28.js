import{a as Rt,u as J,b as Ot,aa as Vt}from"./index-0.0.0-dataease.js";import"./el-tooltip-0.0.0-dataease.js";import"./el-popper-0.0.0-dataease.js";import{J as Mt,w as Be,r as Pt,j as Nt,y as jt,e as Je,d as Ht,k as ft,_ as zt}from"./index-0.0.0-dataease2.js";import{f as _,M as se,N as ve,d as gt,t as wt,ai as tt,r as R,_ as Ke,s as yt,m as y,W as me,a7 as We,a0 as re,w as Ie,al as qt,n as fe,o as Bt,ab as Jt,U as Qe,Z as $t,j as c,g as Q,ac as Ut,ad as Wt,k as $,i as G,Y as Gt,V as dt,S as Zt,X as Yt}from"./vue-0.0.0-dataease.js";import{i as Xt}from"./icon_info_outlined-0.0.0-dataease.js";import Qt from"./ChartComponentG2Plot-0.0.0-dataease.js";import{a as Kt}from"./chart-0.0.0-dataease2.js";import{d as it,v as ei,c as mt,C as Fe}from"./dvMain-0.0.0-dataease.js";import{r as vt,d as ti,e as ii}from"./canvasStyle-0.0.0-dataease.js";import{t as L,y as de,u as ae,B as ni,z as pt,j as li}from"./chart-0.0.0-dataease.js";import{v as ai}from"./formatter-0.0.0-dataease.js";import{h as Ge,p as ri}from"./util-0.0.0-dataease2.js";import{u as Le,d as xt,x as oi}from"./lodash-0.0.0-dataease.js";import{useAppearanceStoreWithOut as si}from"./appearance-0.0.0-dataease.js";import{useAppStoreWithOut as ui}from"./app-0.0.0-dataease.js";import{_ as ci}from"./PluginComponent.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import fi from"./DrillPath-0.0.0-dataease.js";import{j as di,g as et}from"./time-format-0.0.0-dataease.js";import{c as mi}from"./time-format-dayjs-0.0.0-dataease.js";import vi from"./ChartComponentS2-0.0.0-dataease.js";import{G as pi,H as hi}from"./canvasUtils-0.0.0-dataease.js";import{g as $e}from"./base64-0.0.0-dataease.js";import gi from"./DeRichTextView-0.0.0-dataease.js";import wi from"./Component-0.0.0-dataease10.js";import yi from"./ChartEmptyInfo-0.0.0-dataease.js";import{s as xi}from"./snapshot-0.0.0-dataease.js";import{E as Ci}from"./index-0.0.0-dataease4.js";import{_ as ki}from"./_plugin-vue_export-helper-0.0.0-dataease.js";import"./library-0.0.0-dataease.js";import"./axios-0.0.0-dataease.js";import"./echarts-0.0.0-dataease.js";import"./tinymce-0.0.0-dataease.js";import"./user-0.0.0-dataease.js";import"./ViewTrackBar-0.0.0-dataease.js";import"./el-dropdown-menu-0.0.0-dataease.js";import"./dropdown-0.0.0-dataease.js";import"./refs-0.0.0-dataease.js";import"./el-dropdown-item-0.0.0-dataease.js";import"./ChartError-0.0.0-dataease.js";import"./dataVisualization-0.0.0-dataease2.js";import"./util-0.0.0-dataease.js";import"./antv-0.0.0-dataease.js";import"./extends-0.0.0-dataease.js";import"./sysParameter-0.0.0-dataease.js";import"./TableTooltip-0.0.0-dataease.js";import"./el-col-0.0.0-dataease.js";import"./row-0.0.0-dataease.js";import"./el-row-0.0.0-dataease.js";import"./_commonjs-dynamic-modules-0.0.0-dataease.js";import"./translate-0.0.0-dataease.js";import"./font-0.0.0-dataease.js";import"./dayjs.min-0.0.0-dataease.js";import"./el-dialog-0.0.0-dataease.js";import"./use-dialog-0.0.0-dataease.js";import"./el-pagination-0.0.0-dataease.js";import"./el-select-0.0.0-dataease.js";import"./index-0.0.0-dataease14.js";import"./strings-0.0.0-dataease.js";import"./index-0.0.0-dataease5.js";import"./el-tag-0.0.0-dataease.js";import"./eventBus-0.0.0-dataease.js";import"./dataVisualization-0.0.0-dataease.js";import"./imgUtils-0.0.0-dataease.js";import"./chart-dark-list-0.0.0-dataease.js";import"./chart-list-0.0.0-dataease.js";const _i={width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function Si(o,s){return _(),se("svg",_i,s[0]||(s[0]=[ve("path",{d:"M8.622 5.77734C8.76928 5.77734 8.88867 5.89674 8.88867 6.04401V6.84401C8.88867 6.99129 8.76928 7.11068 8.622 7.11068H6.88867C6.77958 7.11068 6.68885 7.18929 6.67003 7.29295L6.66645 7.3329V12.6662C6.66645 12.7753 6.74506 12.8661 6.84873 12.8849L6.88867 12.8885H13.9998C14.1089 12.8885 14.1996 12.8098 14.2184 12.7062L14.222 12.6662V7.3329C14.222 7.22381 14.1434 7.13307 14.0397 7.11426L13.9998 7.11068H12.2664C12.1192 7.11068 11.9998 6.99129 11.9998 6.84401V6.04401C11.9998 5.89674 12.1192 5.77734 12.2664 5.77734H13.9998C14.8303 5.77734 15.5087 6.42813 15.553 7.24755L15.5553 7.3329V12.6662C15.5553 13.4967 14.9045 14.1752 14.0851 14.2195L13.9998 14.2218H6.88867C6.0582 14.2218 5.37973 13.571 5.33542 12.7516L5.33312 12.6662V7.3329C5.33312 6.50243 5.98391 5.82395 6.80332 5.77965L6.88867 5.77734H8.622ZM9.55534 1.77734C10.3858 1.77734 11.0643 2.42813 11.1086 3.24755L11.1109 3.3329V8.66623C11.1109 9.49671 10.4601 10.1752 9.64069 10.2195L9.55534 10.2218H7.822C7.67473 10.2218 7.55534 10.1024 7.55534 9.95512V9.15512C7.55534 9.00785 7.67473 8.88846 7.822 8.88846H9.55534C9.66443 8.88846 9.75516 8.80984 9.77398 8.70618L9.77756 8.66623V3.3329C9.77756 3.22381 9.69895 3.13307 9.59528 3.11426L9.55534 3.11068H2.44423C2.33513 3.11068 2.2444 3.18929 2.22559 3.29295L2.22201 3.3329V8.66623C2.22201 8.77533 2.30062 8.86606 2.40428 8.88488L2.44423 8.88846H4.17756C4.32484 8.88846 4.44423 9.00785 4.44423 9.15512V9.95512C4.44423 10.1024 4.32484 10.2218 4.17756 10.2218H2.44423C1.61375 10.2218 0.935282 9.571 0.890973 8.75158L0.888672 8.66623V3.3329C0.888672 2.50243 1.53946 1.82395 2.35888 1.77965L2.44423 1.77734H9.55534Z",fill:"currentColor"},null,-1)]))}const bi={render:Si},Ii={width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function Fi(o,s){return _(),se("svg",Ii,s[0]||(s[0]=[ve("path",{d:"M11.9858 11L10.5036 9.51778C10.3083 9.32252 10.3083 9.00594 10.5036 8.81067L11.2107 8.10357C11.4059 7.90831 11.7225 7.90831 11.9178 8.10357L15.4749 11.6607C15.6701 11.8559 15.6701 12.1725 15.4749 12.3678L11.9393 15.9033C11.7441 16.0986 11.4275 16.0986 11.2322 15.9033L10.5251 15.1962C10.3299 15.0009 10.3299 14.6844 10.5251 14.4891L12.0142 13H2.5C2.22386 13 2 12.7762 2 12.5V11.5C2 11.2239 2.22386 11 2.5 11H11.9858ZM4 4V9H2V3C2 2.49625 2.47102 2 3 2H21C21.529 2 22 2.49625 22 3V21C22 21.5037 21.529 22 21 22H3C2.47102 22 2 21.5037 2 21V15H4V20H20V4H4Z",fill:"currentColor"},null,-1)]))}const Li={render:Fi},Di={width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function Ti(o,s){return _(),se("svg",Di,s[0]||(s[0]=[ve("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M5.34423 1.50735C5.34246 1.22627 5.56945 0.999292 5.85087 1.00071L18.271 1C18.5524 1.00141 18.7787 1.22769 18.7766 1.50558L18.7791 2.49801C18.7773 2.77554 18.5503 3.00253 18.2724 3.00465L16.0653 3.0043L16.0646 7.53066C16.0646 7.66501 16.1588 7.79441 16.2507 7.88634L20.3954 12.6558C20.4908 12.7512 20.5449 12.881 20.5449 13.0153L20.5439 14.3245C20.5453 14.606 20.3187 14.8326 20.0372 14.8312L13.0651 14.8337L13.065 18H15.3988C15.9133 18 16.1892 18.605 15.8519 18.9934L12.4531 22.9077C12.2138 23.1832 11.7862 23.1832 11.5469 22.9077L8.14813 18.9934C7.81084 18.605 8.08675 18 8.60119 18H11.0371L11.0372 14.8322L4.0505 14.8313C3.77272 14.8333 3.54644 14.607 3.54492 14.3257L3.54584 13.0166C3.54588 12.8822 3.5981 12.7522 3.6931 12.6572L7.84885 7.88775C7.94395 7.79264 8.05642 7.66254 8.05642 7.52819L8.05678 3.00217L5.84875 3.00182C5.57086 3.00394 5.34459 2.77767 5.34317 2.49624L5.34423 1.50735ZM10.0578 3.00197L10.061 8.39982L6.19585 12.8316L11 12.8331C11.1142 12.8334 11.5511 12.8334 11.991 12.8334C12.4309 12.8334 12.8738 12.8334 13 12.8337L17.8942 12.8351L14.0678 8.41842L14.0624 2.99973L10.0578 3.00197Z",fill:"currentColor"},null,-1)]))}const Ei={render:Ti},Ai=gt({__name:"DeIndicator",props:{view:{type:Object,default(){return{propValue:null}}},showPosition:{type:String,required:!1,default:"canvas"},scale:{type:Number,required:!1,default:1},terminal:{type:String,default:"pc"},suffixId:{type:String,required:!1,default:"common"}},emits:["onChartClick","onDrillFilters","onJumpClick"],setup(o,{expose:s,emit:a}){const l=o,{view:f,scale:p,terminal:d}=wt(l),C=it(),{batchOptStatus:S}=tt(C),q=R(""),j=R(!1),Z=Ke({data:null,loading:!1,totalItems:0}),ie=yt({fields:[]}),D=y(()=>{var h;const n=(h=ie.value)==null?void 0:h.series;if(n&&n.length>0)return n[0]}),ue=y(()=>{var n,h;if((h=(n=f.value)==null?void 0:n.yAxis)!=null&&h.length){const x=f.value.yAxis[0];return x.chartShowName?x.chartShowName:x.name}}),ne=y(()=>{var x,m,b;const n=(x=D.value)==null?void 0:x.data;let h;if(n&&n.length>0&&(h=n[0]),h==null)if(f.value.senior&&((b=(m=f.value.senior)==null?void 0:m.functionCfg)==null?void 0:b.emptyDataStrategy)==="setZero")h=0;else return"-";return h}),K=R(L.color),O=y(()=>{var m,b,T;let n=K.value,h=L.backgroundColor;if(ne.value==="-")return{color:n,backgroundColor:h};const x=ne.value;if(f.value.senior&&((m=f.value.senior.threshold)!=null&&m.enable)&&((T=(b=f.value.senior.threshold)==null?void 0:b.labelThreshold)==null?void 0:T.length)>0){const ee=f.value.senior;for(let Y=0;Y<ee.threshold.labelThreshold.length;Y++){let I=!1;const g=ee.threshold.labelThreshold[Y],z=g.value;if(g.term==="eq"?x===z&&(n=g.color,h=g.backgroundColor,I=!0):g.term==="not_eq"?x!==z&&(n=g.color,h=g.backgroundColor,I=!0):g.term==="lt"?x<z&&(n=g.color,h=g.backgroundColor,I=!0):g.term==="gt"?x>z&&(n=g.color,h=g.backgroundColor,I=!0):g.term==="le"?x<=z&&(n=g.color,h=g.backgroundColor,I=!0):g.term==="ge"?x>=z&&(n=g.color,h=g.backgroundColor,I=!0):g.term==="between"&&g.min<=x&&x<=g.max&&(n=g.color,h=g.backgroundColor,I=!0),I)break}}return{color:n,backgroundColor:h}}),De=y(()=>{let n=ne.value;return n==="-"?n:f.value.yAxis&&f.value.yAxis.length>0&&f.value.yAxis[0].formatterCfg?ai(n,f.value.yAxis[0].formatterCfg):n}),Te=a,V=R({display:"flex","flex-direction":"column","align-items":"center","justify-content":"center",height:"100%","background-color":O.value.backgroundColor}),ke=R({color:O.value.color,"font-size":L.fontSize+"px","font-family":Le(de[L.fontFamily],L.fontFamily),"font-weight":L.isBolder?"bold":"normal","font-style":L.isItalic?"italic":"normal","letter-spacing":L.letterSpace+"px","text-shadow":L.fontShadow?"2px 2px 4px":"none","font-synthesis":"weight style"}),i=R({color:L.suffixColor,"font-size":L.suffixFontSize+"px","font-family":Le(de[L.suffixFontFamily],L.suffixFontFamily),"font-weight":L.suffixIsBolder?"bold":"normal","font-style":L.suffixIsItalic?"italic":"normal","letter-spacing":L.suffixLetterSpace+"px","text-shadow":L.suffixFontShadow?"2px 2px 4px":"none","font-synthesis":"weight style"}),M=R(L.suffixEnable),k=R(""),ce=R(!1),_e=Ke({"margin-top":ae.nameValueSpacing+"px"}),H=R({color:ae.color,"font-size":ae.fontSize+"px","font-family":Le(de[ae.fontFamily],ae.fontFamily),"font-weight":ae.isBolder?"bold":"normal","font-style":ae.isItalic?"italic":"normal","letter-spacing":ae.letterSpace+"px","text-shadow":ae.fontShadow?"2px 2px 4px":"none","font-synthesis":"weight style"}),pe=async n=>{if(!n)return;const h=xt(ni);delete h.customAttr.basicStyle.alpha;const x=Mt({...oi(n,h),data:ie.value});if(vt(ti,x.customAttr,p.value,d.value),vt(ii,x.customStyle,p.value,d.value),x.customAttr){const{indicator:m,indicatorName:b,basicStyle:T}=x.customAttr;if(m){switch(m.hPosition){case"left":V.value["align-items"]="flex-start";break;case"right":V.value["align-items"]="flex-end";break;default:V.value["align-items"]="center"}switch(m.vPosition){case"top":V.value["justify-content"]="flex-start";break;case"bottom":V.value["justify-content"]="flex-end";break;default:V.value["justify-content"]="center"}K.value=m.color;let ee=m.suffixColor;(T==null?void 0:T.alpha)!==void 0&&!S.value&&(K.value=Ge(T.colors[0],T.alpha),ee=Ge(T.colors[1],T.alpha)),ke.value={color:O.value.color,"font-size":m.fontSize+"px","font-family":Le(de[m.fontFamily],L.fontFamily),"font-weight":m.isBolder?"bold":"normal","font-style":m.isItalic?"italic":"normal","letter-spacing":m.letterSpace+"px","text-shadow":m.fontShadow?"2px 2px 4px":"none","font-synthesis":"weight style"},V.value["background-color"]=O.value.backgroundColor,i.value={color:ee,"font-size":m.suffixFontSize+"px","font-family":Le(de[m.suffixFontFamily],L.suffixFontFamily),"font-weight":m.suffixIsBolder?"bold":"normal","font-style":m.suffixIsItalic?"italic":"normal","letter-spacing":m.suffixLetterSpace+"px","text-shadow":m.suffixFontShadow?"2px 2px 4px":"none","font-synthesis":"weight style"},M.value=m.suffixEnable,k.value=Le(m.suffix,"")}if(b!=null&&b.show){let ee=b.color;(T==null?void 0:T.alpha)!==void 0&&!S.value&&(ee=Ge(T.colors[2],T.alpha)),ce.value=!0,H.value={color:ee,"font-size":b.fontSize+"px","font-family":Le(de[b.fontFamily],ae.fontFamily),"font-weight":b.isBolder?"bold":"normal","font-style":b.isItalic?"italic":"normal","letter-spacing":b.letterSpace+"px","text-shadow":b.fontShadow?"2px 2px 4px":"none","font-synthesis":"weight style"},_e["margin-top"]=(b.nameValueSpacing??ae.nameValueSpacing)+"px"}else ce.value=!1}};return s({calcData:(n,h)=>{if(n.tableId||n.dataFrom==="template"){Z.loading=!0,j.value=!1;const x=JSON.parse(JSON.stringify(n));Kt(x).then(m=>{m.code&&m.code!==0?(j.value=!0,q.value=m.msg):(ie.value=m==null?void 0:m.data,Te("onDrillFilters",m==null?void 0:m.drillFilters),C.setViewDataDetails(n.id,m),pe(m)),h==null||h()}).catch(()=>{h==null||h()})}else h==null||h()},renderChart:pe}),(n,h)=>(_(),se("div",{style:me(V.value)},[ve("div",null,[ve("span",{style:me(ke.value)},We(De.value),5),M.value?(_(),se("span",{key:0,style:me(i.value)},We(k.value),5)):re("",!0)]),ce.value?(_(),se("div",{key:0,style:me(_e)},[ve("span",{style:me(H.value)},We(ue.value),5)],4)):re("",!0)],4))}}),Ri=it(),{componentData:ht}=tt(Ri),Oi=(o,s,a)=>{const l=(a||"").split("range")[0];if(a==="datetimerange"||o===1||!l)return s.map(d=>+new Date(d));const[f,p]=s;return[+new Date(f),+et(1,l,l,"b",null,a,"start-config",new Date(p))-1e3]},Vi=(o,s,a,l)=>[1,7].includes(o)?Array.isArray(s)?Oi(o,s,l):Mi(s,a):Array.isArray(s)?s:[s],Mi=(o,s)=>{switch(s){case"year":return Pi(o);case"month":return Ni(o);case"date":return ji(o);case"datetime":return[+new Date(o),+new Date(o)]}},Pi=o=>{const s=new Date(o);return[+new Date(s.getFullYear(),0,1),+new Date(s.getFullYear(),11,31)+60*1e3*60*24-1e3]},Ni=o=>{const s=new Date(o),a=new Date(s.getFullYear(),s.getMonth(),1);return a.setDate(1),a.setMonth(a.getMonth()+1),[+new Date(s.getFullYear(),s.getMonth(),1),+new Date(a.getTime()-1e3)]},ji=o=>[+new Date(o),+new Date(o)+60*1e3*60*24-1e3],Hi=(o,s)=>{const[a]=s,l=a.split(",");return o.map(f=>f.id).slice(0,l.length).join(",")},zi=(o,s,a,l,f,p,d,C,S,q)=>+S==9?l?o?f?s.map(j=>j.split("-de-").join(",")):(s||"").split("-de-").join(","):[]:a!=null&&a.length?f?a.map(j=>j.split("-de-").join(",")):(a||"").split("-de-").join(","):[]:d===1&&(p!=null&&p.length||q)&&![1,7].includes(+S)?l?o?p:f?[]:"":(a!=null&&a.length?C:a)||"":l&&!(a!=null&&a.length)?o?s:f?[]:"":a||"",qi=(o,s=!1)=>{const a=[],l=ht.value.filter(f=>f.component==="VQuery");return Ue(l,a,o,s),ht.value.forEach(f=>{if(f.component==="Group"){const p=f.propValue.filter(d=>d.innerType==="VQuery");Ue(p,a,o,s),p.forEach(d=>{d.innerType==="DeTabs"&&d.propValue.forEach(C=>{const S=C.componentData.filter(q=>q.innerType==="VQuery");Ue(S,a,o,s)})})}f.innerType==="DeTabs"&&f.propValue.forEach(p=>{const d=p.componentData.filter(C=>C.innerType==="VQuery");Ue(d,a,o,s)})}),{filter:a}},Bi=(o,s,a,l,f,p)=>{const d=p?s:l,C=p?a:f;return o===0?d===""?[]:d:[d||"",C||""].filter(S=>S!=="")},Ji=(o,s,a,l,f,p)=>p&&!f?[]:[(p?l:a)??"",(p?o:s)??""].filter(S=>S!==""),$i=(o,s,a,l,f,p,d,C,S,q,j,Z)=>{if(+o==9)return s?"in":"eq";if(+o==22)return"between";const ie=Z?f:S,D=Z?d:j,ue=Z?l:C,ne=Z?p:q;if(o==="8"){if(a===0)return ue;const K=[ie===""?"":ue,D===""?"":ne].filter(O=>O!=="");return K.length===2?K.join(`-${a===1?"and":"or"}-`):ie===""?ne:ue}return[1,7].includes(+o)?"between":s?"in":"eq"},Pe=o=>{const s=[];let a=o.map(l=>l.id);for(let l=0;l<o.length;l++){const f=o[l];a.includes(f.id)&&(s.push(f),a=a.filter(p=>p!==f.id))}return s},Ue=(o,s,a,l)=>{o.forEach(f=>{var p;(p=f.propValue)!=null&&p.length&&f.propValue.forEach(d=>{var C,S,q,j,Z,ie;if(d.checkedFields.includes(a)&&d.checkedFieldsMap[a]){let D;const{selectValue:ue,timeGranularityMultiple:ne,defaultNumValueEnd:K,numValueEnd:O,numValueStart:De,defaultNumValueStart:Te,conditionType:V=0,treeFieldList:ke=[],defaultConditionValueOperatorF:i="eq",defaultConditionValueF:M="",defaultConditionValueOperatorS:k="like",defaultConditionValueS:ce="",conditionValueOperatorF:_e="eq",conditionValueF:H="",conditionValueOperatorS:pe="like",conditionValueS:Oe="",defaultValueCheck:n,timeType:h="fixed",defaultValue:x,optionValueSource:m,defaultMapValue:b,mapValue:T,parameters:ee=[],timeGranularity:Y="date",displayType:I,displayId:g,multiple:z}=d,Ee=+I==9;if(h==="dynamic"&&[1,7].includes(+I)&&l&&n)if(+I==1)D=di(d),d.defaultValue=new Date(D[0]),d.selectValue=new Date(D[0]);else{const{timeNum:E,relativeToCurrentType:he,around:P,relativeToCurrentRange:oe,arbitraryTime:A,timeGranularity:X,timeNumRange:te,relativeToCurrentTypeRange:N,aroundRange:Se,timeGranularityMultiple:Ne,arbitraryTimeRange:je}=d;let ge=et(E,he,X,P,A,Ne,"start-panel"),we=et(te,N,X,Se,je,Ne,"end-panel");oe&&oe!=="custom"&&([ge,we]=mi(oe)),d.defaultValue=[ge,we],d.selectValue=[ge,we],D=[ge,we]}else I==="8"?D=Bi(V,M,ce,H,Oe,l):I==="22"?D=Ji(K,O,De,Te,n,l):D=zi(n,x,ue,l,z,b,m,T,I,g);if(D!=null&&D.length||["[object Number]","[object Date]"].includes(Object.prototype.toString.call(D))||I==="8"){let E=Vi(+I,D,Y,ne);const he=$i(I,z,V,i,M,k,ce,_e,H,pe,Oe,l);if(E!=null&&E.length){const P=Ee?Hi(ke,E):d.checkedFieldsMap[a];let oe=Pe(ee.reduce((A,X)=>(X.id===P&&!A.length&&A.push(X),A),[]));if((S=(C=d.checkedFieldsMapArr)==null?void 0:C[a])!=null&&S.length){const A=(q=d.checkedFieldsMapArr)==null?void 0:q[a].find(N=>N!==P),X=Array(2).fill(A===d.checkedFieldsMapEnd[a]?E[1]:E[0]);E=Array(2).fill(A===d.checkedFieldsMapEnd[a]?E[0]:E[1]),oe=Pe(d.parametersArr[a].filter(N=>N.id===P));const te=Pe(d.parametersArr[a].filter(N=>N.id===A));s.push({componentId:f.id,fieldId:A,operator:he,value:X,parameters:te,isTree:Ee})}if((Z=(j=d.checkedFieldsMapArrNum)==null?void 0:j[a])!=null&&Z.length){const A=(ie=d.checkedFieldsMapArrNum)==null?void 0:ie[a].find(N=>N!==P),X=Array(2).fill(A===d.checkedFieldsMapEndNum[a]?E[1]:E[0]);E=Array(2).fill(A===d.checkedFieldsMapEndNum[a]?E[0]:E[1]),oe=Pe(d.parametersArr[a].filter(N=>N.id===P));const te=Pe(d.parametersArr[a].filter(N=>N.id===A));s.push({componentId:f.id,fieldId:A,operator:he,value:X,parameters:te,isTree:Ee})}s.push({componentId:f.id,fieldId:P,operator:he,value:E,parameters:oe,isTree:Ee})}}}})})};function Ui(o){const[s,a]=o.split("?"),[l,f]=s.split("#/");return{path:f,query:a.split("&").map(p=>p.split("=")).reduce((p,d)=>{const[C,S]=d;return p[C]=S,p},{})}}const Wi=["innerHTML"],Gi={key:0,style:{flex:"1",overflow:"hidden"}},Zi=gt({__name:"index",props:{active:{type:Boolean,default:!1},element:{type:Object,default(){return{propValue:null}}},view:{type:Object,default(){return{propValue:null}}},themes:{type:String,required:!1,default:"dark"},showPosition:{type:String,required:!1,default:"preview"},searchCount:{type:Number,required:!1,default:0},disabled:{type:Boolean,required:!1,default:!1},scale:{type:Number,required:!1,default:1},suffixId:{type:String,required:!1,default:"common"}},emits:["onPointClick"],setup(o,{emit:s}){const{wsCache:a}=Rt(),l=R(),{t:f}=Nt(),p=it(),{emitter:d}=J();let C=null;const S=ui(),q=si(),j=y(()=>S.getIsDataEaseBi),Z=y(()=>S.getIsIframe),ie=s,{nowPanelJumpInfo:D,publicLinkStatus:ue,dvInfo:ne,curComponent:K,canvasStyleData:O,mobileInPc:De,inMobile:Te}=tt(p),V=o,ke=R(""),{view:i,showPosition:M,element:k,active:ce,searchCount:_e,scale:H}=wt(V),pe=y(()=>!["rich-text","picture-group"].includes(k.value.innerType)&&n.title_show&&M.value!=="viewDialog"),Oe=xi(),n=Ke({initReady:!0,title_show:!0,title_remark:{show:!1,remark:""},title_class:{fontSize:"18px",color:"#303133",textAlign:"left",fontStyle:"normal",fontWeight:"normal",background:"",fontFamily:"",textShadow:"none",letterSpacing:"0px",fontSynthesis:"style weight",width:"fit-content",maxWidth:"100%",wordBreak:"break-word",whiteSpace:"pre-wrap"},drillFilters:[],viewInfoData:null,drillClickDimensionList:[]}),h=y(()=>n.drillClickDimensionList.length),x=y(()=>pe.value?n.title_class.textAlign==="center"?"center":n.title_class.textAlign==="right"?"flex-end":"flex-start":"flex-start"),m=y(()=>{var e;return((e=l==null?void 0:l.value)==null?void 0:e.trackMenu)??[]}),b=y(()=>m.value.indexOf("linkage")>-1||m.value.indexOf("linkageAndDrill")>-1),T=y(()=>m.value.indexOf("jump")>-1&&!De.value),ee=y(()=>m.value.indexOf("drill")>-1||m.value.indexOf("linkageAndDrill")>-1),Y=R(!1),I=y(()=>{var e;return((e=O.value.dashboard)==null?void 0:e.resultMode)||null}),g=y(()=>{var e;return((e=O.value.dashboard)==null?void 0:e.resultCount)||null}),z=Ot(),Ee=(e=!1,t="minute",r=5)=>{if(M.value==="preview"&&!C&&e){C&&clearInterval(C);const u=t==="second"?r*1e3:r*6e4;C=setInterval(()=>{E(),Ae()},u)}},E=()=>{p.clearViewLinkage(k.value.id),J().emitter.emit("clearPanelLinkage",{viewId:k.value.id})};Ie([()=>i.value],()=>{P()},{deep:!0}),Ie([()=>H.value],()=>{P()}),Ie([()=>_e.value],()=>{C||Ae()}),Ie([()=>g.value],()=>{Ae()}),Ie([()=>I.value],()=>{Ae()}),Ie([()=>H.value],()=>{fe(()=>{var e,t;(t=(e=l==null?void 0:l.value)==null?void 0:e.renderChart)==null||t.call(e,i.value)})}),Ie([()=>K.value],()=>{K.value&&K.value.id===i.value.id&&(n.initReady=!1,fe(()=>{n.initReady=!0}))});const he=yt(null);Zt("chartExtRequest",he);const P=()=>{var e;if(i.value.customStyle){const t=i.value.customStyle;t.text&&(n.title_show=t.text.show,n.title_class.fontSize=t.text.fontSize*H.value+"px",n.title_class.color=t.text.color,n.title_class.textAlign=t.text.hPosition,n.title_class.fontStyle=t.text.isItalic?"italic":"normal",n.title_class.fontWeight=t.text.isBolder?"bold":"normal",q.fontList.length&&q.fontList.forEach(r=>{de[r.name]=r.name}),n.title_class.fontFamily=t.text.fontFamily?de[t.text.fontFamily]:pt.fontFamily,de[t.text.fontFamily]||(n.title_class.fontFamily=(e=q.fontList.find(r=>r.isDefault))==null?void 0:e.name,t.text.fontFamily=n.title_class.fontFamily),q.setCurrentFont(n.title_class.fontFamily),n.title_class.letterSpacing=(t.text.letterSpace?t.text.letterSpace:pt.letterSpace)+"px",n.title_class.textShadow=t.text.fontShadow?"2px 2px 4px":"none"),t.background&&(n.title_class.background=Ge(t.background.color,t.background.alpha)),n.title_remark.show=t.text.show&&t.text.remarkShow,n.title_remark.remark=t.text.remark}},oe=e=>{n.drillClickDimensionList.splice(e),i.value.chartExtRequest=te(),Re(i.value)},A=e=>{try{const t={sourceDvId:ne.value.id,sourceViewId:i.value.id,message:$e.encode(JSON.stringify(e))};ie("onPointClick",t)}catch{console.warn("de_inner_params send error")}},X=e=>{if(i.value.xAxis.map(r=>r.id).indexOf(V.view.drillFields[0].id)==-1){Be.error(f("chart.drill_field_error"));return}n.drillClickDimensionList.length<V.view.drillFields.length-1?(n.drillClickDimensionList.push({dimensionList:e.data.dimensionList,extra:e.extra}),i.value.chartExtRequest=te(),Re(i.value)):V.view.drillFields.length>0&&Be.error(f("chart.last_layer"))},te=e=>{const{filter:t}=qi(i.value.id,e);return{user:a.get("user.uid"),filter:t,linkageFilters:k.value.linkageFilters,outerParamsFilters:k.value.outerParamsFilters,drill:n.drillClickDimensionList,resultCount:g.value,resultMode:I.value}},N=e=>{n.drillFilters=e||[]},Se=R(null),Ne=e=>{if(Se!=null&&Se.value){const t={methodName:"initOpenHandler",args:e};Se.value.invokeMethod(t)}},je=e=>{J().emitter.emit("changeCurrentComponent",e)},ge=(e,t,r="middle")=>{try{let u;if(t==="newPop"){let v,w;r==="large"?(v=.95,w=.9):r==="middle"?(v=.8,w=.75):(v=.6,w=.5);const B=screen.height*w,U=screen.width*v,F=screen.width*((1-v)/2),W=screen.height*((1-w)/2);u=window.open(e,"_blank",`width=${U},height=${B},left=${F},top=${W},toolbar=no,scrollbars=yes,resizable=yes,location=no`)}else t==="_self"?(u=window.open(e,t),Te.value&&window.location.reload()):u=window.open(e,t);Ne(u)}catch{console.warn(f("visualization.url_check_error")+":"+e)}},we=e=>{let t,r,u;if(e.name)e.dimensionList.forEach(v=>{(v.id===e.name||v.value===e.name)&&(t=v,u=e.viewId+"#"+t.id,r=D.value[u])});else for(let v=e.dimensionList.length-1;v>=0&&(t=e.dimensionList[v],u=e.viewId+"#"+t.id,r=D.value[u],!r);v--);if(r){ei(p.getViewDataDetails(e.viewId),e),e.sourceDvId=ne.value.id,e.sourceViewId=e.viewId,e.sourceFieldId=t.id;let v="";const w=j.value&&r.jumpType==="_self",B=Z.value&&r.jumpType==="_self";if(j.value&&(v=z.baseUrl),r.linkType==="inner")if(r.targetDvId)if(ue.value)if(r.publicJumpId){const U=`${v}#/de-link/${r.publicJumpId}?fromLink=true&jumpInfoParam=${encodeURIComponent($e.encode(JSON.stringify(e)))}`,F=window.location.href;localStorage.setItem("beforeJumpUrl",F),ge(U,r.jumpType,r.windowSize)}else Be.warning(f("visualization.public_link_tips"));else{const U=`${v}#/preview?dvId=${r.targetDvId}&fromLink=true&jumpInfoParam=${encodeURIComponent($e.encode(JSON.stringify(e)))}`,F=window.location.href;if(localStorage.setItem("beforeJumpUrl",F),(Z.value||j.value)&&z.clearState(),w){z.setDvId(r.targetDvId),z.setJumpInfoParam(encodeURIComponent($e.encode(JSON.stringify(e)))),je("Preview");return}if(B){Pt.push(Ui(U));return}ge(U,r.jumpType,r.windowSize)}else Be.warning("未指定跳转仪表板");else{const U=[...e.dimensionList,...e.quotaList];let F=pi("id","value",r.content,U);if(F=hi(F),(Z.value||j.value)&&z.clearState(),w){z.setOuterUrl(F),je("Iframe");return}ge(F,r.jumpType,r.windowSize)}}},Ae=(e=!1)=>{if(Y.value)return;const t=p.firstLoadMap.includes(k.value.id),r=te(t?!1:e);let u=xt(i.value);u.chartExtRequest=r,he.value=r,Re(u)},Re=e=>{var t,r,u;p.setLastViewRequestInfo(e.id,e.chartExtRequest),l!=null&&l.value&&(Y.value=!0,i.value.isPlugin?(t=l==null?void 0:l.value)==null||t.invokeMethod({methodName:"calcData",args:[e,v=>{Y.value=!1}]}):(u=(r=l==null?void 0:l.value)==null?void 0:r.calcData)==null||u.call(r,e,v=>{Y.value=!1}))},Ve=(...e)=>{var t,r;if((t=i.value)!=null&&t.render&&((r=i.value)!=null&&r.type)){const u=mt.getChartView(i.value.render,i.value.type);return u&&(e==null?void 0:e.includes(u.library))}else return!1};qt(()=>{M.value.includes("viewDialog")||fe(()=>{J({name:`query-data-${i.value.id}`,callback:Ae})})});const Ct=y(()=>!M.value.includes("viewDialog")),ye=R(!1),Ze=e=>{var t,r,u;if(ye.value=!1,(t=i.value)!=null&&t.render&&((r=i.value)!=null&&r.type)){const v=mt.getChartView(i.value.render,i.value.type);if(!v)return;const w=ri(i.value.customAttr).map;if(["bubble-map","map"].includes((u=i.value)==null?void 0:u.type)&&!(w!=null&&w.id)){ye.value=!0;return}const B=new Map(Object.entries(v.axisConfig));let U=!1;if(e&&e.length>0&&B.forEach((F,W)=>{var le,xe;if(((xe=(le=i.value)==null?void 0:le[W])==null?void 0:xe.length)>0&&(i.value[W].forEach(be=>{if(!e.find(Ce=>Ce.id===be.id))return U=!0,!1}),U))return!1}),U){ye.value=!0;return}B.forEach((F,W)=>{var le,xe,be,Ce,Xe,qe,ut,ct;if(!F.allowEmpty&&!F.limit&&((xe=(le=i.value)==null?void 0:le[W])==null?void 0:xe.length)===0||!F.allowEmpty&&F.limit&&(!((be=i.value)!=null&&be[W])||((Xe=(Ce=i.value)==null?void 0:Ce[W])==null?void 0:Xe.length)<parseInt(F.limit))||((qe=i.value)==null?void 0:qe.type)==="table-info"&&((ct=(ut=i.value)==null?void 0:ut[W])==null?void 0:ct.length)===0)return ye.value=!0,!1})}},kt=()=>{Ze()},_t=()=>{Ze()};Bt(()=>{if(i.value.isPlugin||Ae(!M.value.includes("viewDialog")),!Ct.value)return;J({name:"checkShowEmpty",callback:u=>{var v;((v=u.view)==null?void 0:v.id)===i.value.id&&Ze(u.allFields)}}),J({name:"chart-type-change",callback:kt}),J({name:"dataset-change",callback:_t}),J({name:"clearPanelLinkage",callback:function(u){var v,w;(u.viewId==="all"||u.viewId===k.value.id)&&((w=(v=l==null?void 0:l.value)==null?void 0:v.clearLinkage)==null||w.call(v))}}),J({name:"snapshotChangeToView",callback:function(u){P(),fe(()=>{var v,w;u.snapshotCacheViewCalc.includes(i.value.id)||u.snapshotCacheViewCalc.includes("all")?(i.value.chartExtRequest=te(!1),Re(i.value)):(u.snapshotCacheViewRender.includes(i.value.id)||u.snapshotCacheViewRender.includes("all"))&&((w=(v=l==null?void 0:l.value)==null?void 0:v.renderChart)==null||w.call(v,i.value))})}}),J({name:"calcData-"+i.value.id,callback:function(u){n.initReady&&(P(),fe(()=>{i.value.chartExtRequest=te(!1);const v=u||i.value;Re(v)}))}}),J({name:"calcData-all",callback:function(){n.initReady&&(P(),fe(()=>{i.value.chartExtRequest=te(!1),Re(i.value)}))}}),J({name:"renderChart-"+i.value.id,callback:function(u){if(!n.initReady)return;P();const v=u||i.value;fe(()=>{var w,B;(B=(w=l==null?void 0:l.value)==null?void 0:w.renderChart)==null||B.call(w,v)})}}),J({name:"resetDrill-"+i.value.id,callback:function(u){fe(()=>{oe(u)})}}),J({name:"tabCanvasChange-"+k.value.canvasId,callback:function(){!n.initReady&&!i.value.type.includes("table")||setTimeout(function(){var u,v;(v=(u=l==null?void 0:l.value)==null?void 0:u.renderChart)==null||v.call(u,i.value)},200)}}),J({name:"updateTitle-"+i.value.id,callback:()=>{P()}});const{refreshViewEnable:e,refreshUnit:t,refreshTime:r}=i.value;Ee(e,t,r),P()});const nt=y(()=>(O.value.refreshViewLoading||_e.value===0)&&Y.value),lt=y(()=>{var e,t,r;return!!(i.value.tableId&&(k.value.state===void 0||k.value.state==="ready")||["rich-text","picture-group"].includes(i.value.type)||(e=i.value)!=null&&e.isPlugin||i.value.dataFrom==="template"||(r=(t=i.value.customAttr)==null?void 0:t.map)!=null&&r.id&&["map","bubble-map","flow-map"].includes(i.value.type))}),at=R(),Me=R(!1);function St(){V.active&&(Me.value||(Me.value=!0,fe(()=>{var e;(e=at.value)==null||e.focus(),k.value.editing=!0})))}function rt(){k.value.editing=!1,Me.value=!1}const bt={beforeMount(e,t){e.clickOutsideEvent=function(r){e===r.target||e.contains(r.target)||t.value(r)},document.addEventListener("click",e.clickOutsideEvent)},unmounted(e){document.removeEventListener("click",e.clickOutsideEvent)}};function It(){Oe.recordSnapshotCache()}const He=y(()=>V.themes==="dark"?"ndark":"dark"),Ft=y(()=>pe.value||m.value.length>0||n.title_remark.show?12*H.value+"px":0),ze=y(()=>16*H.value+"px"),Lt=y(()=>({color:O.value.component.seniorStyleSetting.linkageIconColor})),Ye=R(!1),Dt=y(()=>Ye.value?m.value.length>0||n.title_remark.show:!1),ot=R(li),Tt=y(()=>{let e=!1;return ot.value.forEach(t=>{e=t.details.find(r=>{var u;return((u=i.value)==null?void 0:u.type)===r.value})!==void 0}),e}),Et=e=>{e.forEach(t=>{var be;const{category:r,title:u,render:v,chartValue:w,chartTitle:B,icon:U,staticMap:F}=t,W={render:v,category:r,icon:U,value:w,title:B,isPlugin:!0,staticMap:F};((be=i.value)==null?void 0:be.type)===W.value&&(i.value.plugin={isPlugin:!0,staticMap:F});const le=[...ot.value];let xe=!1;for(;le!=null&&le.length;){const Ce=le.pop();Ce.category===r&&(Ce.details.find(qe=>qe.value===W.value)||Ce.details.push(W),xe=!0)}xe||le.push({category:r,title:u,display:"show",details:[W]})})},st=y(()=>["rich-text","picture-group"].includes(k.value.innerType)),At=y(()=>Te.value?`${screen.width-10}px`:De.value?"270px":"500px");return(e,t)=>{var w;const r=zt,u=Ci,v=Jt("loading");return Qe((_(),se("div",{class:dt(["chart-area report-load",{"report-load-finish":!nt.value}]),"element-loading-background":"rgba(0,0,0,0)",onMouseover:t[4]||(t[4]=B=>Ye.value=!0),onMouseleave:t[5]||(t[5]=B=>Ye.value=!1)},[ve("div",{class:"title-container",style:me({"justify-content":x.value,"margin-bottom":Ft.value})},[Me.value?Qe((_(),Q(c(jt),{key:1,style:{flex:"1"},effect:c(O).dashboard.themeColor,ref_key:"titleInputRef",ref:at,modelValue:c(i).title,"onUpdate:modelValue":t[0]||(t[0]=B=>c(i).title=B),onKeydown:[t[1]||(t[1]=Ut(()=>{},["stop"])),Wt(rt,["enter"])],onChange:It},null,8,["effect","modelValue"])),[[bt,rt]]):(_(),se($t,{key:0},[pe.value?(_(),se("p",{key:0,style:me(n.title_class),onDblclick:St},We(c(i).title),37)):re("",!0)],64)),$(Gt,{name:"fade"},{default:G(()=>[Qe(ve("div",{class:dt(["icons-container",{"is-editing":Me.value}]),style:me(Lt.value)},[n.title_remark.show?(_(),Q(u,{key:0,effect:He.value,placement:"top"},{content:G(()=>[ve("div",{style:me({maxWidth:At.value,wordBreak:"break-all",wordWrap:"break-word",whiteSpace:"pre-wrap"}),innerHTML:n.title_remark.remark},null,12,Wi)]),default:G(()=>[$(c(Je),{size:ze.value,class:"inner-icon"},{default:G(()=>[$(r,{name:"icon_info_outlined"},{default:G(()=>[$(c(Xt),{class:"svg-icon"})]),_:1})]),_:1},8,["size"])]),_:1},8,["effect"])):re("",!0),b.value?(_(),Q(u,{key:1,effect:He.value,placement:"top",content:"已设置联动"},{default:G(()=>[$(c(Je),{size:ze.value,class:"inner-icon"},{default:G(()=>[$(r,{name:"icon_link-record_outlined"},{default:G(()=>[$(c(bi),{class:"svg-icon"})]),_:1})]),_:1},8,["size"])]),_:1},8,["effect"])):re("",!0),T.value?(_(),Q(u,{key:2,effect:He.value,placement:"top",content:"已设置跳转"},{default:G(()=>[$(c(Je),{size:ze.value,class:"inner-icon"},{default:G(()=>[$(r,{name:"icon_viewinchat_outlined"},{default:G(()=>[$(c(Li),{class:"svg-icon"})]),_:1})]),_:1},8,["size"])]),_:1},8,["effect"])):re("",!0),ee.value?(_(),Q(u,{key:3,effect:He.value,placement:"top",content:"已设置下钻"},{default:G(()=>[$(c(Je),{size:ze.value,class:"inner-icon"},{default:G(()=>[$(r,{name:"icon_drilling_outlined"},{default:G(()=>[$(c(Ei),{class:"svg-icon"})]),_:1})]),_:1},8,["size"])]),_:1},8,["effect"])):re("",!0)],6),[[Yt,Dt.value]])]),_:1})],4),st.value||lt.value&&!ye.value?(_(),se("div",Gi,[(w=c(i).plugin)!=null&&w.isPlugin?(_(),Q(c(ci),{key:0,jsname:c(i).plugin.staticMap.index,scale:c(H),"dynamic-area-id":ke.value,view:c(i),"show-position":c(M),element:c(k),request:c(Ht),emitter:c(d),store:c(Vt),suffixId:o.suffixId,ref_key:"chartComponent",ref:l,onOnChartClick:X,onOnPointClick:A,onOnDrillFilters:N,onOnJumpClick:we,onResetLoading:t[2]||(t[2]=()=>Y.value=!1)},null,8,["jsname","scale","dynamic-area-id","view","show-position","element","request","emitter","store","suffixId"])):Ve(c(Fe).PICTURE_GROUP)?(_(),Q(wi,{key:1,themes:c(O).dashboard.themeColor,ref_key:"chartComponent",ref:l,element:c(k),active:c(ce),view:c(i),"show-position":c(M),suffixId:o.suffixId},null,8,["themes","element","active","view","show-position","suffixId"])):Ve(c(Fe).RICH_TEXT)?(_(),Q(gi,{key:2,scale:c(H),themes:c(O).dashboard.themeColor,ref_key:"chartComponent",ref:l,element:c(k),disabled:!["canvas","canvasDataV"].includes(c(M))||o.disabled,active:c(ce),"show-position":c(M),suffixId:o.suffixId},null,8,["scale","themes","element","disabled","active","show-position","suffixId"])):Ve(c(Fe).INDICATOR)?(_(),Q(Ai,{key:3,scale:c(H),themes:c(O).dashboard.themeColor,ref_key:"chartComponent",ref:l,view:c(i),"show-position":c(M),suffixId:o.suffixId},null,8,["scale","themes","view","show-position","suffixId"])):Ve(c(Fe).G2_PLOT,c(Fe).L7_PLOT,c(Fe).L7)?(_(),Q(Qt,{key:4,scale:c(H),"dynamic-area-id":ke.value,view:c(i),"show-position":c(M),element:c(k),suffixId:o.suffixId,ref_key:"chartComponent",ref:l,onOnChartClick:X,onOnPointClick:A,onOnDrillFilters:N,onOnJumpClick:we,onResetLoading:t[3]||(t[3]=()=>Y.value=!1)},null,8,["scale","dynamic-area-id","view","show-position","element","suffixId"])):Ve(c(Fe).S2)?(_(),Q(vi,{key:5,view:c(i),scale:c(H),"show-position":c(M),element:c(k),"drill-length":h.value,ref_key:"chartComponent",ref:l,onOnPointClick:A,onOnChartClick:X,onOnDrillFilters:N,onOnJumpClick:we,suffixId:o.suffixId},null,8,["view","scale","show-position","element","drill-length","suffixId"])):re("",!0)])):re("",!0),(!lt.value||ye.value)&&!st.value?(_(),Q(yi,{key:1,themes:c(O).dashboard.themeColor,"view-icon":c(i).type},null,8,["themes","view-icon"])):re("",!0),$(fi,{"drill-filters":n.drillFilters,onOnDrillJump:oe},null,8,["drill-filters"]),$(c(ft),{ref_key:"openHandler",ref:Se,jsname:"L2NvbXBvbmVudC9lbWJlZGRlZC1pZnJhbWUvT3BlbkhhbmRsZXI="},null,512),!Tt.value&&c(i).isPlugin?(_(),Q(c(ft),{key:2,jsname:"L2NvbXBvbmVudC9wbHVnaW5zLWhhbmRsZXIvVmlld0NhdGVnb3J5SGFuZGxlcg==",onLoadPluginCategory:Et})):re("",!0)],34)),[[v,nt.value]])}}});const ul=ki(Zi,[["__scopeId","data-v-62484d28"]]);export{ul as default};
