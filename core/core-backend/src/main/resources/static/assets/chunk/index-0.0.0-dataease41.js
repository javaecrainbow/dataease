import"./index-0.0.0-dataease.js";import{l as te,_ as ne,e as oe}from"./index-0.0.0-dataease2.js";import{i as F}from"./icon_right_outlined-0.0.0-dataease.js";import{useUserStoreWithOut as le}from"./user-0.0.0-dataease.js";import{mountedOrg as re,switchOrg as ie}from"./user-0.0.0-dataease2.js";import H from"./OrgCell-0.0.0-dataease.js";import{d as X,r as g,D as se,m as Y,w as ce,a as ue,o as ee,n as M,k as i,U as de,ab as ve,a5 as W,a9 as fe,f as m,M as I,Z as N,N as k,j as L,a7 as Z,V as q,g as R,i as O,a0 as G,aa as J}from"./vue-0.0.0-dataease.js";import{l as ge}from"./logout-0.0.0-dataease.js";import{s as he}from"./index-0.0.0-dataease53.js";import{c as me,A as V,i as _e,B as pe,n as $,t as K,k as Q,I as ke,w as ye}from"./index-0.0.0-dataease23.js";import"./index-0.0.0-dataease24.js";import"./index-0.0.0-dataease54.js";import{_ as we}from"./_plugin-vue_export-helper-0.0.0-dataease.js";import"./library-0.0.0-dataease.js";import"./lodash-0.0.0-dataease.js";import"./axios-0.0.0-dataease.js";import"./echarts-0.0.0-dataease.js";import"./tinymce-0.0.0-dataease.js";import"./interactive-0.0.0-dataease.js";import"./dataVisualization-0.0.0-dataease.js";import"./dataset-0.0.0-dataease.js";import"./datasource-0.0.0-dataease.js";import"./app-0.0.0-dataease.js";const[xe,S]=me("image"),Ce={src:String,alt:String,fit:String,position:String,round:Boolean,block:Boolean,width:$,height:$,radius:$,lazyLoad:Boolean,iconSize:$,showError:K,errorIcon:Q("photo-fail"),iconPrefix:String,showLoading:K,loadingIcon:Q("photo"),crossorigin:String,referrerpolicy:String};var be=X({name:xe,props:Ce,emits:["load","error"],setup(t,{emit:_,slots:x}){const y=g(!1),u=g(!0),s=g(),{$Lazyload:w}=se().proxy,T=Y(()=>{const e={width:V(t.width),height:V(t.height)};return _e(t.radius)&&(e.overflow="hidden",e.borderRadius=V(t.radius)),e});ce(()=>t.src,()=>{y.value=!1,u.value=!0});const d=e=>{u.value&&(u.value=!1,_("load",e))},C=()=>{const e=new Event("load");Object.defineProperty(e,"target",{value:s.value,enumerable:!0}),d(e)},B=e=>{y.value=!0,u.value=!1,_("error",e)},c=(e,b,D)=>D?D():i(ke,{name:e,size:t.iconSize,class:b,classPrefix:t.iconPrefix},null),p=()=>{if(u.value&&t.showLoading)return i("div",{class:S("loading")},[c(t.loadingIcon,S("loading-icon"),x.loading)]);if(y.value&&t.showError)return i("div",{class:S("error")},[c(t.errorIcon,S("error-icon"),x.error)])},E=()=>{if(y.value||!t.src)return;const e={alt:t.alt,class:S("img"),style:{objectFit:t.fit,objectPosition:t.position},crossorigin:t.crossorigin,referrerpolicy:t.referrerpolicy};return t.lazyLoad?de(i("img",W({ref:s},e),null),[[ve("lazy"),t.src]]):i("img",W({ref:s,src:t.src,onLoad:d,onError:B},e),null)},P=({el:e})=>{const b=()=>{e===s.value&&u.value&&C()};s.value?b():M(b)},z=({el:e})=>{e===s.value&&!y.value&&B()};return w&&pe&&(w.$on("loaded",P),w.$on("error",z),ue(()=>{w.$off("loaded",P),w.$off("error",z)})),ee(()=>{M(()=>{var e;(e=s.value)!=null&&e.complete&&!t.lazyLoad&&C()})}),()=>{var e;return i("div",{class:S({round:t.round,block:t.block}),style:T.value},[E(),p(),(e=x.default)==null?void 0:e.call(x)])}}});const Ie=ye(be);var Le=Ie;const Se=""+new URL("../png/user-0.0.0-dataease.png",import.meta.url).href;const Be={class:"de-mobile-user"},Ee={class:"mobile-user-top"},Pe={class:"user-name"},ze={class:"grey"},De=["onClick"],Ne=X({__name:"index",setup(t){const _=le(),{push:x}=fe(),y=g("组织"),u=g(""),s=g(!0),w=async()=>{await te(),ge(),x("/login")},T=()=>{s.value=!1},d=g("");let C=null;const B=()=>{var o;const n=[...C];for(;n.length;){const a=n.pop();if((a==null?void 0:a.id)===_.getOid){u.value=a==null?void 0:a.name;break}(o=a==null?void 0:a.children)!=null&&o.length&&a.children.forEach(f=>n.push(f))}};let c=[],p=[];const E=(n,o)=>{n.forEach(a=>{var j;const{name:f,id:r}=a;o<=c.length?(o<c.length&&(c=c.slice(0,o),p=p.slice(0,o)),c.splice(c.length-1,1,r),p.splice(p.length-1,1,f)):(c.push(r),p.push(f));let h=o+1;r===_.getOid&&(l.value=[...p],v.value=[...c],h=999),(j=a==null?void 0:a.children)!=null&&j.length&&h!==999&&E(a==null?void 0:a.children,h)})};ee(()=>{re().then(n=>{C=n.data,U.value=n.data,B(),E(C,1),l.value.pop(),v.value.pop(),d.value=l.value[l.value.length-1]})});const P=n=>{ie(n).then(o=>{const a=o.data.token;_.setToken(a),_.setExp(o.data.exp),window.location.reload()})},z=()=>{l.value.pop(),d.value=l.value[l.value.length-1],v.value.pop(),l.value.length||(s.value=!0)},e=()=>{l.value.length&&(l.value=[],d.value="",v.value=[])},b=(n,o)=>{n!=="right"?P(o.id):(l.value.push(o.name),d.value=o.name,v.value.push(o.id))},D=n=>{n!==v.value.length-1&&(v.value=v.value.slice(0,n+1),l.value=l.value.slice(0,n+1),d.value=l.value[l.value.length-1])},U=g([]),l=g([]),v=g([]),A=(n,o)=>{const a=n.shift();return o.reduce((f,r)=>{if(a&&r.id===a){if(!n.length)return r.children||[];f=A([...n],r.children||[])||[]}return f},[])},ae=Y(()=>v.value.length?A([...v.value],U.value):U.value);return(n,o)=>{const a=ne,f=oe;return m(),I("div",Be,[s.value?(m(),I(N,{key:0},[o[0]||(o[0]=k("div",{class:"logout flex-center"},"我的",-1)),k("div",Ee,[i(L(Le),{round:"",width:"48",height:"48",src:L(Se)},null,8,["src"]),k("div",Pe,Z(L(_).name),1)]),i(H,{onClick:T,label:"切换组织","prefix-icon":"icon_switch_outlined",tips:u.value,nextlevel:""},null,8,["tips"]),k("div",{class:"logout flex-center danger",onClick:w},"注销")],64)):(m(),I(N,{key:1},[i(L(he),{"safe-area-inset-top":"",title:d.value||y.value,"left-arrow":"",onClickLeft:z},null,8,["title"]),k("div",ze,[k("div",{onClick:e,class:"flex-align-center"},[k("span",{class:q(["ellipsis",!!l.value.length&&"active"])},"组织",2),l.value.length?(m(),R(f,{key:0},{default:O(()=>[i(a,{name:"icon_right_outlined"},{default:O(()=>[i(L(F),{class:"svg-icon"})]),_:1})]),_:1})):G("",!0)]),(m(!0),I(N,null,J(l.value,(r,h)=>(m(),I("div",{onClick:j=>D(h),class:"flex-align-center",key:r},[k("span",{class:q(["ellipsis",r!==d.value&&"active"])},Z(r),3),l.value.length>1&&h!==l.value.length-1?(m(),R(f,{key:0},{default:O(()=>[i(a,{name:"icon_right_outlined"},{default:O(()=>[i(L(F),{class:"svg-icon"})]),_:1})]),_:1})):G("",!0)],8,De))),128))]),(m(!0),I(N,null,J(ae.value,r=>(m(),R(H,{onClick:h=>b(h,r),key:r.id,label:r.name,nextlevel:r.children,active:u.value===r.name},null,8,["onClick","label","nextlevel","active"]))),128))],64))])}}});const na=we(Ne,[["__scopeId","data-v-57d0c2e5"]]);export{na as default};
