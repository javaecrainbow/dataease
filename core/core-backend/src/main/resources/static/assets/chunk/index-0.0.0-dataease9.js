import{b as Qa,Q as el,u as jt}from"./index-0.0.0-dataease.js";import"./el-form-0.0.0-dataease.js";import{a as tl,E as al}from"./el-form-item-0.0.0-dataease.js";import{E as ll}from"./el-dialog-0.0.0-dataease.js";import{j as ol,x as dt,K as sl,w as Ve,y as nl,n as il,e as w,_ as y,k as Pt}from"./index-0.0.0-dataease2.js";import{E as dl}from"./el-drawer-0.0.0-dataease.js";import{a as rl,E as cl}from"./el-collapse-item-0.0.0-dataease.js";import{E as ul,r as Xt}from"./AddSql-0.0.0-dataease.js";import"./el-popper-0.0.0-dataease.js";import"./el-tag-0.0.0-dataease.js";import"./el-cascader-panel-0.0.0-dataease.js";import"./el-checkbox-0.0.0-dataease.js";import"./el-radio-0.0.0-dataease.js";import{E as ml,a as pl}from"./el-table-column-0.0.0-dataease.js";import"./el-tooltip-0.0.0-dataease.js";import{E as fl}from"./el-tree-0.0.0-dataease.js";import{a as vl,E as _l}from"./el-tabs-0.0.0-dataease.js";import"./el-select-0.0.0-dataease.js";import{E as hl}from"./el-tree-select-0.0.0-dataease.js";import{f as m,M as C,a8 as ta,d as gl,r as v,_ as zt,w as yl,s as rt,m as Be,o as Cl,a as bl,ab as wl,U as Q,N as c,k as l,i as s,j as a,Z as ct,a7 as p,a0 as P,X as Se,W as Le,V as D,a6 as b,g as x,n as ye,u as Tl,a9 as xl,h as Fl,S as kl,an as El,q as I,aa as Nl,am as Dl}from"./vue-0.0.0-dataease.js";import{d as Vl}from"./dv-folder-0.0.0-dataease.js";import{i as Gt}from"./icon_left_outlined-0.0.0-dataease.js";import{i as Sl}from"./icon_right_outlined-0.0.0-dataease.js";import{i as Ll}from"./icon_search-outline_outlined-0.0.0-dataease.js";import{i as Al}from"./icon_add_outlined-0.0.0-dataease.js";import{i as Il}from"./icon_refresh_outlined-0.0.0-dataease.js";import{i as Jt}from"./icon_expand-right_filled-0.0.0-dataease.js";import{F as Wt,i as Yt}from"./FieldMore-0.0.0-dataease.js";import{i as Kt}from"./icon_copy_outlined-0.0.0-dataease.js";import{i as Qt}from"./icon_delete-trash_outlined-0.0.0-dataease.js";import{i as ea}from"./icon_edit_outlined-0.0.0-dataease.js";import{F as $l}from"./fixed-size-list-0.0.0-dataease.js";import{E as Ml}from"./EmptyBackground-0.0.0-dataease.js";import ql from"./CalcFieldEdit-0.0.0-dataease.js";import Ul from"./UnionEdit-0.0.0-dataease.js";import Hl from"./CreatDsGroup-0.0.0-dataease.js";import{g as Re,a as Bl,b as Rl}from"./util-0.0.0-dataease.js";import{f as S}from"./attr-0.0.0-dataease20.js";import{useAppStoreWithOut as Ol}from"./app-0.0.0-dataease.js";import{l as Zl,m as jl,f as Pl,n as Xl,o as zl,s as Gl}from"./dataset-0.0.0-dataease.js";import{_ as Jl}from"./DatasetUnion.vue_vue_type_style_index_0_lang-0.0.0-dataease.js";import{i as $}from"./field-list-0.0.0-dataease.js";import{i as Wl}from"./datasource-list-0.0.0-dataease.js";import{e as Yl,d as ee}from"./lodash-0.0.0-dataease.js";import{E as Kl}from"./index-0.0.0-dataease4.js";import{_ as Ql}from"./_plugin-vue_export-helper-0.0.0-dataease.js";import"./library-0.0.0-dataease.js";import"./use-dialog-0.0.0-dataease.js";import"./refs-0.0.0-dataease.js";import"./axios-0.0.0-dataease.js";import"./echarts-0.0.0-dataease.js";import"./tinymce-0.0.0-dataease.js";import"./user-0.0.0-dataease.js";import"./index-0.0.0-dataease12.js";import"./el-date-picker-0.0.0-dataease.js";import"./dayjs.min-0.0.0-dataease.js";import"./arrays-0.0.0-dataease.js";import"./index-0.0.0-dataease15.js";import"./index-0.0.0-dataease5.js";import"./el-empty-0.0.0-dataease.js";import"./el-virtual-list-0.0.0-dataease.js";import"./el-table-v2-0.0.0-dataease.js";import"./browser-0.0.0-dataease.js";import"./el-popover-0.0.0-dataease.js";import"./dropdown-0.0.0-dataease.js";import"./el-divider-0.0.0-dataease.js";import"./icon_close_outlined-0.0.0-dataease.js";import"./icon_info_outlined-0.0.0-dataease.js";import"./icon_info_colorful-0.0.0-dataease.js";import"./base64-0.0.0-dataease.js";import"./index-0.0.0-dataease16.js";import"./CodeMirror-0.0.0-dataease.js";import"./GridTable-0.0.0-dataease.js";import"./el-pagination-0.0.0-dataease.js";import"./index-0.0.0-dataease14.js";import"./strings-0.0.0-dataease.js";import"./dv-rename-0.0.0-dataease.js";import"./icon_calendar_outlined-0.0.0-dataease.js";import"./more_v-0.0.0-dataease.js";import"./none-0.0.0-dataease.js";import"./nothing-tree-0.0.0-dataease.js";import"./el-input-number-0.0.0-dataease.js";import"./el-row-0.0.0-dataease.js";import"./row-0.0.0-dataease.js";import"./icon_adjustment_outlined-0.0.0-dataease.js";import"./UnionFieldList-0.0.0-dataease.js";import"./UnionItemEdit-0.0.0-dataease.js";import"./icon_right-association-0.0.0-dataease.js";import"./join-join-0.0.0-dataease.js";import"./icon_rename_outlined-0.0.0-dataease.js";import"./HandleMore.vue_vue_type_style_index_0_lang-0.0.0-dataease.js";import"./el-dropdown-menu-0.0.0-dataease.js";import"./el-dropdown-item-0.0.0-dataease.js";import"./appearance-0.0.0-dataease.js";import"./font-0.0.0-dataease.js";import"./antv-0.0.0-dataease.js";const eo={width:"16",height:"16",viewBox:"0 0 16 16",xmlns:"http://www.w3.org/2000/svg"};function to(de,U){return m(),C("svg",eo,U[0]||(U[0]=[ta('<g id="icon_sql_outlined"><g id="Union"><path d="M3.73875 8.736V8.60266H2.66342L2.66143 8.73398C2.65762 8.98596 2.70337 9.21143 2.8045 9.40559C2.90241 9.59358 3.03463 9.74989 3.2009 9.87261L3.20211 9.87349C3.3693 9.99402 3.55876 10.0807 3.76906 10.1343C3.97937 10.1906 4.19515 10.2187 4.41609 10.2187C4.68545 10.2187 4.92669 10.1874 5.1378 10.1222C5.34961 10.0578 5.53149 9.96695 5.67904 9.84731C5.82907 9.72491 5.94364 9.57892 6.02023 9.40962C6.09609 9.24194 6.13342 9.06129 6.13342 8.86933C6.13342 8.638 6.08342 8.4359 5.97261 8.27307C5.87491 8.12108 5.7558 7.99733 5.61464 7.90457C5.48072 7.81656 5.34269 7.75187 5.20064 7.71214C5.07741 7.67346 4.97621 7.64561 4.899 7.62994C4.66262 7.56996 4.4704 7.52058 4.32226 7.48178C4.18072 7.4438 4.0736 7.40713 3.99797 7.37258C3.92618 7.33811 3.89834 7.30959 3.88964 7.29545C3.87812 7.27672 3.86675 7.24291 3.86675 7.184C3.86675 7.12132 3.88029 7.0814 3.89769 7.05529C3.92312 7.01714 3.95447 6.98562 3.99243 6.96002C4.03522 6.93355 4.0822 6.91475 4.13422 6.9038C4.19294 6.89144 4.25129 6.88533 4.30942 6.88533C4.405 6.88533 4.48995 6.89359 4.56489 6.9092L4.56594 6.90941C4.64097 6.92441 4.70351 6.94919 4.75555 6.98206C4.80217 7.0115 4.83972 7.05217 4.86856 7.10724L4.87099 7.11148C4.9008 7.16365 4.92211 7.23655 4.92835 7.33631L4.93616 7.46133H6.00542V7.328C6.00542 7.09131 5.95973 6.88155 5.86141 6.70462C5.76997 6.5303 5.64409 6.38644 5.48455 6.27477C5.32744 6.16479 5.1483 6.08729 4.94889 6.04109C4.75657 5.9922 4.55573 5.968 4.34675 5.968C4.1639 5.968 3.98152 5.99278 3.7999 6.04197C3.61506 6.09203 3.44764 6.1696 3.29886 6.27531C3.14805 6.38246 3.02504 6.51755 2.93035 6.67931L2.92983 6.6802C2.83438 6.84621 2.78942 7.03894 2.78942 7.25333C2.78942 7.44367 2.82432 7.61498 2.90011 7.76235L2.90236 7.76637C2.9785 7.90262 3.07744 8.01798 3.19896 8.11115C3.31621 8.20104 3.44808 8.27454 3.59378 8.33205L3.59666 8.33311C3.73574 8.38435 3.87835 8.42826 4.02447 8.46486C4.16423 8.50425 4.3023 8.54011 4.43869 8.57241C4.56867 8.60319 4.68311 8.63868 4.78257 8.67846C4.87681 8.71616 4.94548 8.76069 4.99377 8.80898L4.99639 8.81146C5.03435 8.84742 5.05609 8.89446 5.05609 8.96533C5.05609 9.03643 5.03834 9.08573 5.01058 9.12208C4.9741 9.16593 4.92816 9.20162 4.87076 9.22895C4.80857 9.25856 4.74142 9.2797 4.66879 9.29204C4.5892 9.30189 4.51569 9.30666 4.44809 9.30666C4.34875 9.30666 4.2533 9.29554 4.16148 9.27356C4.07296 9.24893 3.99768 9.21464 3.93414 9.17183C3.87737 9.12793 3.83023 9.07132 3.79305 8.99982C3.75907 8.93447 3.73875 8.84836 3.73875 8.736Z"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M10.2467 9.94025L9.76461 9.50152C9.89584 9.33145 9.99908 9.1408 10.0745 8.93029C10.1655 8.67632 10.2103 8.40319 10.2103 8.112C10.2103 7.8142 10.1656 7.53601 10.0748 7.27859C9.98421 7.01824 9.85316 6.78963 9.68094 6.59445C9.50771 6.39812 9.29635 6.24476 9.04862 6.13423C8.79781 6.02233 8.51571 5.968 8.20496 5.968C7.89747 5.968 7.61574 6.02243 7.36199 6.13393L7.3613 6.13423C7.11358 6.24476 6.90221 6.39812 6.72898 6.59445C6.55676 6.78963 6.42571 7.01824 6.33512 7.27859C6.24431 7.53601 6.19963 7.8142 6.19963 8.112C6.19963 8.40321 6.24468 8.67847 6.33544 8.93563C6.42627 9.18921 6.55759 9.41246 6.72985 9.60386C6.90306 9.79631 7.11415 9.94752 7.36129 10.0578L7.36355 10.0587C7.61689 10.1662 7.89807 10.2187 8.20496 10.2187C8.54665 10.2187 8.84912 10.1569 9.10796 10.0284L9.67299 10.5375L10.2467 9.94025ZM7.99391 9.01558L8.25457 9.2529C8.23915 9.25318 8.22262 9.25333 8.20496 9.25333C8.03365 9.25333 7.89703 9.22114 7.78956 9.16335C7.67575 9.09853 7.585 9.01485 7.5154 8.91196C7.44287 8.80474 7.3886 8.68419 7.35307 8.54932C7.32015 8.4071 7.30363 8.26139 7.30363 8.112C7.30363 7.95492 7.32028 7.80354 7.35333 7.65762C7.38906 7.5153 7.44346 7.39173 7.51541 7.28538L7.51639 7.28389C7.586 7.17796 7.67614 7.09532 7.78838 7.03465L7.79077 7.03329C7.8979 6.97249 8.03399 6.93866 8.20496 6.93866C8.37593 6.93866 8.51201 6.97251 8.61913 7.03331L8.62156 7.03463C8.73379 7.09529 8.82391 7.17797 8.89352 7.28389L8.89452 7.28537C8.96615 7.39126 9.01866 7.51431 9.05091 7.65622L9.05161 7.659C9.08798 7.80449 9.10629 7.95539 9.10629 8.112C9.10629 8.30607 9.08578 8.46482 9.04792 8.59102C9.02689 8.6611 9.00256 8.72358 8.97527 8.77894L8.56563 8.4047L7.99391 9.01558Z"></path><path d="M11.62 6.05866H10.516V10.1333H13.476V9.16266H11.62V6.05866Z"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M1.33341 2C0.965225 2 0.666748 2.29848 0.666748 2.66667V13.3333C0.666748 13.7015 0.965225 14 1.33341 14H14.6667C15.0349 14 15.3334 13.7015 15.3334 13.3333V2.66667C15.3334 2.29848 15.0349 2 14.6667 2H1.33341ZM2.00008 3.33333V12.6667H14.0001V3.33333H2.00008Z"></path></g></g>',1)]))}const ao={render:to},lo={width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function oo(de,U){return m(),C("svg",lo,U[0]||(U[0]=[ta('<g clip-path="url(#clip0_1052_111876)"><path d="M8.00033 15.3332C12.0504 15.3332 15.3337 12.0499 15.3337 7.99984C15.3337 3.94975 12.0504 0.666504 8.00033 0.666504C3.95024 0.666504 0.666992 3.94975 0.666992 7.99984C0.666992 12.0499 3.95024 15.3332 8.00033 15.3332Z" fill="#FF8800"></path><path d="M7.66634 4.6665C7.48225 4.6665 7.33301 4.81574 7.33301 4.99984V8.99984C7.33301 9.18393 7.48225 9.33317 7.66634 9.33317H8.33301C8.5171 9.33317 8.66634 9.18393 8.66634 8.99984V4.99984C8.66634 4.81574 8.5171 4.6665 8.33301 4.6665H7.66634Z" fill="white"></path><path d="M7.66634 9.99984C7.48225 9.99984 7.33301 10.1491 7.33301 10.3332V10.9998C7.33301 11.1839 7.48225 11.3332 7.66634 11.3332H8.33301C8.5171 11.3332 8.66634 11.1839 8.66634 10.9998V10.3332C8.66634 10.1491 8.5171 9.99984 8.33301 9.99984H7.66634Z" fill="white"></path></g><defs><clipPath id="clip0_1052_111876"><rect width="16" height="16" fill="white"></rect></clipPath></defs>',2)]))}const so={render:oo},no={class:"de-dataset-form"},io={class:"top"},ro={class:"name"},co={key:0,class:"ed-form-item__error"},uo={class:"oprate"},mo={class:"table-list-top"},po={class:"select-ds"},fo={class:"left-outlined"},vo={class:"flex-align-center icon"},_o={key:0},ho={class:"select-ds table-num"},go={class:"num"},yo={key:0,class:"el-empty"},Co={class:"el-empty__description",style:{"margin-top":"80px",color:"#5e6d82","text-align":"center"}},bo={key:1,class:"table-checkbox-list"},wo={class:"label"},To=["title","onDragstart","onClick"],xo={class:"label"},Fo={key:0,class:"different-datasource"},ko={class:"sql-title"},Eo={class:"field-data"},No={class:"table-preview"},Do={class:"preview-field"},Vo={class:"custom-tree-node father"},So=["title"],Lo={class:"operate child"},Ao={class:"custom-tree-node father"},Io=["title"],$o={class:"operate child"},Mo={class:"preview-data"},qo={class:"flex-align-center"},Uo=["title"],Ho={class:"batch-area"},Bo={class:"manage-container"},Ro={class:"column-style"},Oo={class:"column-style"},Zo={key:0},jo={key:1,style:{color:"#8d9199"}},Po={class:"column-style"},Xo={key:0},zo={key:1,style:{color:"#8d9199"}},Go={class:"select-svg-icon"},Jo={class:"column-style"},Wo={key:0,class:"flex-align-center icon"},Yo={key:1,style:{color:"#8d9199"}},Ko={class:"column-style"},Qo={class:"column-style"},es={key:0},ts={key:1,style:{color:"#8d9199"}},as={class:"column-style"},ls={key:0},os={key:1,style:{color:"#8d9199"}},ss={class:"select-svg-icon"},ns={class:"column-style"},is={key:0,class:"flex-align-center icon"},ds={key:1,style:{color:"#8d9199"}},rs={key:0,class:"batch-operate flex-align-center"},cs={class:"flex-align-center"},us={class:"num"},ms={key:0,class:"cascader-batch"},ps={class:"select-svg-icon"};function fs(de){return typeof de=="function"||Object.prototype.toString.call(de)==="[object Object]"&&!Dl(de)}const vs=gl({__name:"index",setup(de){const U=Ol(),te=Qa(),{t:d}=ol(),Oe=Tl(),{push:aa}=xl(),Ae=v(238),ut=v(),re=v(!1),ae=v(),ce=v(!1),k=v(),X=v(d("data_set.unnamed_dataset")),ue=v("preview"),la=v(""),le=v(""),Ce=v(""),be=v(!1),Ze=v(!1),oe=v(240),mt=v(0),pt=v(0),me=v(!0),Ie=v(!1),we=v(!1),G=v(!1),ft=v(),je=v({}),T=v({dateFormat:"",id:"",dateFormatType:"",name:"",idArr:[]});let Pe=!1;const vt=t=>[d("dataset.text"),d("dataset.time"),d("dataset.value"),d("dataset.value")+"("+d("dataset.float")+")",d("dataset.value"),d("dataset.location")][t],_t=()=>{Pe=!0},Xe=[{label:d("dataset.text"),value:0},{label:d("dataset.time"),value:1,children:[{value:"yyyy-MM-dd",label:"yyyy-MM-dd"},{value:"yyyy/MM/dd",label:"yyyy/MM/dd"},{value:"yyyy-MM-dd HH:mm:ss",label:"yyyy-MM-dd HH:mm:ss"},{value:"yyyy/MM/dd HH:mm:ss",label:"yyyy/MM/dd HH:mm:ss"},{value:"custom",label:d("visualization.custom")}]},{label:d("dataset.location"),value:5},{label:d("dataset.value"),value:2},{label:d("dataset.value")+"("+d("dataset.float")+")",value:3},{label:"URL",value:7}],ze=[{label:d("dataset.text"),value:0},{label:d("dataset.time"),value:1},{label:d("dataset.location"),value:5},{label:d("dataset.value"),value:2},{label:d("dataset.value")+"("+d("dataset.float")+")",value:3},{label:"URL",value:7}],ht=v(),gt=v(),oa={name:[{required:!0,message:d("data_set.cannot_be_empty_time"),trigger:"blur"}]},sa={name:[{required:!0,message:d("dataset.input_edit_name"),trigger:"blur"}]},Ge=zt({datasourceId:"",name:"",tableName:d("data_set.custom_sql"),type:"sql"});let H={id:"",pid:"",name:""};const yt={children:"children",label:"label"},L=v(260);let Je=[];const Ct=(t,e)=>{let n="";return t.some(i=>{var r;return i.id===e?(n=i.name,!0):((r=i.children)!=null&&r.length&&(n=Ct(i.children,e)||n),!1)}),n},{height:na}=el(),We=t=>t.filter(e=>{var n,i;return e.leaf?!0:((n=e.children)!=null&&n.length&&(e.children=We(e.children||[])),!!((i=e.children)!=null&&i.length))}),ia=t=>Ct(R.dataSourceList,t),$e=()=>{if(U.isDataEaseBi){te.clearState(),jt().emitter.emit("changeCurrentComponent","Dataset");return}const t=te.getToken&&U.getIsIframe?"dataset-embedded":"dataset";aa({name:t,params:{id:H.id}})},da=()=>{Pe?dt.confirm(d("data_set.want_to_exit"),{confirmButtonText:d("dataset.confirm"),cancelButtonText:d("common.cancel"),showCancelButton:!0,confirmButtonType:"primary",type:"warning",autofocus:!1,showClose:!1}).then(()=>{$e()}):$e()},ra=()=>{if(T.value.idArr.length){const{idArr:t}=T.value;f.value.forEach(e=>{t.includes(e.id)&&Object.assign(e,{deTypeArr:[...He]})}),delete T.value.name,ve()}else Y.value.concat(W.value).some(t=>t.id===T.value.id?(delete T.value.name,Object.assign(t,{deTypeArr:[...He]}),!0):!1);T.value.idArr=[],T.value.id="",G.value=!1},ca=()=>{if(T.value.idArr.length){const{name:t,idArr:e}=T.value;f.value.forEach(n=>{e.includes(n.id)&&Object.assign(n,{deType:1,dateFormatType:"custom",dateFormat:t,deTypeArr:[1,"custom"]})}),delete T.value.name,ve(),G.value=!1}else ht.value.validate(t=>{t&&(Y.value.concat(W.value).some(e=>e.id===T.value.id?(e.dateFormat=T.value.name,e.deType=1,e.dateFormatType="custom",!0):!1),G.value=!1)})};yl(Ce,t=>{O.value=Je.filter(e=>e.tableName.toLowerCase().includes(t.toLowerCase()))});const ua=()=>{const t=[];we.value=!0,Ue(t,k.value.getNodeList()),Gl({...H,name:X.value,union:t,allFields:f.value,nodeType:"dataset"}).then(()=>{Pe=!1,Ve.success(d("data_set.saved_successfully")),st&&$e()}).finally(()=>{we.value=!1})},B=(t,e)=>{_t(),ue.value==="manage"&&(Ee.value=ne.value.getSelectionRows().map(i=>i.id),Ne.value=se.value.getSelectionRows().map(i=>i.id));const n=["text","time","value","float","value","location","binary","url"];if(n.includes(e)){t.deType=n.indexOf(e),t.dateFormat="";return}switch(Bl.includes(e)&&(T.value.dateFormat=t.dateFormat,T.value.dateFormatType=t.dateFormatType,t.deType=1,t.dateFormatType=e,t.dateFormat=e),e){case"copy":pa(t);break;case"delete":va(t);break;case"translate":ma(t.id);break;case"editor":ga(t);break;case"rename":ha(t);break;case"custom":T.value.id=t.id,G.value=!0;break}ue.value==="manage"&&ve()},ma=t=>{const e=f.value.find(n=>n.id===t);e.groupType=e.groupType==="d"?"q":"d"},bt=t=>{const e=ie.value.map(n=>n.id);f.value.forEach(n=>{e.includes(n.id)&&(n.groupType=t)}),ve()},pa=t=>{const e=ee(t);e.id=Re(),e.extField=2,e.originName=t.extField===2?t.originName:"["+t.id+"]",e.name=Rl(Y.value.concat(W.value),t.name),e.dataeaseName=null,e.lastSyncTime=null;const n=f.value.findIndex(i=>i.id===t.id);f.value.splice(n+1,0,e)},wt=t=>{const e=[...t];for(;e.length;){const[n]=e;e.shift(),f.value=f.value.filter(u=>u.id!==n);const i=f.value.reduce((u,g)=>(g.extField===2&&(u=[...u,...(g.params||[]).map(F=>F.id)]),u),[]),r=f.value.map(u=>u.id).concat(i);f.value=f.value.filter(u=>{if(u.extField!==2)return!0;const g=u.originName.match(/\[(.+?)\]/g);return!g||g.every(E=>{const _=E.slice(1,-1);return r.includes(_)})?!0:(e.push(u.id),!1)})}},fa=(t,e)=>{const n=[...t];let i=[];for(;n.length;){const[r]=n;n.shift(),e=e.filter(g=>g.id!==r);const u=e.map(g=>g.id);e=e.filter(g=>{if(g.extField!==2)return!0;const F=g.originName.match(/\[(.+?)\]/g);return!F||F.every(_=>{var N;return(N=g.params)==null?void 0:N.map(M=>M.id).includes(_.slice(1,-1))})||F.every(_=>{const N=_.slice(1,-1);return u.includes(N)})?!0:(n.push(g.id),i.push(g.id),!1)})}return i},va=t=>{let e="";e=f.value.reduce((i,r)=>{if(r.extField!==2)return i;let u=r.originName.match(/\[(.+?)\]/g)||[];return u=u.filter(F=>{var E;return!((E=r.params)!=null&&E.map(_=>_.id).includes(F.slice(1,-1)))}),i=[...u.map(F=>F.slice(1,-1)),...i],i},[]).includes(t.id)?d("data_set.deleted_confirm_deletion"):"",dt.confirm(d("data_set.delete_field_a",{a:t.name}),{confirmButtonText:d("dataset.confirm"),tip:e,cancelButtonText:d("common.cancel"),showCancelButton:!0,confirmButtonType:"danger",type:"warning",autofocus:!1,showClose:!1,callback:i=>{i==="confirm"&&(wt([t.id]),k.value.dfsNodeFieldBackReal(t),Ve({message:d("chart.delete_success"),type:"success"}))}})},_a=t=>{re.value=!0,Ye.value=d("dataset.add_calc_field"),ye(()=>{ae.value.initEdit({groupType:t,id:Re()},Y.value,W.value)})},Me=v(!1),J=v({id:"",name:""}),ha=t=>{const{id:e,name:n}=t;J.value={id:e,name:n},Me.value=!0},Ye=v(""),ga=t=>{re.value=!0,ye(()=>{Ye.value=d("dataset.edit_calc_field"),ae.value.initEdit(t,Y.value,W.value)})},Tt=()=>{J.value.id="",J.value.name="",Me.value=!1},ya=()=>{gt.value.validate(t=>{t&&(f.value.some(e=>e.id===J.value.id?(e.name=J.value.name,!0):!1),Tt())})},Ca=()=>{re.value=!1},ba=()=>{ae.value.formField.validate(t=>{if(t){if(ae.value.setFieldForm(),!ae.value.fieldForm.originName.trim()){Ve.error(d("data_set.cannot_be_empty_de_"));return}const e=ee(ae.value.fieldForm),{deType:n,dateFormat:i,deExtractType:r}=e;e.dateFormat=n===1?i:"",e.dateFormatType=n===1?i:"",e.deTypeArr=n===1&&r===0?[n,i]:[n];const u=f.value.findIndex(g=>e.id===g.id);u!==-1?f.value.splice(u,1,e):f.value.push(e),re.value=!1}})},wa=t=>t.map(e=>({key:e.dataeaseName,deType:e.deType,dataKey:e.dataeaseName,title:e.name,width:150,headerCellRenderer:({column:n})=>{let i;return l("div",{class:"flex-align-center"},[l(w,null,{default:()=>[l(y,null,fs(i=Fl($[S[n.deType]],{class:`svg-icon field-icon-${S[n.deType]}`}))?i:{default:()=>[i]})]}),l("span",{class:"ellipsis",title:n.title,style:{width:"120px",marginLeft:"4px"}},[n.title])])}})),Ke=t=>(Ze.value=!0,Ge.datasourceId=le.value,jl({datasourceId:t}).then(e=>{Je=e||[],O.value=[...Je]}).finally(()=>{Ze.value=!1})),Ta=async(t,e)=>{await Ke(t),e&&(Ce.value=e)},xa=async()=>{let{id:t,datasourceId:e,tableName:n}=Oe.query,{id:i}=Oe.params;if(U.getIsDataEaseBi&&(t=te.datasetId,e=te.datasourceId,n=te.tableName,i=te.datasetCopyId||i),i||t){const r=await Pl(i||t);if(!r||!r.id)return}e&&(le.value=e,Ta(e,n)),!(!t&&!i)&&(we.value=!0,Xl(i||t).then(r=>{var N;let u=[];const{id:g,pid:F,name:E}=r||{};H={id:g,pid:F,name:i?d("data_set.copy_a_dataset"):E},i&&(H.id=""),X.value=H.name,f.value=r.allFields||[],Zt(u,r.union||[]);const[_]=r.union;le.value=(N=_==null?void 0:_.currentDs)==null?void 0:N.datasourceId,Ke(le.value),k.value.initState(u)}).finally(()=>{we.value=!1}))},Fa=t=>{R.editArr=ee(t),ce.value=!0,ye(()=>{ke.value.initState()})},Te=rt([]),Qe=rt([]),W=Be(()=>f.value.filter(t=>t.groupType==="q")),Y=Be(()=>f.value.filter(t=>t.groupType==="d")),xt=(t,e)=>{t.forEach(n=>{var i;e[n.id]=n.tableName,(i=n.children)!=null&&i.length&&xt(n.children,e)})},Ft=t=>{t!=="preview"&&(tt(),f.value.forEach(e=>{if(!Array.isArray(e.deTypeArr))e.deTypeArr=e.deType===1&&e.deExtractType===0?[e.deType,e.dateFormatType]:[e.deType];else{const[n]=e.deTypeArr;e.deTypeArr.length&&n!==e.deType&&e.deTypeArr.splice(0,1,e.deType)}}))},et=()=>{var t,e,n;R.nodeNameList=[...k.value.nodeNameList],(t=R.nodeNameList)!=null&&t.length||(Te.value=[],Qe.value=[]),(n=(e=sl)["/datasetData/previewData"])==null||n.call(e),pe.value=!1,tt()},tt=()=>{xt(k.value.getNodeList(),je.value)},R=zt({nodeNameList:[],editArr:[],dataSourceList:[],fieldCollapse:["dimension","quota"]}),O=rt([]),Z=t=>{if(t===1)return"time";if(t===0)return"text";if([2,3,4].includes(t))return"value";if(t===5)return"location";if(t===7)return"url"},f=v([]);kl("allfields",f);let ka=+new Date;const xe=v(!0),Fe=v(!0),kt=(t,e,n,i)=>{t.forEach(r=>{var u;r.id||(r.id=((u=i.find(g=>g.originName===r.originName))==null?void 0:u.id)||`${++ka}`,r.datasetTableId=e,r.datasourceId=n)})},Et=(t,e)=>{e.forEach(n=>{var r;(r=n.children)!=null&&r.length&&Et(t,n.children);const{currentDsFields:i}=n;t.push(...ee(i))})},Nt=(t,e)=>{const n=t.map(i=>i.id);return[...e.filter(i=>i.extField!==2).filter(i=>!n.includes(i.id)),...e.filter(i=>i.extField===2)]},Dt=(t,e)=>{const n=t.map(u=>u.id),i=e.map(u=>u.id),r=t.filter(u=>!i.includes(u.id));return ee([...e.filter(u=>u.extField===2),...r,...e.filter(u=>n.includes(u.id))])},Vt=()=>{Da(),ke.value.clearState(),ce.value=!1},ke=v(),at=()=>{var n;const t=[];Et(t,k.value.getNodeList());const e=Nt(t,f.value);f.value=Dt(t,f.value),wt(e),Ft("manage"),(n=ke.value)==null||n.clearState()},lt=(t,e)=>t.reduce((n,i)=>{var r;return i.id===e?n=[...i.currentDsFields]:(r=i.children)!=null&&r.length&&(n=lt(i.children,e)),n},[]),St=(t,e,n)=>{e.forEach(i=>{var r;if((r=i.children)!=null&&r.length&&St(t,i.children,n),!n.includes(i.id)){const{currentDsFields:u}=i;t.push(...ee(u))}})},Ea=()=>{const{node:t,parent:e}=ke.value,n=t.id,i=e.id;if(t.unionFields.some(j=>{const{currentField:V,parentField:q}=j;return!V||!q})){Ve.error(d("data_set.cannot_be_empty_de_field"));return}const u=lt(k.value.getNodeList(),n),g=lt(k.value.getNodeList(),i);kt(t.currentDsFields,t.id,t.datasourceId,u),kt(e.currentDsFields,e.id,e.datasourceId,g);const F=ee(t),E=ee(e);let _=[];St(_,k.value.getNodeList(),[t.id,e.id]),_=[..._,...t.currentDsFields,...e.currentDsFields];const N=Nt(_,f.value);let M=Dt(_,f.value);const z=fa(N,M);if(z.length){const j=f.value.reduce((V,q)=>(z.includes(q.id)&&(V=[...q.originName.match(/\[(.+?)\]/g).map(he=>he.slice(1,-1)),...V]),V),[]);dt.confirm(d("data_set.field_selection"),{confirmButtonText:d("dataset.confirm"),cancelButtonText:d("common.cancel"),showCancelButton:!0,tip:`${d("data_set.field")}: ${f.value.filter(V=>[...new Set(j)].includes(V.id)&&V.extField!==2).map(V=>V.name).join(",")}, ${d("data_set.confirm_the_deletion")}`,confirmButtonType:"danger",type:"warning",autofocus:!1,showClose:!1,callback:V=>{V==="confirm"&&(k.value.setStateBack(F,E),at(),ce.value=!1,et(),k.value.setChangeStatus(n,i))}});return}k.value.setStateBack(F,E),at(),ce.value=!1,et(),k.value.setChangeStatus(n,i)},Na=()=>{at()},Da=()=>{k.value.notConfirm()},Lt=(t,e)=>{mt.value=t.offsetX,pt.value=t.offsetY,t.dataTransfer.setData("text/plain",JSON.stringify(e)),Ie.value=!0},At=t=>{t.unableCheck||(la.value=t.tableName)},ot=v(!1),Va=()=>{ot.value=!0,document.querySelector("body").style.userSelect="none",document.querySelector(".dataset-db").addEventListener("mousemove",It)},Sa=()=>{ot.value=!1,document.querySelector("body").style.userSelect="auto";const t=document.querySelector(".dataset-db");t.removeEventListener("mousemove",It),t.removeEventListener("mousemove",$t)},qe=Be(()=>{var t;return(t=k.value)==null?void 0:t.crossDatasources}),It=t=>{if(t.pageX<240){oe.value=240;return}if(t.pageX>500){oe.value=500;return}oe.value=t.pageX},La=()=>{document.querySelector(".dataset-db").addEventListener("mousemove",$t)},$t=t=>{const e=document.documentElement.clientHeight;if(t.pageY-56<64){L.value=64,A.value=e-L.value-56;return}if(t.pageY>e-57){L.value=e-113,A.value=e-L.value-56;return}L.value=t.pageY-56,A.value=e-L.value-56,Ae.value=A.value-242},A=v(0),Mt=Yl(()=>{const t=document.documentElement.clientHeight;if(t-A.value-56<64){L.value=64,A.value=t-L.value-56;return}L.value=t-A.value-56},60);let st=!1;const Aa=()=>{st&&$e()};let qt=null;const Ut=()=>qt(!0);Cl(async()=>{await new Promise(t=>qt=t),await xa(),$a(),jt({name:"onDatasetSave",callback:Aa}),window.addEventListener("resize",Mt),Ia(),Ae.value=A.value-242}),bl(()=>{window.removeEventListener("resize",Mt)});const Ia=()=>{A.value=document.querySelector(".sql-result").offsetHeight},$a=()=>{Zl().then(t=>{const e=t||[];e&&e.length>0&&e[0].id==="0"?R.dataSourceList=We(e[0].children):R.dataSourceList=We(e)})},Ht=(t,e)=>{var n;for(let i in t){const r=Re();e[t[i].currentDs.id]=r,t[i].currentDs.id=r,(n=t[i].childrenDs)!=null&&n.length&&Ht(t[i].childrenDs,e)}},Ma=t=>{const e={};for(let n in f.value){const i=Re();e[f.value[n].id]=i,f.value[n].id=i,f.value[n].datasetGroupId=""}return Ht(t,e),e},qa=(t,e)=>{let n=JSON.stringify(t),i=JSON.stringify(El(k.value.getNodeList())),r=JSON.stringify(a(f.value));return Object.entries(e).forEach(([u,g])=>{n=n.replaceAll(u,g),r=r.replaceAll(u,g),i=i.replaceAll(u,g)}),f.value=JSON.parse(r),k.value.initState(JSON.parse(i)),JSON.parse(n)},Bt=()=>{if(H.id){ua();return}let t=[];Ue(t,k.value.getNodeList());const e=U.getIsDataEaseBi?te.datasetPid:Oe.query.pid||H.pid;if(!t.length){Ve.error(d("data_set.dataset_cannot_be"));return}H.pid&&!H.id&&(t=qa(t,Ma(t))),ut.value.createInit("dataset",{id:e||"0",union:t,allfields:f.value},"",X.value)},Ua=()=>{st=!0,Bt()},pe=v(!1),Ha=()=>{if(pe.value)return;const t=[];Ue(t,k.value.getNodeList()),pe.value=!0,zl({union:t,allFields:f.value}).then(e=>{Te.value=wa(e.data.fields||[]),Qe.value=e.data.data||[]}).finally(()=>{pe.value=!1})},Ue=(t,e)=>{e.forEach(n=>{var j;const i=[];(j=n.children)!=null&&j.length&&Ue(i,n.children);const{tableName:r,type:u,datasourceId:g,id:F,info:E,unionType:_,unionFields:N,currentDsFields:M,sqlVariableDetails:z}=n;t.push({currentDs:{sqlVariableDetails:z,tableName:r,type:u,datasourceId:g,id:F,info:E},currentDsFields:M,childrenDs:i,unionToParent:{unionType:_,unionFields:N}})})},se=v(),ne=v(),Ee=v([]),Ne=v([]),fe=v([]),ie=v([]),Ba=Be(()=>!!fe.value.length&&Array.from(new Set(fe.value)).length===1),Ra=()=>{ne.value.clearSelection(),se.value.clearSelection()},K=v([]),Rt=()=>{ie.value=[...ne.value.getSelectionRows(),...se.value.getSelectionRows()],fe.value=ie.value.map(n=>n.deExtractType);let t=ie.value.map(n=>n.deType);const[e]=ie.value;if(ye(()=>{Ee.value=ne.value.getSelectionRows().map(n=>n.id),Ne.value=se.value.getSelectionRows().map(n=>n.id)}),Array.from(new Set(t)).length!==1){K.value=[];return}K.value=e.deType===1&&e.deExtractType===0?[1,e.dateFormatType]:[e.deType]};let He=[];const Oa=t=>{const[e,n]=t;Ee.value=ne.value.getSelectionRows().map(r=>r.id),Ne.value=se.value.getSelectionRows().map(r=>r.id);const i=[...Ne.value,...Ee.value];if(n==="custom"){const[r]=f.value.filter(u=>i.includes(u.id));He=r.deType===1?[1,r.dateFormatType]:[r.deType],T.value.id="",T.value.idArr=[...i],T.value.dateFormat="",T.value.dateFormatType=n,G.value=!0,ve();return}f.value.forEach(r=>{i.includes(r.id)&&(r.deType=e,r.dateFormat=e===1?n:"",r.dateFormatType=e===1?n:"",r.deTypeArr=e===1&&r.deExtractType===0?[e,n]:[e])}),ve()},Za=(t,e)=>{var n;return t?(n=e.name)==null?void 0:n.toLowerCase().includes(t.toLowerCase()):!0},ve=()=>{ye(()=>{W.value.forEach(t=>{Ne.value.includes(t.id)&&se.value.toggleRowSelection(t,!0)}),Y.value.forEach(t=>{Ee.value.includes(t.id)&&ne.value.toggleRowSelection(t,!0)})})},ja=()=>{Ie.value=!1},Ot=(t,e)=>{const[n,i]=e;if(i==="custom"){He=t.deType===1?[1,t.dateFormatType]:[t.deType],T.value.id=t.id,G.value=!0;return}t.deType=n,t.dateFormat=n===1?i:"",t.dateFormatType=n===1?i:""},Zt=(t,e)=>{e.forEach(n=>{var q;const i=[];(q=n.childrenDs)!=null&&q.length&&Zt(i,n.childrenDs);const{unionToParent:r,currentDsFields:u,currentDs:g}=n,{tableName:F,type:E,datasourceId:_,id:N,info:M,sqlVariableDetails:z}=g||{},{unionType:j,unionFields:V}=r||{};t.push({sqlVariableDetails:z,tableName:F,type:E,datasourceId:_,id:N,info:M,currentDsFields:u,children:i,unionType:j,unionFields:V})})},Pa=()=>{be.value=!0,ye(()=>{ft.value.focus()})},Xa=t=>{const{id:e,pid:n,name:i}=t;X.value=i,H={id:e,pid:n,name:i},f.value=t.allFields||[]},_e=v(""),za=()=>{_e.value="",X.value.trim()||(_e.value=d("commons.input_content")),X.value.trim().length<1&&(_e.value=d("datasource.input_limit_1_64",[1,64])),be.value=!!_e.value},Ga={children:"children",label:"name",disabled:t=>{var e;return!((e=t.children)!=null&&e.length)&&!t.leaf||t.extraFlag<0}},De=v([]),Ja=t=>{De.value=t},Wa=t=>{if((De==null?void 0:De.value.length)===0||!t.leaf)return null;const e=De.value.filter(n=>n.type===t.type);return e&&e.length>0?e[0].icon:null},Ya=t=>t.leaf?Wl[t.type]:Vl;return(t,e)=>{const n=nl,i=il,r=Kl,u=hl,g=_l,F=vl,E=fl,_=pl,N=ml,M=ul,z=cl,j=rl,V=dl,q=ll,nt=tl,it=al,he=wl("loading");return m(),C(ct,null,[Q((m(),C("div",no,[c("div",io,[c("span",ro,[l(a(w),{onClick:da},{default:s(()=>[l(a(y),{name:"icon_left_outlined"},{default:s(()=>[l(a(Gt),{class:"svg-icon"})]),_:1})]),_:1}),be.value?(m(),C(ct,{key:0},[l(n,{maxlength:"64",ref_key:"editerName",ref:ft,modelValue:X.value,"onUpdate:modelValue":e[0]||(e[0]=o=>X.value=o),onBlur:za},null,8,["modelValue"]),_e.value?(m(),C("div",co,p(_e.value),1)):P("",!0)],64)):(m(),C("span",{key:1,onClick:Pa,class:"dataset-name ellipsis",style:{"margin-left":"12px"}},p(X.value),1))]),c("span",uo,[l(i,{disabled:be.value,type:"primary",onClick:Ua},{default:s(()=>[b(p(a(d)("data_set.save_and_return")),1)]),_:1},8,["disabled"]),l(i,{disabled:be.value,type:"primary",onClick:Bt},{default:s(()=>[b(p(a(d)("data_set.save")),1)]),_:1},8,["disabled"])])]),c("div",{class:"container dataset-db",onMouseup:Sa},[Q(c("p",{class:"arrow-right",onClick:e[1]||(e[1]=o=>me.value=!0)},[l(a(w),null,{default:s(()=>[l(a(y),{name:"icon_right_outlined"},{default:s(()=>[l(a(Sl),{class:"svg-icon"})]),_:1})]),_:1})],512),[[Se,!me.value]]),Q(c("div",{style:Le({left:oe.value+"px"}),class:D(["drag-left",ot.value&&"is-dragging"]),onMousedown:Va},null,38),[[Se,me.value]]),Q((m(),C("div",{class:"table-list",style:Le({width:oe.value+"px"})},[c("div",mo,[c("p",po,[b(p(a(d)("data_set.select_data_source"))+" ",1),c("span",fo,[l(a(w),{style:{color:"#1f2329"},onClick:e[2]||(e[2]=o=>me.value=!1)},{default:s(()=>[l(a(y),{name:"icon_left_outlined"},{default:s(()=>[l(a(Gt),{class:"svg-icon"})]),_:1})]),_:1})])]),l(u,{"check-strictly":!1,onChange:Ke,placeholder:a(d)("dataset.pls_slc_data_source"),class:"ds-list","filter-node-method":Za,filterable:"","popper-class":"tree-select-ds_popper",modelValue:le.value,"onUpdate:modelValue":e[3]||(e[3]=o=>le.value=o),"node-key":"id",props:Ga,data:R.dataSourceList,"render-after-expand":!1},{default:s(({data:{name:o,leaf:h,type:ge,extraFlag:Ka}})=>[c("div",vo,[l(a(w),null,{default:s(()=>[l(a(y),{"static-content":Wa({leaf:h,type:ge})},{default:s(()=>[(m(),x(I(Ya({leaf:h,type:ge})),{class:"svg-icon"}))]),_:2},1032,["static-content"])]),_:2},1024),!h||Ka>-1?(m(),C("span",_o,p(o),1)):(m(),x(r,{key:1,effect:"dark",content:`${a(d)("data_set.invalid_data_source")}:${o}`,placement:"top"},{default:s(()=>[c("span",null,p(o),1)]),_:2},1032,["content"]))])]),_:1},8,["placeholder","modelValue","data"]),c("p",ho,[b(p(a(d)("datasource.data_table"))+" ",1),c("span",go,[l(a(w),{class:"icon-color"},{default:s(()=>[l(a(y),{name:"reference-table"},{default:s(()=>[l(a(Xt),{class:"svg-icon"})]),_:1})]),_:1}),b(" "+p(O.value.length),1)])]),l(n,{modelValue:Ce.value,"onUpdate:modelValue":e[4]||(e[4]=o=>Ce.value=o),class:"search",placeholder:a(d)("deDataset.by_table_name"),clearable:""},{prefix:s(()=>[l(a(w),null,{default:s(()=>[l(a(y),{name:"icon_search-outline_outlined"},{default:s(()=>[l(a(Ll),{class:"svg-icon"})]),_:1})]),_:1})]),_:1},8,["modelValue","placeholder"])]),!O.value.length&&Ce.value!==""?(m(),C("div",yo,[c("div",Co,p(a(d)("data_set.relevant_content_found")),1)])):(m(),C("div",bo,[le.value?(m(),C("div",{key:0,class:"list-item_primary",onDragstart:e[5]||(e[5]=o=>Lt(o,Ge)),onDragend:ja,draggable:!0,onClick:e[6]||(e[6]=o=>At(Ge))},[l(a(w),{class:"icon-color"},{default:s(()=>[l(a(y),{name:"icon_sql_outlined_1"},{default:s(()=>[l(a(ao),{class:"svg-icon"})]),_:1})]),_:1}),c("span",wo,p(a(d)("data_set.custom_sql")),1)],32)):P("",!0),l(a($l),{itemSize:40,data:O.value,total:O.value.length,width:oe.value-17,height:a(na)-305,scrollbarAlwaysOn:!1,"class-name":"el-select-dropdown__list",layout:"vertical"},{default:s(({index:o,style:h})=>[c("div",{class:"list-item_primary",style:Le(h),title:O.value[o].tableName,onDragstart:ge=>Lt(ge,O.value[o]),onDragend:e[7]||(e[7]=ge=>Ie.value=!1),draggable:!0,onClick:ge=>At(O.value[o])},[l(a(w),{class:"icon-color"},{default:s(()=>[l(a(y),{name:"reference-table"},{default:s(()=>[l(a(Xt),{class:"svg-icon"})]),_:1})]),_:1}),c("span",xo,p(O.value[o].tableName),1)],44,To)]),_:1},8,["data","total","width","height"])]))],4)),[[he,Ze.value],[Se,me.value]]),c("div",{class:"drag-right",style:Le({width:`calc(100vw - ${me.value?oe.value:0}px)`})},[qe.value?(m(),C("div",Fo,[l(a(w),null,{default:s(()=>[l(a(y),{name:"icon_warning_colorful"},{default:s(()=>[l(a(so),{class:"svg-icon"})]),_:1})]),_:1}),b(" "+p(a(d)("data_set.be_reported_incorrectly")),1)])):P("",!0),l(Jl,{onReGetName:tt,onJoinEditor:Fa,onChangeUpdate:_t,maskShow:Ie.value,dragHeight:L.value,getDsName:ia,offsetX:mt.value,offsetY:pt.value,ref_key:"datasetDrag",ref:k,onUpdateAllfields:Na,onAddComplete:et},null,8,["maskShow","dragHeight","offsetX","offsetY"]),c("div",{class:"sql-result",style:Le({height:A.value?`${qe.value?A.value-40:A.value}px`:`calc(100% - ${qe.value?L.value+40:L.value}px)`})},[c("div",ko,[c("span",{class:"drag",onMousedown:La},null,32),c("div",Eo,[l(i,{disabled:!f.value.length,onClick:e[8]||(e[8]=o=>_a("q")),secondary:""},{icon:s(()=>[l(a(w),null,{default:s(()=>[l(a(y),{name:"icon_add_outlined"},{default:s(()=>[l(a(Al),{class:"svg-icon"})]),_:1})]),_:1})]),default:s(()=>[b(" "+p(a(d)("dataset.add_calc_field")),1)]),_:1},8,["disabled"]),Q((m(),x(i,{style:{"min-width":"70px"},disabled:!f.value.length,onClick:Ha,secondary:""},{icon:s(()=>[l(a(w),null,{default:s(()=>[l(a(y),{name:"icon_refresh_outlined"},{default:s(()=>[l(a(Il),{class:"svg-icon"})]),_:1})]),_:1})]),default:s(()=>[b(" "+p(a(d)("data_set.refresh_data")),1)]),_:1},8,["disabled"])),[[he,pe.value]])])]),l(F,{class:"padding-24",modelValue:ue.value,"onUpdate:modelValue":e[9]||(e[9]=o=>ue.value=o),onTabChange:Ft},{default:s(()=>[l(g,{label:a(d)("chart.data_preview"),name:"preview"},null,8,["label"]),l(g,{label:a(d)("dataset.batch_manage"),name:"manage"},null,8,["label"])]),_:1},8,["modelValue"]),Q(c("div",No,[c("div",Do,[c("div",{class:D(["field-d",{open:xe.value}])},[c("div",{class:D(["title",{expanded:xe.value}]),onClick:e[10]||(e[10]=o=>xe.value=!xe.value)},[l(a(w),{class:"expand"},{default:s(()=>[l(a(y),{name:"icon_expand-right_filled"},{default:s(()=>[l(a(Jt),{class:"svg-icon"})]),_:1})]),_:1}),b("  "+p(a(d)("chart.dimension")),1)],2),xe.value?(m(),x(E,{key:0,data:Y.value,props:yt},{default:s(({data:o})=>[c("span",Vo,[l(a(w),null,{default:s(()=>[l(a(y),null,{default:s(()=>[(m(),x(I(a($)[a(S)[o.deType]]),{class:D(["svg-icon",`field-icon-${a(S)[[2,3].includes(o.deType)?2:0]}`])},null,8,["class"]))]),_:2},1024)]),_:2},1024),c("span",{title:o.name,class:"label-tooltip"},p(o.name),9,So),c("div",Lo,[l(Wt,{extField:o.extField,"trans-type":a(d)("data_set.convert_to_indicator"),"show-time":o.deExtractType===0,onHandleCommand:h=>B(o,h)},null,8,["extField","trans-type","show-time","onHandleCommand"])])])]),_:1},8,["data"])):P("",!0)],2),c("div",{class:D(["field-q",{open:Fe.value}])},[c("div",{class:D(["title",{expanded:Fe.value}]),onClick:e[11]||(e[11]=o=>Fe.value=!Fe.value)},[l(a(w),{class:"expand"},{default:s(()=>[l(a(y),{name:"icon_expand-right_filled"},{default:s(()=>[l(a(Jt),{class:"svg-icon"})]),_:1})]),_:1}),b("  "+p(a(d)("chart.quota")),1)],2),Fe.value?(m(),x(E,{key:0,data:W.value,props:yt},{default:s(({data:o})=>[c("span",Ao,[l(a(w),null,{default:s(()=>[l(a(y),null,{default:s(()=>[(m(),x(I(a($)[a(S)[o.deType]]),{class:D(["svg-icon",`field-icon-${a(S)[[2,3].includes(o.deType)?2:0]}`])},null,8,["class"]))]),_:2},1024)]),_:2},1024),c("span",{title:o.name,class:"label-tooltip"},p(o.name),9,Io),c("div",$o,[l(Wt,{"trans-type":a(d)("data_set.convert_to_dimension"),typeColor:"green-color","show-time":o.deExtractType===0,extField:o.extField,onHandleCommand:h=>B(o,h)},null,8,["trans-type","show-time","extField","onHandleCommand"])])])]),_:1},8,["data"])):P("",!0)],2)]),c("div",Mo,[Q((m(),x(N,{"header-class":"header-cell",data:Qe.value,border:"",style:{width:"100%",height:"100%"}},{empty:s(()=>[l(Ml,{description:a(d)("data_set.no_data"),"img-type":"noneWhite"},null,8,["description"])]),default:s(()=>[(m(!0),C(ct,null,Nl(Te.value,(o,h)=>(m(),x(_,{key:o.dataKey+o.deType,prop:o.dataKey,label:o.title,width:Te.value.length-1===h?150:"auto",fixed:Te.value.length-1===h?"right":!1},{header:s(()=>[c("div",qo,[l(a(w),{style:{"margin-right":"6px"}},{default:s(()=>[l(a(y),null,{default:s(()=>[(m(),x(I(a($)[a(S)[o.deType]]),{class:D(["svg-icon",`field-icon-${a(S)[[2,3].includes(o.deType)?2:0]}`])},null,8,["class"]))]),_:2},1024)]),_:2},1024),c("span",{class:"ellipsis",title:o.title,style:{width:"120px"}},p(o.title),9,Uo)])]),_:2},1032,["prop","label","width","fixed"]))),128))]),_:1},8,["data"])),[[he,pe.value]])])],512),[[Se,ue.value==="preview"&&!!f.value.length]]),Q(c("div",Ho,[c("div",Bo,[l(j,{modelValue:R.fieldCollapse,"onUpdate:modelValue":e[12]||(e[12]=o=>R.fieldCollapse=o),class:"style-collapse"},{default:s(()=>[l(z,{name:"dimension",title:a(d)("chart.dimension"),class:"dimension-manage-header manage-header"},{default:s(()=>[l(N,{onSelectionChange:Rt,ref_key:"dimensionsTable",ref:ne,data:Y.value,height:Ae.value,style:{width:"100%"}},{default:s(()=>[l(_,{type:"selection",width:"40"}),l(_,{prop:"name",label:a(d)("dataset.field_name"),width:"264"},{default:s(o=>[c("div",Ro,[l(n,{modelValue:o.row.name,"onUpdate:modelValue":h=>o.row.name=h,placeholder:a(d)("commons.input_content")},null,8,["modelValue","onUpdate:modelValue","placeholder"])])]),_:1},8,["label"]),l(_,{prop:"originName",label:a(d)("dataset.origin_name"),width:"240"},{default:s(o=>[c("div",Oo,[o.row.extField===0?(m(),C("span",Zo,p(o.row.originName),1)):(m(),C("span",jo,p(a(d)("dataset.calc_field")),1))])]),_:1},8,["label"]),l(_,{prop:"description",label:a(d)("deDataset.description"),width:"240"},{default:s(o=>[c("div",Po,[o.row.extField===0?(m(),C("span",Xo,p(o.row.description),1)):(m(),C("span",zo," "))])]),_:1},8,["label"]),l(_,{prop:"datasetTableId",label:a(d)("data_set.table_name_de"),width:"240"},{default:s(o=>[b(p(o.row.extField===0?je.value[o.row.datasetTableId]:""),1)]),_:1},8,["label"]),l(_,{prop:"deType",label:a(d)("dataset.field_type"),width:"200"},{default:s(o=>[l(M,{class:D(!!o.row.deTypeArr&&!!o.row.deTypeArr.length&&"select-type"),"popper-class":"cascader-panel",modelValue:o.row.deTypeArr,"onUpdate:modelValue":h=>o.row.deTypeArr=h,onChange:h=>Ot(o.row,h),options:o.row.deExtractType===0?Xe:ze},{default:s(({data:h})=>[l(a(w),null,{default:s(()=>[l(a(y),null,{default:s(()=>[(m(),x(I(a($)[Z(h.value)]),{class:D(["svg-icon",`field-icon-${a(S)[[2,3].includes(h.value)?2:0]}`])},null,8,["class"]))]),_:2},1024)]),_:2},1024),c("span",null,p(h.label),1)]),_:2},1032,["class","modelValue","onUpdate:modelValue","onChange","options"]),c("span",Go,[l(a(w),null,{default:s(()=>[l(a(y),null,{default:s(()=>[(m(),x(I(a($)[Z(o.row.deType)]),{class:D(["svg-icon",`field-icon-${a(S)[[2,3].includes(o.row.deType)?2:0]}`])},null,8,["class"]))]),_:2},1024)]),_:2},1024)])]),_:1},8,["label"]),l(_,{prop:"deExtraType",label:a(d)("dataset.origin_type"),width:"168"},{default:s(o=>[c("div",Jo,[o.row.extField===0?(m(),C("span",Wo,[l(a(w),null,{default:s(()=>[l(a(y),{className:"primary-color"},{default:s(()=>[(m(),x(I(a($)[Z(o.row.deExtractType)]),{class:"svg-icon primary-color"}))]),_:2},1024)]),_:2},1024),b(" "+p(vt(o.row.deExtractType)),1)])):(m(),C("span",Yo,p(a(d)("dataset.calc_field")),1))])]),_:1},8,["label"]),l(_,{fixed:"right",label:a(d)("chart.dimension")},{default:s(o=>[l(r,{effect:"dark",content:a(d)("data_set.convert_to_indicator"),placement:"top"},{default:s(()=>[l(i,{text:"",onClick:h=>B(o.row,"translate")},{icon:s(()=>[l(a(y),{name:"icon_switch_outlined"},{default:s(()=>[l(a(Yt),{class:"svg-icon"})]),_:1})]),_:2},1032,["onClick"])]),_:2},1032,["content"])]),_:1},8,["label"]),l(_,{fixed:"right",width:"168",label:a(d)("dataset.operator")},{default:s(o=>[l(r,{effect:"dark",content:a(d)("dataset.copy"),placement:"top"},{default:s(()=>[l(i,{text:"",onClick:h=>B(o.row,"copy")},{icon:s(()=>[l(a(y),{name:"icon_copy_outlined"},{default:s(()=>[l(a(Kt),{class:"svg-icon"})]),_:1})]),_:2},1032,["onClick"])]),_:2},1032,["content"]),l(r,{effect:"dark",content:a(d)("dataset.delete"),placement:"top"},{default:s(()=>[l(i,{text:"",onClick:h=>B(o.row,"delete")},{icon:s(()=>[l(a(y),{name:"icon_delete-trash_outlined"},{default:s(()=>[l(a(Qt),{class:"svg-icon"})]),_:1})]),_:2},1032,["onClick"])]),_:2},1032,["content"]),l(r,{effect:"dark",content:a(d)("dataset.edit"),placement:"top"},{default:s(()=>[o.row.extField===2?(m(),x(i,{key:0,text:"",onClick:h=>B(o.row,"editor")},{icon:s(()=>[l(a(y),{name:"icon_edit_outlined"},{default:s(()=>[l(a(ea),{class:"svg-icon"})]),_:1})]),_:2},1032,["onClick"])):P("",!0)]),_:2},1032,["content"])]),_:1},8,["label"])]),_:1},8,["data","height"])]),_:1},8,["title"]),l(z,{name:"quota",title:a(d)("chart.quota"),class:"quota-manage-header manage-header"},{default:s(()=>[l(N,{onSelectionChange:Rt,ref_key:"quotaTable",ref:se,height:Ae.value,data:W.value,style:{width:"100%"}},{default:s(()=>[l(_,{type:"selection",width:"40"}),l(_,{prop:"name",label:a(d)("dataset.field_name"),width:"264"},{default:s(o=>[c("div",Ko,[l(n,{modelValue:o.row.name,"onUpdate:modelValue":h=>o.row.name=h,placeholder:a(d)("commons.input_content")},null,8,["modelValue","onUpdate:modelValue","placeholder"])])]),_:1},8,["label"]),l(_,{prop:"originName",label:a(d)("dataset.origin_name"),width:"240"},{default:s(o=>[c("div",Qo,[o.row.extField===0?(m(),C("span",es,p(o.row.originName),1)):(m(),C("span",ts,p(a(d)("dataset.calc_field")),1))])]),_:1},8,["label"]),l(_,{prop:"description",label:a(d)("deDataset.description"),width:"240"},{default:s(o=>[c("div",as,[o.row.extField===0?(m(),C("span",ls,p(o.row.description),1)):(m(),C("span",os," "))])]),_:1},8,["label"]),l(_,{prop:"datasetTableId",label:a(d)("data_set.table_name_de"),width:"240"},{default:s(o=>[b(p(o.row.extField===0?je.value[o.row.datasetTableId]:""),1)]),_:1},8,["label"]),l(_,{prop:"deType",label:a(d)("dataset.field_type"),width:"200"},{default:s(o=>[l(M,{class:D(!!o.row.deTypeArr&&!!o.row.deTypeArr.length&&"select-type"),"popper-class":"cascader-panel",modelValue:o.row.deTypeArr,"onUpdate:modelValue":h=>o.row.deTypeArr=h,onChange:h=>Ot(o.row,h),options:o.row.deExtractType===0?Xe:ze},{default:s(({data:h})=>[l(a(w),null,{default:s(()=>[l(a(y),null,{default:s(()=>[(m(),x(I(a($)[Z(h.value)]),{class:D(["svg-icon",`field-icon-${a(S)[[2,3].includes(h.value)?2:0]}`])},null,8,["class"]))]),_:2},1024)]),_:2},1024),c("span",null,p(h.label),1)]),_:2},1032,["class","modelValue","onUpdate:modelValue","onChange","options"]),c("span",ss,[l(a(w),null,{default:s(()=>[l(a(y),null,{default:s(()=>[(m(),x(I(a($)[Z(o.row.deType)]),{class:D(["svg-icon",`field-icon-${a(S)[[2,3].includes(o.row.deType)?2:0]}`])},null,8,["class"]))]),_:2},1024)]),_:2},1024)])]),_:1},8,["label"]),l(_,{prop:"deExtraType",label:a(d)("dataset.origin_type"),width:"168"},{default:s(o=>[c("div",ns,[o.row.extField===0?(m(),C("span",is,[l(a(w),null,{default:s(()=>[l(a(y),{className:"green-color"},{default:s(()=>[(m(),x(I(a($)[Z(o.row.deExtractType)]),{class:"svg-icon green-color"}))]),_:2},1024)]),_:2},1024),b(" "+p(vt(o.row.deExtractType)),1)])):(m(),C("span",ds,p(a(d)("dataset.calc_field")),1))])]),_:1},8,["label"]),l(_,{fixed:"right",label:a(d)("chart.quota")},{default:s(o=>[l(r,{effect:"dark",content:a(d)("data_set.convert_to_dimension"),placement:"top"},{default:s(()=>[l(i,{text:"",onClick:h=>B(o.row,"translate")},{icon:s(()=>[l(a(y),{name:"icon_switch_outlined"},{default:s(()=>[l(a(Yt),{class:"svg-icon"})]),_:1})]),_:2},1032,["onClick"])]),_:2},1032,["content"])]),_:1},8,["label"]),l(_,{fixed:"right",width:"168",label:a(d)("dataset.operator")},{default:s(o=>[l(r,{effect:"dark",content:a(d)("dataset.copy"),placement:"top"},{default:s(()=>[l(i,{text:"",onClick:h=>B(o.row,"copy")},{icon:s(()=>[l(a(y),{name:"icon_copy_outlined"},{default:s(()=>[l(a(Kt),{class:"svg-icon"})]),_:1})]),_:2},1032,["onClick"])]),_:2},1032,["content"]),l(r,{effect:"dark",content:a(d)("dataset.delete"),placement:"top"},{default:s(()=>[l(i,{text:"",onClick:h=>B(o.row,"delete")},{icon:s(()=>[l(a(y),{name:"icon_delete-trash_outlined"},{default:s(()=>[l(a(Qt),{class:"svg-icon"})]),_:1})]),_:2},1032,["onClick"])]),_:2},1032,["content"]),l(r,{effect:"dark",content:a(d)("dataset.edit"),placement:"top"},{default:s(()=>[o.row.extField===2?(m(),x(i,{key:0,text:"",onClick:h=>B(o.row,"editor")},{icon:s(()=>[l(a(y),{name:"icon_edit_outlined"},{default:s(()=>[l(a(ea),{class:"svg-icon"})]),_:1})]),_:2},1032,["onClick"])):P("",!0)]),_:2},1032,["content"])]),_:1},8,["label"])]),_:1},8,["height","data"])]),_:1},8,["title"])]),_:1},8,["modelValue"])]),fe.value.length?(m(),C("div",rs,[c("div",cs,[b(p(a(d)("data_set.selected"))+" ",1),c("span",us,p(fe.value.length),1),b(" "+p(a(d)("data_set.bar"))+" ",1),l(i,{onClick:Ra,text:"",style:{"margin-left":"16px"}},{default:s(()=>[b(p(a(d)("commons.clear")),1)]),_:1})]),Ba.value?(m(),C("div",ms,[l(M,{class:D(!!K.value.length&&"select-type"),modelValue:K.value,"onUpdate:modelValue":e[13]||(e[13]=o=>K.value=o),onChange:Oa,"popper-class":"cascader-panel",options:fe.value.every(o=>o===0)?Xe:ze},{default:s(({data:o})=>[l(a(w),null,{default:s(()=>[l(a(y),null,{default:s(()=>[(m(),x(I(a($)[Z(o.value)]),{class:D(["svg-icon",`field-icon-${a(S)[[2,3].includes(o.value)?2:0]}`])},null,8,["class"]))]),_:2},1024)]),_:2},1024),c("span",null,p(o.label),1)]),_:1},8,["class","modelValue","options"]),c("span",ps,[l(a(w),null,{default:s(()=>[l(a(y),{className:`field-icon-${Z(K.value[0])}`},{default:s(()=>[(m(),x(I(a($)[Z(K.value[0])]),{class:D(["svg-icon",`field-icon-${Z(K.value[0])}`])},null,8,["class"]))]),_:1},8,["className"])]),_:1})])])):P("",!0),ie.value.every(o=>o.groupType==="d")?(m(),x(i,{key:1,onClick:e[14]||(e[14]=o=>bt("q")),plain:"",style:{"margin-left":"200px"}},{default:s(()=>[b(p(a(d)("data_set.convert_to_indicator")),1)]),_:1})):ie.value.every(o=>o.groupType==="q")?(m(),x(i,{key:2,onClick:e[15]||(e[15]=o=>bt("d")),plain:"",style:{"margin-left":"200px"}},{default:s(()=>[b(p(a(d)("data_set.convert_to_dimension")),1)]),_:1})):P("",!0)])):P("",!0)],512),[[Se,ue.value!=="preview"&&!!f.value.length]])],4)],4)],32),l(V,{title:a(d)("dataset.edit_union_relation"),modelValue:ce.value,"onUpdate:modelValue":e[16]||(e[16]=o=>ce.value=o),"custom-class":"union-dataset-drawer",size:"840px","before-close":Vt,direction:"rtl"},{footer:s(()=>[l(i,{secondary:"",onClick:Vt},{default:s(()=>[b(p(a(d)("dataset.cancel")),1)]),_:1}),l(i,{type:"primary",onClick:Ea},{default:s(()=>[b(p(a(d)("dataset.confirm")),1)]),_:1})]),default:s(()=>[l(Ul,{ref_key:"fieldUnion",ref:ke,editArr:R.editArr},null,8,["editArr"])]),_:1},8,["title","modelValue"])])),[[he,we.value]]),l(Hl,{onFinish:Xa,ref_key:"creatDsFolder",ref:ut},null,512),l(q,{"custom-class":"calc-field-edit-dialog",modelValue:re.value,"onUpdate:modelValue":e[19]||(e[19]=o=>re.value=o),width:"1000px",title:Ye.value},{footer:s(()=>[l(i,{secondary:"",onClick:e[17]||(e[17]=o=>Ca())},{default:s(()=>[b(p(a(d)("dataset.cancel")),1)]),_:1}),l(i,{type:"primary",onClick:e[18]||(e[18]=o=>ba())},{default:s(()=>[b(p(a(d)("dataset.confirm")),1)]),_:1})]),default:s(()=>[l(ql,{ref_key:"calcEdit",ref:ae,crossDs:qe.value},null,8,["crossDs"])]),_:1},8,["modelValue","title"]),l(q,{class:"create-dialog",title:a(d)("data_set.format_edit"),modelValue:G.value,"onUpdate:modelValue":e[23]||(e[23]=o=>G.value=o),width:"1000px"},{footer:s(()=>[l(i,{secondary:"",onClick:e[21]||(e[21]=o=>ra())},{default:s(()=>[b(p(a(d)("dataset.cancel")),1)]),_:1}),l(i,{type:"primary",onClick:e[22]||(e[22]=o=>ca())},{default:s(()=>[b(p(a(d)("dataset.confirm")),1)]),_:1})]),default:s(()=>[l(it,{ref_key:"ruleFormRef",ref:ht,rules:oa,model:T.value,"label-width":"120px"},{default:s(()=>[l(nt,{prop:"name",label:a(d)("data_set.custom_time_format")},{default:s(()=>[l(n,{modelValue:T.value.name,"onUpdate:modelValue":e[20]||(e[20]=o=>T.value.name=o)},null,8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["title","modelValue"]),l(q,{class:"create-dialog",title:a(d)("datasource.field_rename"),modelValue:Me.value,"onUpdate:modelValue":e[27]||(e[27]=o=>Me.value=o),width:"420px"},{footer:s(()=>[l(i,{secondary:"",onClick:e[25]||(e[25]=o=>Tt())},{default:s(()=>[b(p(a(d)("dataset.cancel")),1)]),_:1}),l(i,{type:"primary",onClick:e[26]||(e[26]=o=>ya())},{default:s(()=>[b(p(a(d)("dataset.confirm")),1)]),_:1})]),default:s(()=>[l(it,{ref_key:"ruleFormFieldRef",ref:gt,rules:sa,model:J.value,"require-asterisk-position":"right","label-position":"top","label-width":"120px"},{default:s(()=>[l(nt,{prop:"name",label:a(d)("dataset.field_name")},{default:s(()=>[l(n,{modelValue:J.value.name,"onUpdate:modelValue":e[24]||(e[24]=o=>J.value.name=o)},null,8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["title","modelValue"]),l(a(Pt),{jsname:"L2NvbXBvbmVudC9lbWJlZGRlZC1pZnJhbWUvTmV3V2luZG93SGFuZGxlcg==",onLoaded:Ut,onLoadFail:Ut}),l(a(Pt),{jsname:"L2NvbXBvbmVudC9wbHVnaW5zLWhhbmRsZXIvRHNDYXRlZ29yeUhhbmRsZXI=",onLoadDsPlugin:Ja})],64)}}});const si=Ql(vs,[["__scopeId","data-v-715c729c"]]);export{si as default};
