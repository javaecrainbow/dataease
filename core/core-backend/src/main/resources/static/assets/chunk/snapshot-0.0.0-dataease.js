import{ai as f,a3 as d}from"./vue-0.0.0-dataease.js";import{a as m,aa as u,u as c}from"./index-0.0.0-dataease.js";import{d as I}from"./dvMain-0.0.0-dataease.js";import{J as s}from"./index-0.0.0-dataease2.js";import{B as w}from"./dataVisualization-0.0.0-dataease2.js";import{e as v}from"./eventBus-0.0.0-dataease.js";const{wsCache:V}=m("localStorage"),t=I(),{dvInfo:p,curComponent:o,componentData:S,canvasStyleData:T,canvasViewInfo:D,curOriginThemes:g,dataPrepareState:r,nowPanelTrackInfo:y,nowPanelJumpInfo:x,mobileInPc:l}=f(t);let P={componentData:[],canvasStyleData:s(w[g.value]),canvasViewInfo:{},cacheViewIdInfo:{snapshotCacheViewCalc:[],snapshotCacheViewRender:[]}};const R=d("snapshot",{state:()=>({styleChangeTimes:-1,cacheStyleChangeTimes:0,snapshotCacheTimes:0,cacheViewIdInfo:{snapshotCacheViewCalc:[],snapshotCacheViewRender:[]},snapshotData:[],snapshotIndex:-1}),actions:{snapshotCatchToStore(){this.snapshotCacheTimes&&this.recordSnapshot("snapshotCatchToStore")},recordSnapshotCacheToMobile(e,a=o.value,n=null){l.value&&a&&c().emitter.emit("onMobileStatusChange",{type:"componentStyleChange",value:{type:e,component:JSON.parse(JSON.stringify(a)),otherComponent:n}}),this.recordSnapshotCache(e)},recordSnapshotCache(e,a="all"){r.value&&(e==="calcData"?this.cacheViewIdInfo.snapshotCacheViewCalc.push(a):e==="renderChart"&&this.cacheViewIdInfo.snapshotCacheViewRender.push(a),this.snapshotCacheTimes++)},undo(){if(this.snapshotIndex>0){this.snapshotIndex--;const e=s(this.snapshotData[this.snapshotIndex])||J();this.snapshotPublish(e),this.styleChangeTimes++}},redo(){if(this.snapshotIndex<this.snapshotData.length-1){this.snapshotIndex++;const e=s(this.snapshotData[this.snapshotIndex]);this.snapshotPublish(e),this.styleChangeTimes++}},snapshotPublish(e){t.setComponentData(e.componentData),t.setCanvasStyle(e.canvasStyleData),t.setCanvasViewInfo(e.canvasViewInfo),t.setNowPanelJumpInfoInner(e.nowPanelJumpInfo),t.setNowPanelTrackInfo(e.nowPanelTrackInfo),t.updateCurDvInfo(e.dvInfo);const a=s(this.cacheViewIdInfo);if(this.cacheViewIdInfo=e.cacheViewIdInfo,o.value){let h=!1;e.componentData.forEach((i,C)=>{o.value.id===i.id&&(h=!0,t.setCurComponent({component:i,index:C}))}),(!h||o.value.innerType&&o.value.innerType==="rich-text")&&t.setCurComponent({component:null,index:null})}const n={snapshotCacheViewCalc:[...a.snapshotCacheViewCalc,...this.cacheViewIdInfo.snapshotCacheViewCalc],snapshotCacheViewRender:[...a.snapshotCacheViewRender,...this.cacheViewIdInfo.snapshotCacheViewRender],canvasViewInfo:e.canvasViewInfo};v.emit("snapshotChange"),(n.snapshotCacheViewCalc.length>0||n.snapshotCacheViewRender.length>0)&&c().emitter.emit("snapshotChangeToView",n)},resetStyleChangeTimes(){this.styleChangeTimes=0},resetSnapshot(){this.styleChangeTimes=-1,this.cacheStyleChangeTimes=0,this.snapshotCacheTimes=0,this.cacheViewIdInfo={snapshotCacheViewCalc:[],snapshotCacheViewRender:[]},this.snapshotData=[],this.snapshotIndex=-1,this.recordSnapshot()},recordSnapshot(){if(r.value&&!l.value){this.styleChangeTimes=++this.styleChangeTimes;const e=s(S.value);t.removeGroupArea(e);const a={componentData:e,canvasStyleData:s(T.value),canvasViewInfo:s(D.value),cacheViewIdInfo:s(this.cacheViewIdInfo),nowPanelTrackInfo:s(y.value),nowPanelJumpInfo:s(x.value),dvInfo:s(p.value)};this.snapshotData[++this.snapshotIndex]=a,this.snapshotIndex<this.snapshotData.length-1&&(this.snapshotData=this.snapshotData.slice(0,this.snapshotIndex+1)),this.snapshotCacheTimes=0,this.snapshotData.length>1&&V.set("DE-DV-CATCH-"+p.value.id,a)}}}});function J(){return P}const A=()=>R(u);export{A as s};
